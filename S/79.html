<html>
<head>
<title>src/t_string.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/401.html'>src</a>/t_string.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L37'>[^]</a><a href='#L390'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L37' title='Defined at 37.'>checkStringLength</a>
<li><a href='#L45' title='Defined at 45.'>setGenericCommand</a>
<li><a href='#L68' title='Defined at 68.'>setCommand</a>
<li><a href='#L73' title='Defined at 73.'>setnxCommand</a>
<li><a href='#L78' title='Defined at 78.'>setexCommand</a>
<li><a href='#L83' title='Defined at 83.'>psetexCommand</a>
<li><a href='#L88' title='Defined at 88.'>getGenericCommand</a>
<li><a href='#L103' title='Defined at 103.'>getCommand</a>
<li><a href='#L107' title='Defined at 107.'>getsetCommand</a>
<li><a href='#L114' title='Defined at 114.'>setrangeCommand</a>
<li><a href='#L177' title='Defined at 177.'>getrangeCommand</a>
<li><a href='#L214' title='Defined at 214.'>mgetCommand</a>
<li><a href='#L232' title='Defined at 232.'>msetGenericCommand</a>
<li><a href='#L261' title='Defined at 261.'>msetCommand</a>
<li><a href='#L265' title='Defined at 265.'>msetnxCommand</a>
<li><a href='#L269' title='Defined at 269.'>incrDecrCommand</a>
<li><a href='#L296' title='Defined at 296.'>incrCommand</a>
<li><a href='#L300' title='Defined at 300.'>decrCommand</a>
<li><a href='#L304' title='Defined at 304.'>incrbyCommand</a>
<li><a href='#L311' title='Defined at 311.'>decrbyCommand</a>
<li><a href='#L318' title='Defined at 318.'>incrbyfloatCommand</a>
<li><a href='#L351' title='Defined at 351.'>appendCommand</a>
<li><a href='#L390' title='Defined at 390.'>strlenCommand</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'> * Copyright (c) 2009-2012, Salvatore Sanfilippo &lt;antirez at gmail dot com&gt;</font></i>
<a name='L3'><i><font color='green'> * All rights reserved.</font></i>
<a name='L4'><i><font color='green'> *</font></i>
<a name='L5'><i><font color='green'> * Redistribution and use in source and binary forms, with or without</font></i>
<a name='L6'><i><font color='green'> * modification, are permitted provided that the following conditions are met:</font></i>
<a name='L7'><i><font color='green'> *</font></i>
<a name='L8'><i><font color='green'> *   * Redistributions of source code must retain the above copyright notice,</font></i>
<a name='L9'><i><font color='green'> *     this list of conditions and the following disclaimer.</font></i>
<a name='L10'><i><font color='green'> *   * Redistributions in binary form must reproduce the above copyright</font></i>
<a name='L11'><i><font color='green'> *     notice, this list of conditions and the following disclaimer in the</font></i>
<a name='L12'><i><font color='green'> *     documentation and/or other materials provided with the distribution.</font></i>
<a name='L13'><i><font color='green'> *   * Neither the name of Redis nor the names of its contributors may be used</font></i>
<a name='L14'><i><font color='green'> *     to endorse or promote products derived from this software without</font></i>
<a name='L15'><i><font color='green'> *     specific prior written permission.</font></i>
<a name='L16'><i><font color='green'> *</font></i>
<a name='L17'><i><font color='green'> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</font></i>
<a name='L18'><i><font color='green'> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</font></i>
<a name='L19'><i><font color='green'> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</font></i>
<a name='L20'><i><font color='green'> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</font></i>
<a name='L21'><i><font color='green'> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</font></i>
<a name='L22'><i><font color='green'> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</font></i>
<a name='L23'><i><font color='green'> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</font></i>
<a name='L24'><i><font color='green'> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</font></i>
<a name='L25'><i><font color='green'> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</font></i>
<a name='L26'><i><font color='green'> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</font></i>
<a name='L27'><i><font color='green'> * POSSIBILITY OF SUCH DAMAGE.</font></i>
<a name='L28'><i><font color='green'> */</font></i>
<a name='L29'>
<a name='L30'><font color='darkred'>#include</font> "<a href='32.html'>redis.h</a>"
<a name='L31'><font color='darkred'>#include</font> &lt;math.h&gt; <i><font color='green'>/* isnan(), isinf() */</font></i>
<a name='L32'>
<a name='L33'><i><font color='green'>/*-----------------------------------------------------------------------------</font></i>
<a name='L34'><i><font color='green'> * String Commands</font></i>
<a name='L35'><i><font color='green'> *----------------------------------------------------------------------------*/</font></i>
<a name='L36'>
<a name='L37'><b>static</b> <b>int</b> <a href='../R/1543.html' title='Multiple refered from 3 places.'>checkStringLength</a>(redisClient *c, <b>long</b> <b>long</b> size) <font color='red'>{</font>
<a name='L38'>    <b>if</b> (size &gt; 512*1024*1024) <font color='red'>{</font>
<a name='L39'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"string exceeds maximum allowed size (512MB)");
<a name='L40'>        <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L41'>    <font color='red'>}</font>
<a name='L42'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L43'><font color='red'>}</font>
<a name='L44'>
<a name='L45'><b>void</b> <a href='../R/3732.html' title='Multiple refered from 4 places.'>setGenericCommand</a>(redisClient *c, <b>int</b> nx, robj *key, robj *val, robj *expire, <b>int</b> unit) <font color='red'>{</font>
<a name='L46'>    <b>long</b> <b>long</b> milliseconds = 0; <i><font color='green'>/* initialized to avoid an harmness warning */</font></i>
<a name='L47'>
<a name='L48'>    <b>if</b> (expire) <font color='red'>{</font>
<a name='L49'>        <b>if</b> (<a href='../S/71.html#L484' title='Defined at 484 in src/object.c.'>getLongLongFromObjectOrReply</a>(c, expire, &amp;milliseconds, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L50'>            <b>return</b>;
<a name='L51'>        <b>if</b> (milliseconds &lt;= 0) <font color='red'>{</font>
<a name='L52'>            <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"invalid expire time in SETEX");
<a name='L53'>            <b>return</b>;
<a name='L54'>        <font color='red'>}</font>
<a name='L55'>        <b>if</b> (unit == <a href='../S/32.html#L272' title='Defined at 272 in src/redis.h.'>UNIT_SECONDS</a>) milliseconds *= 1000;
<a name='L56'>    <font color='red'>}</font>
<a name='L57'>
<a name='L58'>    <b>if</b> (nx &amp;&amp; <a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,key) != NULL) <font color='red'>{</font>
<a name='L59'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.czero);
<a name='L60'>        <b>return</b>;
<a name='L61'>    <font color='red'>}</font>
<a name='L62'>    <a href='../S/31.html#L116' title='Defined at 116 in src/db.c.'>setKey</a>(c-&gt;db,key,val);
<a name='L63'>    server.dirty++;
<a name='L64'>    <b>if</b> (expire) <a href='../S/31.html#L453' title='Defined at 453 in src/db.c.'>setExpire</a>(c-&gt;db,key,<a href='../D/3402.html' title='Multiple defined in 3 places.'>mstime</a>()+milliseconds);
<a name='L65'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, nx ? shared.cone : shared.<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a>);
<a name='L66'><font color='red'>}</font>
<a name='L67'>
<a name='L68'><b>void</b> <a href='../R/3729.html' title='Multiple refered from 2 places.'>setCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L69'>    c-&gt;argv[2] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[2]);
<a name='L70'>    <a href='../S/79.html#L45' title='Defined at 45 in src/t_string.c.'>setGenericCommand</a>(c,0,c-&gt;argv[1],c-&gt;argv[2],NULL,0);
<a name='L71'><font color='red'>}</font>
<a name='L72'>
<a name='L73'><b>void</b> <a href='../R/3763.html' title='Multiple refered from 2 places.'>setnxCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L74'>    c-&gt;argv[2] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[2]);
<a name='L75'>    <a href='../S/79.html#L45' title='Defined at 45 in src/t_string.c.'>setGenericCommand</a>(c,1,c-&gt;argv[1],c-&gt;argv[2],NULL,0);
<a name='L76'><font color='red'>}</font>
<a name='L77'>
<a name='L78'><b>void</b> <a href='../R/3754.html' title='Multiple refered from 5 places.'>setexCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L79'>    c-&gt;argv[3] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[3]);
<a name='L80'>    <a href='../S/79.html#L45' title='Defined at 45 in src/t_string.c.'>setGenericCommand</a>(c,0,c-&gt;argv[1],c-&gt;argv[3],c-&gt;argv[2],<a href='../S/32.html#L272' title='Defined at 272 in src/redis.h.'>UNIT_SECONDS</a>);
<a name='L81'><font color='red'>}</font>
<a name='L82'>
<a name='L83'><b>void</b> <a href='../R/3250.html' title='Multiple refered from 4 places.'>psetexCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L84'>    c-&gt;argv[3] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[3]);
<a name='L85'>    <a href='../S/79.html#L45' title='Defined at 45 in src/t_string.c.'>setGenericCommand</a>(c,0,c-&gt;argv[1],c-&gt;argv[3],c-&gt;argv[2],<a href='../S/32.html#L273' title='Defined at 273 in src/redis.h.'>UNIT_MILLISECONDS</a>);
<a name='L86'><font color='red'>}</font>
<a name='L87'>
<a name='L88'><b>int</b> <a href='../R/2052.html' title='Multiple refered from 2 places.'>getGenericCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L89'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o;
<a name='L90'>
<a name='L91'>    <b>if</b> ((o = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,c-&gt;argv[1],shared.nullbulk)) == NULL)
<a name='L92'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L93'>
<a name='L94'>    <b>if</b> (o-&gt;type != <a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>) <font color='red'>{</font>
<a name='L95'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.wrongtypeerr);
<a name='L96'>        <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L97'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L98'>        <a href='../S/86.html#L475' title='Defined at 475 in src/networking.c.'>addReplyBulk</a>(c,o);
<a name='L99'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L100'>    <font color='red'>}</font>
<a name='L101'><font color='red'>}</font>
<a name='L102'>
<a name='L103'><b>void</b> <a href='../R/2046.html' title='Multiple refered from 2 places.'>getCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L104'>    <a href='../S/79.html#L88' title='Defined at 88 in src/t_string.c.'>getGenericCommand</a>(c);
<a name='L105'><font color='red'>}</font>
<a name='L106'>
<a name='L107'><b>void</b> <a href='../R/2093.html' title='Multiple refered from 2 places.'>getsetCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L108'>    <b>if</b> (<a href='../S/79.html#L88' title='Defined at 88 in src/t_string.c.'>getGenericCommand</a>(c) == <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>) <b>return</b>;
<a name='L109'>    c-&gt;argv[2] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[2]);
<a name='L110'>    <a href='../S/31.html#L116' title='Defined at 116 in src/db.c.'>setKey</a>(c-&gt;db,c-&gt;argv[1],c-&gt;argv[2]);
<a name='L111'>    server.dirty++;
<a name='L112'><font color='red'>}</font>
<a name='L113'>
<a name='L114'><b>void</b> <a href='../R/3775.html' title='Multiple refered from 2 places.'>setrangeCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L115'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o;
<a name='L116'>    <b>long</b> offset;
<a name='L117'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> value = c-&gt;argv[3]-&gt;ptr;
<a name='L118'>
<a name='L119'>    <b>if</b> (<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c,c-&gt;argv[2],&amp;offset,NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L120'>        <b>return</b>;
<a name='L121'>
<a name='L122'>    <b>if</b> (offset &lt; 0) <font color='red'>{</font>
<a name='L123'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"offset is out of range");
<a name='L124'>        <b>return</b>;
<a name='L125'>    <font color='red'>}</font>
<a name='L126'>
<a name='L127'>    o = <a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L128'>    <b>if</b> (o == NULL) <font color='red'>{</font>
<a name='L129'>        <i><font color='green'>/* Return 0 when setting nothing on a non-existing string */</font></i>
<a name='L130'>        <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(value) == 0) <font color='red'>{</font>
<a name='L131'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.czero);
<a name='L132'>            <b>return</b>;
<a name='L133'>        <font color='red'>}</font>
<a name='L134'>
<a name='L135'>        <i><font color='green'>/* Return when the resulting string exceeds allowed size */</font></i>
<a name='L136'>        <b>if</b> (<a href='../S/79.html#L37' title='Defined at 37 in src/t_string.c.'>checkStringLength</a>(c,offset+<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(value)) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L137'>            <b>return</b>;
<a name='L138'>
<a name='L139'>        o = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>());
<a name='L140'>        <a href='../S/31.html#L91' title='Defined at 91 in src/db.c.'>dbAdd</a>(c-&gt;db,c-&gt;argv[1],o);
<a name='L141'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L142'>        size_t olen;
<a name='L143'>
<a name='L144'>        <i><font color='green'>/* Key exists, check type */</font></i>
<a name='L145'>        <b>if</b> (<a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,o,<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>))
<a name='L146'>            <b>return</b>;
<a name='L147'>
<a name='L148'>        <i><font color='green'>/* Return existing string length when setting nothing */</font></i>
<a name='L149'>        olen = <a href='../S/71.html#L373' title='Defined at 373 in src/object.c.'>stringObjectLen</a>(o);
<a name='L150'>        <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(value) == 0) <font color='red'>{</font>
<a name='L151'>            <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,olen);
<a name='L152'>            <b>return</b>;
<a name='L153'>        <font color='red'>}</font>
<a name='L154'>
<a name='L155'>        <i><font color='green'>/* Return when the resulting string exceeds allowed size */</font></i>
<a name='L156'>        <b>if</b> (<a href='../S/79.html#L37' title='Defined at 37 in src/t_string.c.'>checkStringLength</a>(c,offset+<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(value)) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L157'>            <b>return</b>;
<a name='L158'>
<a name='L159'>        <i><font color='green'>/* Create a copy when the object is shared or encoded. */</font></i>
<a name='L160'>        <b>if</b> (o-&gt;refcount != 1 || o-&gt;encoding != <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>) <font color='red'>{</font>
<a name='L161'>            <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *decoded = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(o);
<a name='L162'>            o = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>(decoded-&gt;ptr, <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(decoded-&gt;ptr));
<a name='L163'>            <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(decoded);
<a name='L164'>            <a href='../S/31.html#L103' title='Defined at 103 in src/db.c.'>dbOverwrite</a>(c-&gt;db,c-&gt;argv[1],o);
<a name='L165'>        <font color='red'>}</font>
<a name='L166'>    <font color='red'>}</font>
<a name='L167'>
<a name='L168'>    <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(value) &gt; 0) <font color='red'>{</font>
<a name='L169'>        o-&gt;ptr = <a href='../D/4009.html' title='Multiple defined in 2 places.'>sdsgrowzero</a>(o-&gt;ptr,offset+<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(value));
<a name='L170'>        memcpy((<b>char</b>*)o-&gt;ptr+offset,value,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(value));
<a name='L171'>        <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L172'>        server.dirty++;
<a name='L173'>    <font color='red'>}</font>
<a name='L174'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(o-&gt;ptr));
<a name='L175'><font color='red'>}</font>
<a name='L176'>
<a name='L177'><b>void</b> <a href='../R/2092.html' title='Multiple refered from 3 places.'>getrangeCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L178'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o;
<a name='L179'>    <b>long</b> start, end;
<a name='L180'>    <b>char</b> *str, llbuf[32];
<a name='L181'>    size_t strlen;
<a name='L182'>
<a name='L183'>    <b>if</b> (<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c,c-&gt;argv[2],&amp;start,NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L184'>        <b>return</b>;
<a name='L185'>    <b>if</b> (<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c,c-&gt;argv[3],&amp;end,NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L186'>        <b>return</b>;
<a name='L187'>    <b>if</b> ((o = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,c-&gt;argv[1],shared.emptybulk)) == NULL ||
<a name='L188'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,o,<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>)) <b>return</b>;
<a name='L189'>
<a name='L190'>    <b>if</b> (o-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>) <font color='red'>{</font>
<a name='L191'>        str = llbuf;
<a name='L192'>        strlen = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>(llbuf,<b>sizeof</b>(llbuf),(<b>long</b>)o-&gt;ptr);
<a name='L193'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L194'>        str = o-&gt;ptr;
<a name='L195'>        strlen = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(str);
<a name='L196'>    <font color='red'>}</font>
<a name='L197'>
<a name='L198'>    <i><font color='green'>/* Convert negative indexes */</font></i>
<a name='L199'>    <b>if</b> (start &lt; 0) start = strlen+start;
<a name='L200'>    <b>if</b> (end &lt; 0) end = strlen+end;
<a name='L201'>    <b>if</b> (start &lt; 0) start = 0;
<a name='L202'>    <b>if</b> (end &lt; 0) end = 0;
<a name='L203'>    <b>if</b> ((<b>unsigned</b>)end &gt;= strlen) end = strlen-1;
<a name='L204'>
<a name='L205'>    <i><font color='green'>/* Precondition: end &gt;= 0 &amp;&amp; end &lt; strlen, so the only condition where</font></i>
<a name='L206'><i><font color='green'>     * nothing can be returned is: start &gt; end. */</font></i>
<a name='L207'>    <b>if</b> (start &gt; end) <font color='red'>{</font>
<a name='L208'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.emptybulk);
<a name='L209'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L210'>        <a href='../S/86.html#L482' title='Defined at 482 in src/networking.c.'>addReplyBulkCBuffer</a>(c,(<b>char</b>*)str+start,end-start+1);
<a name='L211'>    <font color='red'>}</font>
<a name='L212'><font color='red'>}</font>
<a name='L213'>
<a name='L214'><b>void</b> <a href='../R/3013.html' title='Multiple refered from 2 places.'>mgetCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L215'>    <b>int</b> j;
<a name='L216'>
<a name='L217'>    <a href='../S/86.html#L448' title='Defined at 448 in src/networking.c.'>addReplyMultiBulkLen</a>(c,c-&gt;argc-1);
<a name='L218'>    <b>for</b> (j = 1; j &lt; c-&gt;argc; j++) <font color='red'>{</font>
<a name='L219'>        <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o = <a href='../S/31.html#L58' title='Defined at 58 in src/db.c.'>lookupKeyRead</a>(c-&gt;db,c-&gt;argv[j]);
<a name='L220'>        <b>if</b> (o == NULL) <font color='red'>{</font>
<a name='L221'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullbulk);
<a name='L222'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L223'>            <b>if</b> (o-&gt;type != <a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>) <font color='red'>{</font>
<a name='L224'>                <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullbulk);
<a name='L225'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L226'>                <a href='../S/86.html#L475' title='Defined at 475 in src/networking.c.'>addReplyBulk</a>(c,o);
<a name='L227'>            <font color='red'>}</font>
<a name='L228'>        <font color='red'>}</font>
<a name='L229'>    <font color='red'>}</font>
<a name='L230'><font color='red'>}</font>
<a name='L231'>
<a name='L232'><b>void</b> <a href='../R/3052.html' title='Multiple refered from 2 places.'>msetGenericCommand</a>(redisClient *c, <b>int</b> nx) <font color='red'>{</font>
<a name='L233'>    <b>int</b> j, busykeys = 0;
<a name='L234'>
<a name='L235'>    <b>if</b> ((c-&gt;argc % 2) == 0) <font color='red'>{</font>
<a name='L236'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"wrong number of arguments for MSET");
<a name='L237'>        <b>return</b>;
<a name='L238'>    <font color='red'>}</font>
<a name='L239'>    <i><font color='green'>/* Handle the NX flag. The MSETNX semantic is to return zero and don't</font></i>
<a name='L240'><i><font color='green'>     * set nothing at all if at least one already key exists. */</font></i>
<a name='L241'>    <b>if</b> (nx) <font color='red'>{</font>
<a name='L242'>        <b>for</b> (j = 1; j &lt; c-&gt;argc; j += 2) <font color='red'>{</font>
<a name='L243'>            <b>if</b> (<a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,c-&gt;argv[j]) != NULL) <font color='red'>{</font>
<a name='L244'>                busykeys++;
<a name='L245'>            <font color='red'>}</font>
<a name='L246'>        <font color='red'>}</font>
<a name='L247'>        <b>if</b> (busykeys) <font color='red'>{</font>
<a name='L248'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.czero);
<a name='L249'>            <b>return</b>;
<a name='L250'>        <font color='red'>}</font>
<a name='L251'>    <font color='red'>}</font>
<a name='L252'>
<a name='L253'>    <b>for</b> (j = 1; j &lt; c-&gt;argc; j += 2) <font color='red'>{</font>
<a name='L254'>        c-&gt;argv[j+1] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[j+1]);
<a name='L255'>        <a href='../S/31.html#L116' title='Defined at 116 in src/db.c.'>setKey</a>(c-&gt;db,c-&gt;argv[j],c-&gt;argv[j+1]);
<a name='L256'>    <font color='red'>}</font>
<a name='L257'>    server.dirty += (c-&gt;argc-1)/2;
<a name='L258'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, nx ? shared.cone : shared.<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a>);
<a name='L259'><font color='red'>}</font>
<a name='L260'>
<a name='L261'><b>void</b> <a href='../R/3051.html' title='Multiple refered from 2 places.'>msetCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L262'>    <a href='../S/79.html#L232' title='Defined at 232 in src/t_string.c.'>msetGenericCommand</a>(c,0);
<a name='L263'><font color='red'>}</font>
<a name='L264'>
<a name='L265'><b>void</b> <a href='../R/3053.html' title='Multiple refered from 2 places.'>msetnxCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L266'>    <a href='../S/79.html#L232' title='Defined at 232 in src/t_string.c.'>msetGenericCommand</a>(c,1);
<a name='L267'><font color='red'>}</font>
<a name='L268'>
<a name='L269'><b>void</b> <a href='../R/2193.html' title='Multiple refered from 4 places.'>incrDecrCommand</a>(redisClient *c, <b>long</b> <b>long</b> incr) <font color='red'>{</font>
<a name='L270'>    <b>long</b> <b>long</b> value, oldvalue;
<a name='L271'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o, *new;
<a name='L272'>
<a name='L273'>    o = <a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L274'>    <b>if</b> (o != NULL &amp;&amp; <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,o,<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>)) <b>return</b>;
<a name='L275'>    <b>if</b> (<a href='../S/71.html#L484' title='Defined at 484 in src/object.c.'>getLongLongFromObjectOrReply</a>(c,o,&amp;value,NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>return</b>;
<a name='L276'>
<a name='L277'>    oldvalue = value;
<a name='L278'>    <b>if</b> ((incr &lt; 0 &amp;&amp; oldvalue &lt; 0 &amp;&amp; incr &lt; (LLONG_MIN-oldvalue)) ||
<a name='L279'>        (incr &gt; 0 &amp;&amp; oldvalue &gt; 0 &amp;&amp; incr &gt; (LLONG_MAX-oldvalue))) <font color='red'>{</font>
<a name='L280'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"increment or decrement would overflow");
<a name='L281'>        <b>return</b>;
<a name='L282'>    <font color='red'>}</font>
<a name='L283'>    value += incr;
<a name='L284'>    new = <a href='../S/71.html#L51' title='Defined at 51 in src/object.c.'>createStringObjectFromLongLong</a>(value);
<a name='L285'>    <b>if</b> (o)
<a name='L286'>        <a href='../S/31.html#L103' title='Defined at 103 in src/db.c.'>dbOverwrite</a>(c-&gt;db,c-&gt;argv[1],new);
<a name='L287'>    <b>else</b>
<a name='L288'>        <a href='../S/31.html#L91' title='Defined at 91 in src/db.c.'>dbAdd</a>(c-&gt;db,c-&gt;argv[1],new);
<a name='L289'>    <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L290'>    server.dirty++;
<a name='L291'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.colon);
<a name='L292'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,new);
<a name='L293'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.crlf);
<a name='L294'><font color='red'>}</font>
<a name='L295'>
<a name='L296'><b>void</b> <a href='../R/2192.html' title='Multiple refered from 2 places.'>incrCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L297'>    <a href='../S/79.html#L269' title='Defined at 269 in src/t_string.c.'>incrDecrCommand</a>(c,1);
<a name='L298'><font color='red'>}</font>
<a name='L299'>
<a name='L300'><b>void</b> <a href='../R/1780.html' title='Multiple refered from 2 places.'>decrCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L301'>    <a href='../S/79.html#L269' title='Defined at 269 in src/t_string.c.'>incrDecrCommand</a>(c,-1);
<a name='L302'><font color='red'>}</font>
<a name='L303'>
<a name='L304'><b>void</b> <a href='../R/2196.html' title='Multiple refered from 2 places.'>incrbyCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L305'>    <b>long</b> <b>long</b> incr;
<a name='L306'>
<a name='L307'>    <b>if</b> (<a href='../S/71.html#L484' title='Defined at 484 in src/object.c.'>getLongLongFromObjectOrReply</a>(c, c-&gt;argv[2], &amp;incr, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>return</b>;
<a name='L308'>    <a href='../S/79.html#L269' title='Defined at 269 in src/t_string.c.'>incrDecrCommand</a>(c,incr);
<a name='L309'><font color='red'>}</font>
<a name='L310'>
<a name='L311'><b>void</b> <a href='../R/1782.html' title='Multiple refered from 2 places.'>decrbyCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L312'>    <b>long</b> <b>long</b> incr;
<a name='L313'>
<a name='L314'>    <b>if</b> (<a href='../S/71.html#L484' title='Defined at 484 in src/object.c.'>getLongLongFromObjectOrReply</a>(c, c-&gt;argv[2], &amp;incr, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>return</b>;
<a name='L315'>    <a href='../S/79.html#L269' title='Defined at 269 in src/t_string.c.'>incrDecrCommand</a>(c,-incr);
<a name='L316'><font color='red'>}</font>
<a name='L317'>
<a name='L318'><b>void</b> <a href='../R/2197.html' title='Multiple refered from 2 places.'>incrbyfloatCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L319'>    <b>long</b> <b>double</b> incr, value;
<a name='L320'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o, *new, *aux;
<a name='L321'>
<a name='L322'>    o = <a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L323'>    <b>if</b> (o != NULL &amp;&amp; <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,o,<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>)) <b>return</b>;
<a name='L324'>    <b>if</b> (<a href='../S/71.html#L446' title='Defined at 446 in src/object.c.'>getLongDoubleFromObjectOrReply</a>(c,o,&amp;value,NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a> ||
<a name='L325'>        <a href='../S/71.html#L446' title='Defined at 446 in src/object.c.'>getLongDoubleFromObjectOrReply</a>(c,c-&gt;argv[2],&amp;incr,NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L326'>        <b>return</b>;
<a name='L327'>
<a name='L328'>    value += incr;
<a name='L329'>    <b>if</b> (<a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(value) || <a href='../D/2568.html' title='Multiple defined in 3 places.'>isinf</a>(value)) <font color='red'>{</font>
<a name='L330'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"increment would produce NaN or Infinity");
<a name='L331'>        <b>return</b>;
<a name='L332'>    <font color='red'>}</font>
<a name='L333'>    new = <a href='../S/71.html#L70' title='Defined at 70 in src/object.c.'>createStringObjectFromLongDouble</a>(value);
<a name='L334'>    <b>if</b> (o)
<a name='L335'>        <a href='../S/31.html#L103' title='Defined at 103 in src/db.c.'>dbOverwrite</a>(c-&gt;db,c-&gt;argv[1],new);
<a name='L336'>    <b>else</b>
<a name='L337'>        <a href='../S/31.html#L91' title='Defined at 91 in src/db.c.'>dbAdd</a>(c-&gt;db,c-&gt;argv[1],new);
<a name='L338'>    <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L339'>    server.dirty++;
<a name='L340'>    <a href='../S/86.html#L475' title='Defined at 475 in src/networking.c.'>addReplyBulk</a>(c,new);
<a name='L341'>
<a name='L342'>    <i><font color='green'>/* Always replicate INCRBYFLOAT as a SET command with the final value</font></i>
<a name='L343'><i><font color='green'>     * in order to make sure that differences in float pricision or formatting</font></i>
<a name='L344'><i><font color='green'>     * will not create differences in replicas or after an AOF restart. */</font></i>
<a name='L345'>    aux = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("SET",3);
<a name='L346'>    <a href='../S/86.html#L1228' title='Defined at 1228 in src/networking.c.'>rewriteClientCommandArgument</a>(c,0,aux);
<a name='L347'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(aux);
<a name='L348'>    <a href='../S/86.html#L1228' title='Defined at 1228 in src/networking.c.'>rewriteClientCommandArgument</a>(c,2,new);
<a name='L349'><font color='red'>}</font>
<a name='L350'>
<a name='L351'><b>void</b> <a href='../R/1299.html' title='Multiple refered from 2 places.'>appendCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L352'>    size_t totlen;
<a name='L353'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o, *append;
<a name='L354'>
<a name='L355'>    o = <a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L356'>    <b>if</b> (o == NULL) <font color='red'>{</font>
<a name='L357'>        <i><font color='green'>/* Create the key */</font></i>
<a name='L358'>        c-&gt;argv[2] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[2]);
<a name='L359'>        <a href='../S/31.html#L91' title='Defined at 91 in src/db.c.'>dbAdd</a>(c-&gt;db,c-&gt;argv[1],c-&gt;argv[2]);
<a name='L360'>        <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(c-&gt;argv[2]);
<a name='L361'>        totlen = <a href='../S/71.html#L373' title='Defined at 373 in src/object.c.'>stringObjectLen</a>(c-&gt;argv[2]);
<a name='L362'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L363'>        <i><font color='green'>/* Key exists, check type */</font></i>
<a name='L364'>        <b>if</b> (<a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,o,<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>))
<a name='L365'>            <b>return</b>;
<a name='L366'>
<a name='L367'>        <i><font color='green'>/* "append" is an argument, so always an sds */</font></i>
<a name='L368'>        append = c-&gt;argv[2];
<a name='L369'>        totlen = <a href='../S/71.html#L373' title='Defined at 373 in src/object.c.'>stringObjectLen</a>(o)+<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(append-&gt;ptr);
<a name='L370'>        <b>if</b> (<a href='../S/79.html#L37' title='Defined at 37 in src/t_string.c.'>checkStringLength</a>(c,totlen) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L371'>            <b>return</b>;
<a name='L372'>
<a name='L373'>        <i><font color='green'>/* If the object is shared or encoded, we have to make a copy */</font></i>
<a name='L374'>        <b>if</b> (o-&gt;refcount != 1 || o-&gt;encoding != <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>) <font color='red'>{</font>
<a name='L375'>            <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *decoded = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(o);
<a name='L376'>            o = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>(decoded-&gt;ptr, <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(decoded-&gt;ptr));
<a name='L377'>            <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(decoded);
<a name='L378'>            <a href='../S/31.html#L103' title='Defined at 103 in src/db.c.'>dbOverwrite</a>(c-&gt;db,c-&gt;argv[1],o);
<a name='L379'>        <font color='red'>}</font>
<a name='L380'>
<a name='L381'>        <i><font color='green'>/* Append the value */</font></i>
<a name='L382'>        o-&gt;ptr = <a href='../D/3995.html' title='Multiple defined in 2 places.'>sdscatlen</a>(o-&gt;ptr,append-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(append-&gt;ptr));
<a name='L383'>        totlen = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(o-&gt;ptr);
<a name='L384'>    <font color='red'>}</font>
<a name='L385'>    <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,c-&gt;argv[1]);
<a name='L386'>    server.dirty++;
<a name='L387'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,totlen);
<a name='L388'><font color='red'>}</font>
<a name='L389'>
<a name='L390'><b>void</b> <a href='../R/3894.html' title='Multiple refered from 2 places.'>strlenCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L391'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o;
<a name='L392'>    <b>if</b> ((o = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,c-&gt;argv[1],shared.czero)) == NULL ||
<a name='L393'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,o,<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>)) <b>return</b>;
<a name='L394'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,<a href='../S/71.html#L373' title='Defined at 373 in src/object.c.'>stringObjectLen</a>(o));
<a name='L395'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L37'>[^]</a><a href='#L390'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
