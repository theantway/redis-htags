<html>
<head>
<title>deps/lua/src/lstrlib.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/387.html'>deps</a>/<a href='../files/398.html'>lua</a>/<a href='../files/400.html'>src</a>/lstrlib.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L28'>[^]</a><a href='#L860'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L28' title='Defined at 28.'>str_len</a>
<li><a href='#L36' title='Defined at 36.'>posrelat</a>
<li><a href='#L43' title='Defined at 43.'>str_sub</a>
<li><a href='#L57' title='Defined at 57.'>str_reverse</a>
<li><a href='#L68' title='Defined at 68.'>str_lower</a>
<li><a href='#L81' title='Defined at 81.'>str_upper</a>
<li><a href='#L93' title='Defined at 93.'>str_rep</a>
<li><a href='#L106' title='Defined at 106.'>str_byte</a>
<li><a href='#L125' title='Defined at 125.'>str_char</a>
<li><a href='#L140' title='Defined at 140.'>writer</a>
<li><a href='#L147' title='Defined at 147.'>str_dump</a>
<li><a href='#L186' title='Defined at 186.'>check_capture</a>
<li><a href='#L194' title='Defined at 194.'>capture_to_close</a>
<li><a href='#L202' title='Defined at 202.'>classend</a>
<li><a href='#L226' title='Defined at 226.'>match_class</a>
<li><a href='#L245' title='Defined at 245.'>matchbracketclass</a>
<li><a href='#L268' title='Defined at 268.'>singlematch</a>
<li><a href='#L281' title='Defined at 281.'>matchbalance</a>
<li><a href='#L301' title='Defined at 301.'>max_expand</a>
<li><a href='#L316' title='Defined at 316.'>min_expand</a>
<li><a href='#L329' title='Defined at 329.'>start_capture</a>
<li><a href='#L343' title='Defined at 343.'>end_capture</a>
<li><a href='#L354' title='Defined at 354.'>match_capture</a>
<li><a href='#L365' title='Defined at 365.'>match</a>
<li><a href='#L444' title='Defined at 444.'>lmemfind</a>
<li><a href='#L466' title='Defined at 466.'>push_onecapture</a>
<li><a href='#L485' title='Defined at 485.'>push_captures</a>
<li><a href='#L495' title='Defined at 495.'>str_find_aux</a>
<li><a href='#L538' title='Defined at 538.'>str_find</a>
<li><a href='#L543' title='Defined at 543.'>str_match</a>
<li><a href='#L548' title='Defined at 548.'>gmatch_aux</a>
<li><a href='#L574' title='Defined at 574.'>gmatch</a>
<li><a href='#L584' title='Defined at 584.'>gfind_nodef</a>
<li><a href='#L590' title='Defined at 590.'>add_s</a>
<li><a href='#L612' title='Defined at 612.'>add_value</a>
<li><a href='#L644' title='Defined at 644.'>str_gsub</a>
<li><a href='#L696' title='Defined at 696.'>addquoted</a>
<li><a href='#L725' title='Defined at 725.'>scanformat</a>
<li><a href='#L747' title='Defined at 747.'>addintlen</a>
<li><a href='#L756' title='Defined at 756.'>str_format</a>
<li><a href='#L845' title='Defined at 845.'>createmetatable</a>
<li><a href='#L860' title='Defined at 860.'>luaopen_string</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'>** $Id: lstrlib.c,v 1.132.1.4 2008/07/11 17:27:21 roberto Exp $</font></i>
<a name='L3'><i><font color='green'>** Standard library for string operations and pattern-matching</font></i>
<a name='L4'><i><font color='green'>** See Copyright Notice in lua.h</font></i>
<a name='L5'><i><font color='green'>*/</font></i>
<a name='L6'>
<a name='L7'>
<a name='L8'><font color='darkred'>#include</font> &lt;ctype.h&gt;
<a name='L9'><font color='darkred'>#include</font> &lt;stddef.h&gt;
<a name='L10'><font color='darkred'>#include</font> &lt;stdio.h&gt;
<a name='L11'><font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L12'><font color='darkred'>#include</font> &lt;string.h&gt;
<a name='L13'>
<a name='L14'><font color='darkred'>#define</font> lstrlib_c
<a name='L15'><font color='darkred'>#define</font> <a href='../S/317.html#L156' title='Refered from 156 in deps/lua/src/luaconf.h.'>LUA_LIB</a>
<a name='L16'>
<a name='L17'><font color='darkred'>#include</font> "<a href='266.html'>lua.h</a>"
<a name='L18'>
<a name='L19'><font color='darkred'>#include</font> "<a href='265.html'>lauxlib.h</a>"
<a name='L20'><font color='darkred'>#include</font> "<a href='267.html'>lualib.h</a>"
<a name='L21'>
<a name='L22'>
<a name='L23'><i><font color='green'>/* macro to `unsign' a character */</font></i>
<a name='L24'><font color='darkred'>#define</font> <a href='../R/4047.html' title='Multiple refered from 23 places.'>uchar</a>(c)        ((<b>unsigned</b> <b>char</b>)(c))
<a name='L25'>
<a name='L26'>
<a name='L27'>
<a name='L28'><b>static</b> <b>int</b> <a href='../S/270.html#L834' title='Refered from 834 in deps/lua/src/lstrlib.c.'>str_len</a> (lua_State *L) <font color='red'>{</font>
<a name='L29'>  size_t l;
<a name='L30'>  <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l);
<a name='L31'>  <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, l);
<a name='L32'>  <b>return</b> 1;
<a name='L33'><font color='red'>}</font>
<a name='L34'>
<a name='L35'>
<a name='L36'><b>static</b> ptrdiff_t <a href='../R/3154.html' title='Multiple refered from 5 places.'>posrelat</a> (ptrdiff_t pos, size_t len) <font color='red'>{</font>
<a name='L37'>  <i><font color='green'>/* relative string position: negative means back from end */</font></i>
<a name='L38'>  <b>if</b> (<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> &lt; 0) <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> += (ptrdiff_t)len + 1;
<a name='L39'>  <b>return</b> (<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> &gt;= 0) ? <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> : 0;
<a name='L40'><font color='red'>}</font>
<a name='L41'>
<a name='L42'>
<a name='L43'><b>static</b> <b>int</b> <a href='../S/270.html#L839' title='Refered from 839 in deps/lua/src/lstrlib.c.'>str_sub</a> (lua_State *L) <font color='red'>{</font>
<a name='L44'>  size_t l;
<a name='L45'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l);
<a name='L46'>  ptrdiff_t start = <a href='../S/270.html#L36' title='Defined at 36 in deps/lua/src/lstrlib.c.'>posrelat</a>(<a href='../S/260.html#L189' title='Defined at 189 in deps/lua/src/lauxlib.c.'>luaL_checkinteger</a>(L, 2), l);
<a name='L47'>  ptrdiff_t end = <a href='../S/270.html#L36' title='Defined at 36 in deps/lua/src/lstrlib.c.'>posrelat</a>(<a href='../S/260.html#L197' title='Defined at 197 in deps/lua/src/lauxlib.c.'>luaL_optinteger</a>(L, 3, -1), l);
<a name='L48'>  <b>if</b> (start &lt; 1) start = 1;
<a name='L49'>  <b>if</b> (end &gt; (ptrdiff_t)l) end = (ptrdiff_t)l;
<a name='L50'>  <b>if</b> (start &lt;= end)
<a name='L51'>    <a href='../S/272.html#L445' title='Defined at 445 in deps/lua/src/lapi.c.'>lua_pushlstring</a>(L, s+start-1, end-start+1);
<a name='L52'>  <b>else</b> <a href='../S/266.html#L273' title='Defined at 273 in deps/lua/src/lua.h.'>lua_pushliteral</a>(L, "");
<a name='L53'>  <b>return</b> 1;
<a name='L54'><font color='red'>}</font>
<a name='L55'>
<a name='L56'>
<a name='L57'><b>static</b> <b>int</b> <a href='../S/270.html#L838' title='Refered from 838 in deps/lua/src/lstrlib.c.'>str_reverse</a> (lua_State *L) <font color='red'>{</font>
<a name='L58'>  size_t l;
<a name='L59'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L60'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l);
<a name='L61'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L, &amp;b);
<a name='L62'>  <b>while</b> (l--) <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(&amp;b, s[l]);
<a name='L63'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L64'>  <b>return</b> 1;
<a name='L65'><font color='red'>}</font>
<a name='L66'>
<a name='L67'>
<a name='L68'><b>static</b> <b>int</b> <a href='../S/270.html#L835' title='Refered from 835 in deps/lua/src/lstrlib.c.'>str_lower</a> (lua_State *L) <font color='red'>{</font>
<a name='L69'>  size_t l;
<a name='L70'>  size_t i;
<a name='L71'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L72'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l);
<a name='L73'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L, &amp;b);
<a name='L74'>  <b>for</b> (i=0; i&lt;l; i++)
<a name='L75'>    <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(&amp;b, tolower(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(s[i])));
<a name='L76'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L77'>  <b>return</b> 1;
<a name='L78'><font color='red'>}</font>
<a name='L79'>
<a name='L80'>
<a name='L81'><b>static</b> <b>int</b> <a href='../S/270.html#L840' title='Refered from 840 in deps/lua/src/lstrlib.c.'>str_upper</a> (lua_State *L) <font color='red'>{</font>
<a name='L82'>  size_t l;
<a name='L83'>  size_t i;
<a name='L84'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L85'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l);
<a name='L86'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L, &amp;b);
<a name='L87'>  <b>for</b> (i=0; i&lt;l; i++)
<a name='L88'>    <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(&amp;b, toupper(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(s[i])));
<a name='L89'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L90'>  <b>return</b> 1;
<a name='L91'><font color='red'>}</font>
<a name='L92'>
<a name='L93'><b>static</b> <b>int</b> <a href='../S/270.html#L837' title='Refered from 837 in deps/lua/src/lstrlib.c.'>str_rep</a> (lua_State *L) <font color='red'>{</font>
<a name='L94'>  size_t l;
<a name='L95'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L96'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l);
<a name='L97'>  <b>int</b> n = <a href='../S/265.html#L104' title='Defined at 104 in deps/lua/src/lauxlib.h.'>luaL_checkint</a>(L, 2);
<a name='L98'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L, &amp;b);
<a name='L99'>  <b>while</b> (n-- &gt; 0)
<a name='L100'>    <a href='../S/260.html#L436' title='Defined at 436 in deps/lua/src/lauxlib.c.'>luaL_addlstring</a>(&amp;b, s, l);
<a name='L101'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L102'>  <b>return</b> 1;
<a name='L103'><font color='red'>}</font>
<a name='L104'>
<a name='L105'>
<a name='L106'><b>static</b> <b>int</b> <a href='../S/270.html#L826' title='Refered from 826 in deps/lua/src/lstrlib.c.'>str_byte</a> (lua_State *L) <font color='red'>{</font>
<a name='L107'>  size_t l;
<a name='L108'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l);
<a name='L109'>  ptrdiff_t posi = <a href='../S/270.html#L36' title='Defined at 36 in deps/lua/src/lstrlib.c.'>posrelat</a>(<a href='../S/260.html#L197' title='Defined at 197 in deps/lua/src/lauxlib.c.'>luaL_optinteger</a>(L, 2, 1), l);
<a name='L110'>  ptrdiff_t pose = <a href='../S/270.html#L36' title='Defined at 36 in deps/lua/src/lstrlib.c.'>posrelat</a>(<a href='../S/260.html#L197' title='Defined at 197 in deps/lua/src/lauxlib.c.'>luaL_optinteger</a>(L, 3, posi), l);
<a name='L111'>  <b>int</b> n, i;
<a name='L112'>  <b>if</b> (posi &lt;= 0) posi = 1;
<a name='L113'>  <b>if</b> ((size_t)pose &gt; l) pose = l;
<a name='L114'>  <b>if</b> (posi &gt; pose) <b>return</b> 0;  <i><font color='green'>/* empty interval; return no values */</font></i>
<a name='L115'>  n = (<b>int</b>)(pose -  posi + 1);
<a name='L116'>  <b>if</b> (posi + n &lt;= pose)  <i><font color='green'>/* overflow? */</font></i>
<a name='L117'>    <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(L, "string slice too long");
<a name='L118'>  <a href='../S/260.html#L140' title='Defined at 140 in deps/lua/src/lauxlib.c.'>luaL_checkstack</a>(L, n, "string slice too long");
<a name='L119'>  <b>for</b> (i=0; i&lt;n; i++)
<a name='L120'>    <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, <a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(s[posi+i-1]));
<a name='L121'>  <b>return</b> n;
<a name='L122'><font color='red'>}</font>
<a name='L123'>
<a name='L124'>
<a name='L125'><b>static</b> <b>int</b> <a href='../S/270.html#L827' title='Refered from 827 in deps/lua/src/lstrlib.c.'>str_char</a> (lua_State *L) <font color='red'>{</font>
<a name='L126'>  <b>int</b> n = <a href='../S/272.html#L159' title='Defined at 159 in deps/lua/src/lapi.c.'>lua_gettop</a>(L);  <i><font color='green'>/* number of arguments */</font></i>
<a name='L127'>  <b>int</b> i;
<a name='L128'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L129'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L, &amp;b);
<a name='L130'>  <b>for</b> (i=1; i&lt;=n; i++) <font color='red'>{</font>
<a name='L131'>    <b>int</b> c = <a href='../S/265.html#L104' title='Defined at 104 in deps/lua/src/lauxlib.h.'>luaL_checkint</a>(L, i);
<a name='L132'>    <a href='../S/265.html#L100' title='Defined at 100 in deps/lua/src/lauxlib.h.'>luaL_argcheck</a>(L, <a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(c) == c, i, "invalid value");
<a name='L133'>    <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(&amp;b, <a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(c));
<a name='L134'>  <font color='red'>}</font>
<a name='L135'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L136'>  <b>return</b> 1;
<a name='L137'><font color='red'>}</font>
<a name='L138'>
<a name='L139'>
<a name='L140'><b>static</b> <b>int</b> <a href='../R/4087.html' title='Multiple refered from 7 places.'>writer</a> (lua_State *L, <b>const</b> <b>void</b>* b, size_t size, <b>void</b>* B) <font color='red'>{</font>
<a name='L141'>  (<b>void</b>)L;
<a name='L142'>  <a href='../S/260.html#L436' title='Defined at 436 in deps/lua/src/lauxlib.c.'>luaL_addlstring</a>((<a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a>*) B, (<b>const</b> <b>char</b> *)b, size);
<a name='L143'>  <b>return</b> 0;
<a name='L144'><font color='red'>}</font>
<a name='L145'>
<a name='L146'>
<a name='L147'><b>static</b> <b>int</b> <a href='../S/270.html#L828' title='Refered from 828 in deps/lua/src/lstrlib.c.'>str_dump</a> (lua_State *L) <font color='red'>{</font>
<a name='L148'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L149'>  <a href='../S/260.html#L146' title='Defined at 146 in deps/lua/src/lauxlib.c.'>luaL_checktype</a>(L, 1, <a href='../S/266.html#L80' title='Defined at 80 in deps/lua/src/lua.h.'>LUA_TFUNCTION</a>);
<a name='L150'>  <a href='../S/272.html#L164' title='Defined at 164 in deps/lua/src/lapi.c.'>lua_settop</a>(L, 1);
<a name='L151'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L,&amp;b);
<a name='L152'>  <b>if</b> (<a href='../S/272.html#L875' title='Defined at 875 in deps/lua/src/lapi.c.'>lua_dump</a>(L, <a href='../D/4477.html' title='Multiple defined in 2 places.'>writer</a>, &amp;b) != 0)
<a name='L153'>    <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(L, "unable to dump given function");
<a name='L154'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L155'>  <b>return</b> 1;
<a name='L156'><font color='red'>}</font>
<a name='L157'>
<a name='L158'>
<a name='L159'>
<a name='L160'><i><font color='green'>/*</font></i>
<a name='L161'><i><font color='green'>** {======================================================</font></i>
<a name='L162'><i><font color='green'>** PATTERN MATCHING</font></i>
<a name='L163'><i><font color='green'>** =======================================================</font></i>
<a name='L164'><i><font color='green'>*/</font></i>
<a name='L165'>
<a name='L166'>
<a name='L167'><font color='darkred'>#define</font> <a href='../R/56.html' title='Multiple refered from 5 places.'>CAP_UNFINISHED</a>  (-1)
<a name='L168'><font color='darkred'>#define</font> <a href='../R/55.html' title='Multiple refered from 2 places.'>CAP_POSITION</a>    (-2)
<a name='L169'>
<a name='L170'><b>typedef</b> <b>struct</b> <a href='../R/460.html' title='Multiple refered from 3 places.'>MatchState</a> <font color='red'>{</font>
<a name='L171'>  <b>const</b> <b>char</b> *src_init;  <i><font color='green'>/* init of source string */</font></i>
<a name='L172'>  <b>const</b> <b>char</b> *src_end;  <i><font color='green'>/* end (`\0') of source string */</font></i>
<a name='L173'>  <a href='../D/3087.html' title='Multiple defined in 2 places.'>lua_State</a> *L;
<a name='L174'>  <b>int</b> level;  <i><font color='green'>/* total number of captures (finished or unfinished) */</font></i>
<a name='L175'>  <b>struct</b> <font color='red'>{</font>
<a name='L176'>    <b>const</b> <b>char</b> *init;
<a name='L177'>    ptrdiff_t len;
<a name='L178'>  <font color='red'>}</font> capture[<a href='../S/317.html#L633' title='Defined at 633 in deps/lua/src/luaconf.h.'>LUA_MAXCAPTURES</a>];
<a name='L179'><font color='red'>}</font> <a href='../R/460.html' title='Multiple refered from 3 places.'>MatchState</a>;
<a name='L180'>
<a name='L181'>
<a name='L182'><font color='darkred'>#define</font> <a href='../R/404.html' title='Multiple refered from 8 places.'>L_ESC</a>           '%'
<a name='L183'><font color='darkred'>#define</font> <a href='../S/270.html#L503' title='Refered from 503 in deps/lua/src/lstrlib.c.'>SPECIALS</a>        "^$*+?.([%-"
<a name='L184'>
<a name='L185'>
<a name='L186'><b>static</b> <b>int</b> <a href='../S/270.html#L356' title='Refered from 356 in deps/lua/src/lstrlib.c.'>check_capture</a> (MatchState *ms, <b>int</b> l) <font color='red'>{</font>
<a name='L187'>  l -= '1';
<a name='L188'>  <b>if</b> (l &lt; 0 || l &gt;= ms-&gt;level || ms-&gt;capture[l].len == <a href='../S/270.html#L167' title='Defined at 167 in deps/lua/src/lstrlib.c.'>CAP_UNFINISHED</a>)
<a name='L189'>    <b>return</b> <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "invalid capture index");
<a name='L190'>  <b>return</b> l;
<a name='L191'><font color='red'>}</font>
<a name='L192'>
<a name='L193'>
<a name='L194'><b>static</b> <b>int</b> <a href='../S/270.html#L345' title='Refered from 345 in deps/lua/src/lstrlib.c.'>capture_to_close</a> (MatchState *ms) <font color='red'>{</font>
<a name='L195'>  <b>int</b> level = ms-&gt;level;
<a name='L196'>  <b>for</b> (level--; level&gt;=0; level--)
<a name='L197'>    <b>if</b> (ms-&gt;capture[level].len == <a href='../S/270.html#L167' title='Defined at 167 in deps/lua/src/lstrlib.c.'>CAP_UNFINISHED</a>) <b>return</b> level;
<a name='L198'>  <b>return</b> <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "invalid pattern capture");
<a name='L199'><font color='red'>}</font>
<a name='L200'>
<a name='L201'>
<a name='L202'><b>static</b> <b>const</b> <b>char</b> *<a href='../R/1618.html' title='Multiple refered from 2 places.'>classend</a> (MatchState *ms, <b>const</b> <b>char</b> *p) <font color='red'>{</font>
<a name='L203'>  <b>switch</b> (*p++) <font color='red'>{</font>
<a name='L204'>    <b>case</b> <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a>: <font color='red'>{</font>
<a name='L205'>      <b>if</b> (*p == '\0')
<a name='L206'>        <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "malformed pattern (ends with " <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("%%") ")");
<a name='L207'>      <b>return</b> p+1;
<a name='L208'>    <font color='red'>}</font>
<a name='L209'>    <b>case</b> '[': <font color='red'>{</font>
<a name='L210'>      <b>if</b> (*p == '^') p++;
<a name='L211'>      <b>do</b> <font color='red'>{</font>  <i><font color='green'>/* look for a `]' */</font></i>
<a name='L212'>        <b>if</b> (*p == '\0')
<a name='L213'>          <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "malformed pattern (missing " <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("]") ")");
<a name='L214'>        <b>if</b> (*(p++) == <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a> &amp;&amp; *p != '\0')
<a name='L215'>          p++;  <i><font color='green'>/* skip escapes (e.g. `%]') */</font></i>
<a name='L216'>      <font color='red'>}</font> <b>while</b> (*p != ']');
<a name='L217'>      <b>return</b> p+1;
<a name='L218'>    <font color='red'>}</font>
<a name='L219'>    <b>default</b>: <font color='red'>{</font>
<a name='L220'>      <b>return</b> p;
<a name='L221'>    <font color='red'>}</font>
<a name='L222'>  <font color='red'>}</font>
<a name='L223'><font color='red'>}</font>
<a name='L224'>
<a name='L225'>
<a name='L226'><b>static</b> <b>int</b> <a href='../R/2960.html' title='Multiple refered from 2 places.'>match_class</a> (<b>int</b> c, <b>int</b> cl) <font color='red'>{</font>
<a name='L227'>  <b>int</b> res;
<a name='L228'>  <b>switch</b> (tolower(cl)) <font color='red'>{</font>
<a name='L229'>    <b>case</b> 'a' : res = isalpha(c); <b>break</b>;
<a name='L230'>    <b>case</b> 'c' : res = iscntrl(c); <b>break</b>;
<a name='L231'>    <b>case</b> 'd' : res = isdigit(c); <b>break</b>;
<a name='L232'>    <b>case</b> 'l' : res = islower(c); <b>break</b>;
<a name='L233'>    <b>case</b> 'p' : res = ispunct(c); <b>break</b>;
<a name='L234'>    <b>case</b> 's' : res = isspace(c); <b>break</b>;
<a name='L235'>    <b>case</b> 'u' : res = isupper(c); <b>break</b>;
<a name='L236'>    <b>case</b> 'w' : res = isalnum(c); <b>break</b>;
<a name='L237'>    <b>case</b> 'x' : res = isxdigit(c); <b>break</b>;
<a name='L238'>    <b>case</b> 'z' : res = (c == 0); <b>break</b>;
<a name='L239'>    <b>default</b>: <b>return</b> (cl == c);
<a name='L240'>  <font color='red'>}</font>
<a name='L241'>  <b>return</b> (islower(cl) ? res : !res);
<a name='L242'><font color='red'>}</font>
<a name='L243'>
<a name='L244'>
<a name='L245'><b>static</b> <b>int</b> <a href='../R/2962.html' title='Multiple refered from 3 places.'>matchbracketclass</a> (<b>int</b> c, <b>const</b> <b>char</b> *p, <b>const</b> <b>char</b> *ec) <font color='red'>{</font>
<a name='L246'>  <b>int</b> sig = 1;
<a name='L247'>  <b>if</b> (*(p+1) == '^') <font color='red'>{</font>
<a name='L248'>    sig = 0;
<a name='L249'>    p++;  <i><font color='green'>/* skip the `^' */</font></i>
<a name='L250'>  <font color='red'>}</font>
<a name='L251'>  <b>while</b> (++p &lt; ec) <font color='red'>{</font>
<a name='L252'>    <b>if</b> (*p == <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a>) <font color='red'>{</font>
<a name='L253'>      p++;
<a name='L254'>      <b>if</b> (<a href='../S/270.html#L226' title='Defined at 226 in deps/lua/src/lstrlib.c.'>match_class</a>(c, <a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p)))
<a name='L255'>        <b>return</b> sig;
<a name='L256'>    <font color='red'>}</font>
<a name='L257'>    <b>else</b> <b>if</b> ((*(p+1) == '-') &amp;&amp; (p+2 &lt; ec)) <font color='red'>{</font>
<a name='L258'>      p+=2;
<a name='L259'>      <b>if</b> (<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*(p-2)) &lt;= c &amp;&amp; c &lt;= <a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p))
<a name='L260'>        <b>return</b> sig;
<a name='L261'>    <font color='red'>}</font>
<a name='L262'>    <b>else</b> <b>if</b> (<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p) == c) <b>return</b> sig;
<a name='L263'>  <font color='red'>}</font>
<a name='L264'>  <b>return</b> !sig;
<a name='L265'><font color='red'>}</font>
<a name='L266'>
<a name='L267'>
<a name='L268'><b>static</b> <b>int</b> <a href='../R/3797.html' title='Multiple refered from 3 places.'>singlematch</a> (<b>int</b> c, <b>const</b> <b>char</b> *p, <b>const</b> <b>char</b> *ep) <font color='red'>{</font>
<a name='L269'>  <b>switch</b> (*p) <font color='red'>{</font>
<a name='L270'>    <b>case</b> '.': <b>return</b> 1;  <i><font color='green'>/* matches any char */</font></i>
<a name='L271'>    <b>case</b> <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a>: <b>return</b> <a href='../S/270.html#L226' title='Defined at 226 in deps/lua/src/lstrlib.c.'>match_class</a>(c, <a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*(p+1)));
<a name='L272'>    <b>case</b> '[': <b>return</b> <a href='../S/270.html#L245' title='Defined at 245 in deps/lua/src/lstrlib.c.'>matchbracketclass</a>(c, p, ep-1);
<a name='L273'>    <b>default</b>:  <b>return</b> (<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p) == c);
<a name='L274'>  <font color='red'>}</font>
<a name='L275'><font color='red'>}</font>
<a name='L276'>
<a name='L277'>
<a name='L278'><b>static</b> <b>const</b> <b>char</b> *<a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a> (MatchState *ms, <b>const</b> <b>char</b> *s, <b>const</b> <b>char</b> *p);
<a name='L279'>
<a name='L280'>
<a name='L281'><b>static</b> <b>const</b> <b>char</b> *<a href='../S/270.html#L380' title='Refered from 380 in deps/lua/src/lstrlib.c.'>matchbalance</a> (MatchState *ms, <b>const</b> <b>char</b> *s,
<a name='L282'>                                   <b>const</b> <b>char</b> *p) <font color='red'>{</font>
<a name='L283'>  <b>if</b> (*p == 0 || *(p+1) == 0)
<a name='L284'>    <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "unbalanced pattern");
<a name='L285'>  <b>if</b> (*s != *p) <b>return</b> NULL;
<a name='L286'>  <b>else</b> <font color='red'>{</font>
<a name='L287'>    <b>int</b> b = *p;
<a name='L288'>    <b>int</b> e = *(p+1);
<a name='L289'>    <b>int</b> cont = 1;
<a name='L290'>    <b>while</b> (++s &lt; ms-&gt;src_end) <font color='red'>{</font>
<a name='L291'>      <b>if</b> (*s == e) <font color='red'>{</font>
<a name='L292'>        <b>if</b> (--cont == 0) <b>return</b> s+1;
<a name='L293'>      <font color='red'>}</font>
<a name='L294'>      <b>else</b> <b>if</b> (*s == b) cont++;
<a name='L295'>    <font color='red'>}</font>
<a name='L296'>  <font color='red'>}</font>
<a name='L297'>  <b>return</b> NULL;  <i><font color='green'>/* string ends out of balance */</font></i>
<a name='L298'><font color='red'>}</font>
<a name='L299'>
<a name='L300'>
<a name='L301'><b>static</b> <b>const</b> <b>char</b> *<a href='../R/2991.html' title='Multiple refered from 2 places.'>max_expand</a> (MatchState *ms, <b>const</b> <b>char</b> *s,
<a name='L302'>                                 <b>const</b> <b>char</b> *p, <b>const</b> <b>char</b> *ep) <font color='red'>{</font>
<a name='L303'>  ptrdiff_t i = 0;  <i><font color='green'>/* counts maximum expand for item */</font></i>
<a name='L304'>  <b>while</b> ((s+i)&lt;ms-&gt;src_end &amp;&amp; <a href='../S/270.html#L268' title='Defined at 268 in deps/lua/src/lstrlib.c.'>singlematch</a>(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*(s+i)), p, ep))
<a name='L305'>    i++;
<a name='L306'>  <i><font color='green'>/* keeps trying to match with the maximum repetitions */</font></i>
<a name='L307'>  <b>while</b> (i&gt;=0) <font color='red'>{</font>
<a name='L308'>    <b>const</b> <b>char</b> *res = <a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(ms, (s+i), ep+1);
<a name='L309'>    <b>if</b> (res) <b>return</b> res;
<a name='L310'>    i--;  <i><font color='green'>/* else didn't match; reduce 1 repetition to try again */</font></i>
<a name='L311'>  <font color='red'>}</font>
<a name='L312'>  <b>return</b> NULL;
<a name='L313'><font color='red'>}</font>
<a name='L314'>
<a name='L315'>
<a name='L316'><b>static</b> <b>const</b> <b>char</b> *<a href='../S/270.html#L431' title='Refered from 431 in deps/lua/src/lstrlib.c.'>min_expand</a> (MatchState *ms, <b>const</b> <b>char</b> *s,
<a name='L317'>                                 <b>const</b> <b>char</b> *p, <b>const</b> <b>char</b> *ep) <font color='red'>{</font>
<a name='L318'>  <b>for</b> (;;) <font color='red'>{</font>
<a name='L319'>    <b>const</b> <b>char</b> *res = <a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(ms, s, ep+1);
<a name='L320'>    <b>if</b> (res != NULL)
<a name='L321'>      <b>return</b> res;
<a name='L322'>    <b>else</b> <b>if</b> (s&lt;ms-&gt;src_end &amp;&amp; <a href='../S/270.html#L268' title='Defined at 268 in deps/lua/src/lstrlib.c.'>singlematch</a>(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*s), p, ep))
<a name='L323'>      s++;  <i><font color='green'>/* try with one more repetition */</font></i>
<a name='L324'>    <b>else</b> <b>return</b> NULL;
<a name='L325'>  <font color='red'>}</font>
<a name='L326'><font color='red'>}</font>
<a name='L327'>
<a name='L328'>
<a name='L329'><b>static</b> <b>const</b> <b>char</b> *<a href='../R/3832.html' title='Multiple refered from 2 places.'>start_capture</a> (MatchState *ms, <b>const</b> <b>char</b> *s,
<a name='L330'>                                    <b>const</b> <b>char</b> *p, <b>int</b> what) <font color='red'>{</font>
<a name='L331'>  <b>const</b> <b>char</b> *res;
<a name='L332'>  <b>int</b> level = ms-&gt;level;
<a name='L333'>  <b>if</b> (level &gt;= <a href='../S/317.html#L633' title='Defined at 633 in deps/lua/src/luaconf.h.'>LUA_MAXCAPTURES</a>) <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "too many captures");
<a name='L334'>  ms-&gt;capture[level].init = s;
<a name='L335'>  ms-&gt;capture[level].len = what;
<a name='L336'>  ms-&gt;level = level+1;
<a name='L337'>  <b>if</b> ((res=<a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(ms, s, p)) == NULL)  <i><font color='green'>/* match failed? */</font></i>
<a name='L338'>    ms-&gt;level--;  <i><font color='green'>/* undo capture */</font></i>
<a name='L339'>  <b>return</b> res;
<a name='L340'><font color='red'>}</font>
<a name='L341'>
<a name='L342'>
<a name='L343'><b>static</b> <b>const</b> <b>char</b> *<a href='../S/270.html#L375' title='Refered from 375 in deps/lua/src/lstrlib.c.'>end_capture</a> (MatchState *ms, <b>const</b> <b>char</b> *s,
<a name='L344'>                                  <b>const</b> <b>char</b> *p) <font color='red'>{</font>
<a name='L345'>  <b>int</b> l = <a href='../S/270.html#L194' title='Defined at 194 in deps/lua/src/lstrlib.c.'>capture_to_close</a>(ms);
<a name='L346'>  <b>const</b> <b>char</b> *res;
<a name='L347'>  ms-&gt;capture[l].len = s - ms-&gt;capture[l].init;  <i><font color='green'>/* close capture */</font></i>
<a name='L348'>  <b>if</b> ((res = <a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(ms, s, p)) == NULL)  <i><font color='green'>/* match failed? */</font></i>
<a name='L349'>    ms-&gt;capture[l].len = <a href='../S/270.html#L167' title='Defined at 167 in deps/lua/src/lstrlib.c.'>CAP_UNFINISHED</a>;  <i><font color='green'>/* undo capture */</font></i>
<a name='L350'>  <b>return</b> res;
<a name='L351'><font color='red'>}</font>
<a name='L352'>
<a name='L353'>
<a name='L354'><b>static</b> <b>const</b> <b>char</b> *<a href='../S/270.html#L398' title='Refered from 398 in deps/lua/src/lstrlib.c.'>match_capture</a> (MatchState *ms, <b>const</b> <b>char</b> *s, <b>int</b> l) <font color='red'>{</font>
<a name='L355'>  size_t len;
<a name='L356'>  l = <a href='../S/270.html#L186' title='Defined at 186 in deps/lua/src/lstrlib.c.'>check_capture</a>(ms, l);
<a name='L357'>  len = ms-&gt;capture[l].len;
<a name='L358'>  <b>if</b> ((size_t)(ms-&gt;src_end-s) &gt;= len &amp;&amp;
<a name='L359'>      memcmp(ms-&gt;capture[l].init, s, len) == 0)
<a name='L360'>    <b>return</b> s+len;
<a name='L361'>  <b>else</b> <b>return</b> NULL;
<a name='L362'><font color='red'>}</font>
<a name='L363'>
<a name='L364'>
<a name='L365'><b>static</b> <b>const</b> <b>char</b> *<a href='../R/2958.html' title='Multiple refered from 31 places.'>match</a> (MatchState *ms, <b>const</b> <b>char</b> *s, <b>const</b> <b>char</b> *p) <font color='red'>{</font>
<a name='L366'>  init: <i><font color='green'>/* using goto's to optimize tail recursion */</font></i>
<a name='L367'>  <b>switch</b> (*p) <font color='red'>{</font>
<a name='L368'>    <b>case</b> '(': <font color='red'>{</font>  <i><font color='green'>/* start capture */</font></i>
<a name='L369'>      <b>if</b> (*(p+1) == ')')  <i><font color='green'>/* position capture? */</font></i>
<a name='L370'>        <b>return</b> <a href='../S/270.html#L329' title='Defined at 329 in deps/lua/src/lstrlib.c.'>start_capture</a>(ms, s, p+2, <a href='../S/270.html#L168' title='Defined at 168 in deps/lua/src/lstrlib.c.'>CAP_POSITION</a>);
<a name='L371'>      <b>else</b>
<a name='L372'>        <b>return</b> <a href='../S/270.html#L329' title='Defined at 329 in deps/lua/src/lstrlib.c.'>start_capture</a>(ms, s, p+1, <a href='../S/270.html#L167' title='Defined at 167 in deps/lua/src/lstrlib.c.'>CAP_UNFINISHED</a>);
<a name='L373'>    <font color='red'>}</font>
<a name='L374'>    <b>case</b> ')': <font color='red'>{</font>  <i><font color='green'>/* end capture */</font></i>
<a name='L375'>      <b>return</b> <a href='../S/270.html#L343' title='Defined at 343 in deps/lua/src/lstrlib.c.'>end_capture</a>(ms, s, p+1);
<a name='L376'>    <font color='red'>}</font>
<a name='L377'>    <b>case</b> <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a>: <font color='red'>{</font>
<a name='L378'>      <b>switch</b> (*(p+1)) <font color='red'>{</font>
<a name='L379'>        <b>case</b> 'b': <font color='red'>{</font>  <i><font color='green'>/* balanced string? */</font></i>
<a name='L380'>          s = <a href='../S/270.html#L281' title='Defined at 281 in deps/lua/src/lstrlib.c.'>matchbalance</a>(ms, s, p+2);
<a name='L381'>          <b>if</b> (s == NULL) <b>return</b> NULL;
<a name='L382'>          p+=4; <b>goto</b> init;  <i><font color='green'>/* else return match(ms, s, p+4); */</font></i>
<a name='L383'>        <font color='red'>}</font>
<a name='L384'>        <b>case</b> 'f': <font color='red'>{</font>  <i><font color='green'>/* frontier? */</font></i>
<a name='L385'>          <b>const</b> <b>char</b> *ep; <b>char</b> previous;
<a name='L386'>          p += 2;
<a name='L387'>          <b>if</b> (*p != '[')
<a name='L388'>            <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "missing " <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("[") " after "
<a name='L389'>                               <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("%%f") " in pattern");
<a name='L390'>          ep = <a href='../S/270.html#L202' title='Defined at 202 in deps/lua/src/lstrlib.c.'>classend</a>(ms, p);  <i><font color='green'>/* points to what is next */</font></i>
<a name='L391'>          previous = (s == ms-&gt;src_init) ? '\0' : *(s-1);
<a name='L392'>          <b>if</b> (<a href='../S/270.html#L245' title='Defined at 245 in deps/lua/src/lstrlib.c.'>matchbracketclass</a>(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(previous), p, ep-1) ||
<a name='L393'>             !<a href='../S/270.html#L245' title='Defined at 245 in deps/lua/src/lstrlib.c.'>matchbracketclass</a>(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*s), p, ep-1)) <b>return</b> NULL;
<a name='L394'>          p=ep; <b>goto</b> init;  <i><font color='green'>/* else return match(ms, s, ep); */</font></i>
<a name='L395'>        <font color='red'>}</font>
<a name='L396'>        <b>default</b>: <font color='red'>{</font>
<a name='L397'>          <b>if</b> (isdigit(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*(p+1)))) <font color='red'>{</font>  <i><font color='green'>/* capture results (%0-%9)? */</font></i>
<a name='L398'>            s = <a href='../S/270.html#L354' title='Defined at 354 in deps/lua/src/lstrlib.c.'>match_capture</a>(ms, s, <a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*(p+1)));
<a name='L399'>            <b>if</b> (s == NULL) <b>return</b> NULL;
<a name='L400'>            p+=2; <b>goto</b> init;  <i><font color='green'>/* else return match(ms, s, p+2) */</font></i>
<a name='L401'>          <font color='red'>}</font>
<a name='L402'>          <b>goto</b> dflt;  <i><font color='green'>/* case default */</font></i>
<a name='L403'>        <font color='red'>}</font>
<a name='L404'>      <font color='red'>}</font>
<a name='L405'>    <font color='red'>}</font>
<a name='L406'>    <b>case</b> '\0': <font color='red'>{</font>  <i><font color='green'>/* end of pattern */</font></i>
<a name='L407'>      <b>return</b> s;  <i><font color='green'>/* match succeeded */</font></i>
<a name='L408'>    <font color='red'>}</font>
<a name='L409'>    <b>case</b> '$': <font color='red'>{</font>
<a name='L410'>      <b>if</b> (*(p+1) == '\0')  <i><font color='green'>/* is the `$' the last char in pattern? */</font></i>
<a name='L411'>        <b>return</b> (s == ms-&gt;src_end) ? s : NULL;  <i><font color='green'>/* check end of string */</font></i>
<a name='L412'>      <b>else</b> <b>goto</b> dflt;
<a name='L413'>    <font color='red'>}</font>
<a name='L414'>    <b>default</b>: dflt: <font color='red'>{</font>  <i><font color='green'>/* it is a pattern item */</font></i>
<a name='L415'>      <b>const</b> <b>char</b> *ep = <a href='../S/270.html#L202' title='Defined at 202 in deps/lua/src/lstrlib.c.'>classend</a>(ms, p);  <i><font color='green'>/* points to what is next */</font></i>
<a name='L416'>      <b>int</b> m = s&lt;ms-&gt;src_end &amp;&amp; <a href='../S/270.html#L268' title='Defined at 268 in deps/lua/src/lstrlib.c.'>singlematch</a>(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*s), p, ep);
<a name='L417'>      <b>switch</b> (*ep) <font color='red'>{</font>
<a name='L418'>        <b>case</b> '?': <font color='red'>{</font>  <i><font color='green'>/* optional */</font></i>
<a name='L419'>          <b>const</b> <b>char</b> *res;
<a name='L420'>          <b>if</b> (m &amp;&amp; ((res=<a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(ms, s+1, ep+1)) != NULL))
<a name='L421'>            <b>return</b> res;
<a name='L422'>          p=ep+1; <b>goto</b> init;  <i><font color='green'>/* else return match(ms, s, ep+1); */</font></i>
<a name='L423'>        <font color='red'>}</font>
<a name='L424'>        <b>case</b> '*': <font color='red'>{</font>  <i><font color='green'>/* 0 or more repetitions */</font></i>
<a name='L425'>          <b>return</b> <a href='../S/270.html#L301' title='Defined at 301 in deps/lua/src/lstrlib.c.'>max_expand</a>(ms, s, p, ep);
<a name='L426'>        <font color='red'>}</font>
<a name='L427'>        <b>case</b> '+': <font color='red'>{</font>  <i><font color='green'>/* 1 or more repetitions */</font></i>
<a name='L428'>          <b>return</b> (m ? <a href='../S/270.html#L301' title='Defined at 301 in deps/lua/src/lstrlib.c.'>max_expand</a>(ms, s+1, p, ep) : NULL);
<a name='L429'>        <font color='red'>}</font>
<a name='L430'>        <b>case</b> '-': <font color='red'>{</font>  <i><font color='green'>/* 0 or more repetitions (minimum) */</font></i>
<a name='L431'>          <b>return</b> <a href='../S/270.html#L316' title='Defined at 316 in deps/lua/src/lstrlib.c.'>min_expand</a>(ms, s, p, ep);
<a name='L432'>        <font color='red'>}</font>
<a name='L433'>        <b>default</b>: <font color='red'>{</font>
<a name='L434'>          <b>if</b> (!m) <b>return</b> NULL;
<a name='L435'>          s++; p=ep; <b>goto</b> init;  <i><font color='green'>/* else return match(ms, s+1, ep); */</font></i>
<a name='L436'>        <font color='red'>}</font>
<a name='L437'>      <font color='red'>}</font>
<a name='L438'>    <font color='red'>}</font>
<a name='L439'>  <font color='red'>}</font>
<a name='L440'><font color='red'>}</font>
<a name='L441'>
<a name='L442'>
<a name='L443'>
<a name='L444'><b>static</b> <b>const</b> <b>char</b> *<a href='../S/270.html#L505' title='Refered from 505 in deps/lua/src/lstrlib.c.'>lmemfind</a> (<b>const</b> <b>char</b> *s1, size_t l1,
<a name='L445'>                               <b>const</b> <b>char</b> *s2, size_t l2) <font color='red'>{</font>
<a name='L446'>  <b>if</b> (l2 == 0) <b>return</b> s1;  <i><font color='green'>/* empty strings are everywhere */</font></i>
<a name='L447'>  <b>else</b> <b>if</b> (l2 &gt; l1) <b>return</b> NULL;  <i><font color='green'>/* avoids a negative `l1' */</font></i>
<a name='L448'>  <b>else</b> <font color='red'>{</font>
<a name='L449'>    <b>const</b> <b>char</b> *init;  <i><font color='green'>/* to search for a `*s2' inside `s1' */</font></i>
<a name='L450'>    l2--;  <i><font color='green'>/* 1st char will be checked by `memchr' */</font></i>
<a name='L451'>    l1 = l1-l2;  <i><font color='green'>/* `s2' cannot be found after that */</font></i>
<a name='L452'>    <b>while</b> (l1 &gt; 0 &amp;&amp; (init = (<b>const</b> <b>char</b> *)memchr(s1, *s2, l1)) != NULL) <font color='red'>{</font>
<a name='L453'>      init++;   <i><font color='green'>/* 1st char is already checked */</font></i>
<a name='L454'>      <b>if</b> (memcmp(init, s2+1, l2) == 0)
<a name='L455'>        <b>return</b> init-1;
<a name='L456'>      <b>else</b> <font color='red'>{</font>  <i><font color='green'>/* correct `l1' and `s1' to try again */</font></i>
<a name='L457'>        l1 -= init-s1;
<a name='L458'>        s1 = init;
<a name='L459'>      <font color='red'>}</font>
<a name='L460'>    <font color='red'>}</font>
<a name='L461'>    <b>return</b> NULL;  <i><font color='green'>/* not found */</font></i>
<a name='L462'>  <font color='red'>}</font>
<a name='L463'><font color='red'>}</font>
<a name='L464'>
<a name='L465'>
<a name='L466'><b>static</b> <b>void</b> <a href='../R/3267.html' title='Multiple refered from 3 places.'>push_onecapture</a> (MatchState *ms, <b>int</b> i, <b>const</b> <b>char</b> *s,
<a name='L467'>                                                    <b>const</b> <b>char</b> *e) <font color='red'>{</font>
<a name='L468'>  <b>if</b> (i &gt;= ms-&gt;level) <font color='red'>{</font>
<a name='L469'>    <b>if</b> (i == 0)  <i><font color='green'>/* ms-&gt;level == 0, too */</font></i>
<a name='L470'>      <a href='../S/272.html#L445' title='Defined at 445 in deps/lua/src/lapi.c.'>lua_pushlstring</a>(ms-&gt;L, s, e - s);  <i><font color='green'>/* add whole match */</font></i>
<a name='L471'>    <b>else</b>
<a name='L472'>      <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "invalid capture index");
<a name='L473'>  <font color='red'>}</font>
<a name='L474'>  <b>else</b> <font color='red'>{</font>
<a name='L475'>    ptrdiff_t l = ms-&gt;capture[i].len;
<a name='L476'>    <b>if</b> (l == <a href='../S/270.html#L167' title='Defined at 167 in deps/lua/src/lstrlib.c.'>CAP_UNFINISHED</a>) <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(ms-&gt;L, "unfinished capture");
<a name='L477'>    <b>if</b> (l == <a href='../S/270.html#L168' title='Defined at 168 in deps/lua/src/lstrlib.c.'>CAP_POSITION</a>)
<a name='L478'>      <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(ms-&gt;L, ms-&gt;capture[i].init - ms-&gt;src_init + 1);
<a name='L479'>    <b>else</b>
<a name='L480'>      <a href='../S/272.html#L445' title='Defined at 445 in deps/lua/src/lapi.c.'>lua_pushlstring</a>(ms-&gt;L, ms-&gt;capture[i].init, l);
<a name='L481'>  <font color='red'>}</font>
<a name='L482'><font color='red'>}</font>
<a name='L483'>
<a name='L484'>
<a name='L485'><b>static</b> <b>int</b> <a href='../R/3266.html' title='Multiple refered from 4 places.'>push_captures</a> (MatchState *ms, <b>const</b> <b>char</b> *s, <b>const</b> <b>char</b> *e) <font color='red'>{</font>
<a name='L486'>  <b>int</b> i;
<a name='L487'>  <b>int</b> nlevels = (ms-&gt;level == 0 &amp;&amp; s) ? 1 : ms-&gt;level;
<a name='L488'>  <a href='../S/260.html#L140' title='Defined at 140 in deps/lua/src/lauxlib.c.'>luaL_checkstack</a>(ms-&gt;L, nlevels, "too many captures");
<a name='L489'>  <b>for</b> (i = 0; i &lt; nlevels; i++)
<a name='L490'>    <a href='../S/270.html#L466' title='Defined at 466 in deps/lua/src/lstrlib.c.'>push_onecapture</a>(ms, i, s, e);
<a name='L491'>  <b>return</b> nlevels;  <i><font color='green'>/* number of strings pushed */</font></i>
<a name='L492'><font color='red'>}</font>
<a name='L493'>
<a name='L494'>
<a name='L495'><b>static</b> <b>int</b> <a href='../R/3854.html' title='Multiple refered from 2 places.'>str_find_aux</a> (lua_State *L, <b>int</b> find) <font color='red'>{</font>
<a name='L496'>  size_t l1, l2;
<a name='L497'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;l1);
<a name='L498'>  <b>const</b> <b>char</b> *p = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 2, &amp;l2);
<a name='L499'>  ptrdiff_t init = <a href='../S/270.html#L36' title='Defined at 36 in deps/lua/src/lstrlib.c.'>posrelat</a>(<a href='../S/260.html#L197' title='Defined at 197 in deps/lua/src/lauxlib.c.'>luaL_optinteger</a>(L, 3, 1), l1) - 1;
<a name='L500'>  <b>if</b> (init &lt; 0) init = 0;
<a name='L501'>  <b>else</b> <b>if</b> ((size_t)(init) &gt; l1) init = (ptrdiff_t)l1;
<a name='L502'>  <b>if</b> (find &amp;&amp; (<a href='../S/272.html#L337' title='Defined at 337 in deps/lua/src/lapi.c.'>lua_toboolean</a>(L, 4) ||  <i><font color='green'>/* explicit request? */</font></i>
<a name='L503'>      strpbrk(p, <a href='../S/270.html#L183' title='Defined at 183 in deps/lua/src/lstrlib.c.'>SPECIALS</a>) == NULL)) <font color='red'>{</font>  <i><font color='green'>/* or no special characters? */</font></i>
<a name='L504'>    <i><font color='green'>/* do a plain search */</font></i>
<a name='L505'>    <b>const</b> <b>char</b> *s2 = <a href='../S/270.html#L444' title='Defined at 444 in deps/lua/src/lstrlib.c.'>lmemfind</a>(s+init, l1-init, p, l2);
<a name='L506'>    <b>if</b> (s2) <font color='red'>{</font>
<a name='L507'>      <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, s2-s+1);
<a name='L508'>      <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, s2-s+l2);
<a name='L509'>      <b>return</b> 2;
<a name='L510'>    <font color='red'>}</font>
<a name='L511'>  <font color='red'>}</font>
<a name='L512'>  <b>else</b> <font color='red'>{</font>
<a name='L513'>    <a href='../D/511.html' title='Multiple defined in 2 places.'>MatchState</a> ms;
<a name='L514'>    <b>int</b> anchor = (*p == '^') ? (p++, 1) : 0;
<a name='L515'>    <b>const</b> <b>char</b> *s1=s+init;
<a name='L516'>    ms.L = L;
<a name='L517'>    ms.src_init = s;
<a name='L518'>    ms.src_end = s+l1;
<a name='L519'>    <b>do</b> <font color='red'>{</font>
<a name='L520'>      <b>const</b> <b>char</b> *res;
<a name='L521'>      ms.level = 0;
<a name='L522'>      <b>if</b> ((res=<a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(&amp;ms, s1, p)) != NULL) <font color='red'>{</font>
<a name='L523'>        <b>if</b> (find) <font color='red'>{</font>
<a name='L524'>          <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, s1-s+1);  <i><font color='green'>/* start */</font></i>
<a name='L525'>          <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, res-s);   <i><font color='green'>/* end */</font></i>
<a name='L526'>          <b>return</b> <a href='../S/270.html#L485' title='Defined at 485 in deps/lua/src/lstrlib.c.'>push_captures</a>(&amp;ms, NULL, 0) + 2;
<a name='L527'>        <font color='red'>}</font>
<a name='L528'>        <b>else</b>
<a name='L529'>          <b>return</b> <a href='../S/270.html#L485' title='Defined at 485 in deps/lua/src/lstrlib.c.'>push_captures</a>(&amp;ms, s1, res);
<a name='L530'>      <font color='red'>}</font>
<a name='L531'>    <font color='red'>}</font> <b>while</b> (s1++ &lt; ms.src_end &amp;&amp; !anchor);
<a name='L532'>  <font color='red'>}</font>
<a name='L533'>  <a href='../S/272.html#L421' title='Defined at 421 in deps/lua/src/lapi.c.'>lua_pushnil</a>(L);  <i><font color='green'>/* not found */</font></i>
<a name='L534'>  <b>return</b> 1;
<a name='L535'><font color='red'>}</font>
<a name='L536'>
<a name='L537'>
<a name='L538'><b>static</b> <b>int</b> <a href='../S/270.html#L829' title='Refered from 829 in deps/lua/src/lstrlib.c.'>str_find</a> (lua_State *L) <font color='red'>{</font>
<a name='L539'>  <b>return</b> <a href='../S/270.html#L495' title='Defined at 495 in deps/lua/src/lstrlib.c.'>str_find_aux</a>(L, 1);
<a name='L540'><font color='red'>}</font>
<a name='L541'>
<a name='L542'>
<a name='L543'><b>static</b> <b>int</b> <a href='../S/270.html#L836' title='Refered from 836 in deps/lua/src/lstrlib.c.'>str_match</a> (lua_State *L) <font color='red'>{</font>
<a name='L544'>  <b>return</b> <a href='../S/270.html#L495' title='Defined at 495 in deps/lua/src/lstrlib.c.'>str_find_aux</a>(L, 0);
<a name='L545'><font color='red'>}</font>
<a name='L546'>
<a name='L547'>
<a name='L548'><b>static</b> <b>int</b> <a href='../S/270.html#L579' title='Refered from 579 in deps/lua/src/lstrlib.c.'>gmatch_aux</a> (lua_State *L) <font color='red'>{</font>
<a name='L549'>  <a href='../D/511.html' title='Multiple defined in 2 places.'>MatchState</a> ms;
<a name='L550'>  size_t ls;
<a name='L551'>  <b>const</b> <b>char</b> *s = <a href='../S/272.html#L343' title='Defined at 343 in deps/lua/src/lapi.c.'>lua_tolstring</a>(L, <a href='../S/266.html#L39' title='Defined at 39 in deps/lua/src/lua.h.'>lua_upvalueindex</a>(1), &amp;ls);
<a name='L552'>  <b>const</b> <b>char</b> *p = <a href='../S/266.html#L279' title='Defined at 279 in deps/lua/src/lua.h.'>lua_tostring</a>(L, <a href='../S/266.html#L39' title='Defined at 39 in deps/lua/src/lua.h.'>lua_upvalueindex</a>(2));
<a name='L553'>  <b>const</b> <b>char</b> *src;
<a name='L554'>  ms.L = L;
<a name='L555'>  ms.src_init = s;
<a name='L556'>  ms.src_end = s+ls;
<a name='L557'>  <b>for</b> (src = s + (size_t)<a href='../S/272.html#L323' title='Defined at 323 in deps/lua/src/lapi.c.'>lua_tointeger</a>(L, <a href='../S/266.html#L39' title='Defined at 39 in deps/lua/src/lua.h.'>lua_upvalueindex</a>(3));
<a name='L558'>       src &lt;= ms.src_end;
<a name='L559'>       src++) <font color='red'>{</font>
<a name='L560'>    <b>const</b> <b>char</b> *e;
<a name='L561'>    ms.level = 0;
<a name='L562'>    <b>if</b> ((e = <a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(&amp;ms, src, p)) != NULL) <font color='red'>{</font>
<a name='L563'>      <a href='../S/266.html#L103' title='Defined at 103 in deps/lua/src/lua.h.'>lua_Integer</a> newstart = e-s;
<a name='L564'>      <b>if</b> (e == src) newstart++;  <i><font color='green'>/* empty match? go at least one position */</font></i>
<a name='L565'>      <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, newstart);
<a name='L566'>      <a href='../S/272.html#L203' title='Defined at 203 in deps/lua/src/lapi.c.'>lua_replace</a>(L, <a href='../S/266.html#L39' title='Defined at 39 in deps/lua/src/lua.h.'>lua_upvalueindex</a>(3));
<a name='L567'>      <b>return</b> <a href='../S/270.html#L485' title='Defined at 485 in deps/lua/src/lstrlib.c.'>push_captures</a>(&amp;ms, src, e);
<a name='L568'>    <font color='red'>}</font>
<a name='L569'>  <font color='red'>}</font>
<a name='L570'>  <b>return</b> 0;  <i><font color='green'>/* not found */</font></i>
<a name='L571'><font color='red'>}</font>
<a name='L572'>
<a name='L573'>
<a name='L574'><b>static</b> <b>int</b> <a href='../S/270.html#L832' title='Refered from 832 in deps/lua/src/lstrlib.c.'>gmatch</a> (lua_State *L) <font color='red'>{</font>
<a name='L575'>  <a href='../S/265.html#L102' title='Defined at 102 in deps/lua/src/lauxlib.h.'>luaL_checkstring</a>(L, 1);
<a name='L576'>  <a href='../S/265.html#L102' title='Defined at 102 in deps/lua/src/lauxlib.h.'>luaL_checkstring</a>(L, 2);
<a name='L577'>  <a href='../S/272.html#L164' title='Defined at 164 in deps/lua/src/lapi.c.'>lua_settop</a>(L, 2);
<a name='L578'>  <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, 0);
<a name='L579'>  <a href='../S/272.html#L486' title='Defined at 486 in deps/lua/src/lapi.c.'>lua_pushcclosure</a>(L, <a href='../S/270.html#L548' title='Defined at 548 in deps/lua/src/lstrlib.c.'>gmatch_aux</a>, 3);
<a name='L580'>  <b>return</b> 1;
<a name='L581'><font color='red'>}</font>
<a name='L582'>
<a name='L583'>
<a name='L584'><b>static</b> <b>int</b> <a href='../S/270.html#L831' title='Refered from 831 in deps/lua/src/lstrlib.c.'>gfind_nodef</a> (lua_State *L) <font color='red'>{</font>
<a name='L585'>  <b>return</b> <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(L, <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("string.gfind") " was renamed to "
<a name='L586'>                       <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("string.gmatch"));
<a name='L587'><font color='red'>}</font>
<a name='L588'>
<a name='L589'>
<a name='L590'><b>static</b> <b>void</b> <a href='../S/270.html#L618' title='Refered from 618 in deps/lua/src/lstrlib.c.'>add_s</a> (MatchState *ms, luaL_Buffer *b, <b>const</b> <b>char</b> *s,
<a name='L591'>                                                   <b>const</b> <b>char</b> *e) <font color='red'>{</font>
<a name='L592'>  size_t l, i;
<a name='L593'>  <b>const</b> <b>char</b> *news = <a href='../S/272.html#L343' title='Defined at 343 in deps/lua/src/lapi.c.'>lua_tolstring</a>(ms-&gt;L, 3, &amp;l);
<a name='L594'>  <b>for</b> (i = 0; i &lt; l; i++) <font color='red'>{</font>
<a name='L595'>    <b>if</b> (news[i] != <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a>)
<a name='L596'>      <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(b, news[i]);
<a name='L597'>    <b>else</b> <font color='red'>{</font>
<a name='L598'>      i++;  <i><font color='green'>/* skip ESC */</font></i>
<a name='L599'>      <b>if</b> (!isdigit(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(news[i])))
<a name='L600'>        <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(b, news[i]);
<a name='L601'>      <b>else</b> <b>if</b> (news[i] == '0')
<a name='L602'>          <a href='../S/260.html#L436' title='Defined at 436 in deps/lua/src/lauxlib.c.'>luaL_addlstring</a>(b, s, e - s);
<a name='L603'>      <b>else</b> <font color='red'>{</font>
<a name='L604'>        <a href='../S/270.html#L466' title='Defined at 466 in deps/lua/src/lstrlib.c.'>push_onecapture</a>(ms, news[i] - '1', s, e);
<a name='L605'>        <a href='../S/260.html#L454' title='Defined at 454 in deps/lua/src/lauxlib.c.'>luaL_addvalue</a>(b);  <i><font color='green'>/* add capture to accumulated result */</font></i>
<a name='L606'>      <font color='red'>}</font>
<a name='L607'>    <font color='red'>}</font>
<a name='L608'>  <font color='red'>}</font>
<a name='L609'><font color='red'>}</font>
<a name='L610'>
<a name='L611'>
<a name='L612'><b>static</b> <b>void</b> <a href='../S/270.html#L667' title='Refered from 667 in deps/lua/src/lstrlib.c.'>add_value</a> (MatchState *ms, luaL_Buffer *b, <b>const</b> <b>char</b> *s,
<a name='L613'>                                                       <b>const</b> <b>char</b> *e) <font color='red'>{</font>
<a name='L614'>  <a href='../D/3087.html' title='Multiple defined in 2 places.'>lua_State</a> *L = ms-&gt;L;
<a name='L615'>  <b>switch</b> (<a href='../S/272.html#L242' title='Defined at 242 in deps/lua/src/lapi.c.'>lua_type</a>(L, 3)) <font color='red'>{</font>
<a name='L616'>    <b>case</b> <a href='../S/266.html#L77' title='Defined at 77 in deps/lua/src/lua.h.'>LUA_TNUMBER</a>:
<a name='L617'>    <b>case</b> <a href='../S/266.html#L78' title='Defined at 78 in deps/lua/src/lua.h.'>LUA_TSTRING</a>: <font color='red'>{</font>
<a name='L618'>      <a href='../S/270.html#L590' title='Defined at 590 in deps/lua/src/lstrlib.c.'>add_s</a>(ms, b, s, e);
<a name='L619'>      <b>return</b>;
<a name='L620'>    <font color='red'>}</font>
<a name='L621'>    <b>case</b> <a href='../S/266.html#L80' title='Defined at 80 in deps/lua/src/lua.h.'>LUA_TFUNCTION</a>: <font color='red'>{</font>
<a name='L622'>      <b>int</b> n;
<a name='L623'>      <a href='../S/272.html#L228' title='Defined at 228 in deps/lua/src/lapi.c.'>lua_pushvalue</a>(L, 3);
<a name='L624'>      n = <a href='../S/270.html#L485' title='Defined at 485 in deps/lua/src/lstrlib.c.'>push_captures</a>(ms, s, e);
<a name='L625'>      <a href='../S/272.html#L776' title='Defined at 776 in deps/lua/src/lapi.c.'>lua_call</a>(L, n, 1);
<a name='L626'>      <b>break</b>;
<a name='L627'>    <font color='red'>}</font>
<a name='L628'>    <b>case</b> <a href='../S/266.html#L79' title='Defined at 79 in deps/lua/src/lua.h.'>LUA_TTABLE</a>: <font color='red'>{</font>
<a name='L629'>      <a href='../S/270.html#L466' title='Defined at 466 in deps/lua/src/lstrlib.c.'>push_onecapture</a>(ms, 0, s, e);
<a name='L630'>      <a href='../S/272.html#L534' title='Defined at 534 in deps/lua/src/lapi.c.'>lua_gettable</a>(L, 3);
<a name='L631'>      <b>break</b>;
<a name='L632'>    <font color='red'>}</font>
<a name='L633'>  <font color='red'>}</font>
<a name='L634'>  <b>if</b> (!<a href='../S/272.html#L337' title='Defined at 337 in deps/lua/src/lapi.c.'>lua_toboolean</a>(L, -1)) <font color='red'>{</font>  <i><font color='green'>/* nil or false? */</font></i>
<a name='L635'>    <a href='../S/266.html#L254' title='Defined at 254 in deps/lua/src/lua.h.'>lua_pop</a>(L, 1);
<a name='L636'>    <a href='../S/272.html#L445' title='Defined at 445 in deps/lua/src/lapi.c.'>lua_pushlstring</a>(L, s, e - s);  <i><font color='green'>/* keep original text */</font></i>
<a name='L637'>  <font color='red'>}</font>
<a name='L638'>  <b>else</b> <b>if</b> (!<a href='../S/272.html#L267' title='Defined at 267 in deps/lua/src/lapi.c.'>lua_isstring</a>(L, -1))
<a name='L639'>    <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(L, "invalid replacement value (a %s)", <a href='../S/265.html#L109' title='Defined at 109 in deps/lua/src/lauxlib.h.'>luaL_typename</a>(L, -1)); 
<a name='L640'>  <a href='../S/260.html#L454' title='Defined at 454 in deps/lua/src/lauxlib.c.'>luaL_addvalue</a>(b);  <i><font color='green'>/* add result to accumulator */</font></i>
<a name='L641'><font color='red'>}</font>
<a name='L642'>
<a name='L643'>
<a name='L644'><b>static</b> <b>int</b> <a href='../S/270.html#L833' title='Refered from 833 in deps/lua/src/lstrlib.c.'>str_gsub</a> (lua_State *L) <font color='red'>{</font>
<a name='L645'>  size_t srcl;
<a name='L646'>  <b>const</b> <b>char</b> *src = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, 1, &amp;srcl);
<a name='L647'>  <b>const</b> <b>char</b> *p = <a href='../S/265.html#L102' title='Defined at 102 in deps/lua/src/lauxlib.h.'>luaL_checkstring</a>(L, 2);
<a name='L648'>  <b>int</b>  tr = <a href='../S/272.html#L242' title='Defined at 242 in deps/lua/src/lapi.c.'>lua_type</a>(L, 3);
<a name='L649'>  <b>int</b> max_s = <a href='../S/265.html#L105' title='Defined at 105 in deps/lua/src/lauxlib.h.'>luaL_optint</a>(L, 4, srcl+1);
<a name='L650'>  <b>int</b> anchor = (*p == '^') ? (p++, 1) : 0;
<a name='L651'>  <b>int</b> n = 0;
<a name='L652'>  <a href='../D/511.html' title='Multiple defined in 2 places.'>MatchState</a> ms;
<a name='L653'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L654'>  <a href='../S/265.html#L100' title='Defined at 100 in deps/lua/src/lauxlib.h.'>luaL_argcheck</a>(L, tr == <a href='../S/266.html#L77' title='Defined at 77 in deps/lua/src/lua.h.'>LUA_TNUMBER</a> || tr == <a href='../S/266.html#L78' title='Defined at 78 in deps/lua/src/lua.h.'>LUA_TSTRING</a> ||
<a name='L655'>                   tr == <a href='../S/266.html#L80' title='Defined at 80 in deps/lua/src/lua.h.'>LUA_TFUNCTION</a> || tr == <a href='../S/266.html#L79' title='Defined at 79 in deps/lua/src/lua.h.'>LUA_TTABLE</a>, 3,
<a name='L656'>                      "string/function/table expected");
<a name='L657'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L, &amp;b);
<a name='L658'>  ms.L = L;
<a name='L659'>  ms.src_init = src;
<a name='L660'>  ms.src_end = src+srcl;
<a name='L661'>  <b>while</b> (n &lt; max_s) <font color='red'>{</font>
<a name='L662'>    <b>const</b> <b>char</b> *e;
<a name='L663'>    ms.level = 0;
<a name='L664'>    e = <a href='../S/270.html#L365' title='Defined at 365 in deps/lua/src/lstrlib.c.'>match</a>(&amp;ms, src, p);
<a name='L665'>    <b>if</b> (e) <font color='red'>{</font>
<a name='L666'>      n++;
<a name='L667'>      <a href='../S/270.html#L612' title='Defined at 612 in deps/lua/src/lstrlib.c.'>add_value</a>(&amp;ms, &amp;b, src, e);
<a name='L668'>    <font color='red'>}</font>
<a name='L669'>    <b>if</b> (e &amp;&amp; e&gt;src) <i><font color='green'>/* non empty match? */</font></i>
<a name='L670'>      src = e;  <i><font color='green'>/* skip it */</font></i>
<a name='L671'>    <b>else</b> <b>if</b> (src &lt; ms.src_end)
<a name='L672'>      <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(&amp;b, *src++);
<a name='L673'>    <b>else</b> <b>break</b>;
<a name='L674'>    <b>if</b> (anchor) <b>break</b>;
<a name='L675'>  <font color='red'>}</font>
<a name='L676'>  <a href='../S/260.html#L436' title='Defined at 436 in deps/lua/src/lauxlib.c.'>luaL_addlstring</a>(&amp;b, src, ms.src_end-src);
<a name='L677'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L678'>  <a href='../S/272.html#L437' title='Defined at 437 in deps/lua/src/lapi.c.'>lua_pushinteger</a>(L, n);  <i><font color='green'>/* number of substitutions */</font></i>
<a name='L679'>  <b>return</b> 2;
<a name='L680'><font color='red'>}</font>
<a name='L681'>
<a name='L682'><i><font color='green'>/* }====================================================== */</font></i>
<a name='L683'>
<a name='L684'>
<a name='L685'><i><font color='green'>/* maximum size of each formatted item (&gt; len(format('%99.99f', -1e308))) */</font></i>
<a name='L686'><font color='darkred'>#define</font> <a href='../S/270.html#L770' title='Refered from 770 in deps/lua/src/lstrlib.c.'>MAX_ITEM</a>        512
<a name='L687'><i><font color='green'>/* valid flags in a format specification */</font></i>
<a name='L688'><font color='darkred'>#define</font> <a href='../R/149.html' title='Multiple refered from 3 places.'>FLAGS</a>   "-+ #0"
<a name='L689'><i><font color='green'>/*</font></i>
<a name='L690'><i><font color='green'>** maximum size of each format specification (such as '%-099.99d')</font></i>
<a name='L691'><i><font color='green'>** (+10 accounts for %99.99x plus margin of error)</font></i>
<a name='L692'><i><font color='green'>*/</font></i>
<a name='L693'><font color='darkred'>#define</font> <a href='../S/270.html#L769' title='Refered from 769 in deps/lua/src/lstrlib.c.'>MAX_FORMAT</a>      (<b>sizeof</b>(<a href='../S/270.html#L688' title='Defined at 688 in deps/lua/src/lstrlib.c.'>FLAGS</a>) + <b>sizeof</b>(<a href='../D/383.html' title='Multiple defined in 2 places.'>LUA_INTFRMLEN</a>) + 10)
<a name='L694'>
<a name='L695'>
<a name='L696'><b>static</b> <b>void</b> <a href='../S/270.html#L794' title='Refered from 794 in deps/lua/src/lstrlib.c.'>addquoted</a> (lua_State *L, luaL_Buffer *b, <b>int</b> arg) <font color='red'>{</font>
<a name='L697'>  size_t l;
<a name='L698'>  <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, arg, &amp;l);
<a name='L699'>  <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(b, '"');
<a name='L700'>  <b>while</b> (l--) <font color='red'>{</font>
<a name='L701'>    <b>switch</b> (*s) <font color='red'>{</font>
<a name='L702'>      <b>case</b> '"': <b>case</b> '\\': <b>case</b> '\n': <font color='red'>{</font>
<a name='L703'>        <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(b, '\\');
<a name='L704'>        <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(b, *s);
<a name='L705'>        <b>break</b>;
<a name='L706'>      <font color='red'>}</font>
<a name='L707'>      <b>case</b> '\r': <font color='red'>{</font>
<a name='L708'>        <a href='../S/260.html#L436' title='Defined at 436 in deps/lua/src/lauxlib.c.'>luaL_addlstring</a>(b, "\\r", 2);
<a name='L709'>        <b>break</b>;
<a name='L710'>      <font color='red'>}</font>
<a name='L711'>      <b>case</b> '\0': <font color='red'>{</font>
<a name='L712'>        <a href='../S/260.html#L436' title='Defined at 436 in deps/lua/src/lauxlib.c.'>luaL_addlstring</a>(b, "\\000", 4);
<a name='L713'>        <b>break</b>;
<a name='L714'>      <font color='red'>}</font>
<a name='L715'>      <b>default</b>: <font color='red'>{</font>
<a name='L716'>        <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(b, *s);
<a name='L717'>        <b>break</b>;
<a name='L718'>      <font color='red'>}</font>
<a name='L719'>    <font color='red'>}</font>
<a name='L720'>    s++;
<a name='L721'>  <font color='red'>}</font>
<a name='L722'>  <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(b, '"');
<a name='L723'><font color='red'>}</font>
<a name='L724'>
<a name='L725'><b>static</b> <b>const</b> <b>char</b> *<a href='../S/270.html#L772' title='Refered from 772 in deps/lua/src/lstrlib.c.'>scanformat</a> (lua_State *L, <b>const</b> <b>char</b> *strfrmt, <b>char</b> *form) <font color='red'>{</font>
<a name='L726'>  <b>const</b> <b>char</b> *p = strfrmt;
<a name='L727'>  <b>while</b> (*p != '\0' &amp;&amp; strchr(<a href='../S/270.html#L688' title='Defined at 688 in deps/lua/src/lstrlib.c.'>FLAGS</a>, *p) != NULL) p++;  <i><font color='green'>/* skip flags */</font></i>
<a name='L728'>  <b>if</b> ((size_t)(p - strfrmt) &gt;= <b>sizeof</b>(<a href='../S/270.html#L688' title='Defined at 688 in deps/lua/src/lstrlib.c.'>FLAGS</a>))
<a name='L729'>    <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(L, "invalid format (repeated flags)");
<a name='L730'>  <b>if</b> (isdigit(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p))) p++;  <i><font color='green'>/* skip width */</font></i>
<a name='L731'>  <b>if</b> (isdigit(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p))) p++;  <i><font color='green'>/* (2 digits at most) */</font></i>
<a name='L732'>  <b>if</b> (*p == '.') <font color='red'>{</font>
<a name='L733'>    p++;
<a name='L734'>    <b>if</b> (isdigit(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p))) p++;  <i><font color='green'>/* skip precision */</font></i>
<a name='L735'>    <b>if</b> (isdigit(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p))) p++;  <i><font color='green'>/* (2 digits at most) */</font></i>
<a name='L736'>  <font color='red'>}</font>
<a name='L737'>  <b>if</b> (isdigit(<a href='../S/270.html#L24' title='Defined at 24 in deps/lua/src/lstrlib.c.'>uchar</a>(*p)))
<a name='L738'>    <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(L, "invalid format (width or precision too long)");
<a name='L739'>  *(form++) = '%';
<a name='L740'>  strncpy(form, strfrmt, p - strfrmt + 1);
<a name='L741'>  form += p - strfrmt + 1;
<a name='L742'>  *form = '\0';
<a name='L743'>  <b>return</b> p;
<a name='L744'><font color='red'>}</font>
<a name='L745'>
<a name='L746'>
<a name='L747'><b>static</b> <b>void</b> <a href='../R/1221.html' title='Multiple refered from 2 places.'>addintlen</a> (<b>char</b> *form) <font color='red'>{</font>
<a name='L748'>  size_t l = strlen(form);
<a name='L749'>  <b>char</b> spec = form[l - 1];
<a name='L750'>  strcpy(form + l - 1, <a href='../D/383.html' title='Multiple defined in 2 places.'>LUA_INTFRMLEN</a>);
<a name='L751'>  form[l + <b>sizeof</b>(<a href='../D/383.html' title='Multiple defined in 2 places.'>LUA_INTFRMLEN</a>) - 2] = spec;
<a name='L752'>  form[l + <b>sizeof</b>(<a href='../D/383.html' title='Multiple defined in 2 places.'>LUA_INTFRMLEN</a>) - 1] = '\0';
<a name='L753'><font color='red'>}</font>
<a name='L754'>
<a name='L755'>
<a name='L756'><b>static</b> <b>int</b> <a href='../S/270.html#L830' title='Refered from 830 in deps/lua/src/lstrlib.c.'>str_format</a> (lua_State *L) <font color='red'>{</font>
<a name='L757'>  <b>int</b> arg = 1;
<a name='L758'>  size_t sfl;
<a name='L759'>  <b>const</b> <b>char</b> *strfrmt = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, arg, &amp;sfl);
<a name='L760'>  <b>const</b> <b>char</b> *strfrmt_end = strfrmt+sfl;
<a name='L761'>  <a href='../D/2951.html' title='Multiple defined in 2 places.'>luaL_Buffer</a> b;
<a name='L762'>  <a href='../S/260.html#L472' title='Defined at 472 in deps/lua/src/lauxlib.c.'>luaL_buffinit</a>(L, &amp;b);
<a name='L763'>  <b>while</b> (strfrmt &lt; strfrmt_end) <font color='red'>{</font>
<a name='L764'>    <b>if</b> (*strfrmt != <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a>)
<a name='L765'>      <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(&amp;b, *strfrmt++);
<a name='L766'>    <b>else</b> <b>if</b> (*++strfrmt == <a href='../S/270.html#L182' title='Defined at 182 in deps/lua/src/lstrlib.c.'>L_ESC</a>)
<a name='L767'>      <a href='../S/265.html#L136' title='Defined at 136 in deps/lua/src/lauxlib.h.'>luaL_addchar</a>(&amp;b, *strfrmt++);  <i><font color='green'>/* %% */</font></i>
<a name='L768'>    <b>else</b> <font color='red'>{</font> <i><font color='green'>/* format item */</font></i>
<a name='L769'>      <b>char</b> form[<a href='../S/270.html#L693' title='Defined at 693 in deps/lua/src/lstrlib.c.'>MAX_FORMAT</a>];  <i><font color='green'>/* to store the format (`%...') */</font></i>
<a name='L770'>      <b>char</b> buff[<a href='../S/270.html#L686' title='Defined at 686 in deps/lua/src/lstrlib.c.'>MAX_ITEM</a>];  <i><font color='green'>/* to store the formatted item */</font></i>
<a name='L771'>      arg++;
<a name='L772'>      strfrmt = <a href='../S/270.html#L725' title='Defined at 725 in deps/lua/src/lstrlib.c.'>scanformat</a>(L, strfrmt, form);
<a name='L773'>      <b>switch</b> (*strfrmt++) <font color='red'>{</font>
<a name='L774'>        <b>case</b> 'c': <font color='red'>{</font>
<a name='L775'>          sprintf(buff, form, (<b>int</b>)<a href='../S/260.html#L176' title='Defined at 176 in deps/lua/src/lauxlib.c.'>luaL_checknumber</a>(L, arg));
<a name='L776'>          <b>break</b>;
<a name='L777'>        <font color='red'>}</font>
<a name='L778'>        <b>case</b> 'd':  <b>case</b> 'i': <font color='red'>{</font>
<a name='L779'>          <a href='../S/270.html#L747' title='Defined at 747 in deps/lua/src/lstrlib.c.'>addintlen</a>(form);
<a name='L780'>          sprintf(buff, form, (<a href='../D/384.html' title='Multiple defined in 2 places.'>LUA_INTFRM_T</a>)<a href='../S/260.html#L176' title='Defined at 176 in deps/lua/src/lauxlib.c.'>luaL_checknumber</a>(L, arg));
<a name='L781'>          <b>break</b>;
<a name='L782'>        <font color='red'>}</font>
<a name='L783'>        <b>case</b> 'o':  <b>case</b> 'u':  <b>case</b> 'x':  <b>case</b> 'X': <font color='red'>{</font>
<a name='L784'>          <a href='../S/270.html#L747' title='Defined at 747 in deps/lua/src/lstrlib.c.'>addintlen</a>(form);
<a name='L785'>          sprintf(buff, form, (<b>unsigned</b> <a href='../D/384.html' title='Multiple defined in 2 places.'>LUA_INTFRM_T</a>)<a href='../S/260.html#L176' title='Defined at 176 in deps/lua/src/lauxlib.c.'>luaL_checknumber</a>(L, arg));
<a name='L786'>          <b>break</b>;
<a name='L787'>        <font color='red'>}</font>
<a name='L788'>        <b>case</b> 'e':  <b>case</b> 'E': <b>case</b> 'f':
<a name='L789'>        <b>case</b> 'g': <b>case</b> 'G': <font color='red'>{</font>
<a name='L790'>          sprintf(buff, form, (<b>double</b>)<a href='../S/260.html#L176' title='Defined at 176 in deps/lua/src/lauxlib.c.'>luaL_checknumber</a>(L, arg));
<a name='L791'>          <b>break</b>;
<a name='L792'>        <font color='red'>}</font>
<a name='L793'>        <b>case</b> 'q': <font color='red'>{</font>
<a name='L794'>          <a href='../S/270.html#L696' title='Defined at 696 in deps/lua/src/lstrlib.c.'>addquoted</a>(L, &amp;b, arg);
<a name='L795'>          <b>continue</b>;  <i><font color='green'>/* skip the 'addsize' at the end */</font></i>
<a name='L796'>        <font color='red'>}</font>
<a name='L797'>        <b>case</b> 's': <font color='red'>{</font>
<a name='L798'>          size_t l;
<a name='L799'>          <b>const</b> <b>char</b> *s = <a href='../S/260.html#L158' title='Defined at 158 in deps/lua/src/lauxlib.c.'>luaL_checklstring</a>(L, arg, &amp;l);
<a name='L800'>          <b>if</b> (!strchr(form, '.') &amp;&amp; l &gt;= 100) <font color='red'>{</font>
<a name='L801'>            <i><font color='green'>/* no precision and string is too long to be formatted;</font></i>
<a name='L802'><i><font color='green'>               keep original string */</font></i>
<a name='L803'>            <a href='../S/272.html#L228' title='Defined at 228 in deps/lua/src/lapi.c.'>lua_pushvalue</a>(L, arg);
<a name='L804'>            <a href='../S/260.html#L454' title='Defined at 454 in deps/lua/src/lauxlib.c.'>luaL_addvalue</a>(&amp;b);
<a name='L805'>            <b>continue</b>;  <i><font color='green'>/* skip the `addsize' at the end */</font></i>
<a name='L806'>          <font color='red'>}</font>
<a name='L807'>          <b>else</b> <font color='red'>{</font>
<a name='L808'>            sprintf(buff, form, s);
<a name='L809'>            <b>break</b>;
<a name='L810'>          <font color='red'>}</font>
<a name='L811'>        <font color='red'>}</font>
<a name='L812'>        <b>default</b>: <font color='red'>{</font>  <i><font color='green'>/* also treat cases `pnLlh' */</font></i>
<a name='L813'>          <b>return</b> <a href='../S/260.html#L86' title='Defined at 86 in deps/lua/src/lauxlib.c.'>luaL_error</a>(L, "invalid option " <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("%%%c") " to "
<a name='L814'>                               <a href='../S/317.html#L201' title='Defined at 201 in deps/lua/src/luaconf.h.'>LUA_QL</a>("format"), *(strfrmt - 1));
<a name='L815'>        <font color='red'>}</font>
<a name='L816'>      <font color='red'>}</font>
<a name='L817'>      <a href='../S/260.html#L436' title='Defined at 436 in deps/lua/src/lauxlib.c.'>luaL_addlstring</a>(&amp;b, buff, strlen(buff));
<a name='L818'>    <font color='red'>}</font>
<a name='L819'>  <font color='red'>}</font>
<a name='L820'>  <a href='../S/260.html#L447' title='Defined at 447 in deps/lua/src/lauxlib.c.'>luaL_pushresult</a>(&amp;b);
<a name='L821'>  <b>return</b> 1;
<a name='L822'><font color='red'>}</font>
<a name='L823'>
<a name='L824'>
<a name='L825'><b>static</b> <b>const</b> <a href='../D/2952.html' title='Multiple defined in 2 places.'>luaL_Reg</a> strlib[] = <font color='red'>{</font>
<a name='L826'>  <font color='red'>{</font>"byte", <a href='../S/270.html#L106' title='Defined at 106 in deps/lua/src/lstrlib.c.'>str_byte</a><font color='red'>}</font>,
<a name='L827'>  <font color='red'>{</font>"char", <a href='../S/270.html#L125' title='Defined at 125 in deps/lua/src/lstrlib.c.'>str_char</a><font color='red'>}</font>,
<a name='L828'>  <font color='red'>{</font>"dump", <a href='../S/270.html#L147' title='Defined at 147 in deps/lua/src/lstrlib.c.'>str_dump</a><font color='red'>}</font>,
<a name='L829'>  <font color='red'>{</font>"find", <a href='../S/270.html#L538' title='Defined at 538 in deps/lua/src/lstrlib.c.'>str_find</a><font color='red'>}</font>,
<a name='L830'>  <font color='red'>{</font>"format", <a href='../S/270.html#L756' title='Defined at 756 in deps/lua/src/lstrlib.c.'>str_format</a><font color='red'>}</font>,
<a name='L831'>  <font color='red'>{</font>"gfind", <a href='../S/270.html#L584' title='Defined at 584 in deps/lua/src/lstrlib.c.'>gfind_nodef</a><font color='red'>}</font>,
<a name='L832'>  <font color='red'>{</font>"gmatch", <a href='../S/270.html#L574' title='Defined at 574 in deps/lua/src/lstrlib.c.'>gmatch</a><font color='red'>}</font>,
<a name='L833'>  <font color='red'>{</font>"gsub", <a href='../S/270.html#L644' title='Defined at 644 in deps/lua/src/lstrlib.c.'>str_gsub</a><font color='red'>}</font>,
<a name='L834'>  <font color='red'>{</font>"len", <a href='../S/270.html#L28' title='Defined at 28 in deps/lua/src/lstrlib.c.'>str_len</a><font color='red'>}</font>,
<a name='L835'>  <font color='red'>{</font>"lower", <a href='../S/270.html#L68' title='Defined at 68 in deps/lua/src/lstrlib.c.'>str_lower</a><font color='red'>}</font>,
<a name='L836'>  <font color='red'>{</font>"match", <a href='../S/270.html#L543' title='Defined at 543 in deps/lua/src/lstrlib.c.'>str_match</a><font color='red'>}</font>,
<a name='L837'>  <font color='red'>{</font>"rep", <a href='../S/270.html#L93' title='Defined at 93 in deps/lua/src/lstrlib.c.'>str_rep</a><font color='red'>}</font>,
<a name='L838'>  <font color='red'>{</font>"reverse", <a href='../S/270.html#L57' title='Defined at 57 in deps/lua/src/lstrlib.c.'>str_reverse</a><font color='red'>}</font>,
<a name='L839'>  <font color='red'>{</font>"sub", <a href='../S/270.html#L43' title='Defined at 43 in deps/lua/src/lstrlib.c.'>str_sub</a><font color='red'>}</font>,
<a name='L840'>  <font color='red'>{</font>"upper", <a href='../S/270.html#L81' title='Defined at 81 in deps/lua/src/lstrlib.c.'>str_upper</a><font color='red'>}</font>,
<a name='L841'>  <font color='red'>{</font>NULL, NULL<font color='red'>}</font>
<a name='L842'><font color='red'>}</font>;
<a name='L843'>
<a name='L844'>
<a name='L845'><b>static</b> <b>void</b> <a href='../S/270.html#L866' title='Refered from 866 in deps/lua/src/lstrlib.c.'>createmetatable</a> (lua_State *L) <font color='red'>{</font>
<a name='L846'>  <a href='../S/272.html#L578' title='Defined at 578 in deps/lua/src/lapi.c.'>lua_createtable</a>(L, 0, 1);  <i><font color='green'>/* create metatable for strings */</font></i>
<a name='L847'>  <a href='../S/266.html#L273' title='Defined at 273 in deps/lua/src/lua.h.'>lua_pushliteral</a>(L, "");  <i><font color='green'>/* dummy string */</font></i>
<a name='L848'>  <a href='../S/272.html#L228' title='Defined at 228 in deps/lua/src/lapi.c.'>lua_pushvalue</a>(L, -2);
<a name='L849'>  <a href='../S/272.html#L697' title='Defined at 697 in deps/lua/src/lapi.c.'>lua_setmetatable</a>(L, -2);  <i><font color='green'>/* set string metatable */</font></i>
<a name='L850'>  <a href='../S/266.html#L254' title='Defined at 254 in deps/lua/src/lua.h.'>lua_pop</a>(L, 1);  <i><font color='green'>/* pop dummy string */</font></i>
<a name='L851'>  <a href='../S/272.html#L228' title='Defined at 228 in deps/lua/src/lapi.c.'>lua_pushvalue</a>(L, -2);  <i><font color='green'>/* string library... */</font></i>
<a name='L852'>  <a href='../S/272.html#L657' title='Defined at 657 in deps/lua/src/lapi.c.'>lua_setfield</a>(L, -2, "__index");  <i><font color='green'>/* ...is the __index metamethod */</font></i>
<a name='L853'>  <a href='../S/266.html#L254' title='Defined at 254 in deps/lua/src/lua.h.'>lua_pop</a>(L, 1);  <i><font color='green'>/* pop metatable */</font></i>
<a name='L854'><font color='red'>}</font>
<a name='L855'>
<a name='L856'>
<a name='L857'><i><font color='green'>/*</font></i>
<a name='L858'><i><font color='green'>** Open string library</font></i>
<a name='L859'><i><font color='green'>*/</font></i>
<a name='L860'><a href='../S/317.html#L169' title='Defined at 169 in deps/lua/src/luaconf.h.'>LUALIB_API</a> <b>int</b> <a href='../R/2904.html' title='Multiple refered from 3 places.'>luaopen_string</a> (lua_State *L) <font color='red'>{</font>
<a name='L861'>  luaL_register(L, <a href='../S/267.html#L30' title='Defined at 30 in deps/lua/src/lualib.h.'>LUA_STRLIBNAME</a>, strlib);
<a name='L862'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/317.html#L358' title='Defined at 358 in deps/lua/src/luaconf.h.'>LUA_COMPAT_GFIND</a>)
<a name='L863'>  <a href='../S/272.html#L544' title='Defined at 544 in deps/lua/src/lapi.c.'>lua_getfield</a>(L, -1, "gmatch");
<a name='L864'>  <a href='../S/272.html#L657' title='Defined at 657 in deps/lua/src/lapi.c.'>lua_setfield</a>(L, -2, "gfind");
<a name='L865'><font color='darkred'>#endif</font>
<a name='L866'>  <a href='../S/270.html#L845' title='Defined at 845 in deps/lua/src/lstrlib.c.'>createmetatable</a>(L);
<a name='L867'>  <b>return</b> 1;
<a name='L868'><font color='red'>}</font>
<a name='L869'>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L28'>[^]</a><a href='#L860'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
