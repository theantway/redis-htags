<html>
<head>
<title>src/networking.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/401.html'>src</a>/networking.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L39'>[^]</a><a href='#L1355'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L39' title='Defined at 39.'>zmalloc_size_sds</a>
<li><a href='#L43' title='Defined at 43.'>dupClientReplyValue</a>
<li><a href='#L48' title='Defined at 48.'>listMatchObjects</a>
<li><a href='#L52' title='Defined at 52.'>createClient</a>
<li><a href='#L122' title='Defined at 122.'>prepareClientToWrite</a>
<li><a href='#L135' title='Defined at 135.'>dupLastObjectIfNeeded</a>
<li><a href='#L153' title='Defined at 153.'>_addReplyToBuffer</a>
<li><a href='#L170' title='Defined at 170.'>_addReplyObjectToList</a>
<li><a href='#L201' title='Defined at 201.'>_addReplySdsToList</a>
<li><a href='#L232' title='Defined at 232.'>_addReplyStringToList</a>
<li><a href='#L268' title='Defined at 268.'>addReply</a>
<li><a href='#L304' title='Defined at 304.'>addReplySds</a>
<li><a href='#L318' title='Defined at 318.'>addReplyString</a>
<li><a href='#L324' title='Defined at 324.'>addReplyErrorLength</a>
<li><a href='#L330' title='Defined at 330.'>addReplyError</a>
<li><a href='#L334' title='Defined at 334.'>addReplyErrorFormat</a>
<li><a href='#L350' title='Defined at 350.'>addReplyStatusLength</a>
<li><a href='#L356' title='Defined at 356.'>addReplyStatus</a>
<li><a href='#L360' title='Defined at 360.'>addReplyStatusFormat</a>
<li><a href='#L371' title='Defined at 371.'>addDeferredMultiBulkLength</a>
<li><a href='#L381' title='Defined at 381.'>setDeferredMultiBulkLength</a>
<li><a href='#L407' title='Defined at 407.'>addReplyDouble</a>
<li><a href='#L417' title='Defined at 417.'>addReplyLongLongWithPrefix</a>
<li><a href='#L439' title='Defined at 439.'>addReplyLongLong</a>
<li><a href='#L448' title='Defined at 448.'>addReplyMultiBulkLen</a>
<li><a href='#L453' title='Defined at 453.'>addReplyBulkLen</a>
<li><a href='#L475' title='Defined at 475.'>addReplyBulk</a>
<li><a href='#L482' title='Defined at 482.'>addReplyBulkCBuffer</a>
<li><a href='#L489' title='Defined at 489.'>addReplyBulkCString</a>
<li><a href='#L498' title='Defined at 498.'>addReplyBulkLongLong</a>
<li><a href='#L509' title='Defined at 509.'>copyClientOutputBuffer</a>
<li><a href='#L517' title='Defined at 517.'>acceptCommonHandler</a>
<li><a href='#L543' title='Defined at 543.'>acceptTcpHandler</a>
<li><a href='#L559' title='Defined at 559.'>acceptUnixHandler</a>
<li><a href='#L575' title='Defined at 575.'>freeClientArgv</a>
<li><a href='#L586' title='Defined at 586.'>disconnectSlaves</a>
<li><a href='#L593' title='Defined at 593.'>freeClient</a>
<li><a href='#L678' title='Defined at 678.'>freeClientAsync</a>
<li><a href='#L684' title='Defined at 684.'>freeClientsInAsyncFreeQueue</a>
<li><a href='#L695' title='Defined at 695.'>sendReplyToClient</a>
<li><a href='#L781' title='Defined at 781.'>resetClient</a>
<li><a href='#L790' title='Defined at 790.'>processInlineBuffer</a>
<li><a href='#L831' title='Defined at 831.'>setProtocolError</a>
<li><a href='#L842' title='Defined at 842.'>processMultibulkBuffer</a>
<li><a href='#L974' title='Defined at 974.'>processInputBuffer</a>
<li><a href='#L1013' title='Defined at 1013.'>readQueryFromClient</a>
<li><a href='#L1074' title='Defined at 1074.'>getClientsMaxBuffers</a>
<li><a href='#L1093' title='Defined at 1093.'>getClientInfoString</a>
<li><a href='#L1143' title='Defined at 1143.'>getAllClientsInfoString</a>
<li><a href='#L1162' title='Defined at 1162.'>clientCommand</a>
<li><a href='#L1199' title='Defined at 1199.'>rewriteClientCommandVector</a>
<li><a href='#L1228' title='Defined at 1228.'>rewriteClientCommandArgument</a>
<li><a href='#L1257' title='Defined at 1257.'>getClientOutputBufferMemoryUsage</a>
<li><a href='#L1271' title='Defined at 1271.'>getClientLimitClass</a>
<li><a href='#L1278' title='Defined at 1278.'>getClientLimitClassByName</a>
<li><a href='#L1285' title='Defined at 1285.'>getClientLimitClassName</a>
<li><a href='#L1300' title='Defined at 1300.'>checkClientOutputBufferLimits</a>
<li><a href='#L1341' title='Defined at 1341.'>asyncCloseClientOnOutputBufferLimitReached</a>
<li><a href='#L1355' title='Defined at 1355.'>flushSlavesOutputBuffers</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'> * Copyright (c) 2009-2012, Salvatore Sanfilippo &lt;antirez at gmail dot com&gt;</font></i>
<a name='L3'><i><font color='green'> * All rights reserved.</font></i>
<a name='L4'><i><font color='green'> *</font></i>
<a name='L5'><i><font color='green'> * Redistribution and use in source and binary forms, with or without</font></i>
<a name='L6'><i><font color='green'> * modification, are permitted provided that the following conditions are met:</font></i>
<a name='L7'><i><font color='green'> *</font></i>
<a name='L8'><i><font color='green'> *   * Redistributions of source code must retain the above copyright notice,</font></i>
<a name='L9'><i><font color='green'> *     this list of conditions and the following disclaimer.</font></i>
<a name='L10'><i><font color='green'> *   * Redistributions in binary form must reproduce the above copyright</font></i>
<a name='L11'><i><font color='green'> *     notice, this list of conditions and the following disclaimer in the</font></i>
<a name='L12'><i><font color='green'> *     documentation and/or other materials provided with the distribution.</font></i>
<a name='L13'><i><font color='green'> *   * Neither the name of Redis nor the names of its contributors may be used</font></i>
<a name='L14'><i><font color='green'> *     to endorse or promote products derived from this software without</font></i>
<a name='L15'><i><font color='green'> *     specific prior written permission.</font></i>
<a name='L16'><i><font color='green'> *</font></i>
<a name='L17'><i><font color='green'> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</font></i>
<a name='L18'><i><font color='green'> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</font></i>
<a name='L19'><i><font color='green'> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</font></i>
<a name='L20'><i><font color='green'> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</font></i>
<a name='L21'><i><font color='green'> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</font></i>
<a name='L22'><i><font color='green'> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</font></i>
<a name='L23'><i><font color='green'> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</font></i>
<a name='L24'><i><font color='green'> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</font></i>
<a name='L25'><i><font color='green'> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</font></i>
<a name='L26'><i><font color='green'> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</font></i>
<a name='L27'><i><font color='green'> * POSSIBILITY OF SUCH DAMAGE.</font></i>
<a name='L28'><i><font color='green'> */</font></i>
<a name='L29'>
<a name='L30'><font color='darkred'>#include</font> "<a href='32.html'>redis.h</a>"
<a name='L31'><font color='darkred'>#include</font> &lt;sys/uio.h&gt;
<a name='L32'>
<a name='L33'><b>static</b> <b>void</b> <a href='../S/86.html#L831' title='Defined at 831 in src/networking.c.'>setProtocolError</a>(redisClient *c, <b>int</b> pos);
<a name='L34'>
<a name='L35'><i><font color='green'>/* To evaluate the output buffer size of a client we need to get size of</font></i>
<a name='L36'><i><font color='green'> * allocated objects, however we can't used zmalloc_size() directly on sds</font></i>
<a name='L37'><i><font color='green'> * strings because of the trick they use to work (the header is before the</font></i>
<a name='L38'><i><font color='green'> * returned pointer), so we use this helper function. */</font></i>
<a name='L39'>size_t <a href='../R/4159.html' title='Multiple refered from 17 places.'>zmalloc_size_sds</a>(sds s) <font color='red'>{</font>
<a name='L40'>    <b>return</b> <a href='../D/4548.html' title='Multiple defined in 4 places.'>zmalloc_size</a>(s-<b>sizeof</b>(<b>struct</b> <a href='../D/4010.html' title='Multiple defined in 2 places.'>sdshdr</a>));
<a name='L41'><font color='red'>}</font>
<a name='L42'>
<a name='L43'><b>void</b> *<a href='../R/1878.html' title='Multiple refered from 3 places.'>dupClientReplyValue</a>(<b>void</b> *o) <font color='red'>{</font>
<a name='L44'>    <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>((<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*)o);
<a name='L45'>    <b>return</b> o;
<a name='L46'><font color='red'>}</font>
<a name='L47'>
<a name='L48'><b>int</b> <a href='../S/86.html#L102' title='Refered from 102 in src/networking.c.'>listMatchObjects</a>(<b>void</b> *a, <b>void</b> *b) <font color='red'>{</font>
<a name='L49'>    <b>return</b> <a href='../S/71.html#L365' title='Defined at 365 in src/object.c.'>equalStringObjects</a>(a,b);
<a name='L50'><font color='red'>}</font>
<a name='L51'>
<a name='L52'><a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *<a href='../R/1691.html' title='Multiple refered from 7 places.'>createClient</a>(<b>int</b> fd) <font color='red'>{</font>
<a name='L53'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(<a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a>));
<a name='L54'>
<a name='L55'>    <i><font color='green'>/* passing -1 as fd it is possible to create a non connected client.</font></i>
<a name='L56'><i><font color='green'>     * This is useful since all the Redis commands needs to be executed</font></i>
<a name='L57'><i><font color='green'>     * in the context of a client. When commands are executed in other</font></i>
<a name='L58'><i><font color='green'>     * contexts (for instance a Lua script) we need a non connected client. */</font></i>
<a name='L59'>    <b>if</b> (fd != -1) <font color='red'>{</font>
<a name='L60'>        <a href='../S/50.html#L60' title='Defined at 60 in src/anet.c.'>anetNonBlock</a>(NULL,fd);
<a name='L61'>        <a href='../S/50.html#L78' title='Defined at 78 in src/anet.c.'>anetTcpNoDelay</a>(NULL,fd);
<a name='L62'>        <b>if</b> (<a href='../S/36.html#L104' title='Defined at 104 in src/ae.c.'>aeCreateFileEvent</a>(server.el,fd,<a href='../S/38.html#L40' title='Defined at 40 in src/ae.h.'>AE_READABLE</a>,
<a name='L63'>            <a href='../S/86.html#L1013' title='Defined at 1013 in src/networking.c.'>readQueryFromClient</a>, c) == <a href='../S/38.html#L37' title='Defined at 37 in src/ae.h.'>AE_ERR</a>)
<a name='L64'>        <font color='red'>{</font>
<a name='L65'>            close(fd);
<a name='L66'>            <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(c);
<a name='L67'>            <b>return</b> NULL;
<a name='L68'>        <font color='red'>}</font>
<a name='L69'>    <font color='red'>}</font>
<a name='L70'>
<a name='L71'>    <a href='../S/31.html#L181' title='Defined at 181 in src/db.c.'>selectDb</a>(c,0);
<a name='L72'>    c-&gt;fd = fd;
<a name='L73'>    c-&gt;bufpos = 0;
<a name='L74'>    c-&gt;querybuf = <a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>();
<a name='L75'>    c-&gt;querybuf_peak = 0;
<a name='L76'>    c-&gt;reqtype = 0;
<a name='L77'>    c-&gt;argc = 0;
<a name='L78'>    c-&gt;argv = NULL;
<a name='L79'>    c-&gt;cmd = c-&gt;lastcmd = NULL;
<a name='L80'>    c-&gt;multibulklen = 0;
<a name='L81'>    c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> = -1;
<a name='L82'>    c-&gt;sentlen = 0;
<a name='L83'>    c-&gt;flags = 0;
<a name='L84'>    c-&gt;ctime = c-&gt;lastinteraction = server.unixtime;
<a name='L85'>    c-&gt;authenticated = 0;
<a name='L86'>    c-&gt;replstate = <a href='../S/32.html#L199' title='Defined at 199 in src/redis.h.'>REDIS_REPL_NONE</a>;
<a name='L87'>    c-&gt;slave_listening_port = 0;
<a name='L88'>    c-&gt;reply = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L89'>    c-&gt;reply_bytes = 0;
<a name='L90'>    c-&gt;obuf_soft_limit_reached_time = 0;
<a name='L91'>    <a href='../S/58.html#L65' title='Defined at 65 in src/adlist.h.'>listSetFreeMethod</a>(c-&gt;reply,<a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>);
<a name='L92'>    <a href='../S/58.html#L64' title='Defined at 64 in src/adlist.h.'>listSetDupMethod</a>(c-&gt;reply,<a href='../S/86.html#L43' title='Defined at 43 in src/networking.c.'>dupClientReplyValue</a>);
<a name='L93'>    c-&gt;bpop.keys = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;setDictType,NULL);
<a name='L94'>    c-&gt;bpop.timeout = 0;
<a name='L95'>    c-&gt;bpop.target = NULL;
<a name='L96'>    c-&gt;io_keys = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L97'>    c-&gt;watched_keys = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L98'>    <a href='../S/58.html#L65' title='Defined at 65 in src/adlist.h.'>listSetFreeMethod</a>(c-&gt;io_keys,<a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>);
<a name='L99'>    c-&gt;pubsub_channels = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;setDictType,NULL);
<a name='L100'>    c-&gt;pubsub_patterns = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L101'>    <a href='../S/58.html#L65' title='Defined at 65 in src/adlist.h.'>listSetFreeMethod</a>(c-&gt;pubsub_patterns,<a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>);
<a name='L102'>    <a href='../S/58.html#L66' title='Defined at 66 in src/adlist.h.'>listSetMatchMethod</a>(c-&gt;pubsub_patterns,<a href='../S/86.html#L48' title='Defined at 48 in src/networking.c.'>listMatchObjects</a>);
<a name='L103'>    <b>if</b> (fd != -1) <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(server.clients,c);
<a name='L104'>    <a href='../S/81.html#L35' title='Defined at 35 in src/multi.c.'>initClientMultiState</a>(c);
<a name='L105'>    <b>return</b> c;
<a name='L106'><font color='red'>}</font>
<a name='L107'>
<a name='L108'><i><font color='green'>/* This function is called every time we are going to transmit new data</font></i>
<a name='L109'><i><font color='green'> * to the client. The behavior is the following:</font></i>
<a name='L110'><i><font color='green'> *</font></i>
<a name='L111'><i><font color='green'> * If the client should receive new data (normal clients will) the function</font></i>
<a name='L112'><i><font color='green'> * returns REDIS_OK, and make sure to install the write handler in our event</font></i>
<a name='L113'><i><font color='green'> * loop so that when the socket is writable new data gets written.</font></i>
<a name='L114'><i><font color='green'> *</font></i>
<a name='L115'><i><font color='green'> * If the client should not receive new data, because it is a fake client</font></i>
<a name='L116'><i><font color='green'> * or a slave, or because the setup of the write handler failed, the function</font></i>
<a name='L117'><i><font color='green'> * returns REDIS_ERR.</font></i>
<a name='L118'><i><font color='green'> *</font></i>
<a name='L119'><i><font color='green'> * Typically gets called every time a reply is built, before adding more</font></i>
<a name='L120'><i><font color='green'> * data to the clients output buffers. If the function returns REDIS_ERR no</font></i>
<a name='L121'><i><font color='green'> * data should be appended to the output buffers. */</font></i>
<a name='L122'><b>int</b> <a href='../R/3160.html' title='Multiple refered from 4 places.'>prepareClientToWrite</a>(redisClient *c) <font color='red'>{</font>
<a name='L123'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L181' title='Defined at 181 in src/redis.h.'>REDIS_LUA_CLIENT</a>) <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L124'>    <b>if</b> (c-&gt;fd &lt;= 0) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>; <i><font color='green'>/* Fake client */</font></i>
<a name='L125'>    <b>if</b> (c-&gt;bufpos == 0 &amp;&amp; <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) == 0 &amp;&amp;
<a name='L126'>        (c-&gt;replstate == <a href='../S/32.html#L199' title='Defined at 199 in src/redis.h.'>REDIS_REPL_NONE</a> ||
<a name='L127'>         c-&gt;replstate == <a href='../S/32.html#L216' title='Defined at 216 in src/redis.h.'>REDIS_REPL_ONLINE</a>) &amp;&amp;
<a name='L128'>        <a href='../S/36.html#L104' title='Defined at 104 in src/ae.c.'>aeCreateFileEvent</a>(server.el, c-&gt;fd, <a href='../S/38.html#L41' title='Defined at 41 in src/ae.h.'>AE_WRITABLE</a>,
<a name='L129'>        <a href='../S/86.html#L695' title='Defined at 695 in src/networking.c.'>sendReplyToClient</a>, c) == <a href='../S/38.html#L37' title='Defined at 37 in src/ae.h.'>AE_ERR</a>) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L130'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L131'><font color='red'>}</font>
<a name='L132'>
<a name='L133'><i><font color='green'>/* Create a duplicate of the last object in the reply list when</font></i>
<a name='L134'><i><font color='green'> * it is not exclusively owned by the reply list. */</font></i>
<a name='L135'><a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *<a href='../R/1879.html' title='Multiple refered from 3 places.'>dupLastObjectIfNeeded</a>(list *reply) <font color='red'>{</font>
<a name='L136'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *new, *cur;
<a name='L137'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L138'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(reply) &gt; 0);
<a name='L139'>    ln = <a href='../S/58.html#L59' title='Defined at 59 in src/adlist.h.'>listLast</a>(reply);
<a name='L140'>    cur = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L141'>    <b>if</b> (cur-&gt;refcount &gt; 1) <font color='red'>{</font>
<a name='L142'>        new = <a href='../S/71.html#L92' title='Defined at 92 in src/object.c.'>dupStringObject</a>(cur);
<a name='L143'>        <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(cur);
<a name='L144'>        <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln) = new;
<a name='L145'>    <font color='red'>}</font>
<a name='L146'>    <b>return</b> <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L147'><font color='red'>}</font>
<a name='L148'>
<a name='L149'><i><font color='green'>/* -----------------------------------------------------------------------------</font></i>
<a name='L150'><i><font color='green'> * Low level functions to add more data to output buffers.</font></i>
<a name='L151'><i><font color='green'> * -------------------------------------------------------------------------- */</font></i>
<a name='L152'>
<a name='L153'><b>int</b> <a href='../R/1156.html' title='Multiple refered from 5 places.'>_addReplyToBuffer</a>(redisClient *c, <b>char</b> *s, size_t len) <font color='red'>{</font>
<a name='L154'>    size_t available = <b>sizeof</b>(c-&gt;buf)-c-&gt;bufpos;
<a name='L155'>
<a name='L156'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>) <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L157'>
<a name='L158'>    <i><font color='green'>/* If there already are entries in the reply list, we cannot</font></i>
<a name='L159'><i><font color='green'>     * add anything more to the static buffer. */</font></i>
<a name='L160'>    <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) &gt; 0) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L161'>
<a name='L162'>    <i><font color='green'>/* Check that the buffer has enough space available for this string. */</font></i>
<a name='L163'>    <b>if</b> (len &gt; available) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L164'>
<a name='L165'>    memcpy(c-&gt;buf+c-&gt;bufpos,s,len);
<a name='L166'>    c-&gt;bufpos+=len;
<a name='L167'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L168'><font color='red'>}</font>
<a name='L169'>
<a name='L170'><b>void</b> <a href='../R/1153.html' title='Multiple refered from 2 places.'>_addReplyObjectToList</a>(redisClient *c, robj *o) <font color='red'>{</font>
<a name='L171'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *tail;
<a name='L172'>
<a name='L173'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>) <b>return</b>;
<a name='L174'>
<a name='L175'>    <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) == 0) <font color='red'>{</font>
<a name='L176'>        <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(o);
<a name='L177'>        <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(c-&gt;reply,o);
<a name='L178'>        c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(o-&gt;ptr);
<a name='L179'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L180'>        tail = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(<a href='../S/58.html#L59' title='Defined at 59 in src/adlist.h.'>listLast</a>(c-&gt;reply));
<a name='L181'>
<a name='L182'>        <i><font color='green'>/* Append to this object when possible. */</font></i>
<a name='L183'>        <b>if</b> (tail-&gt;ptr != NULL &amp;&amp;
<a name='L184'>            <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(tail-&gt;ptr)+<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(o-&gt;ptr) &lt;= <a href='../S/32.html#L98' title='Defined at 98 in src/redis.h.'>REDIS_REPLY_CHUNK_BYTES</a>)
<a name='L185'>        <font color='red'>{</font>
<a name='L186'>            c-&gt;reply_bytes -= <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(tail-&gt;ptr);
<a name='L187'>            tail = <a href='../S/86.html#L135' title='Defined at 135 in src/networking.c.'>dupLastObjectIfNeeded</a>(c-&gt;reply);
<a name='L188'>            tail-&gt;ptr = <a href='../D/3995.html' title='Multiple defined in 2 places.'>sdscatlen</a>(tail-&gt;ptr,o-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(o-&gt;ptr));
<a name='L189'>            c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(tail-&gt;ptr);
<a name='L190'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L191'>            <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(o);
<a name='L192'>            <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(c-&gt;reply,o);
<a name='L193'>            c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(o-&gt;ptr);
<a name='L194'>        <font color='red'>}</font>
<a name='L195'>    <font color='red'>}</font>
<a name='L196'>    <a href='../S/86.html#L1341' title='Defined at 1341 in src/networking.c.'>asyncCloseClientOnOutputBufferLimitReached</a>(c);
<a name='L197'><font color='red'>}</font>
<a name='L198'>
<a name='L199'><i><font color='green'>/* This method takes responsibility over the sds. When it is no longer</font></i>
<a name='L200'><i><font color='green'> * needed it will be free'd, otherwise it ends up in a robj. */</font></i>
<a name='L201'><b>void</b> <a href='../S/86.html#L314' title='Refered from 314 in src/networking.c.'>_addReplySdsToList</a>(redisClient *c, sds s) <font color='red'>{</font>
<a name='L202'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *tail;
<a name='L203'>
<a name='L204'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>) <font color='red'>{</font>
<a name='L205'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(s);
<a name='L206'>        <b>return</b>;
<a name='L207'>    <font color='red'>}</font>
<a name='L208'>
<a name='L209'>    <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) == 0) <font color='red'>{</font>
<a name='L210'>        <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(c-&gt;reply,<a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,s));
<a name='L211'>        c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(s);
<a name='L212'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L213'>        tail = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(<a href='../S/58.html#L59' title='Defined at 59 in src/adlist.h.'>listLast</a>(c-&gt;reply));
<a name='L214'>
<a name='L215'>        <i><font color='green'>/* Append to this object when possible. */</font></i>
<a name='L216'>        <b>if</b> (tail-&gt;ptr != NULL &amp;&amp;
<a name='L217'>            <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(tail-&gt;ptr)+<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(s) &lt;= <a href='../S/32.html#L98' title='Defined at 98 in src/redis.h.'>REDIS_REPLY_CHUNK_BYTES</a>)
<a name='L218'>        <font color='red'>{</font>
<a name='L219'>            c-&gt;reply_bytes -= <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(tail-&gt;ptr);
<a name='L220'>            tail = <a href='../S/86.html#L135' title='Defined at 135 in src/networking.c.'>dupLastObjectIfNeeded</a>(c-&gt;reply);
<a name='L221'>            tail-&gt;ptr = <a href='../D/3995.html' title='Multiple defined in 2 places.'>sdscatlen</a>(tail-&gt;ptr,s,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(s));
<a name='L222'>            c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(tail-&gt;ptr);
<a name='L223'>            <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(s);
<a name='L224'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L225'>            <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(c-&gt;reply,<a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,s));
<a name='L226'>            c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(s);
<a name='L227'>        <font color='red'>}</font>
<a name='L228'>    <font color='red'>}</font>
<a name='L229'>    <a href='../S/86.html#L1341' title='Defined at 1341 in src/networking.c.'>asyncCloseClientOnOutputBufferLimitReached</a>(c);
<a name='L230'><font color='red'>}</font>
<a name='L231'>
<a name='L232'><b>void</b> <a href='../S/86.html#L321' title='Refered from 321 in src/networking.c.'>_addReplyStringToList</a>(redisClient *c, <b>char</b> *s, size_t len) <font color='red'>{</font>
<a name='L233'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *tail;
<a name='L234'>
<a name='L235'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>) <b>return</b>;
<a name='L236'>
<a name='L237'>    <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) == 0) <font color='red'>{</font>
<a name='L238'>        <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>(s,len);
<a name='L239'>
<a name='L240'>        <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(c-&gt;reply,o);
<a name='L241'>        c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(o-&gt;ptr);
<a name='L242'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L243'>        tail = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(<a href='../S/58.html#L59' title='Defined at 59 in src/adlist.h.'>listLast</a>(c-&gt;reply));
<a name='L244'>
<a name='L245'>        <i><font color='green'>/* Append to this object when possible. */</font></i>
<a name='L246'>        <b>if</b> (tail-&gt;ptr != NULL &amp;&amp;
<a name='L247'>            <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(tail-&gt;ptr)+len &lt;= <a href='../S/32.html#L98' title='Defined at 98 in src/redis.h.'>REDIS_REPLY_CHUNK_BYTES</a>)
<a name='L248'>        <font color='red'>{</font>
<a name='L249'>            c-&gt;reply_bytes -= <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(tail-&gt;ptr);
<a name='L250'>            tail = <a href='../S/86.html#L135' title='Defined at 135 in src/networking.c.'>dupLastObjectIfNeeded</a>(c-&gt;reply);
<a name='L251'>            tail-&gt;ptr = <a href='../D/3995.html' title='Multiple defined in 2 places.'>sdscatlen</a>(tail-&gt;ptr,s,len);
<a name='L252'>            c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(tail-&gt;ptr);
<a name='L253'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L254'>            <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>(s,len);
<a name='L255'>
<a name='L256'>            <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(c-&gt;reply,o);
<a name='L257'>            c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(o-&gt;ptr);
<a name='L258'>        <font color='red'>}</font>
<a name='L259'>    <font color='red'>}</font>
<a name='L260'>    <a href='../S/86.html#L1341' title='Defined at 1341 in src/networking.c.'>asyncCloseClientOnOutputBufferLimitReached</a>(c);
<a name='L261'><font color='red'>}</font>
<a name='L262'>
<a name='L263'><i><font color='green'>/* -----------------------------------------------------------------------------</font></i>
<a name='L264'><i><font color='green'> * Higher level functions to queue data on the client output buffer.</font></i>
<a name='L265'><i><font color='green'> * The following functions are the ones that commands implementations will call.</font></i>
<a name='L266'><i><font color='green'> * -------------------------------------------------------------------------- */</font></i>
<a name='L267'>
<a name='L268'><b>void</b> <a href='../R/1197.html' title='Multiple refered from 182 places.'>addReply</a>(redisClient *c, robj *obj) <font color='red'>{</font>
<a name='L269'>    <b>if</b> (<a href='../S/86.html#L122' title='Defined at 122 in src/networking.c.'>prepareClientToWrite</a>(c) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>return</b>;
<a name='L270'>
<a name='L271'>    <i><font color='green'>/* This is an important place where we can avoid copy-on-write</font></i>
<a name='L272'><i><font color='green'>     * when there is a saving child running, avoiding touching the</font></i>
<a name='L273'><i><font color='green'>     * refcount field of the object if it's not needed.</font></i>
<a name='L274'><i><font color='green'>     *</font></i>
<a name='L275'><i><font color='green'>     * If the encoding is RAW and there is room in the static buffer</font></i>
<a name='L276'><i><font color='green'>     * we'll be able to send the object to the client without</font></i>
<a name='L277'><i><font color='green'>     * messing with its page. */</font></i>
<a name='L278'>    <b>if</b> (obj-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>) <font color='red'>{</font>
<a name='L279'>        <b>if</b> (<a href='../S/86.html#L153' title='Defined at 153 in src/networking.c.'>_addReplyToBuffer</a>(c,obj-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(obj-&gt;ptr)) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L280'>            <a href='../S/86.html#L170' title='Defined at 170 in src/networking.c.'>_addReplyObjectToList</a>(c,obj);
<a name='L281'>    <font color='red'>}</font> <b>else</b> <b>if</b> (obj-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>) <font color='red'>{</font>
<a name='L282'>        <i><font color='green'>/* Optimization: if there is room in the static buffer for 32 bytes</font></i>
<a name='L283'><i><font color='green'>         * (more than the max chars a 64 bit integer can take as string) we</font></i>
<a name='L284'><i><font color='green'>         * avoid decoding the object and go for the lower level approach. */</font></i>
<a name='L285'>        <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) == 0 &amp;&amp; (<b>sizeof</b>(c-&gt;buf) - c-&gt;bufpos) &gt;= 32) <font color='red'>{</font>
<a name='L286'>            <b>char</b> buf[32];
<a name='L287'>            <b>int</b> len;
<a name='L288'>
<a name='L289'>            len = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>(buf,<b>sizeof</b>(buf),(<b>long</b>)obj-&gt;ptr);
<a name='L290'>            <b>if</b> (<a href='../S/86.html#L153' title='Defined at 153 in src/networking.c.'>_addReplyToBuffer</a>(c,buf,len) == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L291'>                <b>return</b>;
<a name='L292'>            <i><font color='green'>/* else... continue with the normal code path, but should never</font></i>
<a name='L293'><i><font color='green'>             * happen actually since we verified there is room. */</font></i>
<a name='L294'>        <font color='red'>}</font>
<a name='L295'>        obj = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(obj);
<a name='L296'>        <b>if</b> (<a href='../S/86.html#L153' title='Defined at 153 in src/networking.c.'>_addReplyToBuffer</a>(c,obj-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(obj-&gt;ptr)) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L297'>            <a href='../S/86.html#L170' title='Defined at 170 in src/networking.c.'>_addReplyObjectToList</a>(c,obj);
<a name='L298'>        <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(obj);
<a name='L299'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L300'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Wrong obj-&gt;encoding in addReply()");
<a name='L301'>    <font color='red'>}</font>
<a name='L302'><font color='red'>}</font>
<a name='L303'>
<a name='L304'><b>void</b> <a href='../R/1211.html' title='Multiple refered from 19 places.'>addReplySds</a>(redisClient *c, sds s) <font color='red'>{</font>
<a name='L305'>    <b>if</b> (<a href='../S/86.html#L122' title='Defined at 122 in src/networking.c.'>prepareClientToWrite</a>(c) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <font color='red'>{</font>
<a name='L306'>        <i><font color='green'>/* The caller expects the sds to be free'd. */</font></i>
<a name='L307'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(s);
<a name='L308'>        <b>return</b>;
<a name='L309'>    <font color='red'>}</font>
<a name='L310'>    <b>if</b> (<a href='../S/86.html#L153' title='Defined at 153 in src/networking.c.'>_addReplyToBuffer</a>(c,s,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(s)) == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <font color='red'>{</font>
<a name='L311'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(s);
<a name='L312'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L313'>        <i><font color='green'>/* This method free's the sds when it is no longer needed. */</font></i>
<a name='L314'>        <a href='../S/86.html#L201' title='Defined at 201 in src/networking.c.'>_addReplySdsToList</a>(c,s);
<a name='L315'>    <font color='red'>}</font>
<a name='L316'><font color='red'>}</font>
<a name='L317'>
<a name='L318'><b>void</b> <a href='../R/1216.html' title='Multiple refered from 9 places.'>addReplyString</a>(redisClient *c, <b>char</b> *s, size_t len) <font color='red'>{</font>
<a name='L319'>    <b>if</b> (<a href='../S/86.html#L122' title='Defined at 122 in src/networking.c.'>prepareClientToWrite</a>(c) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>return</b>;
<a name='L320'>    <b>if</b> (<a href='../S/86.html#L153' title='Defined at 153 in src/networking.c.'>_addReplyToBuffer</a>(c,s,len) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L321'>        <a href='../S/86.html#L232' title='Defined at 232 in src/networking.c.'>_addReplyStringToList</a>(c,s,len);
<a name='L322'><font color='red'>}</font>
<a name='L323'>
<a name='L324'><b>void</b> <a href='../R/1207.html' title='Multiple refered from 2 places.'>addReplyErrorLength</a>(redisClient *c, <b>char</b> *s, size_t len) <font color='red'>{</font>
<a name='L325'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,"-ERR ",5);
<a name='L326'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,s,len);
<a name='L327'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,"\r\n",2);
<a name='L328'><font color='red'>}</font>
<a name='L329'>
<a name='L330'><b>void</b> <a href='../R/1205.html' title='Multiple refered from 65 places.'>addReplyError</a>(redisClient *c, <b>char</b> *err) <font color='red'>{</font>
<a name='L331'>    <a href='../S/86.html#L324' title='Defined at 324 in src/networking.c.'>addReplyErrorLength</a>(c,err,strlen(err));
<a name='L332'><font color='red'>}</font>
<a name='L333'>
<a name='L334'><b>void</b> <a href='../R/1206.html' title='Multiple refered from 17 places.'>addReplyErrorFormat</a>(redisClient *c, <b>const</b> <b>char</b> *fmt, ...) <font color='red'>{</font>
<a name='L335'>    size_t l, j;
<a name='L336'>    va_list ap;
<a name='L337'>    va_start(ap,fmt);
<a name='L338'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> s = <a href='../D/3999.html' title='Multiple defined in 2 places.'>sdscatvprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),fmt,ap);
<a name='L339'>    va_end(ap);
<a name='L340'>    <i><font color='green'>/* Make sure there are no newlines in the string, otherwise invalid protocol</font></i>
<a name='L341'><i><font color='green'>     * is emitted. */</font></i>
<a name='L342'>    l = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(s);
<a name='L343'>    <b>for</b> (j = 0; j &lt; l; j++) <font color='red'>{</font>
<a name='L344'>        <b>if</b> (s[j] == '\r' || s[j] == '\n') s[j] = ' ';
<a name='L345'>    <font color='red'>}</font>
<a name='L346'>    <a href='../S/86.html#L324' title='Defined at 324 in src/networking.c.'>addReplyErrorLength</a>(c,s,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(s));
<a name='L347'>    <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(s);
<a name='L348'><font color='red'>}</font>
<a name='L349'>
<a name='L350'><b>void</b> <a href='../R/1215.html' title='Multiple refered from 2 places.'>addReplyStatusLength</a>(redisClient *c, <b>char</b> *s, size_t len) <font color='red'>{</font>
<a name='L351'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,"+",1);
<a name='L352'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,s,len);
<a name='L353'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,"\r\n",2);
<a name='L354'><font color='red'>}</font>
<a name='L355'>
<a name='L356'><b>void</b> <a href='../R/1213.html' title='Multiple refered from 6 places.'>addReplyStatus</a>(redisClient *c, <b>char</b> *status) <font color='red'>{</font>
<a name='L357'>    <a href='../S/86.html#L350' title='Defined at 350 in src/networking.c.'>addReplyStatusLength</a>(c,status,strlen(status));
<a name='L358'><font color='red'>}</font>
<a name='L359'>
<a name='L360'><b>void</b> <a href='../R/1214.html' title='Multiple refered from 3 places.'>addReplyStatusFormat</a>(redisClient *c, <b>const</b> <b>char</b> *fmt, ...) <font color='red'>{</font>
<a name='L361'>    va_list ap;
<a name='L362'>    va_start(ap,fmt);
<a name='L363'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> s = <a href='../D/3999.html' title='Multiple defined in 2 places.'>sdscatvprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),fmt,ap);
<a name='L364'>    va_end(ap);
<a name='L365'>    <a href='../S/86.html#L350' title='Defined at 350 in src/networking.c.'>addReplyStatusLength</a>(c,s,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(s));
<a name='L366'>    <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(s);
<a name='L367'><font color='red'>}</font>
<a name='L368'>
<a name='L369'><i><font color='green'>/* Adds an empty object to the reply list that will contain the multi bulk</font></i>
<a name='L370'><i><font color='green'> * length, which is not known when this function is called. */</font></i>
<a name='L371'><b>void</b> *<a href='../R/1194.html' title='Multiple refered from 9 places.'>addDeferredMultiBulkLength</a>(redisClient *c) <font color='red'>{</font>
<a name='L372'>    <i><font color='green'>/* Note that we install the write event here even if the object is not</font></i>
<a name='L373'><i><font color='green'>     * ready to be sent, since we are sure that before returning to the</font></i>
<a name='L374'><i><font color='green'>     * event loop setDeferredMultiBulkLength() will be called. */</font></i>
<a name='L375'>    <b>if</b> (<a href='../S/86.html#L122' title='Defined at 122 in src/networking.c.'>prepareClientToWrite</a>(c) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>return</b> NULL;
<a name='L376'>    <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(c-&gt;reply,<a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,NULL));
<a name='L377'>    <b>return</b> <a href='../S/58.html#L59' title='Defined at 59 in src/adlist.h.'>listLast</a>(c-&gt;reply);
<a name='L378'><font color='red'>}</font>
<a name='L379'>
<a name='L380'><i><font color='green'>/* Populate the length object and try glueing it to the next chunk. */</font></i>
<a name='L381'><b>void</b> <a href='../R/3730.html' title='Multiple refered from 8 places.'>setDeferredMultiBulkLength</a>(redisClient *c, <b>void</b> *node, <b>long</b> length) <font color='red'>{</font>
<a name='L382'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln = (<a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a>*)node;
<a name='L383'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *len, *<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>;
<a name='L384'>
<a name='L385'>    <i><font color='green'>/* Abort when *node is NULL (see addDeferredMultiBulkLength). */</font></i>
<a name='L386'>    <b>if</b> (node == NULL) <b>return</b>;
<a name='L387'>
<a name='L388'>    len = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L389'>    len-&gt;ptr = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),"*%ld\r\n",length);
<a name='L390'>    c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(len-&gt;ptr);
<a name='L391'>    <b>if</b> (ln-&gt;<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a> != NULL) <font color='red'>{</font>
<a name='L392'>        <a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a> = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln-&gt;<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>);
<a name='L393'>
<a name='L394'>        <i><font color='green'>/* Only glue when the next node is non-NULL (an sds in this case) */</font></i>
<a name='L395'>        <b>if</b> (<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>-&gt;ptr != NULL) <font color='red'>{</font>
<a name='L396'>            c-&gt;reply_bytes -= <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(len-&gt;ptr);
<a name='L397'>            c-&gt;reply_bytes -= <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>-&gt;ptr);
<a name='L398'>            len-&gt;ptr = <a href='../D/3995.html' title='Multiple defined in 2 places.'>sdscatlen</a>(len-&gt;ptr,<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>-&gt;ptr));
<a name='L399'>            c-&gt;reply_bytes += <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(len-&gt;ptr);
<a name='L400'>            <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(c-&gt;reply,ln-&gt;<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>);
<a name='L401'>        <font color='red'>}</font>
<a name='L402'>    <font color='red'>}</font>
<a name='L403'>    <a href='../S/86.html#L1341' title='Defined at 1341 in src/networking.c.'>asyncCloseClientOnOutputBufferLimitReached</a>(c);
<a name='L404'><font color='red'>}</font>
<a name='L405'>
<a name='L406'><i><font color='green'>/* Add a duble as a bulk reply */</font></i>
<a name='L407'><b>void</b> <a href='../R/1204.html' title='Multiple refered from 8 places.'>addReplyDouble</a>(redisClient *c, <b>double</b> d) <font color='red'>{</font>
<a name='L408'>    <b>char</b> dbuf[128], sbuf[128];
<a name='L409'>    <b>int</b> dlen, slen;
<a name='L410'>    dlen = snprintf(dbuf,<b>sizeof</b>(dbuf),"%.17g",d);
<a name='L411'>    slen = snprintf(sbuf,<b>sizeof</b>(sbuf),"$%d\r\n%s\r\n",dlen,dbuf);
<a name='L412'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,sbuf,slen);
<a name='L413'><font color='red'>}</font>
<a name='L414'>
<a name='L415'><i><font color='green'>/* Add a long long as integer reply or bulk len / multi bulk count.</font></i>
<a name='L416'><i><font color='green'> * Basically this is used to output &lt;prefix&gt;&lt;long long&gt;&lt;crlf&gt;. */</font></i>
<a name='L417'><b>void</b> <a href='../R/1209.html' title='Multiple refered from 4 places.'>addReplyLongLongWithPrefix</a>(redisClient *c, <b>long</b> <b>long</b> ll, <b>char</b> prefix) <font color='red'>{</font>
<a name='L418'>    <b>char</b> buf[128];
<a name='L419'>    <b>int</b> len;
<a name='L420'>
<a name='L421'>    <i><font color='green'>/* Things like $3\r\n or *2\r\n are emitted very often by the protocol</font></i>
<a name='L422'><i><font color='green'>     * so we have a few shared objects to use if the integer is small</font></i>
<a name='L423'><i><font color='green'>     * like it is most of the times. */</font></i>
<a name='L424'>    <b>if</b> (prefix == '*' &amp;&amp; ll &lt; <a href='../S/32.html#L80' title='Defined at 80 in src/redis.h.'>REDIS_SHARED_BULKHDR_LEN</a>) <font color='red'>{</font>
<a name='L425'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.mbulkhdr[ll]);
<a name='L426'>        <b>return</b>;
<a name='L427'>    <font color='red'>}</font> <b>else</b> <b>if</b> (prefix == '$' &amp;&amp; ll &lt; <a href='../S/32.html#L80' title='Defined at 80 in src/redis.h.'>REDIS_SHARED_BULKHDR_LEN</a>) <font color='red'>{</font>
<a name='L428'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.bulkhdr[ll]);
<a name='L429'>        <b>return</b>;
<a name='L430'>    <font color='red'>}</font>
<a name='L431'>
<a name='L432'>    buf[0] = prefix;
<a name='L433'>    len = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>(buf+1,<b>sizeof</b>(buf)-1,ll);
<a name='L434'>    buf[len+1] = '\r';
<a name='L435'>    buf[len+2] = '\n';
<a name='L436'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,buf,len+3);
<a name='L437'><font color='red'>}</font>
<a name='L438'>
<a name='L439'><b>void</b> <a href='../R/1208.html' title='Multiple refered from 49 places.'>addReplyLongLong</a>(redisClient *c, <b>long</b> <b>long</b> ll) <font color='red'>{</font>
<a name='L440'>    <b>if</b> (ll == 0)
<a name='L441'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.czero);
<a name='L442'>    <b>else</b> <b>if</b> (ll == 1)
<a name='L443'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.cone);
<a name='L444'>    <b>else</b>
<a name='L445'>        <a href='../S/86.html#L417' title='Defined at 417 in src/networking.c.'>addReplyLongLongWithPrefix</a>(c,ll,':');
<a name='L446'><font color='red'>}</font>
<a name='L447'>
<a name='L448'><b>void</b> <a href='../R/1210.html' title='Multiple refered from 24 places.'>addReplyMultiBulkLen</a>(redisClient *c, <b>long</b> length) <font color='red'>{</font>
<a name='L449'>    <a href='../S/86.html#L417' title='Defined at 417 in src/networking.c.'>addReplyLongLongWithPrefix</a>(c,length,'*');
<a name='L450'><font color='red'>}</font>
<a name='L451'>
<a name='L452'><i><font color='green'>/* Create the length prefix of a bulk reply, example: $2234 */</font></i>
<a name='L453'><b>void</b> <a href='../S/86.html#L476' title='Refered from 476 in src/networking.c.'>addReplyBulkLen</a>(redisClient *c, robj *obj) <font color='red'>{</font>
<a name='L454'>    size_t len;
<a name='L455'>
<a name='L456'>    <b>if</b> (obj-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>) <font color='red'>{</font>
<a name='L457'>        len = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(obj-&gt;ptr);
<a name='L458'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L459'>        <b>long</b> n = (<b>long</b>)obj-&gt;ptr;
<a name='L460'>
<a name='L461'>        <i><font color='green'>/* Compute how many bytes will take this integer as a radix 10 string */</font></i>
<a name='L462'>        len = 1;
<a name='L463'>        <b>if</b> (n &lt; 0) <font color='red'>{</font>
<a name='L464'>            len++;
<a name='L465'>            n = -n;
<a name='L466'>        <font color='red'>}</font>
<a name='L467'>        <b>while</b>((n = n/10) != 0) <font color='red'>{</font>
<a name='L468'>            len++;
<a name='L469'>        <font color='red'>}</font>
<a name='L470'>    <font color='red'>}</font>
<a name='L471'>    <a href='../S/86.html#L417' title='Defined at 417 in src/networking.c.'>addReplyLongLongWithPrefix</a>(c,len,'$');
<a name='L472'><font color='red'>}</font>
<a name='L473'>
<a name='L474'><i><font color='green'>/* Add a Redis Object as a bulk reply */</font></i>
<a name='L475'><b>void</b> <a href='../R/1198.html' title='Multiple refered from 41 places.'>addReplyBulk</a>(redisClient *c, robj *obj) <font color='red'>{</font>
<a name='L476'>    <a href='../S/86.html#L453' title='Defined at 453 in src/networking.c.'>addReplyBulkLen</a>(c,obj);
<a name='L477'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,obj);
<a name='L478'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.crlf);
<a name='L479'><font color='red'>}</font>
<a name='L480'>
<a name='L481'><i><font color='green'>/* Add a C buffer as bulk reply */</font></i>
<a name='L482'><b>void</b> <a href='../R/1199.html' title='Multiple refered from 12 places.'>addReplyBulkCBuffer</a>(redisClient *c, <b>void</b> *p, size_t len) <font color='red'>{</font>
<a name='L483'>    <a href='../S/86.html#L417' title='Defined at 417 in src/networking.c.'>addReplyLongLongWithPrefix</a>(c,len,'$');
<a name='L484'>    <a href='../S/86.html#L318' title='Defined at 318 in src/networking.c.'>addReplyString</a>(c,p,len);
<a name='L485'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.crlf);
<a name='L486'><font color='red'>}</font>
<a name='L487'>
<a name='L488'><i><font color='green'>/* Add a C nul term string as bulk reply */</font></i>
<a name='L489'><b>void</b> <a href='../R/1200.html' title='Multiple refered from 67 places.'>addReplyBulkCString</a>(redisClient *c, <b>char</b> *s) <font color='red'>{</font>
<a name='L490'>    <b>if</b> (s == NULL) <font color='red'>{</font>
<a name='L491'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullbulk);
<a name='L492'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L493'>        <a href='../S/86.html#L482' title='Defined at 482 in src/networking.c.'>addReplyBulkCBuffer</a>(c,s,strlen(s));
<a name='L494'>    <font color='red'>}</font>
<a name='L495'><font color='red'>}</font>
<a name='L496'>
<a name='L497'><i><font color='green'>/* Add a long long as a bulk reply */</font></i>
<a name='L498'><b>void</b> <a href='../R/1202.html' title='Multiple refered from 31 places.'>addReplyBulkLongLong</a>(redisClient *c, <b>long</b> <b>long</b> ll) <font color='red'>{</font>
<a name='L499'>    <b>char</b> buf[64];
<a name='L500'>    <b>int</b> len;
<a name='L501'>
<a name='L502'>    len = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>(buf,64,ll);
<a name='L503'>    <a href='../S/86.html#L482' title='Defined at 482 in src/networking.c.'>addReplyBulkCBuffer</a>(c,buf,len);
<a name='L504'><font color='red'>}</font>
<a name='L505'>
<a name='L506'><i><font color='green'>/* Copy 'src' client output buffers into 'dst' client output buffers.</font></i>
<a name='L507'><i><font color='green'> * The function takes care of freeing the old output buffers of the</font></i>
<a name='L508'><i><font color='green'> * destination client. */</font></i>
<a name='L509'><b>void</b> <a href='../R/1684.html' title='Multiple refered from 2 places.'>copyClientOutputBuffer</a>(redisClient *dst, redisClient *src) <font color='red'>{</font>
<a name='L510'>    <a href='../S/54.html#L58' title='Defined at 58 in src/adlist.c.'>listRelease</a>(dst-&gt;reply);
<a name='L511'>    dst-&gt;reply = <a href='../S/54.html#L242' title='Defined at 242 in src/adlist.c.'>listDup</a>(src-&gt;reply);
<a name='L512'>    memcpy(dst-&gt;buf,src-&gt;buf,src-&gt;bufpos);
<a name='L513'>    dst-&gt;bufpos = src-&gt;bufpos;
<a name='L514'>    dst-&gt;reply_bytes = src-&gt;reply_bytes;
<a name='L515'><font color='red'>}</font>
<a name='L516'>
<a name='L517'><b>static</b> <b>void</b> <a href='../R/1190.html' title='Multiple refered from 2 places.'>acceptCommonHandler</a>(<b>int</b> fd, <b>int</b> flags) <font color='red'>{</font>
<a name='L518'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c;
<a name='L519'>    <b>if</b> ((c = <a href='../D/1966.html' title='Multiple defined in 2 places.'>createClient</a>(fd)) == NULL) <font color='red'>{</font>
<a name='L520'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Error allocating resources for the client");
<a name='L521'>        close(fd); <i><font color='green'>/* May be already closed, just ignore errors */</font></i>
<a name='L522'>        <b>return</b>;
<a name='L523'>    <font color='red'>}</font>
<a name='L524'>    <i><font color='green'>/* If maxclient directive is set and this is one client more... close the</font></i>
<a name='L525'><i><font color='green'>     * connection. Note that we create the client instead to check before</font></i>
<a name='L526'><i><font color='green'>     * for this condition, since now the socket is already set in nonblocking</font></i>
<a name='L527'><i><font color='green'>     * mode and we can send an error for free using the Kernel I/O */</font></i>
<a name='L528'>    <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.clients) &gt; server.maxclients) <font color='red'>{</font>
<a name='L529'>        <b>char</b> *err = "-ERR max number of clients reached\r\n";
<a name='L530'>
<a name='L531'>        <i><font color='green'>/* That's a best effort error message, don't check write errors */</font></i>
<a name='L532'>        <b>if</b> (write(c-&gt;fd,err,strlen(err)) == -1) <font color='red'>{</font>
<a name='L533'>            <i><font color='green'>/* Nothing to do, Just to avoid the warning... */</font></i>
<a name='L534'>        <font color='red'>}</font>
<a name='L535'>        server.stat_rejected_conn++;
<a name='L536'>        <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L537'>        <b>return</b>;
<a name='L538'>    <font color='red'>}</font>
<a name='L539'>    server.stat_numconnections++;
<a name='L540'>    c-&gt;flags |= flags;
<a name='L541'><font color='red'>}</font>
<a name='L542'>
<a name='L543'><b>void</b> <a href='../R/1191.html' title='Multiple refered from 2 places.'>acceptTcpHandler</a>(aeEventLoop *el, <b>int</b> fd, <b>void</b> *privdata, <b>int</b> mask) <font color='red'>{</font>
<a name='L544'>    <b>int</b> cport, cfd;
<a name='L545'>    <b>char</b> cip[128];
<a name='L546'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(el);
<a name='L547'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(mask);
<a name='L548'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(privdata);
<a name='L549'>
<a name='L550'>    cfd = <a href='../S/50.html#L334' title='Defined at 334 in src/anet.c.'>anetTcpAccept</a>(server.neterr, fd, cip, &amp;cport);
<a name='L551'>    <b>if</b> (cfd == <a href='../S/38.html#L37' title='Defined at 37 in src/ae.h.'>AE_ERR</a>) <font color='red'>{</font>
<a name='L552'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Accepting client connection: %s", server.neterr);
<a name='L553'>        <b>return</b>;
<a name='L554'>    <font color='red'>}</font>
<a name='L555'>    <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>,"Accepted %s:%d", cip, cport);
<a name='L556'>    <a href='../S/86.html#L517' title='Defined at 517 in src/networking.c.'>acceptCommonHandler</a>(cfd,0);
<a name='L557'><font color='red'>}</font>
<a name='L558'>
<a name='L559'><b>void</b> <a href='../R/1192.html' title='Multiple refered from 2 places.'>acceptUnixHandler</a>(aeEventLoop *el, <b>int</b> fd, <b>void</b> *privdata, <b>int</b> mask) <font color='red'>{</font>
<a name='L560'>    <b>int</b> cfd;
<a name='L561'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(el);
<a name='L562'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(mask);
<a name='L563'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(privdata);
<a name='L564'>
<a name='L565'>    cfd = <a href='../S/50.html#L346' title='Defined at 346 in src/anet.c.'>anetUnixAccept</a>(server.neterr, fd);
<a name='L566'>    <b>if</b> (cfd == <a href='../S/38.html#L37' title='Defined at 37 in src/ae.h.'>AE_ERR</a>) <font color='red'>{</font>
<a name='L567'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Accepting client connection: %s", server.neterr);
<a name='L568'>        <b>return</b>;
<a name='L569'>    <font color='red'>}</font>
<a name='L570'>    <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>,"Accepted connection to %s", server.unixsocket);
<a name='L571'>    <a href='../S/86.html#L517' title='Defined at 517 in src/networking.c.'>acceptCommonHandler</a>(cfd,<a href='../S/32.html#L184' title='Defined at 184 in src/redis.h.'>REDIS_UNIX_SOCKET</a>);
<a name='L572'><font color='red'>}</font>
<a name='L573'>
<a name='L574'>
<a name='L575'><b>static</b> <b>void</b> <a href='../R/1994.html' title='Multiple refered from 2 places.'>freeClientArgv</a>(redisClient *c) <font color='red'>{</font>
<a name='L576'>    <b>int</b> j;
<a name='L577'>    <b>for</b> (j = 0; j &lt; c-&gt;argc; j++)
<a name='L578'>        <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(c-&gt;argv[j]);
<a name='L579'>    c-&gt;argc = 0;
<a name='L580'>    c-&gt;cmd = NULL;
<a name='L581'><font color='red'>}</font>
<a name='L582'>
<a name='L583'><i><font color='green'>/* Close all the slaves connections. This is useful in chained replication</font></i>
<a name='L584'><i><font color='green'> * when we resync with our own master and want to force all our slaves to</font></i>
<a name='L585'><i><font color='green'> * resync with us as well. */</font></i>
<a name='L586'><b>void</b> <a href='../R/1861.html' title='Multiple refered from 3 places.'>disconnectSlaves</a>(<b>void</b>) <font color='red'>{</font>
<a name='L587'>    <b>while</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves)) <font color='red'>{</font>
<a name='L588'>        <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln = <a href='../S/58.html#L58' title='Defined at 58 in src/adlist.h.'>listFirst</a>(server.slaves);
<a name='L589'>        <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>((<a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a>*)ln-&gt;value);
<a name='L590'>    <font color='red'>}</font>
<a name='L591'><font color='red'>}</font>
<a name='L592'>
<a name='L593'><b>void</b> <a href='../R/1993.html' title='Multiple refered from 27 places.'>freeClient</a>(redisClient *c) <font color='red'>{</font>
<a name='L594'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L595'>
<a name='L596'>    <i><font color='green'>/* If this is marked as current client unset it */</font></i>
<a name='L597'>    <b>if</b> (server.current_client == c) server.current_client = NULL;
<a name='L598'>
<a name='L599'>    <i><font color='green'>/* Note that if the client we are freeing is blocked into a blocking</font></i>
<a name='L600'><i><font color='green'>     * call, we have to set querybuf to NULL *before* to call</font></i>
<a name='L601'><i><font color='green'>     * unblockClientWaitingData() to avoid processInputBuffer() will get</font></i>
<a name='L602'><i><font color='green'>     * called. Also it is important to remove the file events after</font></i>
<a name='L603'><i><font color='green'>     * this, because this call adds the READABLE event. */</font></i>
<a name='L604'>    <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(c-&gt;querybuf);
<a name='L605'>    c-&gt;querybuf = NULL;
<a name='L606'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L176' title='Defined at 176 in src/redis.h.'>REDIS_BLOCKED</a>)
<a name='L607'>        <a href='../S/60.html#L792' title='Defined at 792 in src/t_list.c.'>unblockClientWaitingData</a>(c);
<a name='L608'>    <a href='../D/2108.html' title='Multiple defined in 2 places.'>dictRelease</a>(c-&gt;bpop.keys);
<a name='L609'>
<a name='L610'>    <i><font color='green'>/* UNWATCH all the keys */</font></i>
<a name='L611'>    <a href='../S/81.html#L236' title='Defined at 236 in src/multi.c.'>unwatchAllKeys</a>(c);
<a name='L612'>    <a href='../S/54.html#L58' title='Defined at 58 in src/adlist.c.'>listRelease</a>(c-&gt;watched_keys);
<a name='L613'>    <i><font color='green'>/* Unsubscribe from all the pubsub channels */</font></i>
<a name='L614'>    <a href='../S/46.html#L172' title='Defined at 172 in src/pubsub.c.'>pubsubUnsubscribeAllChannels</a>(c,0);
<a name='L615'>    <a href='../S/46.html#L188' title='Defined at 188 in src/pubsub.c.'>pubsubUnsubscribeAllPatterns</a>(c,0);
<a name='L616'>    <a href='../D/2108.html' title='Multiple defined in 2 places.'>dictRelease</a>(c-&gt;pubsub_channels);
<a name='L617'>    <a href='../S/54.html#L58' title='Defined at 58 in src/adlist.c.'>listRelease</a>(c-&gt;pubsub_patterns);
<a name='L618'>    <i><font color='green'>/* Obvious cleanup */</font></i>
<a name='L619'>    <a href='../S/36.html#L121' title='Defined at 121 in src/ae.c.'>aeDeleteFileEvent</a>(server.el,c-&gt;fd,<a href='../S/38.html#L40' title='Defined at 40 in src/ae.h.'>AE_READABLE</a>);
<a name='L620'>    <a href='../S/36.html#L121' title='Defined at 121 in src/ae.c.'>aeDeleteFileEvent</a>(server.el,c-&gt;fd,<a href='../S/38.html#L41' title='Defined at 41 in src/ae.h.'>AE_WRITABLE</a>);
<a name='L621'>    <a href='../S/54.html#L58' title='Defined at 58 in src/adlist.c.'>listRelease</a>(c-&gt;reply);
<a name='L622'>    <a href='../S/86.html#L575' title='Defined at 575 in src/networking.c.'>freeClientArgv</a>(c);
<a name='L623'>    close(c-&gt;fd);
<a name='L624'>    <i><font color='green'>/* Remove from the list of clients */</font></i>
<a name='L625'>    ln = <a href='../S/54.html#L285' title='Defined at 285 in src/adlist.c.'>listSearchKey</a>(server.clients,c);
<a name='L626'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(ln != NULL);
<a name='L627'>    <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(server.clients,ln);
<a name='L628'>    <i><font color='green'>/* When client was just unblocked because of a blocking operation,</font></i>
<a name='L629'><i><font color='green'>     * remove it from the list with unblocked clients. */</font></i>
<a name='L630'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L179' title='Defined at 179 in src/redis.h.'>REDIS_UNBLOCKED</a>) <font color='red'>{</font>
<a name='L631'>        ln = <a href='../S/54.html#L285' title='Defined at 285 in src/adlist.c.'>listSearchKey</a>(server.unblocked_clients,c);
<a name='L632'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(ln != NULL);
<a name='L633'>        <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(server.unblocked_clients,ln);
<a name='L634'>    <font color='red'>}</font>
<a name='L635'>    <a href='../S/54.html#L58' title='Defined at 58 in src/adlist.c.'>listRelease</a>(c-&gt;io_keys);
<a name='L636'>    <i><font color='green'>/* Master/slave cleanup.</font></i>
<a name='L637'><i><font color='green'>     * Case 1: we lost the connection with a slave. */</font></i>
<a name='L638'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L172' title='Defined at 172 in src/redis.h.'>REDIS_SLAVE</a>) <font color='red'>{</font>
<a name='L639'>        <b>if</b> (c-&gt;replstate == <a href='../S/32.html#L215' title='Defined at 215 in src/redis.h.'>REDIS_REPL_SEND_BULK</a> &amp;&amp; c-&gt;repldbfd != -1)
<a name='L640'>            close(c-&gt;repldbfd);
<a name='L641'>        <a href='../D/2690.html' title='Multiple defined in 2 places.'>list</a> *l = (c-&gt;flags &amp; <a href='../S/32.html#L174' title='Defined at 174 in src/redis.h.'>REDIS_MONITOR</a>) ? server.monitors : server.slaves;
<a name='L642'>        ln = <a href='../S/54.html#L285' title='Defined at 285 in src/adlist.c.'>listSearchKey</a>(l,c);
<a name='L643'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(ln != NULL);
<a name='L644'>        <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(l,ln);
<a name='L645'>    <font color='red'>}</font>
<a name='L646'>
<a name='L647'>    <i><font color='green'>/* Case 2: we lost the connection with the master. */</font></i>
<a name='L648'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L173' title='Defined at 173 in src/redis.h.'>REDIS_MASTER</a>) <font color='red'>{</font>
<a name='L649'>        server.master = NULL;
<a name='L650'>        server.repl_state = <a href='../S/32.html#L200' title='Defined at 200 in src/redis.h.'>REDIS_REPL_CONNECT</a>;
<a name='L651'>        server.repl_down_since = server.unixtime;
<a name='L652'>        <i><font color='green'>/* We lost connection with our master, force our slaves to resync</font></i>
<a name='L653'><i><font color='green'>         * with us as well to load the new data set.</font></i>
<a name='L654'><i><font color='green'>         *</font></i>
<a name='L655'><i><font color='green'>         * If server.masterhost is NULL the user called SLAVEOF NO ONE so</font></i>
<a name='L656'><i><font color='green'>         * slave resync is not needed. */</font></i>
<a name='L657'>        <b>if</b> (server.masterhost != NULL) <a href='../S/86.html#L586' title='Defined at 586 in src/networking.c.'>disconnectSlaves</a>();
<a name='L658'>    <font color='red'>}</font>
<a name='L659'>
<a name='L660'>    <i><font color='green'>/* If this client was scheduled for async freeing we need to remove it</font></i>
<a name='L661'><i><font color='green'>     * from the queue. */</font></i>
<a name='L662'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L183' title='Defined at 183 in src/redis.h.'>REDIS_CLOSE_ASAP</a>) <font color='red'>{</font>
<a name='L663'>        ln = <a href='../S/54.html#L285' title='Defined at 285 in src/adlist.c.'>listSearchKey</a>(server.clients_to_close,c);
<a name='L664'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(ln != NULL);
<a name='L665'>        <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(server.clients_to_close,ln);
<a name='L666'>    <font color='red'>}</font>
<a name='L667'>
<a name='L668'>    <i><font color='green'>/* Release memory */</font></i>
<a name='L669'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(c-&gt;argv);
<a name='L670'>    <a href='../S/81.html#L41' title='Defined at 41 in src/multi.c.'>freeClientMultiState</a>(c);
<a name='L671'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(c);
<a name='L672'><font color='red'>}</font>
<a name='L673'>
<a name='L674'><i><font color='green'>/* Schedule a client to free it at a safe time in the serverCron() function.</font></i>
<a name='L675'><i><font color='green'> * This function is useful when we need to terminate a client but we are in</font></i>
<a name='L676'><i><font color='green'> * a context where calling freeClient() is not possible, because the client</font></i>
<a name='L677'><i><font color='green'> * should be valid for the continuation of the flow of the program. */</font></i>
<a name='L678'><b>void</b> <a href='../S/86.html#L1347' title='Refered from 1347 in src/networking.c.'>freeClientAsync</a>(redisClient *c) <font color='red'>{</font>
<a name='L679'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L183' title='Defined at 183 in src/redis.h.'>REDIS_CLOSE_ASAP</a>) <b>return</b>;
<a name='L680'>    c-&gt;flags |= <a href='../S/32.html#L183' title='Defined at 183 in src/redis.h.'>REDIS_CLOSE_ASAP</a>;
<a name='L681'>    <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(server.clients_to_close,c);
<a name='L682'><font color='red'>}</font>
<a name='L683'>
<a name='L684'><b>void</b> <a href='../R/1997.html' title='Multiple refered from 2 places.'>freeClientsInAsyncFreeQueue</a>(<b>void</b>) <font color='red'>{</font>
<a name='L685'>    <b>while</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.clients_to_close)) <font color='red'>{</font>
<a name='L686'>        <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln = <a href='../S/58.html#L58' title='Defined at 58 in src/adlist.h.'>listFirst</a>(server.clients_to_close);
<a name='L687'>        <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L688'>
<a name='L689'>        c-&gt;flags &amp;= ~<a href='../S/32.html#L183' title='Defined at 183 in src/redis.h.'>REDIS_CLOSE_ASAP</a>;
<a name='L690'>        <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L691'>        <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(server.clients_to_close,ln);
<a name='L692'>    <font color='red'>}</font>
<a name='L693'><font color='red'>}</font>
<a name='L694'>
<a name='L695'><b>void</b> <a href='../R/3659.html' title='Multiple refered from 4 places.'>sendReplyToClient</a>(aeEventLoop *el, <b>int</b> fd, <b>void</b> *privdata, <b>int</b> mask) <font color='red'>{</font>
<a name='L696'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c = privdata;
<a name='L697'>    <b>int</b> nwritten = 0, totwritten = 0, objlen;
<a name='L698'>    size_t objmem;
<a name='L699'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o;
<a name='L700'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(el);
<a name='L701'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(mask);
<a name='L702'>
<a name='L703'>    <b>while</b>(c-&gt;bufpos &gt; 0 || <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply)) <font color='red'>{</font>
<a name='L704'>        <b>if</b> (c-&gt;bufpos &gt; 0) <font color='red'>{</font>
<a name='L705'>            <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L173' title='Defined at 173 in src/redis.h.'>REDIS_MASTER</a>) <font color='red'>{</font>
<a name='L706'>                <i><font color='green'>/* Don't reply to a master */</font></i>
<a name='L707'>                nwritten = c-&gt;bufpos - c-&gt;sentlen;
<a name='L708'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L709'>                nwritten = write(fd,c-&gt;buf+c-&gt;sentlen,c-&gt;bufpos-c-&gt;sentlen);
<a name='L710'>                <b>if</b> (nwritten &lt;= 0) <b>break</b>;
<a name='L711'>            <font color='red'>}</font>
<a name='L712'>            c-&gt;sentlen += nwritten;
<a name='L713'>            totwritten += nwritten;
<a name='L714'>
<a name='L715'>            <i><font color='green'>/* If the buffer was sent, set bufpos to zero to continue with</font></i>
<a name='L716'><i><font color='green'>             * the remainder of the reply. */</font></i>
<a name='L717'>            <b>if</b> (c-&gt;sentlen == c-&gt;bufpos) <font color='red'>{</font>
<a name='L718'>                c-&gt;bufpos = 0;
<a name='L719'>                c-&gt;sentlen = 0;
<a name='L720'>            <font color='red'>}</font>
<a name='L721'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L722'>            o = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(<a href='../S/58.html#L58' title='Defined at 58 in src/adlist.h.'>listFirst</a>(c-&gt;reply));
<a name='L723'>            objlen = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(o-&gt;ptr);
<a name='L724'>            objmem = <a href='../S/86.html#L39' title='Defined at 39 in src/networking.c.'>zmalloc_size_sds</a>(o-&gt;ptr);
<a name='L725'>
<a name='L726'>            <b>if</b> (objlen == 0) <font color='red'>{</font>
<a name='L727'>                <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(c-&gt;reply,<a href='../S/58.html#L58' title='Defined at 58 in src/adlist.h.'>listFirst</a>(c-&gt;reply));
<a name='L728'>                <b>continue</b>;
<a name='L729'>            <font color='red'>}</font>
<a name='L730'>
<a name='L731'>            <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L173' title='Defined at 173 in src/redis.h.'>REDIS_MASTER</a>) <font color='red'>{</font>
<a name='L732'>                <i><font color='green'>/* Don't reply to a master */</font></i>
<a name='L733'>                nwritten = objlen - c-&gt;sentlen;
<a name='L734'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L735'>                nwritten = write(fd, ((<b>char</b>*)o-&gt;ptr)+c-&gt;sentlen,objlen-c-&gt;sentlen);
<a name='L736'>                <b>if</b> (nwritten &lt;= 0) <b>break</b>;
<a name='L737'>            <font color='red'>}</font>
<a name='L738'>            c-&gt;sentlen += nwritten;
<a name='L739'>            totwritten += nwritten;
<a name='L740'>
<a name='L741'>            <i><font color='green'>/* If we fully sent the object on head go to the next one */</font></i>
<a name='L742'>            <b>if</b> (c-&gt;sentlen == objlen) <font color='red'>{</font>
<a name='L743'>                <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(c-&gt;reply,<a href='../S/58.html#L58' title='Defined at 58 in src/adlist.h.'>listFirst</a>(c-&gt;reply));
<a name='L744'>                c-&gt;sentlen = 0;
<a name='L745'>                c-&gt;reply_bytes -= objmem;
<a name='L746'>            <font color='red'>}</font>
<a name='L747'>        <font color='red'>}</font>
<a name='L748'>        <i><font color='green'>/* Note that we avoid to send more than REDIS_MAX_WRITE_PER_EVENT</font></i>
<a name='L749'><i><font color='green'>         * bytes, in a single threaded server it's a good idea to serve</font></i>
<a name='L750'><i><font color='green'>         * other clients as well, even if a very large request comes from</font></i>
<a name='L751'><i><font color='green'>         * super fast link that is always able to accept data (in real world</font></i>
<a name='L752'><i><font color='green'>         * scenario think about 'KEYS *' against the loopback interface).</font></i>
<a name='L753'><i><font color='green'>         *</font></i>
<a name='L754'><i><font color='green'>         * However if we are over the maxmemory limit we ignore that and</font></i>
<a name='L755'><i><font color='green'>         * just deliver as much data as it is possible to deliver. */</font></i>
<a name='L756'>        <b>if</b> (totwritten &gt; <a href='../S/32.html#L77' title='Defined at 77 in src/redis.h.'>REDIS_MAX_WRITE_PER_EVENT</a> &amp;&amp;
<a name='L757'>            (server.maxmemory == 0 ||
<a name='L758'>             <a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>() &lt; server.maxmemory)) <b>break</b>;
<a name='L759'>    <font color='red'>}</font>
<a name='L760'>    <b>if</b> (nwritten == -1) <font color='red'>{</font>
<a name='L761'>        <b>if</b> (errno == EAGAIN) <font color='red'>{</font>
<a name='L762'>            nwritten = 0;
<a name='L763'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L764'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>,
<a name='L765'>                "Error writing to client: %s", strerror(errno));
<a name='L766'>            <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L767'>            <b>return</b>;
<a name='L768'>        <font color='red'>}</font>
<a name='L769'>    <font color='red'>}</font>
<a name='L770'>    <b>if</b> (totwritten &gt; 0) c-&gt;lastinteraction = server.unixtime;
<a name='L771'>    <b>if</b> (c-&gt;bufpos == 0 &amp;&amp; <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) == 0) <font color='red'>{</font>
<a name='L772'>        c-&gt;sentlen = 0;
<a name='L773'>        <a href='../S/36.html#L121' title='Defined at 121 in src/ae.c.'>aeDeleteFileEvent</a>(server.el,c-&gt;fd,<a href='../S/38.html#L41' title='Defined at 41 in src/ae.h.'>AE_WRITABLE</a>);
<a name='L774'>
<a name='L775'>        <i><font color='green'>/* Close connection after entire reply has been sent. */</font></i>
<a name='L776'>        <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>) <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L777'>    <font color='red'>}</font>
<a name='L778'><font color='red'>}</font>
<a name='L779'>
<a name='L780'><i><font color='green'>/* resetClient prepare the client to process the next command */</font></i>
<a name='L781'><b>void</b> <a href='../R/3536.html' title='Multiple refered from 4 places.'>resetClient</a>(redisClient *c) <font color='red'>{</font>
<a name='L782'>    <a href='../S/86.html#L575' title='Defined at 575 in src/networking.c.'>freeClientArgv</a>(c);
<a name='L783'>    c-&gt;reqtype = 0;
<a name='L784'>    c-&gt;multibulklen = 0;
<a name='L785'>    c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> = -1;
<a name='L786'>    <i><font color='green'>/* We clear the ASKING flag as well if we are not inside a MULTI. */</font></i>
<a name='L787'>    <b>if</b> (!(c-&gt;flags &amp; <a href='../S/32.html#L175' title='Defined at 175 in src/redis.h.'>REDIS_MULTI</a>)) c-&gt;flags &amp;= (~<a href='../S/32.html#L182' title='Defined at 182 in src/redis.h.'>REDIS_ASKING</a>);
<a name='L788'><font color='red'>}</font>
<a name='L789'>
<a name='L790'><b>int</b> <a href='../S/86.html#L995' title='Refered from 995 in src/networking.c.'>processInlineBuffer</a>(redisClient *c) <font color='red'>{</font>
<a name='L791'>    <b>char</b> *newline = strstr(c-&gt;querybuf,"\r\n");
<a name='L792'>    <b>int</b> argc, j;
<a name='L793'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> *argv;
<a name='L794'>    size_t querylen;
<a name='L795'>
<a name='L796'>    <i><font color='green'>/* Nothing to do without a \r\n */</font></i>
<a name='L797'>    <b>if</b> (newline == NULL) <font color='red'>{</font>
<a name='L798'>        <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf) &gt; <a href='../S/32.html#L99' title='Defined at 99 in src/redis.h.'>REDIS_INLINE_MAX_SIZE</a>) <font color='red'>{</font>
<a name='L799'>            <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"Protocol error: too big inline request");
<a name='L800'>            <a href='../S/86.html#L831' title='Defined at 831 in src/networking.c.'>setProtocolError</a>(c,0);
<a name='L801'>        <font color='red'>}</font>
<a name='L802'>        <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L803'>    <font color='red'>}</font>
<a name='L804'>
<a name='L805'>    <i><font color='green'>/* Split the input buffer up to the \r\n */</font></i>
<a name='L806'>    querylen = newline-(c-&gt;querybuf);
<a name='L807'>    argv = <a href='../D/4018.html' title='Multiple defined in 2 places.'>sdssplitlen</a>(c-&gt;querybuf,querylen," ",1,&amp;argc);
<a name='L808'>
<a name='L809'>    <i><font color='green'>/* Leave data after the first line of the query in the buffer */</font></i>
<a name='L810'>    c-&gt;querybuf = <a href='../D/4015.html' title='Multiple defined in 2 places.'>sdsrange</a>(c-&gt;querybuf,querylen+2,-1);
<a name='L811'>
<a name='L812'>    <i><font color='green'>/* Setup argv array on client structure */</font></i>
<a name='L813'>    <b>if</b> (c-&gt;argv) <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(c-&gt;argv);
<a name='L814'>    c-&gt;argv = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*)*argc);
<a name='L815'>
<a name='L816'>    <i><font color='green'>/* Create redis objects for all arguments. */</font></i>
<a name='L817'>    <b>for</b> (c-&gt;argc = 0, j = 0; j &lt; argc; j++) <font color='red'>{</font>
<a name='L818'>        <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(argv[j])) <font color='red'>{</font>
<a name='L819'>            c-&gt;argv[c-&gt;argc] = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,argv[j]);
<a name='L820'>            c-&gt;argc++;
<a name='L821'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L822'>            <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(argv[j]);
<a name='L823'>        <font color='red'>}</font>
<a name='L824'>    <font color='red'>}</font>
<a name='L825'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(argv);
<a name='L826'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L827'><font color='red'>}</font>
<a name='L828'>
<a name='L829'><i><font color='green'>/* Helper function. Trims query buffer to make the function that processes</font></i>
<a name='L830'><i><font color='green'> * multi bulk requests idempotent. */</font></i>
<a name='L831'><b>static</b> <b>void</b> <a href='../R/3734.html' title='Multiple refered from 7 places.'>setProtocolError</a>(redisClient *c, <b>int</b> pos) <font color='red'>{</font>
<a name='L832'>    <b>if</b> (server.verbosity &gt;= <a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>) <font color='red'>{</font>
<a name='L833'>        <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a> = <a href='../S/86.html#L1093' title='Defined at 1093 in src/networking.c.'>getClientInfoString</a>(c);
<a name='L834'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>,
<a name='L835'>            "Protocol error from client: %s", <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>);
<a name='L836'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>);
<a name='L837'>    <font color='red'>}</font>
<a name='L838'>    c-&gt;flags |= <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>;
<a name='L839'>    c-&gt;querybuf = <a href='../D/4015.html' title='Multiple defined in 2 places.'>sdsrange</a>(c-&gt;querybuf,<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>,-1);
<a name='L840'><font color='red'>}</font>
<a name='L841'>
<a name='L842'><b>int</b> <a href='../S/86.html#L997' title='Refered from 997 in src/networking.c.'>processMultibulkBuffer</a>(redisClient *c) <font color='red'>{</font>
<a name='L843'>    <b>char</b> *newline = NULL;
<a name='L844'>    <b>int</b> <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> = 0, <a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a>;
<a name='L845'>    <b>long</b> <b>long</b> ll;
<a name='L846'>
<a name='L847'>    <b>if</b> (c-&gt;multibulklen == 0) <font color='red'>{</font>
<a name='L848'>        <i><font color='green'>/* The client should have been reset */</font></i>
<a name='L849'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,NULL,c-&gt;argc == 0);
<a name='L850'>
<a name='L851'>        <i><font color='green'>/* Multi bulk length cannot be read without a \r\n */</font></i>
<a name='L852'>        newline = strchr(c-&gt;querybuf,'\r');
<a name='L853'>        <b>if</b> (newline == NULL) <font color='red'>{</font>
<a name='L854'>            <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf) &gt; <a href='../S/32.html#L99' title='Defined at 99 in src/redis.h.'>REDIS_INLINE_MAX_SIZE</a>) <font color='red'>{</font>
<a name='L855'>                <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"Protocol error: too big mbulk count string");
<a name='L856'>                <a href='../S/86.html#L831' title='Defined at 831 in src/networking.c.'>setProtocolError</a>(c,0);
<a name='L857'>            <font color='red'>}</font>
<a name='L858'>            <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L859'>        <font color='red'>}</font>
<a name='L860'>
<a name='L861'>        <i><font color='green'>/* Buffer should also contain \n */</font></i>
<a name='L862'>        <b>if</b> (newline-(c-&gt;querybuf) &gt; ((<b>signed</b>)<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf)-2))
<a name='L863'>            <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L864'>
<a name='L865'>        <i><font color='green'>/* We know for sure there is a whole line since newline != NULL,</font></i>
<a name='L866'><i><font color='green'>         * so go ahead and find out the multi bulk length. */</font></i>
<a name='L867'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,NULL,c-&gt;querybuf[0] == '*');
<a name='L868'>        <a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a> = <a href='../S/74.html#L244' title='Defined at 244 in src/util.c.'>string2ll</a>(c-&gt;querybuf+1,newline-(c-&gt;querybuf+1),&amp;ll);
<a name='L869'>        <b>if</b> (!<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a> || ll &gt; 1024*1024) <font color='red'>{</font>
<a name='L870'>            <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"Protocol error: invalid multibulk length");
<a name='L871'>            <a href='../S/86.html#L831' title='Defined at 831 in src/networking.c.'>setProtocolError</a>(c,<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>);
<a name='L872'>            <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L873'>        <font color='red'>}</font>
<a name='L874'>
<a name='L875'>        <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> = (newline-c-&gt;querybuf)+2;
<a name='L876'>        <b>if</b> (ll &lt;= 0) <font color='red'>{</font>
<a name='L877'>            c-&gt;querybuf = <a href='../D/4015.html' title='Multiple defined in 2 places.'>sdsrange</a>(c-&gt;querybuf,<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>,-1);
<a name='L878'>            <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L879'>        <font color='red'>}</font>
<a name='L880'>
<a name='L881'>        c-&gt;multibulklen = ll;
<a name='L882'>
<a name='L883'>        <i><font color='green'>/* Setup argv array on client structure */</font></i>
<a name='L884'>        <b>if</b> (c-&gt;argv) <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(c-&gt;argv);
<a name='L885'>        c-&gt;argv = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*)*c-&gt;multibulklen);
<a name='L886'>    <font color='red'>}</font>
<a name='L887'>
<a name='L888'>    <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,NULL,c-&gt;multibulklen &gt; 0);
<a name='L889'>    <b>while</b>(c-&gt;multibulklen) <font color='red'>{</font>
<a name='L890'>        <i><font color='green'>/* Read bulk length if unknown */</font></i>
<a name='L891'>        <b>if</b> (c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> == -1) <font color='red'>{</font>
<a name='L892'>            newline = strchr(c-&gt;querybuf+<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>,'\r');
<a name='L893'>            <b>if</b> (newline == NULL) <font color='red'>{</font>
<a name='L894'>                <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf) &gt; <a href='../S/32.html#L99' title='Defined at 99 in src/redis.h.'>REDIS_INLINE_MAX_SIZE</a>) <font color='red'>{</font>
<a name='L895'>                    <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"Protocol error: too big bulk count string");
<a name='L896'>                    <a href='../S/86.html#L831' title='Defined at 831 in src/networking.c.'>setProtocolError</a>(c,0);
<a name='L897'>                <font color='red'>}</font>
<a name='L898'>                <b>break</b>;
<a name='L899'>            <font color='red'>}</font>
<a name='L900'>
<a name='L901'>            <i><font color='green'>/* Buffer should also contain \n */</font></i>
<a name='L902'>            <b>if</b> (newline-(c-&gt;querybuf) &gt; ((<b>signed</b>)<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf)-2))
<a name='L903'>                <b>break</b>;
<a name='L904'>
<a name='L905'>            <b>if</b> (c-&gt;querybuf[<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>] != '$') <font color='red'>{</font>
<a name='L906'>                <a href='../S/86.html#L334' title='Defined at 334 in src/networking.c.'>addReplyErrorFormat</a>(c,
<a name='L907'>                    "Protocol error: expected '$', got '%c'",
<a name='L908'>                    c-&gt;querybuf[<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>]);
<a name='L909'>                <a href='../S/86.html#L831' title='Defined at 831 in src/networking.c.'>setProtocolError</a>(c,<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>);
<a name='L910'>                <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L911'>            <font color='red'>}</font>
<a name='L912'>
<a name='L913'>            <a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a> = <a href='../S/74.html#L244' title='Defined at 244 in src/util.c.'>string2ll</a>(c-&gt;querybuf+<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>+1,newline-(c-&gt;querybuf+<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>+1),&amp;ll);
<a name='L914'>            <b>if</b> (!<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a> || ll &lt; 0 || ll &gt; 512*1024*1024) <font color='red'>{</font>
<a name='L915'>                <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"Protocol error: invalid bulk length");
<a name='L916'>                <a href='../S/86.html#L831' title='Defined at 831 in src/networking.c.'>setProtocolError</a>(c,<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>);
<a name='L917'>                <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L918'>            <font color='red'>}</font>
<a name='L919'>
<a name='L920'>            <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> += newline-(c-&gt;querybuf+<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>)+2;
<a name='L921'>            <b>if</b> (ll &gt;= <a href='../S/32.html#L100' title='Defined at 100 in src/redis.h.'>REDIS_MBULK_BIG_ARG</a>) <font color='red'>{</font>
<a name='L922'>                <i><font color='green'>/* If we are going to read a large object from network</font></i>
<a name='L923'><i><font color='green'>                 * try to make it likely that it will start at c-&gt;querybuf</font></i>
<a name='L924'><i><font color='green'>                 * boundary so that we can optimized object creation</font></i>
<a name='L925'><i><font color='green'>                 * avoiding a large copy of data. */</font></i>
<a name='L926'>                c-&gt;querybuf = <a href='../D/4015.html' title='Multiple defined in 2 places.'>sdsrange</a>(c-&gt;querybuf,<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>,-1);
<a name='L927'>                <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> = 0;
<a name='L928'>                <i><font color='green'>/* Hint the sds library about the amount of bytes this string is</font></i>
<a name='L929'><i><font color='green'>                 * going to contain. */</font></i>
<a name='L930'>                c-&gt;querybuf = <a href='../D/3990.html' title='Multiple defined in 2 places.'>sdsMakeRoomFor</a>(c-&gt;querybuf,ll+2);
<a name='L931'>            <font color='red'>}</font>
<a name='L932'>            c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> = ll;
<a name='L933'>        <font color='red'>}</font>
<a name='L934'>
<a name='L935'>        <i><font color='green'>/* Read bulk argument */</font></i>
<a name='L936'>        <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf)-<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> &lt; (<b>unsigned</b>)(c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a>+2)) <font color='red'>{</font>
<a name='L937'>            <i><font color='green'>/* Not enough data (+2 == trailing \r\n) */</font></i>
<a name='L938'>            <b>break</b>;
<a name='L939'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L940'>            <i><font color='green'>/* Optimization: if the buffer contanins JUST our bulk element</font></i>
<a name='L941'><i><font color='green'>             * instead of creating a new object by *copying* the sds we</font></i>
<a name='L942'><i><font color='green'>             * just use the current sds string. */</font></i>
<a name='L943'>            <b>if</b> (<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> == 0 &amp;&amp;
<a name='L944'>                c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> &gt;= <a href='../S/32.html#L100' title='Defined at 100 in src/redis.h.'>REDIS_MBULK_BIG_ARG</a> &amp;&amp;
<a name='L945'>                (<b>signed</b>) <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf) == c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a>+2)
<a name='L946'>            <font color='red'>{</font>
<a name='L947'>                c-&gt;argv[c-&gt;argc++] = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,c-&gt;querybuf);
<a name='L948'>                <a href='../S/63.html#L153' title='Defined at 153 in src/sds.c.'>sdsIncrLen</a>(c-&gt;querybuf,-2); <i><font color='green'>/* remove CRLF */</font></i>
<a name='L949'>                c-&gt;querybuf = <a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>();
<a name='L950'>                <i><font color='green'>/* Assume that if we saw a fat argument we'll see another one</font></i>
<a name='L951'><i><font color='green'>                 * likely... */</font></i>
<a name='L952'>                c-&gt;querybuf = <a href='../D/3990.html' title='Multiple defined in 2 places.'>sdsMakeRoomFor</a>(c-&gt;querybuf,c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a>+2);
<a name='L953'>                <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> = 0;
<a name='L954'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L955'>                c-&gt;argv[c-&gt;argc++] =
<a name='L956'>                    <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>(c-&gt;querybuf+<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>,c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a>);
<a name='L957'>                <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> += c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a>+2;
<a name='L958'>            <font color='red'>}</font>
<a name='L959'>            c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> = -1;
<a name='L960'>            c-&gt;multibulklen--;
<a name='L961'>        <font color='red'>}</font>
<a name='L962'>    <font color='red'>}</font>
<a name='L963'>
<a name='L964'>    <i><font color='green'>/* Trim to pos */</font></i>
<a name='L965'>    <b>if</b> (<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>) c-&gt;querybuf = <a href='../D/4015.html' title='Multiple defined in 2 places.'>sdsrange</a>(c-&gt;querybuf,<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>,-1);
<a name='L966'>
<a name='L967'>    <i><font color='green'>/* We're done when c-&gt;multibulk == 0 */</font></i>
<a name='L968'>    <b>if</b> (c-&gt;multibulklen == 0) <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L969'>
<a name='L970'>    <i><font color='green'>/* Still not read to process the command */</font></i>
<a name='L971'>    <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L972'><font color='red'>}</font>
<a name='L973'>
<a name='L974'><b>void</b> <a href='../R/3178.html' title='Multiple refered from 3 places.'>processInputBuffer</a>(redisClient *c) <font color='red'>{</font>
<a name='L975'>    <i><font color='green'>/* Keep processing while there is something in the input buffer */</font></i>
<a name='L976'>    <b>while</b>(<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf)) <font color='red'>{</font>
<a name='L977'>        <i><font color='green'>/* Immediately abort if the client is in the middle of something. */</font></i>
<a name='L978'>        <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L176' title='Defined at 176 in src/redis.h.'>REDIS_BLOCKED</a>) <b>return</b>;
<a name='L979'>
<a name='L980'>        <i><font color='green'>/* REDIS_CLOSE_AFTER_REPLY closes the connection once the reply is</font></i>
<a name='L981'><i><font color='green'>         * written to the client. Make sure to not let the reply grow after</font></i>
<a name='L982'><i><font color='green'>         * this flag has been set (i.e. don't process more commands). */</font></i>
<a name='L983'>        <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>) <b>return</b>;
<a name='L984'>
<a name='L985'>        <i><font color='green'>/* Determine request type when unknown. */</font></i>
<a name='L986'>        <b>if</b> (!c-&gt;reqtype) <font color='red'>{</font>
<a name='L987'>            <b>if</b> (c-&gt;querybuf[0] == '*') <font color='red'>{</font>
<a name='L988'>                c-&gt;reqtype = <a href='../S/32.html#L189' title='Defined at 189 in src/redis.h.'>REDIS_REQ_MULTIBULK</a>;
<a name='L989'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L990'>                c-&gt;reqtype = <a href='../S/32.html#L188' title='Defined at 188 in src/redis.h.'>REDIS_REQ_INLINE</a>;
<a name='L991'>            <font color='red'>}</font>
<a name='L992'>        <font color='red'>}</font>
<a name='L993'>
<a name='L994'>        <b>if</b> (c-&gt;reqtype == <a href='../S/32.html#L188' title='Defined at 188 in src/redis.h.'>REDIS_REQ_INLINE</a>) <font color='red'>{</font>
<a name='L995'>            <b>if</b> (<a href='../S/86.html#L790' title='Defined at 790 in src/networking.c.'>processInlineBuffer</a>(c) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>break</b>;
<a name='L996'>        <font color='red'>}</font> <b>else</b> <b>if</b> (c-&gt;reqtype == <a href='../S/32.html#L189' title='Defined at 189 in src/redis.h.'>REDIS_REQ_MULTIBULK</a>) <font color='red'>{</font>
<a name='L997'>            <b>if</b> (<a href='../S/86.html#L842' title='Defined at 842 in src/networking.c.'>processMultibulkBuffer</a>(c) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <b>break</b>;
<a name='L998'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L999'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown request type");
<a name='L1000'>        <font color='red'>}</font>
<a name='L1001'>
<a name='L1002'>        <i><font color='green'>/* Multibulk processing could see a &lt;= 0 length. */</font></i>
<a name='L1003'>        <b>if</b> (c-&gt;argc == 0) <font color='red'>{</font>
<a name='L1004'>            <a href='../D/3906.html' title='Multiple defined in 2 places.'>resetClient</a>(c);
<a name='L1005'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1006'>            <i><font color='green'>/* Only reset the client when the command was executed. */</font></i>
<a name='L1007'>            <b>if</b> (<a href='../S/35.html#L1554' title='Defined at 1554 in src/redis.c.'>processCommand</a>(c) == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L1008'>                <a href='../D/3906.html' title='Multiple defined in 2 places.'>resetClient</a>(c);
<a name='L1009'>        <font color='red'>}</font>
<a name='L1010'>    <font color='red'>}</font>
<a name='L1011'><font color='red'>}</font>
<a name='L1012'>
<a name='L1013'><b>void</b> <a href='../R/3377.html' title='Multiple refered from 3 places.'>readQueryFromClient</a>(aeEventLoop *el, <b>int</b> fd, <b>void</b> *privdata, <b>int</b> mask) <font color='red'>{</font>
<a name='L1014'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c = (<a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a>*) privdata;
<a name='L1015'>    <b>int</b> nread, readlen;
<a name='L1016'>    size_t qblen;
<a name='L1017'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(el);
<a name='L1018'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(mask);
<a name='L1019'>
<a name='L1020'>    server.current_client = c;
<a name='L1021'>    readlen = <a href='../S/32.html#L97' title='Defined at 97 in src/redis.h.'>REDIS_IOBUF_LEN</a>;
<a name='L1022'>    <i><font color='green'>/* If this is a multi bulk request, and we are processing a bulk reply</font></i>
<a name='L1023'><i><font color='green'>     * that is large enough, try to maximize the probability that the query</font></i>
<a name='L1024'><i><font color='green'>     * buffer contains exactly the SDS string representing the object, even</font></i>
<a name='L1025'><i><font color='green'>     * at the risk of requiring more read(2) calls. This way the function</font></i>
<a name='L1026'><i><font color='green'>     * processMultiBulkBuffer() can avoid copying buffers to create the</font></i>
<a name='L1027'><i><font color='green'>     * Redis Object representing the argument. */</font></i>
<a name='L1028'>    <b>if</b> (c-&gt;reqtype == <a href='../S/32.html#L189' title='Defined at 189 in src/redis.h.'>REDIS_REQ_MULTIBULK</a> &amp;&amp; c-&gt;multibulklen &amp;&amp; c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> != -1
<a name='L1029'>        &amp;&amp; c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a> &gt;= <a href='../S/32.html#L100' title='Defined at 100 in src/redis.h.'>REDIS_MBULK_BIG_ARG</a>)
<a name='L1030'>    <font color='red'>{</font>
<a name='L1031'>        <b>int</b> remaining = (<b>unsigned</b>)(c-&gt;<a href='../S/120.html#L682' title='Defined at 682 in deps/hiredis/hiredis.c.'>bulklen</a>+2)-<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf);
<a name='L1032'>
<a name='L1033'>        <b>if</b> (remaining &lt; readlen) readlen = remaining;
<a name='L1034'>    <font color='red'>}</font>
<a name='L1035'>
<a name='L1036'>    qblen = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf);
<a name='L1037'>    <b>if</b> (c-&gt;querybuf_peak &lt; qblen) c-&gt;querybuf_peak = qblen;
<a name='L1038'>    c-&gt;querybuf = <a href='../D/3990.html' title='Multiple defined in 2 places.'>sdsMakeRoomFor</a>(c-&gt;querybuf, readlen);
<a name='L1039'>    nread = read(fd, c-&gt;querybuf+qblen, readlen);
<a name='L1040'>    <b>if</b> (nread == -1) <font color='red'>{</font>
<a name='L1041'>        <b>if</b> (errno == EAGAIN) <font color='red'>{</font>
<a name='L1042'>            nread = 0;
<a name='L1043'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1044'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>, "Reading from client: %s",strerror(errno));
<a name='L1045'>            <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L1046'>            <b>return</b>;
<a name='L1047'>        <font color='red'>}</font>
<a name='L1048'>    <font color='red'>}</font> <b>else</b> <b>if</b> (nread == 0) <font color='red'>{</font>
<a name='L1049'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>, "Client closed connection");
<a name='L1050'>        <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L1051'>        <b>return</b>;
<a name='L1052'>    <font color='red'>}</font>
<a name='L1053'>    <b>if</b> (nread) <font color='red'>{</font>
<a name='L1054'>        <a href='../S/63.html#L153' title='Defined at 153 in src/sds.c.'>sdsIncrLen</a>(c-&gt;querybuf,nread);
<a name='L1055'>        c-&gt;lastinteraction = server.unixtime;
<a name='L1056'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1057'>        server.current_client = NULL;
<a name='L1058'>        <b>return</b>;
<a name='L1059'>    <font color='red'>}</font>
<a name='L1060'>    <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf) &gt; server.client_max_querybuf_len) <font color='red'>{</font>
<a name='L1061'>        <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> ci = <a href='../S/86.html#L1093' title='Defined at 1093 in src/networking.c.'>getClientInfoString</a>(c), bytes = <a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>();
<a name='L1062'>
<a name='L1063'>        bytes = <a href='../D/3997.html' title='Multiple defined in 2 places.'>sdscatrepr</a>(bytes,c-&gt;querybuf,64);
<a name='L1064'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Closing client that reached max query buffer length: %s (qbuf initial bytes: %s)", ci, bytes);
<a name='L1065'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(ci);
<a name='L1066'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(bytes);
<a name='L1067'>        <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L1068'>        <b>return</b>;
<a name='L1069'>    <font color='red'>}</font>
<a name='L1070'>    <a href='../S/86.html#L974' title='Defined at 974 in src/networking.c.'>processInputBuffer</a>(c);
<a name='L1071'>    server.current_client = NULL;
<a name='L1072'><font color='red'>}</font>
<a name='L1073'>
<a name='L1074'><b>void</b> <a href='../R/2044.html' title='Multiple refered from 2 places.'>getClientsMaxBuffers</a>(<b>unsigned</b> <b>long</b> *longest_output_list,
<a name='L1075'>                          <b>unsigned</b> <b>long</b> *biggest_input_buffer) <font color='red'>{</font>
<a name='L1076'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c;
<a name='L1077'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L1078'>    <a href='../D/2703.html' title='Multiple defined in 2 places.'>listIter</a> li;
<a name='L1079'>    <b>unsigned</b> <b>long</b> lol = 0, bib = 0;
<a name='L1080'>
<a name='L1081'>    <a href='../S/54.html#L197' title='Defined at 197 in src/adlist.c.'>listRewind</a>(server.clients,&amp;li);
<a name='L1082'>    <b>while</b> ((ln = <a href='../S/54.html#L221' title='Defined at 221 in src/adlist.c.'>listNext</a>(&amp;li)) != NULL) <font color='red'>{</font>
<a name='L1083'>        c = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L1084'>
<a name='L1085'>        <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply) &gt; lol) lol = <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply);
<a name='L1086'>        <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf) &gt; bib) bib = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf);
<a name='L1087'>    <font color='red'>}</font>
<a name='L1088'>    *longest_output_list = lol;
<a name='L1089'>    *biggest_input_buffer = bib;
<a name='L1090'><font color='red'>}</font>
<a name='L1091'>
<a name='L1092'><i><font color='green'>/* Turn a Redis client into an sds string representing its state. */</font></i>
<a name='L1093'><a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> <a href='../R/2039.html' title='Multiple refered from 6 places.'>getClientInfoString</a>(redisClient *client) <font color='red'>{</font>
<a name='L1094'>    <b>char</b> ip[32], flags[16], events[3], *p;
<a name='L1095'>    <b>int</b> port = 0; <i><font color='green'>/* initialized to zero for the unix socket case. */</font></i>
<a name='L1096'>    <b>int</b> emask;
<a name='L1097'>
<a name='L1098'>    <b>if</b> (!(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L184' title='Defined at 184 in src/redis.h.'>REDIS_UNIX_SOCKET</a>))
<a name='L1099'>        <a href='../S/50.html#L356' title='Defined at 356 in src/anet.c.'>anetPeerToString</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;fd,ip,&amp;port);
<a name='L1100'>    p = flags;
<a name='L1101'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L172' title='Defined at 172 in src/redis.h.'>REDIS_SLAVE</a>) <font color='red'>{</font>
<a name='L1102'>        <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L174' title='Defined at 174 in src/redis.h.'>REDIS_MONITOR</a>)
<a name='L1103'>            *p++ = 'O';
<a name='L1104'>        <b>else</b>
<a name='L1105'>            *p++ = 'S';
<a name='L1106'>    <font color='red'>}</font>
<a name='L1107'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L173' title='Defined at 173 in src/redis.h.'>REDIS_MASTER</a>) *p++ = 'M';
<a name='L1108'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L175' title='Defined at 175 in src/redis.h.'>REDIS_MULTI</a>) *p++ = 'x';
<a name='L1109'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L176' title='Defined at 176 in src/redis.h.'>REDIS_BLOCKED</a>) *p++ = 'b';
<a name='L1110'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L177' title='Defined at 177 in src/redis.h.'>REDIS_DIRTY_CAS</a>) *p++ = 'd';
<a name='L1111'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>) *p++ = 'c';
<a name='L1112'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L179' title='Defined at 179 in src/redis.h.'>REDIS_UNBLOCKED</a>) *p++ = 'u';
<a name='L1113'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L183' title='Defined at 183 in src/redis.h.'>REDIS_CLOSE_ASAP</a>) *p++ = 'A';
<a name='L1114'>    <b>if</b> (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L184' title='Defined at 184 in src/redis.h.'>REDIS_UNIX_SOCKET</a>) *p++ = 'U';
<a name='L1115'>    <b>if</b> (p == flags) *p++ = 'N';
<a name='L1116'>    *p++ = '\0';
<a name='L1117'>
<a name='L1118'>    emask = <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;fd == -1 ? 0 : <a href='../S/36.html#L139' title='Defined at 139 in src/ae.c.'>aeGetFileEvents</a>(server.el,<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;fd);
<a name='L1119'>    p = events;
<a name='L1120'>    <b>if</b> (emask &amp; <a href='../S/38.html#L40' title='Defined at 40 in src/ae.h.'>AE_READABLE</a>) *p++ = 'r';
<a name='L1121'>    <b>if</b> (emask &amp; <a href='../S/38.html#L41' title='Defined at 41 in src/ae.h.'>AE_WRITABLE</a>) *p++ = 'w';
<a name='L1122'>    *p = '\0';
<a name='L1123'>    <b>return</b> <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),
<a name='L1124'>        "addr=%s:%d fd=%d age=%ld idle=%ld flags=%s db=%d sub=%d psub=%d multi=%d qbuf=%lu qbuf-free=%lu obl=%lu oll=%lu omem=%lu events=%s cmd=%s",
<a name='L1125'>        (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L184' title='Defined at 184 in src/redis.h.'>REDIS_UNIX_SOCKET</a>) ? server.unixsocket : ip,
<a name='L1126'>        port,<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;fd,
<a name='L1127'>        (<b>long</b>)(server.unixtime - <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;ctime),
<a name='L1128'>        (<b>long</b>)(server.unixtime - <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;lastinteraction),
<a name='L1129'>        flags,
<a name='L1130'>        <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;db-&gt;id,
<a name='L1131'>        (<b>int</b>) <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;pubsub_channels),
<a name='L1132'>        (<b>int</b>) <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;pubsub_patterns),
<a name='L1133'>        (<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags &amp; <a href='../S/32.html#L175' title='Defined at 175 in src/redis.h.'>REDIS_MULTI</a>) ? <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;mstate.count : -1,
<a name='L1134'>        (<b>unsigned</b> <b>long</b>) <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;querybuf),
<a name='L1135'>        (<b>unsigned</b> <b>long</b>) <a href='../D/3993.html' title='Multiple defined in 2 places.'>sdsavail</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;querybuf),
<a name='L1136'>        (<b>unsigned</b> <b>long</b>) <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;bufpos,
<a name='L1137'>        (<b>unsigned</b> <b>long</b>) <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;reply),
<a name='L1138'>        <a href='../S/86.html#L1257' title='Defined at 1257 in src/networking.c.'>getClientOutputBufferMemoryUsage</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>),
<a name='L1139'>        events,
<a name='L1140'>        <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;lastcmd ? <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;lastcmd-&gt;name : "NULL");
<a name='L1141'><font color='red'>}</font>
<a name='L1142'>
<a name='L1143'><a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> <a href='../R/2034.html' title='Multiple refered from 3 places.'>getAllClientsInfoString</a>(<b>void</b>) <font color='red'>{</font>
<a name='L1144'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L1145'>    <a href='../D/2703.html' title='Multiple defined in 2 places.'>listIter</a> li;
<a name='L1146'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>;
<a name='L1147'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> o = <a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>();
<a name='L1148'>
<a name='L1149'>    <a href='../S/54.html#L197' title='Defined at 197 in src/adlist.c.'>listRewind</a>(server.clients,&amp;li);
<a name='L1150'>    <b>while</b> ((ln = <a href='../S/54.html#L221' title='Defined at 221 in src/adlist.c.'>listNext</a>(&amp;li)) != NULL) <font color='red'>{</font>
<a name='L1151'>        <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> cs;
<a name='L1152'>
<a name='L1153'>        <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a> = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L1154'>        cs = <a href='../S/86.html#L1093' title='Defined at 1093 in src/networking.c.'>getClientInfoString</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>);
<a name='L1155'>        o = <a href='../S/63.html#L200' title='Defined at 200 in src/sds.c.'>sdscatsds</a>(o,cs);
<a name='L1156'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(cs);
<a name='L1157'>        o = <a href='../D/3995.html' title='Multiple defined in 2 places.'>sdscatlen</a>(o,"\n",1);
<a name='L1158'>    <font color='red'>}</font>
<a name='L1159'>    <b>return</b> o;
<a name='L1160'><font color='red'>}</font>
<a name='L1161'>
<a name='L1162'><b>void</b> <a href='../R/1637.html' title='Multiple refered from 2 places.'>clientCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1163'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L1164'>    <a href='../D/2703.html' title='Multiple defined in 2 places.'>listIter</a> li;
<a name='L1165'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>;
<a name='L1166'>
<a name='L1167'>    <b>if</b> (!strcasecmp(c-&gt;argv[1]-&gt;ptr,"list") &amp;&amp; c-&gt;argc == 2) <font color='red'>{</font>
<a name='L1168'>        <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> o = <a href='../S/86.html#L1143' title='Defined at 1143 in src/networking.c.'>getAllClientsInfoString</a>();
<a name='L1169'>        <a href='../S/86.html#L482' title='Defined at 482 in src/networking.c.'>addReplyBulkCBuffer</a>(c,o,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(o));
<a name='L1170'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(o);
<a name='L1171'>    <font color='red'>}</font> <b>else</b> <b>if</b> (!strcasecmp(c-&gt;argv[1]-&gt;ptr,"kill") &amp;&amp; c-&gt;argc == 3) <font color='red'>{</font>
<a name='L1172'>        <a href='../S/54.html#L197' title='Defined at 197 in src/adlist.c.'>listRewind</a>(server.clients,&amp;li);
<a name='L1173'>        <b>while</b> ((ln = <a href='../S/54.html#L221' title='Defined at 221 in src/adlist.c.'>listNext</a>(&amp;li)) != NULL) <font color='red'>{</font>
<a name='L1174'>            <b>char</b> ip[32], addr[64];
<a name='L1175'>            <b>int</b> port;
<a name='L1176'>
<a name='L1177'>            <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a> = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L1178'>            <b>if</b> (<a href='../S/50.html#L356' title='Defined at 356 in src/anet.c.'>anetPeerToString</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;fd,ip,&amp;port) == -1) <b>continue</b>;
<a name='L1179'>            snprintf(addr,<b>sizeof</b>(addr),"%s:%d",ip,port);
<a name='L1180'>            <b>if</b> (strcmp(addr,c-&gt;argv[2]-&gt;ptr) == 0) <font color='red'>{</font>
<a name='L1181'>                <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a>);
<a name='L1182'>                <b>if</b> (c == <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>) <font color='red'>{</font>
<a name='L1183'>                    <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>-&gt;flags |= <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>;
<a name='L1184'>                <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1185'>                    <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>);
<a name='L1186'>                <font color='red'>}</font>
<a name='L1187'>                <b>return</b>;
<a name='L1188'>            <font color='red'>}</font>
<a name='L1189'>        <font color='red'>}</font>
<a name='L1190'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"No such client");
<a name='L1191'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1192'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c, "Syntax error, try CLIENT (LIST | KILL ip:port)");
<a name='L1193'>    <font color='red'>}</font>
<a name='L1194'><font color='red'>}</font>
<a name='L1195'>
<a name='L1196'><i><font color='green'>/* Rewrite the command vector of the client. All the new objects ref count</font></i>
<a name='L1197'><i><font color='green'> * is incremented. The old command vector is freed, and the old objects</font></i>
<a name='L1198'><i><font color='green'> * ref count is decremented. */</font></i>
<a name='L1199'><b>void</b> <a href='../R/3555.html' title='Multiple refered from 5 places.'>rewriteClientCommandVector</a>(redisClient *c, <b>int</b> argc, ...) <font color='red'>{</font>
<a name='L1200'>    va_list ap;
<a name='L1201'>    <b>int</b> j;
<a name='L1202'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> **argv; <i><font color='green'>/* The new argument vector */</font></i>
<a name='L1203'>
<a name='L1204'>    argv = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*)*argc);
<a name='L1205'>    va_start(ap,argc);
<a name='L1206'>    <b>for</b> (j = 0; j &lt; argc; j++) <font color='red'>{</font>
<a name='L1207'>        <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *a;
<a name='L1208'>        
<a name='L1209'>        a = va_arg(ap, <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*);
<a name='L1210'>        argv[j] = a;
<a name='L1211'>        <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(a);
<a name='L1212'>    <font color='red'>}</font>
<a name='L1213'>    <i><font color='green'>/* We free the objects in the original vector at the end, so we are</font></i>
<a name='L1214'><i><font color='green'>     * sure that if the same objects are reused in the new vector the</font></i>
<a name='L1215'><i><font color='green'>     * refcount gets incremented before it gets decremented. */</font></i>
<a name='L1216'>    <b>for</b> (j = 0; j &lt; c-&gt;argc; j++) <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(c-&gt;argv[j]);
<a name='L1217'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(c-&gt;argv);
<a name='L1218'>    <i><font color='green'>/* Replace argv and argc with our new versions. */</font></i>
<a name='L1219'>    c-&gt;argv = argv;
<a name='L1220'>    c-&gt;argc = argc;
<a name='L1221'>    c-&gt;cmd = <a href='../S/35.html#L1448' title='Defined at 1448 in src/redis.c.'>lookupCommand</a>(c-&gt;argv[0]-&gt;ptr);
<a name='L1222'>    <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,NULL,c-&gt;cmd != NULL);
<a name='L1223'>    va_end(ap);
<a name='L1224'><font color='red'>}</font>
<a name='L1225'>
<a name='L1226'><i><font color='green'>/* Rewrite a single item in the command vector.</font></i>
<a name='L1227'><i><font color='green'> * The new val ref count is incremented, and the old decremented. */</font></i>
<a name='L1228'><b>void</b> <a href='../R/3554.html' title='Multiple refered from 7 places.'>rewriteClientCommandArgument</a>(redisClient *c, <b>int</b> i, robj *newval) <font color='red'>{</font>
<a name='L1229'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *oldval;
<a name='L1230'>   
<a name='L1231'>    <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,NULL,i &lt; c-&gt;argc);
<a name='L1232'>    oldval = c-&gt;argv[i];
<a name='L1233'>    c-&gt;argv[i] = newval;
<a name='L1234'>    <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(newval);
<a name='L1235'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(oldval);
<a name='L1236'>
<a name='L1237'>    <i><font color='green'>/* If this is the command name make sure to fix c-&gt;cmd. */</font></i>
<a name='L1238'>    <b>if</b> (i == 0) <font color='red'>{</font>
<a name='L1239'>        c-&gt;cmd = <a href='../S/35.html#L1448' title='Defined at 1448 in src/redis.c.'>lookupCommand</a>(c-&gt;argv[0]-&gt;ptr);
<a name='L1240'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,NULL,c-&gt;cmd != NULL);
<a name='L1241'>    <font color='red'>}</font>
<a name='L1242'><font color='red'>}</font>
<a name='L1243'>
<a name='L1244'><i><font color='green'>/* This function returns the number of bytes that Redis is virtually</font></i>
<a name='L1245'><i><font color='green'> * using to store the reply still not read by the client.</font></i>
<a name='L1246'><i><font color='green'> * It is "virtual" since the reply output list may contain objects that</font></i>
<a name='L1247'><i><font color='green'> * are shared and are not really using additional memory.</font></i>
<a name='L1248'><i><font color='green'> *</font></i>
<a name='L1249'><i><font color='green'> * The function returns the total sum of the length of all the objects</font></i>
<a name='L1250'><i><font color='green'> * stored in the output list, plus the memory used to allocate every</font></i>
<a name='L1251'><i><font color='green'> * list node. The static reply buffer is not taken into account since it</font></i>
<a name='L1252'><i><font color='green'> * is allocated anyway.</font></i>
<a name='L1253'><i><font color='green'> *</font></i>
<a name='L1254'><i><font color='green'> * Note: this function is very fast so can be called as many time as</font></i>
<a name='L1255'><i><font color='green'> * the caller wishes. The main usage of this function currently is</font></i>
<a name='L1256'><i><font color='green'> * enforcing the client output length limits. */</font></i>
<a name='L1257'><b>unsigned</b> <b>long</b> <a href='../R/2043.html' title='Multiple refered from 4 places.'>getClientOutputBufferMemoryUsage</a>(redisClient *c) <font color='red'>{</font>
<a name='L1258'>    <b>unsigned</b> <b>long</b> list_item_size = <b>sizeof</b>(<a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a>)+<b>sizeof</b>(<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>);
<a name='L1259'>
<a name='L1260'>    <b>return</b> c-&gt;reply_bytes + (list_item_size*<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;reply));
<a name='L1261'><font color='red'>}</font>
<a name='L1262'>
<a name='L1263'><i><font color='green'>/* Get the class of a client, used in order to enforce limits to different</font></i>
<a name='L1264'><i><font color='green'> * classes of clients.</font></i>
<a name='L1265'><i><font color='green'> *</font></i>
<a name='L1266'><i><font color='green'> * The function will return one of the following:</font></i>
<a name='L1267'><i><font color='green'> * REDIS_CLIENT_LIMIT_CLASS_NORMAL -&gt; Normal client</font></i>
<a name='L1268'><i><font color='green'> * REDIS_CLIENT_LIMIT_CLASS_SLAVE  -&gt; Slave or client executing MONITOR command</font></i>
<a name='L1269'><i><font color='green'> * REDIS_CLIENT_LIMIT_CLASS_PUBSUB -&gt; Client subscribed to Pub/Sub channels</font></i>
<a name='L1270'><i><font color='green'> */</font></i>
<a name='L1271'><b>int</b> <a href='../S/86.html#L1304' title='Refered from 1304 in src/networking.c.'>getClientLimitClass</a>(redisClient *c) <font color='red'>{</font>
<a name='L1272'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L172' title='Defined at 172 in src/redis.h.'>REDIS_SLAVE</a>) <b>return</b> <a href='../S/32.html#L194' title='Defined at 194 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_SLAVE</a>;
<a name='L1273'>    <b>if</b> (<a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(c-&gt;pubsub_channels) || <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;pubsub_patterns))
<a name='L1274'>        <b>return</b> <a href='../S/32.html#L195' title='Defined at 195 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_PUBSUB</a>;
<a name='L1275'>    <b>return</b> <a href='../S/32.html#L193' title='Defined at 193 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_NORMAL</a>;
<a name='L1276'><font color='red'>}</font>
<a name='L1277'>
<a name='L1278'><b>int</b> <a href='../R/2041.html' title='Multiple refered from 4 places.'>getClientLimitClassByName</a>(<b>char</b> *name) <font color='red'>{</font>
<a name='L1279'>    <b>if</b> (!strcasecmp(name,"normal")) <b>return</b> <a href='../S/32.html#L193' title='Defined at 193 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_NORMAL</a>;
<a name='L1280'>    <b>else</b> <b>if</b> (!strcasecmp(name,"slave")) <b>return</b> <a href='../S/32.html#L194' title='Defined at 194 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_SLAVE</a>;
<a name='L1281'>    <b>else</b> <b>if</b> (!strcasecmp(name,"pubsub")) <b>return</b> <a href='../S/32.html#L195' title='Defined at 195 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_PUBSUB</a>;
<a name='L1282'>    <b>else</b> <b>return</b> -1;
<a name='L1283'><font color='red'>}</font>
<a name='L1284'>
<a name='L1285'><b>char</b> *<a href='../R/2042.html' title='Multiple refered from 2 places.'>getClientLimitClassName</a>(<b>int</b> class) <font color='red'>{</font>
<a name='L1286'>    <b>switch</b>(class) <font color='red'>{</font>
<a name='L1287'>    <b>case</b> <a href='../S/32.html#L193' title='Defined at 193 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_NORMAL</a>:   <b>return</b> "normal";
<a name='L1288'>    <b>case</b> <a href='../S/32.html#L194' title='Defined at 194 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_SLAVE</a>:    <b>return</b> "slave";
<a name='L1289'>    <b>case</b> <a href='../S/32.html#L195' title='Defined at 195 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_PUBSUB</a>:   <b>return</b> "pubsub";
<a name='L1290'>    <b>default</b>:                                <b>return</b> NULL;
<a name='L1291'>    <font color='red'>}</font>
<a name='L1292'><font color='red'>}</font>
<a name='L1293'>
<a name='L1294'><i><font color='green'>/* The function checks if the client reached output buffer soft or hard</font></i>
<a name='L1295'><i><font color='green'> * limit, and also update the state needed to check the soft limit as</font></i>
<a name='L1296'><i><font color='green'> * a side effect.</font></i>
<a name='L1297'><i><font color='green'> *</font></i>
<a name='L1298'><i><font color='green'> * Return value: non-zero if the client reached the soft or the hard limit.</font></i>
<a name='L1299'><i><font color='green'> *               Otherwise zero is returned. */</font></i>
<a name='L1300'><b>int</b> <a href='../S/86.html#L1344' title='Refered from 1344 in src/networking.c.'>checkClientOutputBufferLimits</a>(redisClient *c) <font color='red'>{</font>
<a name='L1301'>    <b>int</b> soft = 0, hard = 0, class;
<a name='L1302'>    <b>unsigned</b> <b>long</b> used_mem = <a href='../S/86.html#L1257' title='Defined at 1257 in src/networking.c.'>getClientOutputBufferMemoryUsage</a>(c);
<a name='L1303'>
<a name='L1304'>    class = <a href='../S/86.html#L1271' title='Defined at 1271 in src/networking.c.'>getClientLimitClass</a>(c);
<a name='L1305'>    <b>if</b> (server.client_obuf_limits[class].hard_limit_bytes &amp;&amp;
<a name='L1306'>        used_mem &gt;= server.client_obuf_limits[class].hard_limit_bytes)
<a name='L1307'>        hard = 1;
<a name='L1308'>    <b>if</b> (server.client_obuf_limits[class].soft_limit_bytes &amp;&amp;
<a name='L1309'>        used_mem &gt;= server.client_obuf_limits[class].soft_limit_bytes)
<a name='L1310'>        soft = 1;
<a name='L1311'>
<a name='L1312'>    <i><font color='green'>/* We need to check if the soft limit is reached continuously for the</font></i>
<a name='L1313'><i><font color='green'>     * specified amount of seconds. */</font></i>
<a name='L1314'>    <b>if</b> (soft) <font color='red'>{</font>
<a name='L1315'>        <b>if</b> (c-&gt;obuf_soft_limit_reached_time == 0) <font color='red'>{</font>
<a name='L1316'>            c-&gt;obuf_soft_limit_reached_time = server.unixtime;
<a name='L1317'>            soft = 0; <i><font color='green'>/* First time we see the soft limit reached */</font></i>
<a name='L1318'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1319'>            time_t elapsed = server.unixtime - c-&gt;obuf_soft_limit_reached_time;
<a name='L1320'>
<a name='L1321'>            <b>if</b> (elapsed &lt;=
<a name='L1322'>                server.client_obuf_limits[class].soft_limit_seconds) <font color='red'>{</font>
<a name='L1323'>                soft = 0; <i><font color='green'>/* The client still did not reached the max number of</font></i>
<a name='L1324'><i><font color='green'>                             seconds for the soft limit to be considered</font></i>
<a name='L1325'><i><font color='green'>                             reached. */</font></i>
<a name='L1326'>            <font color='red'>}</font>
<a name='L1327'>        <font color='red'>}</font>
<a name='L1328'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1329'>        c-&gt;obuf_soft_limit_reached_time = 0;
<a name='L1330'>    <font color='red'>}</font>
<a name='L1331'>    <b>return</b> soft || hard;
<a name='L1332'><font color='red'>}</font>
<a name='L1333'>
<a name='L1334'><i><font color='green'>/* Asynchronously close a client if soft or hard limit is reached on the</font></i>
<a name='L1335'><i><font color='green'> * output buffer size. The caller can check if the client will be closed</font></i>
<a name='L1336'><i><font color='green'> * checking if the client REDIS_CLOSE_ASAP flag is set.</font></i>
<a name='L1337'><i><font color='green'> *</font></i>
<a name='L1338'><i><font color='green'> * Note: we need to close the client asynchronously because this function is</font></i>
<a name='L1339'><i><font color='green'> * called from contexts where the client can't be freed safely, i.e. from the</font></i>
<a name='L1340'><i><font color='green'> * lower level functions pushing data inside the client output buffers. */</font></i>
<a name='L1341'><b>void</b> <a href='../R/1416.html' title='Multiple refered from 5 places.'>asyncCloseClientOnOutputBufferLimitReached</a>(redisClient *c) <font color='red'>{</font>
<a name='L1342'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(c-&gt;reply_bytes &lt; ULONG_MAX-(1024*64));
<a name='L1343'>    <b>if</b> (c-&gt;reply_bytes == 0 || c-&gt;flags &amp; <a href='../S/32.html#L183' title='Defined at 183 in src/redis.h.'>REDIS_CLOSE_ASAP</a>) <b>return</b>;
<a name='L1344'>    <b>if</b> (<a href='../S/86.html#L1300' title='Defined at 1300 in src/networking.c.'>checkClientOutputBufferLimits</a>(c)) <font color='red'>{</font>
<a name='L1345'>        <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a> = <a href='../S/86.html#L1093' title='Defined at 1093 in src/networking.c.'>getClientInfoString</a>(c);
<a name='L1346'>
<a name='L1347'>        <a href='../S/86.html#L678' title='Defined at 678 in src/networking.c.'>freeClientAsync</a>(c);
<a name='L1348'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Client %s scheduled to be closed ASAP for overcoming of output buffer limits.", <a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>);
<a name='L1349'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(<a href='../S/94.html#L87' title='Defined at 87 in src/redis-benchmark.c.'>client</a>);
<a name='L1350'>    <font color='red'>}</font>
<a name='L1351'><font color='red'>}</font>
<a name='L1352'>
<a name='L1353'><i><font color='green'>/* Helper function used by freeMemoryIfNeeded() in order to flush slaves</font></i>
<a name='L1354'><i><font color='green'> * output buffers without returning control to the event loop. */</font></i>
<a name='L1355'><b>void</b> <a href='../R/1982.html' title='Multiple refered from 2 places.'>flushSlavesOutputBuffers</a>(<b>void</b>) <font color='red'>{</font>
<a name='L1356'>    <a href='../D/2703.html' title='Multiple defined in 2 places.'>listIter</a> li;
<a name='L1357'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L1358'>
<a name='L1359'>    <a href='../S/54.html#L197' title='Defined at 197 in src/adlist.c.'>listRewind</a>(server.slaves,&amp;li);
<a name='L1360'>    <b>while</b>((ln = <a href='../S/54.html#L221' title='Defined at 221 in src/adlist.c.'>listNext</a>(&amp;li))) <font color='red'>{</font>
<a name='L1361'>        <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *slave = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L1362'>        <b>int</b> events;
<a name='L1363'>
<a name='L1364'>        events = <a href='../S/36.html#L139' title='Defined at 139 in src/ae.c.'>aeGetFileEvents</a>(server.el,slave-&gt;fd);
<a name='L1365'>        <b>if</b> (events &amp; <a href='../S/38.html#L41' title='Defined at 41 in src/ae.h.'>AE_WRITABLE</a> &amp;&amp;
<a name='L1366'>            slave-&gt;replstate == <a href='../S/32.html#L216' title='Defined at 216 in src/redis.h.'>REDIS_REPL_ONLINE</a> &amp;&amp;
<a name='L1367'>            <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(slave-&gt;reply))
<a name='L1368'>        <font color='red'>{</font>
<a name='L1369'>            <a href='../S/86.html#L695' title='Defined at 695 in src/networking.c.'>sendReplyToClient</a>(server.el,slave-&gt;fd,slave,0);
<a name='L1370'>        <font color='red'>}</font>
<a name='L1371'>    <font color='red'>}</font>
<a name='L1372'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L39'>[^]</a><a href='#L1355'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
