<html>
<head>
<title>src/redis.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/401.html'>src</a>/redis.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L260'>[^]</a><a href='#L2530'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L260' title='Defined at 260.'>redisLogRaw</a>
<li><a href='#L294' title='Defined at 294.'>redisLog</a>
<li><a href='#L313' title='Defined at 313.'>redisLogFromHandler</a>
<li><a href='#L337' title='Defined at 337.'>ustime</a>
<li><a href='#L348' title='Defined at 348.'>mstime</a>
<li><a href='#L356' title='Defined at 356.'>exitFromChild</a>
<li><a href='#L370' title='Defined at 370.'>dictVanillaFree</a>
<li><a href='#L376' title='Defined at 376.'>dictListDestructor</a>
<li><a href='#L382' title='Defined at 382.'>dictSdsKeyCompare</a>
<li><a href='#L396' title='Defined at 396.'>dictSdsKeyCaseCompare</a>
<li><a href='#L404' title='Defined at 404.'>dictRedisObjectDestructor</a>
<li><a href='#L412' title='Defined at 412.'>dictSdsDestructor</a>
<li><a href='#L419' title='Defined at 419.'>dictObjKeyCompare</a>
<li><a href='#L426' title='Defined at 426.'>dictObjHash</a>
<li><a href='#L431' title='Defined at 431.'>dictSdsHash</a>
<li><a href='#L435' title='Defined at 435.'>dictSdsCaseHash</a>
<li><a href='#L439' title='Defined at 439.'>dictEncObjKeyCompare</a>
<li><a href='#L457' title='Defined at 457.'>dictEncObjHash</a>
<li><a href='#L562' title='Defined at 562.'>htNeedsResize</a>
<li><a href='#L573' title='Defined at 573.'>tryResizeHashTables</a>
<li><a href='#L588' title='Defined at 588.'>incrementallyRehash</a>
<li><a href='#L611' title='Defined at 611.'>updateDictResizePolicy</a>
<li><a href='#L624' title='Defined at 624.'>activeExpireCycle</a>
<li><a href='#L684' title='Defined at 684.'>updateLRUClock</a>
<li><a href='#L691' title='Defined at 691.'>trackOperationsPerSecond</a>
<li><a href='#L705' title='Defined at 705.'>getOperationsPerSecond</a>
<li><a href='#L715' title='Defined at 715.'>clientsCronHandleTimeout</a>
<li><a href='#L742' title='Defined at 742.'>clientsCronResizeQueryBuffer</a>
<li><a href='#L764' title='Defined at 764.'>clientsCron</a>
<li><a href='#L812' title='Defined at 812.'>serverCron</a>
<li><a href='#L985' title='Defined at 985.'>beforeSleep</a>
<li><a href='#L1012' title='Defined at 1012.'>createSharedObjects</a>
<li><a href='#L1083' title='Defined at 1083.'>initServerConfig</a>
<li><a href='#L1212' title='Defined at 1212.'>adjustOpenFilesLimit</a>
<li><a href='#L1248' title='Defined at 1248.'>initServer</a>
<li><a href='#L1364' title='Defined at 1364.'>populateCommandTable</a>
<li><a href='#L1397' title='Defined at 1397.'>resetCommandTableStats</a>
<li><a href='#L1411' title='Defined at 1411.'>redisOpArrayInit</a>
<li><a href='#L1416' title='Defined at 1416.'>redisOpArrayAppend</a>
<li><a href='#L1432' title='Defined at 1432.'>redisOpArrayFree</a>
<li><a href='#L1448' title='Defined at 1448.'>lookupCommand</a>
<li><a href='#L1452' title='Defined at 1452.'>lookupCommandByCString</a>
<li><a href='#L1469' title='Defined at 1469.'>propagate</a>
<li><a href='#L1480' title='Defined at 1480.'>alsoPropagate</a>
<li><a href='#L1487' title='Defined at 1487.'>call</a>
<li><a href='#L1554' title='Defined at 1554.'>processCommand</a>
<li><a href='#L1685' title='Defined at 1685.'>prepareForShutdown</a>
<li><a href='#L1750' title='Defined at 1750.'>time_independent_strcmp</a>
<li><a href='#L1783' title='Defined at 1783.'>authCommand</a>
<li><a href='#L1795' title='Defined at 1795.'>pingCommand</a>
<li><a href='#L1799' title='Defined at 1799.'>echoCommand</a>
<li><a href='#L1803' title='Defined at 1803.'>timeCommand</a>
<li><a href='#L1816' title='Defined at 1816.'>bytesToHuman</a>
<li><a href='#L1838' title='Defined at 1838.'>genRedisInfoString</a>
<li><a href='#L2187' title='Defined at 2187.'>infoCommand</a>
<li><a href='#L2201' title='Defined at 2201.'>monitorCommand</a>
<li><a href='#L2228' title='Defined at 2228.'>freeMemoryIfNeeded</a>
<li><a href='#L2372' title='Defined at 2372.'>linuxOvercommitMemoryValue</a>
<li><a href='#L2386' title='Defined at 2386.'>linuxOvercommitMemoryWarning</a>
<li><a href='#L2393' title='Defined at 2393.'>createPidFile</a>
<li><a href='#L2402' title='Defined at 2402.'>daemonize</a>
<li><a href='#L2419' title='Defined at 2419.'>version</a>
<li><a href='#L2429' title='Defined at 2429.'>usage</a>
<li><a href='#L2446' title='Defined at 2446.'>redisAsciiArt</a>
<li><a href='#L2465' title='Defined at 2465.'>sigtermHandler</a>
<li><a href='#L2472' title='Defined at 2472.'>setupSignalHandlers</a>
<li><a href='#L2498' title='Defined at 2498.'>checkForSentinelMode</a>
<li><a href='#L2508' title='Defined at 2508.'>loadDataFromDisk</a>
<li><a href='#L2524' title='Defined at 2524.'>redisOutOfMemoryHandler</a>
<li><a href='#L2530' title='Defined at 2530.'>main</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'> * Copyright (c) 2009-2012, Salvatore Sanfilippo &lt;antirez at gmail dot com&gt;</font></i>
<a name='L3'><i><font color='green'> * All rights reserved.</font></i>
<a name='L4'><i><font color='green'> *</font></i>
<a name='L5'><i><font color='green'> * Redistribution and use in source and binary forms, with or without</font></i>
<a name='L6'><i><font color='green'> * modification, are permitted provided that the following conditions are met:</font></i>
<a name='L7'><i><font color='green'> *</font></i>
<a name='L8'><i><font color='green'> *   * Redistributions of source code must retain the above copyright notice,</font></i>
<a name='L9'><i><font color='green'> *     this list of conditions and the following disclaimer.</font></i>
<a name='L10'><i><font color='green'> *   * Redistributions in binary form must reproduce the above copyright</font></i>
<a name='L11'><i><font color='green'> *     notice, this list of conditions and the following disclaimer in the</font></i>
<a name='L12'><i><font color='green'> *     documentation and/or other materials provided with the distribution.</font></i>
<a name='L13'><i><font color='green'> *   * Neither the name of Redis nor the names of its contributors may be used</font></i>
<a name='L14'><i><font color='green'> *     to endorse or promote products derived from this software without</font></i>
<a name='L15'><i><font color='green'> *     specific prior written permission.</font></i>
<a name='L16'><i><font color='green'> *</font></i>
<a name='L17'><i><font color='green'> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</font></i>
<a name='L18'><i><font color='green'> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</font></i>
<a name='L19'><i><font color='green'> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</font></i>
<a name='L20'><i><font color='green'> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</font></i>
<a name='L21'><i><font color='green'> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</font></i>
<a name='L22'><i><font color='green'> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</font></i>
<a name='L23'><i><font color='green'> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</font></i>
<a name='L24'><i><font color='green'> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</font></i>
<a name='L25'><i><font color='green'> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</font></i>
<a name='L26'><i><font color='green'> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</font></i>
<a name='L27'><i><font color='green'> * POSSIBILITY OF SUCH DAMAGE.</font></i>
<a name='L28'><i><font color='green'> */</font></i>
<a name='L29'>
<a name='L30'><font color='darkred'>#include</font> "<a href='32.html'>redis.h</a>"
<a name='L31'><font color='darkred'>#include</font> "<a href='21.html'>slowlog.h</a>"
<a name='L32'><font color='darkred'>#include</font> "<a href='68.html'>bio.h</a>"
<a name='L33'>
<a name='L34'><font color='darkred'>#include</font> &lt;time.h&gt;
<a name='L35'><font color='darkred'>#include</font> &lt;signal.h&gt;
<a name='L36'><font color='darkred'>#include</font> &lt;sys/wait.h&gt;
<a name='L37'><font color='darkred'>#include</font> &lt;errno.h&gt;
<a name='L38'><font color='darkred'>#include</font> &lt;assert.h&gt;
<a name='L39'><font color='darkred'>#include</font> &lt;ctype.h&gt;
<a name='L40'><font color='darkred'>#include</font> &lt;stdarg.h&gt;
<a name='L41'><font color='darkred'>#include</font> &lt;arpa/inet.h&gt;
<a name='L42'><font color='darkred'>#include</font> &lt;sys/stat.h&gt;
<a name='L43'><font color='darkred'>#include</font> &lt;fcntl.h&gt;
<a name='L44'><font color='darkred'>#include</font> &lt;sys/time.h&gt;
<a name='L45'><font color='darkred'>#include</font> &lt;sys/resource.h&gt;
<a name='L46'><font color='darkred'>#include</font> &lt;sys/uio.h&gt;
<a name='L47'><font color='darkred'>#include</font> &lt;limits.h&gt;
<a name='L48'><font color='darkred'>#include</font> &lt;float.h&gt;
<a name='L49'><font color='darkred'>#include</font> &lt;math.h&gt;
<a name='L50'><font color='darkred'>#include</font> &lt;sys/resource.h&gt;
<a name='L51'><font color='darkred'>#include</font> &lt;sys/utsname.h&gt;
<a name='L52'>
<a name='L53'><i><font color='green'>/* Our shared "common" objects */</font></i>
<a name='L54'>
<a name='L55'><b>struct</b> <a href='../S/32.html#L423' title='Defined at 423 in src/redis.h.'>sharedObjectsStruct</a> shared;
<a name='L56'>
<a name='L57'><i><font color='green'>/* Global vars that are actually used as constants. The following double</font></i>
<a name='L58'><i><font color='green'> * values are used for double on-disk serialization, and are initialized</font></i>
<a name='L59'><i><font color='green'> * at runtime to avoid strange compiler optimizations. */</font></i>
<a name='L60'>
<a name='L61'><b>double</b> R_Zero, R_PosInf, R_NegInf, R_Nan;
<a name='L62'>
<a name='L63'><i><font color='green'>/*================================= Globals ================================= */</font></i>
<a name='L64'>
<a name='L65'><i><font color='green'>/* Global vars */</font></i>
<a name='L66'><b>struct</b> <a href='../S/32.html#L494' title='Defined at 494 in src/redis.h.'>redisServer</a> server; <i><font color='green'>/* server global state */</font></i>
<a name='L67'><b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> *commandTable;
<a name='L68'>
<a name='L69'><i><font color='green'>/* Our command table.</font></i>
<a name='L70'><i><font color='green'> *</font></i>
<a name='L71'><i><font color='green'> * Every entry is composed of the following fields:</font></i>
<a name='L72'><i><font color='green'> *</font></i>
<a name='L73'><i><font color='green'> * name: a string representing the command name.</font></i>
<a name='L74'><i><font color='green'> * function: pointer to the C function implementing the command.</font></i>
<a name='L75'><i><font color='green'> * arity: number of arguments, it is possible to use -N to say &gt;= N</font></i>
<a name='L76'><i><font color='green'> * sflags: command flags as string. See below for a table of flags.</font></i>
<a name='L77'><i><font color='green'> * flags: flags as bitmask. Computed by Redis using the 'sflags' field.</font></i>
<a name='L78'><i><font color='green'> * get_keys_proc: an optional function to get key arguments from a command.</font></i>
<a name='L79'><i><font color='green'> *                This is only used when the following three fields are not</font></i>
<a name='L80'><i><font color='green'> *                enough to specify what arguments are keys.</font></i>
<a name='L81'><i><font color='green'> * first_key_index: first argument that is a key</font></i>
<a name='L82'><i><font color='green'> * last_key_index: last argument that is a key</font></i>
<a name='L83'><i><font color='green'> * key_step: step to get all the keys from first to last argument. For instance</font></i>
<a name='L84'><i><font color='green'> *           in MSET the step is two since arguments are key,val,key,val,...</font></i>
<a name='L85'><i><font color='green'> * microseconds: microseconds of total execution time for this command.</font></i>
<a name='L86'><i><font color='green'> * calls: total number of calls of this command.</font></i>
<a name='L87'><i><font color='green'> *</font></i>
<a name='L88'><i><font color='green'> * The flags, microseconds and calls fields are computed by Redis and should</font></i>
<a name='L89'><i><font color='green'> * always be set to zero.</font></i>
<a name='L90'><i><font color='green'> *</font></i>
<a name='L91'><i><font color='green'> * Command flags are expressed using strings where every character represents</font></i>
<a name='L92'><i><font color='green'> * a flag. Later the populateCommandTable() function will take care of</font></i>
<a name='L93'><i><font color='green'> * populating the real 'flags' field using this characters.</font></i>
<a name='L94'><i><font color='green'> *</font></i>
<a name='L95'><i><font color='green'> * This is the meaning of the flags:</font></i>
<a name='L96'><i><font color='green'> *</font></i>
<a name='L97'><i><font color='green'> * w: write command (may modify the key space).</font></i>
<a name='L98'><i><font color='green'> * r: read command  (will never modify the key space).</font></i>
<a name='L99'><i><font color='green'> * m: may increase memory usage once called. Don't allow if out of memory.</font></i>
<a name='L100'><i><font color='green'> * a: admin command, like SAVE or SHUTDOWN.</font></i>
<a name='L101'><i><font color='green'> * p: Pub/Sub related command.</font></i>
<a name='L102'><i><font color='green'> * f: force replication of this command, regarless of server.dirty.</font></i>
<a name='L103'><i><font color='green'> * s: command not allowed in scripts.</font></i>
<a name='L104'><i><font color='green'> * R: random command. Command is not deterministic, that is, the same command</font></i>
<a name='L105'><i><font color='green'> *    with the same arguments, with the same key space, may have different</font></i>
<a name='L106'><i><font color='green'> *    results. For instance SPOP and RANDOMKEY are two random commands.</font></i>
<a name='L107'><i><font color='green'> * S: Sort command output array if called from script, so that the output</font></i>
<a name='L108'><i><font color='green'> *    is deterministic.</font></i>
<a name='L109'><i><font color='green'> * l: Allow command while loading the database.</font></i>
<a name='L110'><i><font color='green'> * t: Allow command while a slave has stale data but is not allowed to</font></i>
<a name='L111'><i><font color='green'> *    server this data. Normally no command is accepted in this condition</font></i>
<a name='L112'><i><font color='green'> *    but just a few.</font></i>
<a name='L113'><i><font color='green'> * M: Do not automatically propagate the command on MONITOR.</font></i>
<a name='L114'><i><font color='green'> */</font></i>
<a name='L115'><b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> redisCommandTable[] = <font color='red'>{</font>
<a name='L116'>    <font color='red'>{</font>"get",<a href='../S/79.html#L103' title='Defined at 103 in src/t_string.c.'>getCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L117'>    <font color='red'>{</font>"set",<a href='../S/79.html#L68' title='Defined at 68 in src/t_string.c.'>setCommand</a>,3,"wm",0,<a href='../S/31.html#L676' title='Defined at 676 in src/db.c.'>noPreloadGetKeys</a>,1,1,1,0,0<font color='red'>}</font>,
<a name='L118'>    <font color='red'>{</font>"setnx",<a href='../S/79.html#L73' title='Defined at 73 in src/t_string.c.'>setnxCommand</a>,3,"wm",0,<a href='../S/31.html#L676' title='Defined at 676 in src/db.c.'>noPreloadGetKeys</a>,1,1,1,0,0<font color='red'>}</font>,
<a name='L119'>    <font color='red'>{</font>"setex",<a href='../S/79.html#L78' title='Defined at 78 in src/t_string.c.'>setexCommand</a>,4,"wm",0,<a href='../S/31.html#L676' title='Defined at 676 in src/db.c.'>noPreloadGetKeys</a>,1,1,1,0,0<font color='red'>}</font>,
<a name='L120'>    <font color='red'>{</font>"psetex",<a href='../S/79.html#L83' title='Defined at 83 in src/t_string.c.'>psetexCommand</a>,4,"wm",0,<a href='../S/31.html#L676' title='Defined at 676 in src/db.c.'>noPreloadGetKeys</a>,1,1,1,0,0<font color='red'>}</font>,
<a name='L121'>    <font color='red'>{</font>"append",<a href='../S/79.html#L351' title='Defined at 351 in src/t_string.c.'>appendCommand</a>,3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L122'>    <font color='red'>{</font>"strlen",<a href='../S/79.html#L390' title='Defined at 390 in src/t_string.c.'>strlenCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L123'>    <font color='red'>{</font>"del",<a href='../S/31.html#L235' title='Defined at 235 in src/db.c.'>delCommand</a>,-2,"w",0,<a href='../S/31.html#L676' title='Defined at 676 in src/db.c.'>noPreloadGetKeys</a>,1,-1,1,0,0<font color='red'>}</font>,
<a name='L124'>    <font color='red'>{</font>"exists",<a href='../S/31.html#L248' title='Defined at 248 in src/db.c.'>existsCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L125'>    <font color='red'>{</font>"setbit",<a href='../S/17.html#L106' title='Defined at 106 in src/bitops.c.'>setbitCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L126'>    <font color='red'>{</font>"getbit",<a href='../S/17.html#L161' title='Defined at 161 in src/bitops.c.'>getbitCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L127'>    <font color='red'>{</font>"setrange",<a href='../S/79.html#L114' title='Defined at 114 in src/t_string.c.'>setrangeCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L128'>    <font color='red'>{</font>"getrange",<a href='../S/79.html#L177' title='Defined at 177 in src/t_string.c.'>getrangeCommand</a>,4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L129'>    <font color='red'>{</font>"substr",<a href='../S/79.html#L177' title='Defined at 177 in src/t_string.c.'>getrangeCommand</a>,4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L130'>    <font color='red'>{</font>"incr",<a href='../S/79.html#L296' title='Defined at 296 in src/t_string.c.'>incrCommand</a>,2,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L131'>    <font color='red'>{</font>"decr",<a href='../S/79.html#L300' title='Defined at 300 in src/t_string.c.'>decrCommand</a>,2,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L132'>    <font color='red'>{</font>"mget",<a href='../S/79.html#L214' title='Defined at 214 in src/t_string.c.'>mgetCommand</a>,-2,"r",0,NULL,1,-1,1,0,0<font color='red'>}</font>,
<a name='L133'>    <font color='red'>{</font>"rpush",<a href='../S/60.html#L327' title='Defined at 327 in src/t_list.c.'>rpushCommand</a>,-3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L134'>    <font color='red'>{</font>"lpush",<a href='../S/60.html#L323' title='Defined at 323 in src/t_list.c.'>lpushCommand</a>,-3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L135'>    <font color='red'>{</font>"rpushx",<a href='../S/60.html#L389' title='Defined at 389 in src/t_list.c.'>rpushxCommand</a>,3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L136'>    <font color='red'>{</font>"lpushx",<a href='../S/60.html#L384' title='Defined at 384 in src/t_list.c.'>lpushxCommand</a>,3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L137'>    <font color='red'>{</font>"linsert",<a href='../S/60.html#L394' title='Defined at 394 in src/t_list.c.'>linsertCommand</a>,5,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L138'>    <font color='red'>{</font>"rpop",<a href='../S/60.html#L511' title='Defined at 511 in src/t_list.c.'>rpopCommand</a>,2,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L139'>    <font color='red'>{</font>"lpop",<a href='../S/60.html#L507' title='Defined at 507 in src/t_list.c.'>lpopCommand</a>,2,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L140'>    <font color='red'>{</font>"brpop",<a href='../S/60.html#L1085' title='Defined at 1085 in src/t_list.c.'>brpopCommand</a>,-3,"ws",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L141'>    <font color='red'>{</font>"brpoplpush",<a href='../S/60.html#L1089' title='Defined at 1089 in src/t_list.c.'>brpoplpushCommand</a>,4,"wms",0,NULL,1,2,1,0,0<font color='red'>}</font>,
<a name='L142'>    <font color='red'>{</font>"blpop",<a href='../S/60.html#L1081' title='Defined at 1081 in src/t_list.c.'>blpopCommand</a>,-3,"ws",0,NULL,1,-2,1,0,0<font color='red'>}</font>,
<a name='L143'>    <font color='red'>{</font>"llen",<a href='../S/60.html#L405' title='Defined at 405 in src/t_list.c.'>llenCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L144'>    <font color='red'>{</font>"lindex",<a href='../S/60.html#L411' title='Defined at 411 in src/t_list.c.'>lindexCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L145'>    <font color='red'>{</font>"lset",<a href='../S/60.html#L450' title='Defined at 450 in src/t_list.c.'>lsetCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L146'>    <font color='red'>{</font>"lrange",<a href='../S/60.html#L515' title='Defined at 515 in src/t_list.c.'>lrangeCommand</a>,4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L147'>    <font color='red'>{</font>"ltrim",<a href='../S/60.html#L574' title='Defined at 574 in src/t_list.c.'>ltrimCommand</a>,4,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L148'>    <font color='red'>{</font>"lrem",<a href='../S/60.html#L627' title='Defined at 627 in src/t_list.c.'>lremCommand</a>,4,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L149'>    <font color='red'>{</font>"rpoplpush",<a href='../S/60.html#L700' title='Defined at 700 in src/t_list.c.'>rpoplpushCommand</a>,3,"wm",0,NULL,1,2,1,0,0<font color='red'>}</font>,
<a name='L150'>    <font color='red'>{</font>"sadd",<a href='../S/92.html#L250' title='Defined at 250 in src/t_set.c.'>saddCommand</a>,-3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L151'>    <font color='red'>{</font>"srem",<a href='../S/92.html#L274' title='Defined at 274 in src/t_set.c.'>sremCommand</a>,-3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L152'>    <font color='red'>{</font>"smove",<a href='../S/92.html#L297' title='Defined at 297 in src/t_set.c.'>smoveCommand</a>,4,"w",0,NULL,1,2,1,0,0<font color='red'>}</font>,
<a name='L153'>    <font color='red'>{</font>"sismember",<a href='../S/92.html#L343' title='Defined at 343 in src/t_set.c.'>sismemberCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L154'>    <font color='red'>{</font>"scard",<a href='../S/92.html#L356' title='Defined at 356 in src/t_set.c.'>scardCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L155'>    <font color='red'>{</font>"spop",<a href='../S/92.html#L365' title='Defined at 365 in src/t_set.c.'>spopCommand</a>,2,"wRs",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L156'>    <font color='red'>{</font>"srandmember",<a href='../S/92.html#L540' title='Defined at 540 in src/t_set.c.'>srandmemberCommand</a>,-2,"rR",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L157'>    <font color='red'>{</font>"sinter",<a href='../S/92.html#L698' title='Defined at 698 in src/t_set.c.'>sinterCommand</a>,-2,"rS",0,NULL,1,-1,1,0,0<font color='red'>}</font>,
<a name='L158'>    <font color='red'>{</font>"sinterstore",<a href='../S/92.html#L702' title='Defined at 702 in src/t_set.c.'>sinterstoreCommand</a>,-3,"wm",0,NULL,1,-1,1,0,0<font color='red'>}</font>,
<a name='L159'>    <font color='red'>{</font>"sunion",<a href='../S/92.html#L788' title='Defined at 788 in src/t_set.c.'>sunionCommand</a>,-2,"rS",0,NULL,1,-1,1,0,0<font color='red'>}</font>,
<a name='L160'>    <font color='red'>{</font>"sunionstore",<a href='../S/92.html#L792' title='Defined at 792 in src/t_set.c.'>sunionstoreCommand</a>,-3,"wm",0,NULL,1,-1,1,0,0<font color='red'>}</font>,
<a name='L161'>    <font color='red'>{</font>"sdiff",<a href='../S/92.html#L796' title='Defined at 796 in src/t_set.c.'>sdiffCommand</a>,-2,"rS",0,NULL,1,-1,1,0,0<font color='red'>}</font>,
<a name='L162'>    <font color='red'>{</font>"sdiffstore",<a href='../S/92.html#L800' title='Defined at 800 in src/t_set.c.'>sdiffstoreCommand</a>,-3,"wm",0,NULL,1,-1,1,0,0<font color='red'>}</font>,
<a name='L163'>    <font color='red'>{</font>"smembers",<a href='../S/92.html#L698' title='Defined at 698 in src/t_set.c.'>sinterCommand</a>,2,"rS",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L164'>    <font color='red'>{</font>"zadd",<a href='../S/59.html#L984' title='Defined at 984 in src/t_zset.c.'>zaddCommand</a>,-4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L165'>    <font color='red'>{</font>"zincrby",<a href='../S/59.html#L988' title='Defined at 988 in src/t_zset.c.'>zincrbyCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L166'>    <font color='red'>{</font>"zrem",<a href='../S/59.html#L992' title='Defined at 992 in src/t_zset.c.'>zremCommand</a>,-3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L167'>    <font color='red'>{</font>"zremrangebyscore",<a href='../S/59.html#L1047' title='Defined at 1047 in src/t_zset.c.'>zremrangebyscoreCommand</a>,4,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L168'>    <font color='red'>{</font>"zremrangebyrank",<a href='../S/59.html#L1079' title='Defined at 1079 in src/t_zset.c.'>zremrangebyrankCommand</a>,4,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L169'>    <font color='red'>{</font>"zunionstore",<a href='../S/59.html#L1684' title='Defined at 1684 in src/t_zset.c.'>zunionstoreCommand</a>,-4,"wm",0,<a href='../S/31.html#L696' title='Defined at 696 in src/db.c.'>zunionInterGetKeys</a>,0,0,0,0,0<font color='red'>}</font>,
<a name='L170'>    <font color='red'>{</font>"zinterstore",<a href='../S/59.html#L1688' title='Defined at 1688 in src/t_zset.c.'>zinterstoreCommand</a>,-4,"wm",0,<a href='../S/31.html#L696' title='Defined at 696 in src/db.c.'>zunionInterGetKeys</a>,0,0,0,0,0<font color='red'>}</font>,
<a name='L171'>    <font color='red'>{</font>"zrange",<a href='../S/59.html#L1794' title='Defined at 1794 in src/t_zset.c.'>zrangeCommand</a>,-4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L172'>    <font color='red'>{</font>"zrangebyscore",<a href='../S/59.html#L1989' title='Defined at 1989 in src/t_zset.c.'>zrangebyscoreCommand</a>,-4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L173'>    <font color='red'>{</font>"zrevrangebyscore",<a href='../S/59.html#L1993' title='Defined at 1993 in src/t_zset.c.'>zrevrangebyscoreCommand</a>,-4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L174'>    <font color='red'>{</font>"zcount",<a href='../S/59.html#L1997' title='Defined at 1997 in src/t_zset.c.'>zcountCommand</a>,4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L175'>    <font color='red'>{</font>"zrevrange",<a href='../S/59.html#L1798' title='Defined at 1798 in src/t_zset.c.'>zrevrangeCommand</a>,-4,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L176'>    <font color='red'>{</font>"zcard",<a href='../S/59.html#L2074' title='Defined at 2074 in src/t_zset.c.'>zcardCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L177'>    <font color='red'>{</font>"zscore",<a href='../S/59.html#L2084' title='Defined at 2084 in src/t_zset.c.'>zscoreCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L178'>    <font color='red'>{</font>"zrank",<a href='../S/59.html#L2175' title='Defined at 2175 in src/t_zset.c.'>zrankCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L179'>    <font color='red'>{</font>"zrevrank",<a href='../S/59.html#L2179' title='Defined at 2179 in src/t_zset.c.'>zrevrankCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L180'>    <font color='red'>{</font>"hset",<a href='../S/97.html#L467' title='Defined at 467 in src/t_hash.c.'>hsetCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L181'>    <font color='red'>{</font>"hsetnx",<a href='../S/97.html#L480' title='Defined at 480 in src/t_hash.c.'>hsetnxCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L182'>    <font color='red'>{</font>"hget",<a href='../S/97.html#L623' title='Defined at 623 in src/t_hash.c.'>hgetCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L183'>    <font color='red'>{</font>"hmset",<a href='../S/97.html#L496' title='Defined at 496 in src/t_hash.c.'>hmsetCommand</a>,-4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L184'>    <font color='red'>{</font>"hmget",<a href='../S/97.html#L632' title='Defined at 632 in src/t_hash.c.'>hmgetCommand</a>,-3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L185'>    <font color='red'>{</font>"hincrby",<a href='../S/97.html#L516' title='Defined at 516 in src/t_hash.c.'>hincrbyCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L186'>    <font color='red'>{</font>"hincrbyfloat",<a href='../S/97.html#L549' title='Defined at 549 in src/t_hash.c.'>hincrbyfloatCommand</a>,4,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L187'>    <font color='red'>{</font>"hdel",<a href='../S/97.html#L650' title='Defined at 650 in src/t_hash.c.'>hdelCommand</a>,-3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L188'>    <font color='red'>{</font>"hlen",<a href='../S/97.html#L673' title='Defined at 673 in src/t_hash.c.'>hlenCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L189'>    <font color='red'>{</font>"hkeys",<a href='../S/97.html#L736' title='Defined at 736 in src/t_hash.c.'>hkeysCommand</a>,2,"rS",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L190'>    <font color='red'>{</font>"hvals",<a href='../S/97.html#L740' title='Defined at 740 in src/t_hash.c.'>hvalsCommand</a>,2,"rS",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L191'>    <font color='red'>{</font>"hgetall",<a href='../S/97.html#L744' title='Defined at 744 in src/t_hash.c.'>hgetallCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L192'>    <font color='red'>{</font>"hexists",<a href='../S/97.html#L748' title='Defined at 748 in src/t_hash.c.'>hexistsCommand</a>,3,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L193'>    <font color='red'>{</font>"incrby",<a href='../S/79.html#L304' title='Defined at 304 in src/t_string.c.'>incrbyCommand</a>,3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L194'>    <font color='red'>{</font>"decrby",<a href='../S/79.html#L311' title='Defined at 311 in src/t_string.c.'>decrbyCommand</a>,3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L195'>    <font color='red'>{</font>"incrbyfloat",<a href='../S/79.html#L318' title='Defined at 318 in src/t_string.c.'>incrbyfloatCommand</a>,3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L196'>    <font color='red'>{</font>"getset",<a href='../S/79.html#L107' title='Defined at 107 in src/t_string.c.'>getsetCommand</a>,3,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L197'>    <font color='red'>{</font>"mset",<a href='../S/79.html#L261' title='Defined at 261 in src/t_string.c.'>msetCommand</a>,-3,"wm",0,NULL,1,-1,2,0,0<font color='red'>}</font>,
<a name='L198'>    <font color='red'>{</font>"msetnx",<a href='../S/79.html#L265' title='Defined at 265 in src/t_string.c.'>msetnxCommand</a>,-3,"wm",0,NULL,1,-1,2,0,0<font color='red'>}</font>,
<a name='L199'>    <font color='red'>{</font>"randomkey",<a href='../S/31.html#L271' title='Defined at 271 in src/db.c.'>randomkeyCommand</a>,1,"rR",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L200'>    <font color='red'>{</font>"select",<a href='../S/31.html#L257' title='Defined at 257 in src/db.c.'>selectCommand</a>,2,"r",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L201'>    <font color='red'>{</font>"move",<a href='../S/31.html#L399' title='Defined at 399 in src/db.c.'>moveCommand</a>,3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L202'>    <font color='red'>{</font>"rename",<a href='../S/31.html#L391' title='Defined at 391 in src/db.c.'>renameCommand</a>,3,"w",0,<a href='../S/31.html#L685' title='Defined at 685 in src/db.c.'>renameGetKeys</a>,1,2,1,0,0<font color='red'>}</font>,
<a name='L203'>    <font color='red'>{</font>"renamenx",<a href='../S/31.html#L395' title='Defined at 395 in src/db.c.'>renamenxCommand</a>,3,"w",0,<a href='../S/31.html#L685' title='Defined at 685 in src/db.c.'>renameGetKeys</a>,1,2,1,0,0<font color='red'>}</font>,
<a name='L204'>    <font color='red'>{</font>"expire",<a href='../S/31.html#L586' title='Defined at 586 in src/db.c.'>expireCommand</a>,3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L205'>    <font color='red'>{</font>"expireat",<a href='../S/31.html#L590' title='Defined at 590 in src/db.c.'>expireatCommand</a>,3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L206'>    <font color='red'>{</font>"pexpire",<a href='../S/31.html#L594' title='Defined at 594 in src/db.c.'>pexpireCommand</a>,3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L207'>    <font color='red'>{</font>"pexpireat",<a href='../S/31.html#L598' title='Defined at 598 in src/db.c.'>pexpireatCommand</a>,3,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L208'>    <font color='red'>{</font>"keys",<a href='../S/31.html#L283' title='Defined at 283 in src/db.c.'>keysCommand</a>,2,"rS",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L209'>    <font color='red'>{</font>"dbsize",<a href='../S/31.html#L310' title='Defined at 310 in src/db.c.'>dbsizeCommand</a>,1,"r",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L210'>    <font color='red'>{</font>"auth",<a href='../S/35.html#L1783' title='Defined at 1783 in src/redis.c.'>authCommand</a>,2,"rs",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L211'>    <font color='red'>{</font>"ping",<a href='../S/35.html#L1795' title='Defined at 1795 in src/redis.c.'>pingCommand</a>,1,"r",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L212'>    <font color='red'>{</font>"echo",<a href='../S/35.html#L1799' title='Defined at 1799 in src/redis.c.'>echoCommand</a>,2,"r",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L213'>    <font color='red'>{</font>"save",<a href='../S/87.html#L1207' title='Defined at 1207 in src/rdb.c.'>saveCommand</a>,1,"ars",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L214'>    <font color='red'>{</font>"bgsave",<a href='../S/87.html#L1219' title='Defined at 1219 in src/rdb.c.'>bgsaveCommand</a>,1,"ar",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L215'>    <font color='red'>{</font>"bgrewriteaof",<a href='../S/62.html#L1001' title='Defined at 1001 in src/aof.c.'>bgrewriteaofCommand</a>,1,"ar",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L216'>    <font color='red'>{</font>"shutdown",<a href='../S/31.html#L338' title='Defined at 338 in src/db.c.'>shutdownCommand</a>,-1,"ar",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L217'>    <font color='red'>{</font>"lastsave",<a href='../S/31.html#L314' title='Defined at 314 in src/db.c.'>lastsaveCommand</a>,1,"r",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L218'>    <font color='red'>{</font>"type",<a href='../S/31.html#L318' title='Defined at 318 in src/db.c.'>typeCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L219'>    <font color='red'>{</font>"multi",<a href='../S/81.html#L86' title='Defined at 86 in src/multi.c.'>multiCommand</a>,1,"rs",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L220'>    <font color='red'>{</font>"exec",<a href='../S/81.html#L116' title='Defined at 116 in src/multi.c.'>execCommand</a>,1,"sM",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L221'>    <font color='red'>{</font>"discard",<a href='../S/81.html#L95' title='Defined at 95 in src/multi.c.'>discardCommand</a>,1,"rs",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L222'>    <font color='red'>{</font>"sync",<a href='../S/14.html#L117' title='Defined at 117 in src/replication.c.'>syncCommand</a>,1,"ars",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L223'>    <font color='red'>{</font>"replconf",<a href='../S/14.html#L194' title='Defined at 194 in src/replication.c.'>replconfCommand</a>,-1,"ars",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L224'>    <font color='red'>{</font>"flushdb",<a href='../S/31.html#L209' title='Defined at 209 in src/db.c.'>flushdbCommand</a>,1,"w",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L225'>    <font color='red'>{</font>"flushall",<a href='../S/31.html#L217' title='Defined at 217 in src/db.c.'>flushallCommand</a>,1,"w",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L226'>    <font color='red'>{</font>"sort",<a href='../S/57.html#L179' title='Defined at 179 in src/sort.c.'>sortCommand</a>,-2,"wm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L227'>    <font color='red'>{</font>"info",<a href='../S/35.html#L2187' title='Defined at 2187 in src/redis.c.'>infoCommand</a>,-1,"rlt",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L228'>    <font color='red'>{</font>"monitor",<a href='../S/35.html#L2201' title='Defined at 2201 in src/redis.c.'>monitorCommand</a>,1,"ars",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L229'>    <font color='red'>{</font>"ttl",<a href='../S/31.html#L617' title='Defined at 617 in src/db.c.'>ttlCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L230'>    <font color='red'>{</font>"pttl",<a href='../S/31.html#L621' title='Defined at 621 in src/db.c.'>pttlCommand</a>,2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L231'>    <font color='red'>{</font>"persist",<a href='../S/31.html#L625' title='Defined at 625 in src/db.c.'>persistCommand</a>,2,"w",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L232'>    <font color='red'>{</font>"slaveof",<a href='../S/14.html#L696' title='Defined at 696 in src/replication.c.'>slaveofCommand</a>,3,"ast",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L233'>    <font color='red'>{</font>"debug",<a href='../S/69.html#L247' title='Defined at 247 in src/debug.c.'>debugCommand</a>,-2,"as",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L234'>    <font color='red'>{</font>"config",<a href='../S/96.html#L925' title='Defined at 925 in src/config.c.'>configCommand</a>,-2,"ar",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L235'>    <font color='red'>{</font>"subscribe",<a href='../S/46.html#L255' title='Defined at 255 in src/pubsub.c.'>subscribeCommand</a>,-2,"rpslt",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L236'>    <font color='red'>{</font>"unsubscribe",<a href='../S/46.html#L262' title='Defined at 262 in src/pubsub.c.'>unsubscribeCommand</a>,-1,"rpslt",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L237'>    <font color='red'>{</font>"psubscribe",<a href='../S/46.html#L274' title='Defined at 274 in src/pubsub.c.'>psubscribeCommand</a>,-2,"rpslt",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L238'>    <font color='red'>{</font>"punsubscribe",<a href='../S/46.html#L281' title='Defined at 281 in src/pubsub.c.'>punsubscribeCommand</a>,-1,"rpslt",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L239'>    <font color='red'>{</font>"publish",<a href='../S/46.html#L293' title='Defined at 293 in src/pubsub.c.'>publishCommand</a>,3,"pflt",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L240'>    <font color='red'>{</font>"watch",<a href='../S/81.html#L310' title='Defined at 310 in src/multi.c.'>watchCommand</a>,-2,"rs",0,<a href='../S/31.html#L676' title='Defined at 676 in src/db.c.'>noPreloadGetKeys</a>,1,-1,1,0,0<font color='red'>}</font>,
<a name='L241'>    <font color='red'>{</font>"unwatch",<a href='../S/81.html#L322' title='Defined at 322 in src/multi.c.'>unwatchCommand</a>,1,"rs",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L242'>    <font color='red'>{</font>"restore",<a href='../S/18.html#L86' title='Defined at 86 in src/migrate.c.'>restoreCommand</a>,4,"awm",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L243'>    <font color='red'>{</font>"migrate",<a href='../S/18.html#L129' title='Defined at 129 in src/migrate.c.'>migrateCommand</a>,6,"aw",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L244'>    <font color='red'>{</font>"dump",<a href='../S/18.html#L65' title='Defined at 65 in src/migrate.c.'>dumpCommand</a>,2,"ar",0,NULL,1,1,1,0,0<font color='red'>}</font>,
<a name='L245'>    <font color='red'>{</font>"object",<a href='../S/71.html#L556' title='Defined at 556 in src/object.c.'>objectCommand</a>,-2,"r",0,NULL,2,2,2,0,0<font color='red'>}</font>,
<a name='L246'>    <font color='red'>{</font>"client",<a href='../S/86.html#L1162' title='Defined at 1162 in src/networking.c.'>clientCommand</a>,-2,"ar",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L247'>    <font color='red'>{</font>"eval",<a href='../S/75.html#L916' title='Defined at 916 in src/scripting.c.'>evalCommand</a>,-3,"s",0,<a href='../S/31.html#L696' title='Defined at 696 in src/db.c.'>zunionInterGetKeys</a>,0,0,0,0,0<font color='red'>}</font>,
<a name='L248'>    <font color='red'>{</font>"evalsha",<a href='../S/75.html#L920' title='Defined at 920 in src/scripting.c.'>evalShaCommand</a>,-3,"s",0,<a href='../S/31.html#L696' title='Defined at 696 in src/db.c.'>zunionInterGetKeys</a>,0,0,0,0,0<font color='red'>}</font>,
<a name='L249'>    <font color='red'>{</font>"slowlog",<a href='../S/70.html#L130' title='Defined at 130 in src/slowlog.c.'>slowlogCommand</a>,-2,"r",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L250'>    <font color='red'>{</font>"script",<a href='../S/75.html#L975' title='Defined at 975 in src/scripting.c.'>scriptCommand</a>,-2,"ras",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L251'>    <font color='red'>{</font>"time",<a href='../S/35.html#L1803' title='Defined at 1803 in src/redis.c.'>timeCommand</a>,1,"rR",0,NULL,0,0,0,0,0<font color='red'>}</font>,
<a name='L252'>    <font color='red'>{</font>"bitop",<a href='../S/17.html#L188' title='Defined at 188 in src/bitops.c.'>bitopCommand</a>,-4,"wm",0,NULL,2,-1,1,0,0<font color='red'>}</font>,
<a name='L253'>    <font color='red'>{</font>"bitcount",<a href='../S/17.html#L358' title='Defined at 358 in src/bitops.c.'>bitcountCommand</a>,-2,"r",0,NULL,1,1,1,0,0<font color='red'>}</font>
<a name='L254'><font color='red'>}</font>;
<a name='L255'>
<a name='L256'><i><font color='green'>/*============================ Utility functions ============================ */</font></i>
<a name='L257'>
<a name='L258'><i><font color='green'>/* Low level logging. To use only for very big messages, otherwise</font></i>
<a name='L259'><i><font color='green'> * redisLog() is to prefer. */</font></i>
<a name='L260'><b>void</b> <a href='../R/3470.html' title='Multiple refered from 8 places.'>redisLogRaw</a>(<b>int</b> level, <b>const</b> <b>char</b> *msg) <font color='red'>{</font>
<a name='L261'>    <b>const</b> <b>int</b> syslogLevelMap[] = <font color='red'>{</font> LOG_DEBUG, LOG_INFO, LOG_NOTICE, LOG_WARNING <font color='red'>}</font>;
<a name='L262'>    <b>const</b> <b>char</b> *c = ".-*#";
<a name='L263'>    FILE *fp;
<a name='L264'>    <b>char</b> buf[64];
<a name='L265'>    <b>int</b> rawmode = (level &amp; <a href='../S/32.html#L233' title='Defined at 233 in src/redis.h.'>REDIS_LOG_RAW</a>);
<a name='L266'>
<a name='L267'>    level &amp;= 0xff; <i><font color='green'>/* clear flags */</font></i>
<a name='L268'>    <b>if</b> (level &lt; server.verbosity) <b>return</b>;
<a name='L269'>
<a name='L270'>    fp = (server.logfile == NULL) ? stdout : fopen(server.logfile,"a");
<a name='L271'>    <b>if</b> (!fp) <b>return</b>;
<a name='L272'>
<a name='L273'>    <b>if</b> (rawmode) <font color='red'>{</font>
<a name='L274'>        fprintf(fp,"%s",msg);
<a name='L275'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L276'>        <b>int</b> off;
<a name='L277'>        <b>struct</b> timeval tv;
<a name='L278'>
<a name='L279'>        gettimeofday(&amp;tv,NULL);
<a name='L280'>        off = strftime(buf,<b>sizeof</b>(buf),"%d %b %H:%M:%S.",localtime(&amp;tv.tv_sec));
<a name='L281'>        snprintf(buf+off,<b>sizeof</b>(buf)-off,"%03d",(<b>int</b>)tv.tv_usec/1000);
<a name='L282'>        fprintf(fp,"[%d] %s %c %s\n",(<b>int</b>)getpid(),buf,c[level],msg);
<a name='L283'>    <font color='red'>}</font>
<a name='L284'>    fflush(fp);
<a name='L285'>
<a name='L286'>    <b>if</b> (server.logfile) fclose(fp);
<a name='L287'>
<a name='L288'>    <b>if</b> (server.syslog_enabled) syslog(syslogLevelMap[level], "%s", msg);
<a name='L289'><font color='red'>}</font>
<a name='L290'>
<a name='L291'><i><font color='green'>/* Like redisLogRaw() but with printf-alike support. This is the funciton that</font></i>
<a name='L292'><i><font color='green'> * is used across the code. The raw version is only used in order to dump</font></i>
<a name='L293'><i><font color='green'> * the INFO output on crash. */</font></i>
<a name='L294'><b>void</b> <a href='../R/3466.html' title='Multiple refered from 191 places.'>redisLog</a>(<b>int</b> level, <b>const</b> <b>char</b> *fmt, ...) <font color='red'>{</font>
<a name='L295'>    va_list ap;
<a name='L296'>    <b>char</b> msg[<a href='../S/32.html#L81' title='Defined at 81 in src/redis.h.'>REDIS_MAX_LOGMSG_LEN</a>];
<a name='L297'>
<a name='L298'>    <b>if</b> ((level&amp;0xff) &lt; server.verbosity) <b>return</b>;
<a name='L299'>
<a name='L300'>    va_start(ap, fmt);
<a name='L301'>    vsnprintf(msg, <b>sizeof</b>(msg), fmt, ap);
<a name='L302'>    va_end(ap);
<a name='L303'>
<a name='L304'>    <a href='../S/35.html#L260' title='Defined at 260 in src/redis.c.'>redisLogRaw</a>(level,msg);
<a name='L305'><font color='red'>}</font>
<a name='L306'>
<a name='L307'><i><font color='green'>/* Log a fixed message without printf-alike capabilities, in a way that is</font></i>
<a name='L308'><i><font color='green'> * safe to call from a signal handler.</font></i>
<a name='L309'><i><font color='green'> *</font></i>
<a name='L310'><i><font color='green'> * We actually use this only for signals that are not fatal from the point</font></i>
<a name='L311'><i><font color='green'> * of view of Redis. Signals that are going to kill the server anyway and</font></i>
<a name='L312'><i><font color='green'> * where we need printf-alike features are served by redisLog(). */</font></i>
<a name='L313'><b>void</b> <a href='../R/3467.html' title='Multiple refered from 5 places.'>redisLogFromHandler</a>(<b>int</b> level, <b>const</b> <b>char</b> *msg) <font color='red'>{</font>
<a name='L314'>    <b>int</b> fd;
<a name='L315'>    <b>char</b> buf[64];
<a name='L316'>
<a name='L317'>    <b>if</b> ((level&amp;0xff) &lt; server.verbosity ||
<a name='L318'>        (server.logfile == NULL &amp;&amp; server.<a href='../S/35.html#L2402' title='Defined at 2402 in src/redis.c.'>daemonize</a>)) <b>return</b>;
<a name='L319'>    fd = server.logfile ?
<a name='L320'>        open(server.logfile, O_APPEND|O_CREAT|O_WRONLY, 0644) :
<a name='L321'>        STDOUT_FILENO;
<a name='L322'>    <b>if</b> (fd == -1) <b>return</b>;
<a name='L323'>    <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>(buf,<b>sizeof</b>(buf),getpid());
<a name='L324'>    <b>if</b> (write(fd,"[",1) == -1) <b>goto</b> err;
<a name='L325'>    <b>if</b> (write(fd,buf,strlen(buf)) == -1) <b>goto</b> err;
<a name='L326'>    <b>if</b> (write(fd," | signal handler] (",20) == -1) <b>goto</b> err;
<a name='L327'>    <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>(buf,<b>sizeof</b>(buf),time(NULL));
<a name='L328'>    <b>if</b> (write(fd,buf,strlen(buf)) == -1) <b>goto</b> err;
<a name='L329'>    <b>if</b> (write(fd,") ",2) == -1) <b>goto</b> err;
<a name='L330'>    <b>if</b> (write(fd,msg,strlen(msg)) == -1) <b>goto</b> err;
<a name='L331'>    <b>if</b> (write(fd,"\n",1) == -1) <b>goto</b> err;
<a name='L332'>err:
<a name='L333'>    <b>if</b> (server.logfile) close(fd);
<a name='L334'><font color='red'>}</font>
<a name='L335'>
<a name='L336'><i><font color='green'>/* Return the UNIX time in microseconds */</font></i>
<a name='L337'><b>long</b> <b>long</b> <a href='../R/4072.html' title='Multiple refered from 19 places.'>ustime</a>(<b>void</b>) <font color='red'>{</font>
<a name='L338'>    <b>struct</b> timeval tv;
<a name='L339'>    <b>long</b> <b>long</b> ust;
<a name='L340'>
<a name='L341'>    gettimeofday(&amp;tv, NULL);
<a name='L342'>    ust = ((<b>long</b> <b>long</b>)tv.tv_sec)*1000000;
<a name='L343'>    ust += tv.tv_usec;
<a name='L344'>    <b>return</b> ust;
<a name='L345'><font color='red'>}</font>
<a name='L346'>
<a name='L347'><i><font color='green'>/* Return the UNIX time in milliseconds */</font></i>
<a name='L348'><b>long</b> <b>long</b> <a href='../R/3054.html' title='Multiple refered from 95 places.'>mstime</a>(<b>void</b>) <font color='red'>{</font>
<a name='L349'>    <b>return</b> <a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>()/1000;
<a name='L350'><font color='red'>}</font>
<a name='L351'>
<a name='L352'><i><font color='green'>/* After an RDB dump or AOF rewrite we exit from children using _exit() instead of</font></i>
<a name='L353'><i><font color='green'> * exit(), because the latter may interact with the same file objects used by</font></i>
<a name='L354'><i><font color='green'> * the parent process. However if we are testing the coverage normal exit() is</font></i>
<a name='L355'><i><font color='green'> * used in order to obtain the right coverage information. */</font></i>
<a name='L356'><b>void</b> <a href='../R/1906.html' title='Multiple refered from 4 places.'>exitFromChild</a>(<b>int</b> retcode) <font color='red'>{</font>
<a name='L357'><font color='darkred'>#ifdef</font> COVERAGE_TEST
<a name='L358'>    exit(retcode);
<a name='L359'><font color='darkred'>#else</font>
<a name='L360'>    _exit(retcode);
<a name='L361'><font color='darkred'>#endif</font>
<a name='L362'><font color='red'>}</font>
<a name='L363'>
<a name='L364'><i><font color='green'>/*====================== Hash table type implementation  ==================== */</font></i>
<a name='L365'>
<a name='L366'><i><font color='green'>/* This is an hash table type that uses the SDS dynamic strings libary as</font></i>
<a name='L367'><i><font color='green'> * keys and radis objects as values (objects can hold SDS strings,</font></i>
<a name='L368'><i><font color='green'> * lists, sets). */</font></i>
<a name='L369'>
<a name='L370'><b>void</b> dictVanillaFree(<b>void</b> *privdata, <b>void</b> *val)
<a name='L371'><font color='red'>{</font>
<a name='L372'>    <a href='../D/123.html' title='Multiple defined in 2 places.'>DICT_NOTUSED</a>(privdata);
<a name='L373'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(val);
<a name='L374'><font color='red'>}</font>
<a name='L375'>
<a name='L376'><b>void</b> <a href='../S/35.html#L559' title='Refered from 559 in src/redis.c.'>dictListDestructor</a>(<b>void</b> *privdata, <b>void</b> *val)
<a name='L377'><font color='red'>{</font>
<a name='L378'>    <a href='../D/123.html' title='Multiple defined in 2 places.'>DICT_NOTUSED</a>(privdata);
<a name='L379'>    <a href='../S/54.html#L58' title='Defined at 58 in src/adlist.c.'>listRelease</a>((<a href='../D/2690.html' title='Multiple defined in 2 places.'>list</a>*)val);
<a name='L380'><font color='red'>}</font>
<a name='L381'>
<a name='L382'><b>int</b> <a href='../R/1839.html' title='Multiple refered from 7 places.'>dictSdsKeyCompare</a>(<b>void</b> *privdata, <b>const</b> <b>void</b> *key1,
<a name='L383'>        <b>const</b> <b>void</b> *key2)
<a name='L384'><font color='red'>{</font>
<a name='L385'>    <b>int</b> l1,l2;
<a name='L386'>    <a href='../D/123.html' title='Multiple defined in 2 places.'>DICT_NOTUSED</a>(privdata);
<a name='L387'>
<a name='L388'>    l1 = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>((<a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a>)key1);
<a name='L389'>    l2 = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>((<a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a>)key2);
<a name='L390'>    <b>if</b> (l1 != l2) <b>return</b> 0;
<a name='L391'>    <b>return</b> memcmp(key1, key2, l1) == 0;
<a name='L392'><font color='red'>}</font>
<a name='L393'>
<a name='L394'><i><font color='green'>/* A case insensitive version used for the command lookup table and other</font></i>
<a name='L395'><i><font color='green'> * places where case insensitive non binary-safe comparison is needed. */</font></i>
<a name='L396'><b>int</b> <a href='../R/1838.html' title='Multiple refered from 2 places.'>dictSdsKeyCaseCompare</a>(<b>void</b> *privdata, <b>const</b> <b>void</b> *key1,
<a name='L397'>        <b>const</b> <b>void</b> *key2)
<a name='L398'><font color='red'>{</font>
<a name='L399'>    <a href='../D/123.html' title='Multiple defined in 2 places.'>DICT_NOTUSED</a>(privdata);
<a name='L400'>
<a name='L401'>    <b>return</b> strcasecmp(key1, key2) == 0;
<a name='L402'><font color='red'>}</font>
<a name='L403'>
<a name='L404'><b>void</b> <a href='../R/1827.html' title='Multiple refered from 7 places.'>dictRedisObjectDestructor</a>(<b>void</b> *privdata, <b>void</b> *val)
<a name='L405'><font color='red'>{</font>
<a name='L406'>    <a href='../D/123.html' title='Multiple defined in 2 places.'>DICT_NOTUSED</a>(privdata);
<a name='L407'>
<a name='L408'>    <b>if</b> (val == NULL) <b>return</b>; <i><font color='green'>/* Values of swapped out keys as set to NULL */</font></i>
<a name='L409'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(val);
<a name='L410'><font color='red'>}</font>
<a name='L411'>
<a name='L412'><b>void</b> <a href='../R/1836.html' title='Multiple refered from 3 places.'>dictSdsDestructor</a>(<b>void</b> *privdata, <b>void</b> *val)
<a name='L413'><font color='red'>{</font>
<a name='L414'>    <a href='../D/123.html' title='Multiple defined in 2 places.'>DICT_NOTUSED</a>(privdata);
<a name='L415'>
<a name='L416'>    <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(val);
<a name='L417'><font color='red'>}</font>
<a name='L418'>
<a name='L419'><b>int</b> <a href='../S/35.html#L557' title='Refered from 557 in src/redis.c.'>dictObjKeyCompare</a>(<b>void</b> *privdata, <b>const</b> <b>void</b> *key1,
<a name='L420'>        <b>const</b> <b>void</b> *key2)
<a name='L421'><font color='red'>{</font>
<a name='L422'>    <b>const</b> <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o1 = key1, *o2 = key2;
<a name='L423'>    <b>return</b> <a href='../S/35.html#L382' title='Defined at 382 in src/redis.c.'>dictSdsKeyCompare</a>(privdata,o1-&gt;ptr,o2-&gt;ptr);
<a name='L424'><font color='red'>}</font>
<a name='L425'>
<a name='L426'><b>unsigned</b> <b>int</b> <a href='../S/35.html#L554' title='Refered from 554 in src/redis.c.'>dictObjHash</a>(<b>const</b> <b>void</b> *key) <font color='red'>{</font>
<a name='L427'>    <b>const</b> <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o = key;
<a name='L428'>    <b>return</b> <a href='../D/2082.html' title='Multiple defined in 2 places.'>dictGenHashFunction</a>(o-&gt;ptr, <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>((<a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a>)o-&gt;ptr));
<a name='L429'><font color='red'>}</font>
<a name='L430'>
<a name='L431'><b>unsigned</b> <b>int</b> <a href='../R/1837.html' title='Multiple refered from 5 places.'>dictSdsHash</a>(<b>const</b> <b>void</b> *key) <font color='red'>{</font>
<a name='L432'>    <b>return</b> <a href='../D/2082.html' title='Multiple defined in 2 places.'>dictGenHashFunction</a>((<b>unsigned</b> <b>char</b>*)key, <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>((<b>char</b>*)key));
<a name='L433'><font color='red'>}</font>
<a name='L434'>
<a name='L435'><b>unsigned</b> <b>int</b> <a href='../R/1835.html' title='Multiple refered from 2 places.'>dictSdsCaseHash</a>(<b>const</b> <b>void</b> *key) <font color='red'>{</font>
<a name='L436'>    <b>return</b> <a href='../S/29.html#L153' title='Defined at 153 in src/dict.c.'>dictGenCaseHashFunction</a>((<b>unsigned</b> <b>char</b>*)key, <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>((<b>char</b>*)key));
<a name='L437'><font color='red'>}</font>
<a name='L438'>
<a name='L439'><b>int</b> <a href='../R/1797.html' title='Multiple refered from 3 places.'>dictEncObjKeyCompare</a>(<b>void</b> *privdata, <b>const</b> <b>void</b> *key1,
<a name='L440'>        <b>const</b> <b>void</b> *key2)
<a name='L441'><font color='red'>{</font>
<a name='L442'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o1 = (<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*) key1, *o2 = (<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*) key2;
<a name='L443'>    <b>int</b> cmp;
<a name='L444'>
<a name='L445'>    <b>if</b> (o1-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a> &amp;&amp;
<a name='L446'>        o2-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>)
<a name='L447'>            <b>return</b> o1-&gt;ptr == o2-&gt;ptr;
<a name='L448'>
<a name='L449'>    o1 = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(o1);
<a name='L450'>    o2 = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(o2);
<a name='L451'>    cmp = <a href='../S/35.html#L382' title='Defined at 382 in src/redis.c.'>dictSdsKeyCompare</a>(privdata,o1-&gt;ptr,o2-&gt;ptr);
<a name='L452'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(o1);
<a name='L453'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(o2);
<a name='L454'>    <b>return</b> cmp;
<a name='L455'><font color='red'>}</font>
<a name='L456'>
<a name='L457'><b>unsigned</b> <b>int</b> <a href='../R/1796.html' title='Multiple refered from 3 places.'>dictEncObjHash</a>(<b>const</b> <b>void</b> *key) <font color='red'>{</font>
<a name='L458'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o = (<a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a>*) key;
<a name='L459'>
<a name='L460'>    <b>if</b> (o-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>) <font color='red'>{</font>
<a name='L461'>        <b>return</b> <a href='../D/2082.html' title='Multiple defined in 2 places.'>dictGenHashFunction</a>(o-&gt;ptr, <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>((<a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a>)o-&gt;ptr));
<a name='L462'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L463'>        <b>if</b> (o-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>) <font color='red'>{</font>
<a name='L464'>            <b>char</b> buf[32];
<a name='L465'>            <b>int</b> len;
<a name='L466'>
<a name='L467'>            len = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>(buf,32,(<b>long</b>)o-&gt;ptr);
<a name='L468'>            <b>return</b> <a href='../D/2082.html' title='Multiple defined in 2 places.'>dictGenHashFunction</a>((<b>unsigned</b> <b>char</b>*)buf, len);
<a name='L469'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L470'>            <b>unsigned</b> <b>int</b> <a href='../D/2394.html' title='Multiple defined in 2 places.'>hash</a>;
<a name='L471'>
<a name='L472'>            o = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(o);
<a name='L473'>            <a href='../D/2394.html' title='Multiple defined in 2 places.'>hash</a> = <a href='../D/2082.html' title='Multiple defined in 2 places.'>dictGenHashFunction</a>(o-&gt;ptr, <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>((<a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a>)o-&gt;ptr));
<a name='L474'>            <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(o);
<a name='L475'>            <b>return</b> <a href='../D/2394.html' title='Multiple defined in 2 places.'>hash</a>;
<a name='L476'>        <font color='red'>}</font>
<a name='L477'>    <font color='red'>}</font>
<a name='L478'><font color='red'>}</font>
<a name='L479'>
<a name='L480'><i><font color='green'>/* Sets type hash table */</font></i>
<a name='L481'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> setDictType = <font color='red'>{</font>
<a name='L482'>    <a href='../S/35.html#L457' title='Defined at 457 in src/redis.c.'>dictEncObjHash</a>,            <i><font color='green'>/* hash function */</font></i>
<a name='L483'>    NULL,                      <i><font color='green'>/* key dup */</font></i>
<a name='L484'>    NULL,                      <i><font color='green'>/* val dup */</font></i>
<a name='L485'>    <a href='../S/35.html#L439' title='Defined at 439 in src/redis.c.'>dictEncObjKeyCompare</a>,      <i><font color='green'>/* key compare */</font></i>
<a name='L486'>    <a href='../S/35.html#L404' title='Defined at 404 in src/redis.c.'>dictRedisObjectDestructor</a>, <i><font color='green'>/* key destructor */</font></i>
<a name='L487'>    NULL                       <i><font color='green'>/* val destructor */</font></i>
<a name='L488'><font color='red'>}</font>;
<a name='L489'>
<a name='L490'><i><font color='green'>/* Sorted sets hash (note: a skiplist is used in addition to the hash table) */</font></i>
<a name='L491'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> zsetDictType = <font color='red'>{</font>
<a name='L492'>    <a href='../S/35.html#L457' title='Defined at 457 in src/redis.c.'>dictEncObjHash</a>,            <i><font color='green'>/* hash function */</font></i>
<a name='L493'>    NULL,                      <i><font color='green'>/* key dup */</font></i>
<a name='L494'>    NULL,                      <i><font color='green'>/* val dup */</font></i>
<a name='L495'>    <a href='../S/35.html#L439' title='Defined at 439 in src/redis.c.'>dictEncObjKeyCompare</a>,      <i><font color='green'>/* key compare */</font></i>
<a name='L496'>    <a href='../S/35.html#L404' title='Defined at 404 in src/redis.c.'>dictRedisObjectDestructor</a>, <i><font color='green'>/* key destructor */</font></i>
<a name='L497'>    NULL                       <i><font color='green'>/* val destructor */</font></i>
<a name='L498'><font color='red'>}</font>;
<a name='L499'>
<a name='L500'><i><font color='green'>/* Db-&gt;dict, keys are sds strings, vals are Redis objects. */</font></i>
<a name='L501'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> dbDictType = <font color='red'>{</font>
<a name='L502'>    <a href='../S/35.html#L431' title='Defined at 431 in src/redis.c.'>dictSdsHash</a>,                <i><font color='green'>/* hash function */</font></i>
<a name='L503'>    NULL,                       <i><font color='green'>/* key dup */</font></i>
<a name='L504'>    NULL,                       <i><font color='green'>/* val dup */</font></i>
<a name='L505'>    <a href='../S/35.html#L382' title='Defined at 382 in src/redis.c.'>dictSdsKeyCompare</a>,          <i><font color='green'>/* key compare */</font></i>
<a name='L506'>    <a href='../S/35.html#L412' title='Defined at 412 in src/redis.c.'>dictSdsDestructor</a>,          <i><font color='green'>/* key destructor */</font></i>
<a name='L507'>    <a href='../S/35.html#L404' title='Defined at 404 in src/redis.c.'>dictRedisObjectDestructor</a>   <i><font color='green'>/* val destructor */</font></i>
<a name='L508'><font color='red'>}</font>;
<a name='L509'>
<a name='L510'><i><font color='green'>/* server.lua_scripts sha (as sds string) -&gt; scripts (as robj) cache. */</font></i>
<a name='L511'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> shaScriptObjectDictType = <font color='red'>{</font>
<a name='L512'>    <a href='../S/35.html#L435' title='Defined at 435 in src/redis.c.'>dictSdsCaseHash</a>,            <i><font color='green'>/* hash function */</font></i>
<a name='L513'>    NULL,                       <i><font color='green'>/* key dup */</font></i>
<a name='L514'>    NULL,                       <i><font color='green'>/* val dup */</font></i>
<a name='L515'>    <a href='../S/35.html#L396' title='Defined at 396 in src/redis.c.'>dictSdsKeyCaseCompare</a>,      <i><font color='green'>/* key compare */</font></i>
<a name='L516'>    <a href='../S/35.html#L412' title='Defined at 412 in src/redis.c.'>dictSdsDestructor</a>,          <i><font color='green'>/* key destructor */</font></i>
<a name='L517'>    <a href='../S/35.html#L404' title='Defined at 404 in src/redis.c.'>dictRedisObjectDestructor</a>   <i><font color='green'>/* val destructor */</font></i>
<a name='L518'><font color='red'>}</font>;
<a name='L519'>
<a name='L520'><i><font color='green'>/* Db-&gt;expires */</font></i>
<a name='L521'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> keyptrDictType = <font color='red'>{</font>
<a name='L522'>    <a href='../S/35.html#L431' title='Defined at 431 in src/redis.c.'>dictSdsHash</a>,               <i><font color='green'>/* hash function */</font></i>
<a name='L523'>    NULL,                      <i><font color='green'>/* key dup */</font></i>
<a name='L524'>    NULL,                      <i><font color='green'>/* val dup */</font></i>
<a name='L525'>    <a href='../S/35.html#L382' title='Defined at 382 in src/redis.c.'>dictSdsKeyCompare</a>,         <i><font color='green'>/* key compare */</font></i>
<a name='L526'>    NULL,                      <i><font color='green'>/* key destructor */</font></i>
<a name='L527'>    NULL                       <i><font color='green'>/* val destructor */</font></i>
<a name='L528'><font color='red'>}</font>;
<a name='L529'>
<a name='L530'><i><font color='green'>/* Command table. sds string -&gt; command struct pointer. */</font></i>
<a name='L531'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> commandTableDictType = <font color='red'>{</font>
<a name='L532'>    <a href='../S/35.html#L435' title='Defined at 435 in src/redis.c.'>dictSdsCaseHash</a>,           <i><font color='green'>/* hash function */</font></i>
<a name='L533'>    NULL,                      <i><font color='green'>/* key dup */</font></i>
<a name='L534'>    NULL,                      <i><font color='green'>/* val dup */</font></i>
<a name='L535'>    <a href='../S/35.html#L396' title='Defined at 396 in src/redis.c.'>dictSdsKeyCaseCompare</a>,     <i><font color='green'>/* key compare */</font></i>
<a name='L536'>    <a href='../S/35.html#L412' title='Defined at 412 in src/redis.c.'>dictSdsDestructor</a>,         <i><font color='green'>/* key destructor */</font></i>
<a name='L537'>    NULL                       <i><font color='green'>/* val destructor */</font></i>
<a name='L538'><font color='red'>}</font>;
<a name='L539'>
<a name='L540'><i><font color='green'>/* Hash type hash table (note that small hashes are represented with zimpaps) */</font></i>
<a name='L541'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> hashDictType = <font color='red'>{</font>
<a name='L542'>    <a href='../S/35.html#L457' title='Defined at 457 in src/redis.c.'>dictEncObjHash</a>,             <i><font color='green'>/* hash function */</font></i>
<a name='L543'>    NULL,                       <i><font color='green'>/* key dup */</font></i>
<a name='L544'>    NULL,                       <i><font color='green'>/* val dup */</font></i>
<a name='L545'>    <a href='../S/35.html#L439' title='Defined at 439 in src/redis.c.'>dictEncObjKeyCompare</a>,       <i><font color='green'>/* key compare */</font></i>
<a name='L546'>    <a href='../S/35.html#L404' title='Defined at 404 in src/redis.c.'>dictRedisObjectDestructor</a>,  <i><font color='green'>/* key destructor */</font></i>
<a name='L547'>    <a href='../S/35.html#L404' title='Defined at 404 in src/redis.c.'>dictRedisObjectDestructor</a>   <i><font color='green'>/* val destructor */</font></i>
<a name='L548'><font color='red'>}</font>;
<a name='L549'>
<a name='L550'><i><font color='green'>/* Keylist hash table type has unencoded redis objects as keys and</font></i>
<a name='L551'><i><font color='green'> * lists as values. It's used for blocking operations (BLPOP) and to</font></i>
<a name='L552'><i><font color='green'> * map swapped keys to a list of clients waiting for this keys to be loaded. */</font></i>
<a name='L553'><a href='../D/2127.html' title='Multiple defined in 4 places.'>dictType</a> keylistDictType = <font color='red'>{</font>
<a name='L554'>    <a href='../S/35.html#L426' title='Defined at 426 in src/redis.c.'>dictObjHash</a>,                <i><font color='green'>/* hash function */</font></i>
<a name='L555'>    NULL,                       <i><font color='green'>/* key dup */</font></i>
<a name='L556'>    NULL,                       <i><font color='green'>/* val dup */</font></i>
<a name='L557'>    <a href='../S/35.html#L419' title='Defined at 419 in src/redis.c.'>dictObjKeyCompare</a>,          <i><font color='green'>/* key compare */</font></i>
<a name='L558'>    <a href='../S/35.html#L404' title='Defined at 404 in src/redis.c.'>dictRedisObjectDestructor</a>,  <i><font color='green'>/* key destructor */</font></i>
<a name='L559'>    <a href='../S/35.html#L376' title='Defined at 376 in src/redis.c.'>dictListDestructor</a>          <i><font color='green'>/* val destructor */</font></i>
<a name='L560'><font color='red'>}</font>;
<a name='L561'>
<a name='L562'><b>int</b> <a href='../R/2158.html' title='Multiple refered from 8 places.'>htNeedsResize</a>(dict *dict) <font color='red'>{</font>
<a name='L563'>    <b>long</b> <b>long</b> size, used;
<a name='L564'>
<a name='L565'>    size = <a href='../D/2126.html' title='Multiple defined in 2 places.'>dictSlots</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L566'>    used = <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L567'>    <b>return</b> (size &amp;&amp; used &amp;&amp; size &gt; <a href='../D/122.html' title='Multiple defined in 2 places.'>DICT_HT_INITIAL_SIZE</a> &amp;&amp;
<a name='L568'>            (used*100/size &lt; <a href='../S/32.html#L103' title='Defined at 103 in src/redis.h.'>REDIS_HT_MINFILL</a>));
<a name='L569'><font color='red'>}</font>
<a name='L570'>
<a name='L571'><i><font color='green'>/* If the percentage of used slots in the HT reaches REDIS_HT_MINFILL</font></i>
<a name='L572'><i><font color='green'> * we resize the hash table to save memory */</font></i>
<a name='L573'><b>void</b> <a href='../S/35.html#L877' title='Refered from 877 in src/redis.c.'>tryResizeHashTables</a>(<b>void</b>) <font color='red'>{</font>
<a name='L574'>    <b>int</b> j;
<a name='L575'>
<a name='L576'>    <b>for</b> (j = 0; j &lt; server.dbnum; j++) <font color='red'>{</font>
<a name='L577'>        <b>if</b> (<a href='../S/35.html#L562' title='Defined at 562 in src/redis.c.'>htNeedsResize</a>(server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>))
<a name='L578'>            <a href='../S/29.html#L198' title='Defined at 198 in src/dict.c.'>dictResize</a>(server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L579'>        <b>if</b> (<a href='../S/35.html#L562' title='Defined at 562 in src/redis.c.'>htNeedsResize</a>(server.db[j].expires))
<a name='L580'>            <a href='../S/29.html#L198' title='Defined at 198 in src/dict.c.'>dictResize</a>(server.db[j].expires);
<a name='L581'>    <font color='red'>}</font>
<a name='L582'><font color='red'>}</font>
<a name='L583'>
<a name='L584'><i><font color='green'>/* Our hash table implementation performs rehashing incrementally while</font></i>
<a name='L585'><i><font color='green'> * we write/read from the hash table. Still if the server is idle, the hash</font></i>
<a name='L586'><i><font color='green'> * table will use two tables for a long time. So we try to use 1 millisecond</font></i>
<a name='L587'><i><font color='green'> * of CPU time at every serverCron() loop in order to rehash some key. */</font></i>
<a name='L588'><b>void</b> <a href='../S/35.html#L878' title='Refered from 878 in src/redis.c.'>incrementallyRehash</a>(<b>void</b>) <font color='red'>{</font>
<a name='L589'>    <b>int</b> j;
<a name='L590'>
<a name='L591'>    <b>for</b> (j = 0; j &lt; server.dbnum; j++) <font color='red'>{</font>
<a name='L592'>        <i><font color='green'>/* Keys dictionary */</font></i>
<a name='L593'>        <b>if</b> (<a href='../S/88.html#L137' title='Defined at 137 in src/dict.h.'>dictIsRehashing</a>(server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>)) <font color='red'>{</font>
<a name='L594'>            <a href='../S/29.html#L290' title='Defined at 290 in src/dict.c.'>dictRehashMilliseconds</a>(server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,1);
<a name='L595'>            <b>break</b>; <i><font color='green'>/* already used our millisecond for this loop... */</font></i>
<a name='L596'>        <font color='red'>}</font>
<a name='L597'>        <i><font color='green'>/* Expires */</font></i>
<a name='L598'>        <b>if</b> (<a href='../S/88.html#L137' title='Defined at 137 in src/dict.h.'>dictIsRehashing</a>(server.db[j].expires)) <font color='red'>{</font>
<a name='L599'>            <a href='../S/29.html#L290' title='Defined at 290 in src/dict.c.'>dictRehashMilliseconds</a>(server.db[j].expires,1);
<a name='L600'>            <b>break</b>; <i><font color='green'>/* already used our millisecond for this loop... */</font></i>
<a name='L601'>        <font color='red'>}</font>
<a name='L602'>    <font color='red'>}</font>
<a name='L603'><font color='red'>}</font>
<a name='L604'>
<a name='L605'><i><font color='green'>/* This function is called once a background process of some kind terminates,</font></i>
<a name='L606'><i><font color='green'> * as we want to avoid resizing the hash tables when there is a child in order</font></i>
<a name='L607'><i><font color='green'> * to play well with copy-on-write (otherwise when a resize happens lots of</font></i>
<a name='L608'><i><font color='green'> * memory pages are copied). The goal of this function is to update the ability</font></i>
<a name='L609'><i><font color='green'> * for dict.c to resize the hash tables accordingly to the fact we have o not</font></i>
<a name='L610'><i><font color='green'> * running childs. */</font></i>
<a name='L611'><b>void</b> <a href='../R/4062.html' title='Multiple refered from 4 places.'>updateDictResizePolicy</a>(<b>void</b>) <font color='red'>{</font>
<a name='L612'>    <b>if</b> (server.rdb_child_pid == -1 &amp;&amp; server.aof_child_pid == -1)
<a name='L613'>        <a href='../S/29.html#L680' title='Defined at 680 in src/dict.c.'>dictEnableResize</a>();
<a name='L614'>    <b>else</b>
<a name='L615'>        <a href='../S/29.html#L684' title='Defined at 684 in src/dict.c.'>dictDisableResize</a>();
<a name='L616'><font color='red'>}</font>
<a name='L617'>
<a name='L618'><i><font color='green'>/* ======================= Cron: called every 100 ms ======================== */</font></i>
<a name='L619'>
<a name='L620'><i><font color='green'>/* Try to expire a few timed out keys. The algorithm used is adaptive and</font></i>
<a name='L621'><i><font color='green'> * will use few CPU cycles if there are few expiring keys, otherwise</font></i>
<a name='L622'><i><font color='green'> * it will get more aggressive to avoid that too much memory is used by</font></i>
<a name='L623'><i><font color='green'> * keys that can be removed from the keyspace. */</font></i>
<a name='L624'><b>void</b> <a href='../S/35.html#L964' title='Refered from 964 in src/redis.c.'>activeExpireCycle</a>(<b>void</b>) <font color='red'>{</font>
<a name='L625'>    <b>int</b> j, iteration = 0;
<a name='L626'>    <b>long</b> <b>long</b> start = <a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>(), timelimit;
<a name='L627'>
<a name='L628'>    <i><font color='green'>/* We can use at max REDIS_EXPIRELOOKUPS_TIME_PERC percentage of CPU time</font></i>
<a name='L629'><i><font color='green'>     * per iteration. Since this function gets called with a frequency of</font></i>
<a name='L630'><i><font color='green'>     * REDIS_HZ times per second, the following is the max amount of</font></i>
<a name='L631'><i><font color='green'>     * microseconds we can spend in this function. */</font></i>
<a name='L632'>    timelimit = 1000000*<a href='../S/32.html#L76' title='Defined at 76 in src/redis.h.'>REDIS_EXPIRELOOKUPS_TIME_PERC</a>/<a href='../S/32.html#L70' title='Defined at 70 in src/redis.h.'>REDIS_HZ</a>/100;
<a name='L633'>    <b>if</b> (timelimit &lt;= 0) timelimit = 1;
<a name='L634'>
<a name='L635'>    <b>for</b> (j = 0; j &lt; server.dbnum; j++) <font color='red'>{</font>
<a name='L636'>        <b>int</b> expired;
<a name='L637'>        <a href='../D/3798.html' title='Multiple defined in 2 places.'>redisDb</a> *db = server.db+j;
<a name='L638'>
<a name='L639'>        <i><font color='green'>/* Continue to expire if at the end of the cycle more than 25%</font></i>
<a name='L640'><i><font color='green'>         * of the keys were expired. */</font></i>
<a name='L641'>        <b>do</b> <font color='red'>{</font>
<a name='L642'>            <b>unsigned</b> <b>long</b> num = <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(db-&gt;expires);
<a name='L643'>            <b>unsigned</b> <b>long</b> slots = <a href='../D/2126.html' title='Multiple defined in 2 places.'>dictSlots</a>(db-&gt;expires);
<a name='L644'>            <b>long</b> <b>long</b> now = <a href='../D/3402.html' title='Multiple defined in 3 places.'>mstime</a>();
<a name='L645'>
<a name='L646'>            <i><font color='green'>/* When there are less than 1% filled slots getting random</font></i>
<a name='L647'><i><font color='green'>             * keys is expensive, so stop here waiting for better times...</font></i>
<a name='L648'><i><font color='green'>             * The dictionary will be resized asap. */</font></i>
<a name='L649'>            <b>if</b> (num &amp;&amp; slots &gt; <a href='../D/122.html' title='Multiple defined in 2 places.'>DICT_HT_INITIAL_SIZE</a> &amp;&amp;
<a name='L650'>                (num*100/slots &lt; 1)) <b>break</b>;
<a name='L651'>
<a name='L652'>            <i><font color='green'>/* The main collection cycle. Sample random keys among keys</font></i>
<a name='L653'><i><font color='green'>             * with an expire set, checking for expired ones. */</font></i>
<a name='L654'>            expired = 0;
<a name='L655'>            <b>if</b> (num &gt; <a href='../S/32.html#L75' title='Defined at 75 in src/redis.h.'>REDIS_EXPIRELOOKUPS_PER_CRON</a>)
<a name='L656'>                num = <a href='../S/32.html#L75' title='Defined at 75 in src/redis.h.'>REDIS_EXPIRELOOKUPS_PER_CRON</a>;
<a name='L657'>            <b>while</b> (num--) <font color='red'>{</font>
<a name='L658'>                <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L659'>                <b>long</b> <b>long</b> t;
<a name='L660'>
<a name='L661'>                <b>if</b> ((de = <a href='../S/29.html#L568' title='Defined at 568 in src/dict.c.'>dictGetRandomKey</a>(db-&gt;expires)) == NULL) <b>break</b>;
<a name='L662'>                t = <a href='../S/88.html#L133' title='Defined at 133 in src/dict.h.'>dictGetSignedIntegerVal</a>(de);
<a name='L663'>                <b>if</b> (now &gt; t) <font color='red'>{</font>
<a name='L664'>                    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> key = <a href='../S/88.html#L131' title='Defined at 131 in src/dict.h.'>dictGetKey</a>(de);
<a name='L665'>                    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *keyobj = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>(key,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(key));
<a name='L666'>
<a name='L667'>                    <a href='../S/31.html#L486' title='Defined at 486 in src/db.c.'>propagateExpire</a>(db,keyobj);
<a name='L668'>                    <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(db,keyobj);
<a name='L669'>                    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(keyobj);
<a name='L670'>                    expired++;
<a name='L671'>                    server.stat_expiredkeys++;
<a name='L672'>                <font color='red'>}</font>
<a name='L673'>            <font color='red'>}</font>
<a name='L674'>            <i><font color='green'>/* We can't block forever here even if there are many keys to</font></i>
<a name='L675'><i><font color='green'>             * expire. So after a given amount of milliseconds return to the</font></i>
<a name='L676'><i><font color='green'>             * caller waiting for the other active expire cycle. */</font></i>
<a name='L677'>            iteration++;
<a name='L678'>            <b>if</b> ((iteration &amp; 0xf) == 0 &amp;&amp; <i><font color='green'>/* check once every 16 cycles. */</font></i>
<a name='L679'>                (<a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>()-start) &gt; timelimit) <b>return</b>;
<a name='L680'>        <font color='red'>}</font> <b>while</b> (expired &gt; <a href='../S/32.html#L75' title='Defined at 75 in src/redis.h.'>REDIS_EXPIRELOOKUPS_PER_CRON</a>/4);
<a name='L681'>    <font color='red'>}</font>
<a name='L682'><font color='red'>}</font>
<a name='L683'>
<a name='L684'><b>void</b> <a href='../R/4063.html' title='Multiple refered from 2 places.'>updateLRUClock</a>(<b>void</b>) <font color='red'>{</font>
<a name='L685'>    server.lruclock = (server.unixtime/<a href='../S/32.html#L310' title='Defined at 310 in src/redis.h.'>REDIS_LRU_CLOCK_RESOLUTION</a>) &amp;
<a name='L686'>                                                <a href='../S/32.html#L309' title='Defined at 309 in src/redis.h.'>REDIS_LRU_CLOCK_MAX</a>;
<a name='L687'><font color='red'>}</font>
<a name='L688'>
<a name='L689'>
<a name='L690'><i><font color='green'>/* Add a sample to the operations per second array of samples. */</font></i>
<a name='L691'><b>void</b> <a href='../S/35.html#L828' title='Refered from 828 in src/redis.c.'>trackOperationsPerSecond</a>(<b>void</b>) <font color='red'>{</font>
<a name='L692'>    <b>long</b> <b>long</b> t = <a href='../D/3402.html' title='Multiple defined in 3 places.'>mstime</a>() - server.ops_sec_last_sample_time;
<a name='L693'>    <b>long</b> <b>long</b> ops = server.stat_numcommands - server.ops_sec_last_sample_ops;
<a name='L694'>    <b>long</b> <b>long</b> ops_sec;
<a name='L695'>
<a name='L696'>    ops_sec = t &gt; 0 ? (ops*1000/t) : 0;
<a name='L697'>
<a name='L698'>    server.ops_sec_samples[server.ops_sec_idx] = ops_sec;
<a name='L699'>    server.ops_sec_idx = (server.ops_sec_idx+1) % <a href='../S/32.html#L93' title='Defined at 93 in src/redis.h.'>REDIS_OPS_SEC_SAMPLES</a>;
<a name='L700'>    server.ops_sec_last_sample_time = <a href='../D/3402.html' title='Multiple defined in 3 places.'>mstime</a>();
<a name='L701'>    server.ops_sec_last_sample_ops = server.stat_numcommands;
<a name='L702'><font color='red'>}</font>
<a name='L703'>
<a name='L704'><i><font color='green'>/* Return the mean of all the samples. */</font></i>
<a name='L705'><b>long</b> <b>long</b> <a href='../S/35.html#L2047' title='Refered from 2047 in src/redis.c.'>getOperationsPerSecond</a>(<b>void</b>) <font color='red'>{</font>
<a name='L706'>    <b>int</b> j;
<a name='L707'>    <b>long</b> <b>long</b> sum = 0;
<a name='L708'>
<a name='L709'>    <b>for</b> (j = 0; j &lt; <a href='../S/32.html#L93' title='Defined at 93 in src/redis.h.'>REDIS_OPS_SEC_SAMPLES</a>; j++)
<a name='L710'>        sum += server.ops_sec_samples[j];
<a name='L711'>    <b>return</b> sum / <a href='../S/32.html#L93' title='Defined at 93 in src/redis.h.'>REDIS_OPS_SEC_SAMPLES</a>;
<a name='L712'><font color='red'>}</font>
<a name='L713'>
<a name='L714'><i><font color='green'>/* Check for timeouts. Returns non-zero if the client was terminated */</font></i>
<a name='L715'><b>int</b> <a href='../S/35.html#L788' title='Refered from 788 in src/redis.c.'>clientsCronHandleTimeout</a>(redisClient *c) <font color='red'>{</font>
<a name='L716'>    time_t now = server.unixtime;
<a name='L717'>
<a name='L718'>    <b>if</b> (server.maxidletime &amp;&amp;
<a name='L719'>        !(c-&gt;flags &amp; <a href='../S/32.html#L172' title='Defined at 172 in src/redis.h.'>REDIS_SLAVE</a>) &amp;&amp;    <i><font color='green'>/* no timeout for slaves */</font></i>
<a name='L720'>        !(c-&gt;flags &amp; <a href='../S/32.html#L173' title='Defined at 173 in src/redis.h.'>REDIS_MASTER</a>) &amp;&amp;   <i><font color='green'>/* no timeout for masters */</font></i>
<a name='L721'>        !(c-&gt;flags &amp; <a href='../S/32.html#L176' title='Defined at 176 in src/redis.h.'>REDIS_BLOCKED</a>) &amp;&amp;  <i><font color='green'>/* no timeout for BLPOP */</font></i>
<a name='L722'>        <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(c-&gt;pubsub_channels) == 0 &amp;&amp; <i><font color='green'>/* no timeout for pubsub */</font></i>
<a name='L723'>        <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;pubsub_patterns) == 0 &amp;&amp;
<a name='L724'>        (now - c-&gt;lastinteraction &gt; server.maxidletime))
<a name='L725'>    <font color='red'>{</font>
<a name='L726'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>,"Closing idle client");
<a name='L727'>        <a href='../D/2273.html' title='Multiple defined in 2 places.'>freeClient</a>(c);
<a name='L728'>        <b>return</b> 1;
<a name='L729'>    <font color='red'>}</font> <b>else</b> <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L176' title='Defined at 176 in src/redis.h.'>REDIS_BLOCKED</a>) <font color='red'>{</font>
<a name='L730'>        <b>if</b> (c-&gt;bpop.timeout != 0 &amp;&amp; c-&gt;bpop.timeout &lt; now) <font color='red'>{</font>
<a name='L731'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullmultibulk);
<a name='L732'>            <a href='../S/60.html#L792' title='Defined at 792 in src/t_list.c.'>unblockClientWaitingData</a>(c);
<a name='L733'>        <font color='red'>}</font>
<a name='L734'>    <font color='red'>}</font>
<a name='L735'>    <b>return</b> 0;
<a name='L736'><font color='red'>}</font>
<a name='L737'>
<a name='L738'><i><font color='green'>/* The client query buffer is an sds.c string that can end with a lot of</font></i>
<a name='L739'><i><font color='green'> * free space not used, this function reclaims space if needed.</font></i>
<a name='L740'><i><font color='green'> *</font></i>
<a name='L741'><i><font color='green'> * The funciton always returns 0 as it never terminates the client. */</font></i>
<a name='L742'><b>int</b> <a href='../S/35.html#L789' title='Refered from 789 in src/redis.c.'>clientsCronResizeQueryBuffer</a>(redisClient *c) <font color='red'>{</font>
<a name='L743'>    size_t querybuf_size = <a href='../S/63.html#L126' title='Defined at 126 in src/sds.c.'>sdsAllocSize</a>(c-&gt;querybuf);
<a name='L744'>    time_t idletime = server.unixtime - c-&gt;lastinteraction;
<a name='L745'>
<a name='L746'>    <i><font color='green'>/* There are two conditions to resize the query buffer:</font></i>
<a name='L747'><i><font color='green'>     * 1) Query buffer is &gt; BIG_ARG and too big for latest peak.</font></i>
<a name='L748'><i><font color='green'>     * 2) Client is inactive and the buffer is bigger than 1k. */</font></i>
<a name='L749'>    <b>if</b> (((querybuf_size &gt; <a href='../S/32.html#L100' title='Defined at 100 in src/redis.h.'>REDIS_MBULK_BIG_ARG</a>) &amp;&amp;
<a name='L750'>         (querybuf_size/(c-&gt;querybuf_peak+1)) &gt; 2) ||
<a name='L751'>         (querybuf_size &gt; 1024 &amp;&amp; idletime &gt; 2))
<a name='L752'>    <font color='red'>{</font>
<a name='L753'>        <i><font color='green'>/* Only resize the query buffer if it is actually wasting space. */</font></i>
<a name='L754'>        <b>if</b> (<a href='../D/3993.html' title='Multiple defined in 2 places.'>sdsavail</a>(c-&gt;querybuf) &gt; 1024) <font color='red'>{</font>
<a name='L755'>            c-&gt;querybuf = <a href='../S/63.html#L117' title='Defined at 117 in src/sds.c.'>sdsRemoveFreeSpace</a>(c-&gt;querybuf);
<a name='L756'>        <font color='red'>}</font>
<a name='L757'>    <font color='red'>}</font>
<a name='L758'>    <i><font color='green'>/* Reset the peak again to capture the peak memory usage in the next</font></i>
<a name='L759'><i><font color='green'>     * cycle. */</font></i>
<a name='L760'>    c-&gt;querybuf_peak = 0;
<a name='L761'>    <b>return</b> 0;
<a name='L762'><font color='red'>}</font>
<a name='L763'>
<a name='L764'><b>void</b> <a href='../S/35.html#L893' title='Refered from 893 in src/redis.c.'>clientsCron</a>(<b>void</b>) <font color='red'>{</font>
<a name='L765'>    <i><font color='green'>/* Make sure to process at least 1/(REDIS_HZ*10) of clients per call.</font></i>
<a name='L766'><i><font color='green'>     * Since this function is called REDIS_HZ times per second we are sure that</font></i>
<a name='L767'><i><font color='green'>     * in the worst case we process all the clients in 10 seconds.</font></i>
<a name='L768'><i><font color='green'>     * In normal conditions (a reasonable number of clients) we process</font></i>
<a name='L769'><i><font color='green'>     * all the clients in a shorter time. */</font></i>
<a name='L770'>    <b>int</b> numclients = <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.clients);
<a name='L771'>    <b>int</b> iterations = numclients/(<a href='../S/32.html#L70' title='Defined at 70 in src/redis.h.'>REDIS_HZ</a>*10);
<a name='L772'>
<a name='L773'>    <b>if</b> (iterations &lt; 50)
<a name='L774'>        iterations = (numclients &lt; 50) ? numclients : 50;
<a name='L775'>    <b>while</b>(<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.clients) &amp;&amp; iterations--) <font color='red'>{</font>
<a name='L776'>        <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c;
<a name='L777'>        <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *head;
<a name='L778'>
<a name='L779'>        <i><font color='green'>/* Rotate the list, take the current head, process.</font></i>
<a name='L780'><i><font color='green'>         * This way if the client must be removed from the list it's the</font></i>
<a name='L781'><i><font color='green'>         * first element and we don't incur into O(N) computation. */</font></i>
<a name='L782'>        <a href='../S/54.html#L328' title='Defined at 328 in src/adlist.c.'>listRotate</a>(server.clients);
<a name='L783'>        head = <a href='../S/58.html#L58' title='Defined at 58 in src/adlist.h.'>listFirst</a>(server.clients);
<a name='L784'>        c = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(head);
<a name='L785'>        <i><font color='green'>/* The following functions do different service checks on the client.</font></i>
<a name='L786'><i><font color='green'>         * The protocol is that they return non-zero if the client was</font></i>
<a name='L787'><i><font color='green'>         * terminated. */</font></i>
<a name='L788'>        <b>if</b> (<a href='../S/35.html#L715' title='Defined at 715 in src/redis.c.'>clientsCronHandleTimeout</a>(c)) <b>continue</b>;
<a name='L789'>        <b>if</b> (<a href='../S/35.html#L742' title='Defined at 742 in src/redis.c.'>clientsCronResizeQueryBuffer</a>(c)) <b>continue</b>;
<a name='L790'>    <font color='red'>}</font>
<a name='L791'><font color='red'>}</font>
<a name='L792'>
<a name='L793'><i><font color='green'>/* This is our timer interrupt, called REDIS_HZ times per second.</font></i>
<a name='L794'><i><font color='green'> * Here is where we do a number of things that need to be done asynchronously.</font></i>
<a name='L795'><i><font color='green'> * For instance:</font></i>
<a name='L796'><i><font color='green'> *</font></i>
<a name='L797'><i><font color='green'> * - Active expired keys collection (it is also performed in a lazy way on</font></i>
<a name='L798'><i><font color='green'> *   lookup).</font></i>
<a name='L799'><i><font color='green'> * - Software watchdong.</font></i>
<a name='L800'><i><font color='green'> * - Update some statistic.</font></i>
<a name='L801'><i><font color='green'> * - Incremental rehashing of the DBs hash tables.</font></i>
<a name='L802'><i><font color='green'> * - Triggering BGSAVE / AOF rewrite, and handling of terminated children.</font></i>
<a name='L803'><i><font color='green'> * - Clients timeout of differnet kinds.</font></i>
<a name='L804'><i><font color='green'> * - Replication reconnection.</font></i>
<a name='L805'><i><font color='green'> * - Many more...</font></i>
<a name='L806'><i><font color='green'> *</font></i>
<a name='L807'><i><font color='green'> * Everything directly called here will be called REDIS_HZ times per second,</font></i>
<a name='L808'><i><font color='green'> * so in order to throttle execution of things we want to do less frequently</font></i>
<a name='L809'><i><font color='green'> * a macro is used: run_with_period(milliseconds) { .... }</font></i>
<a name='L810'><i><font color='green'> */</font></i>
<a name='L811'>
<a name='L812'><b>int</b> <a href='../S/35.html#L1331' title='Refered from 1331 in src/redis.c.'>serverCron</a>(<b>struct</b> aeEventLoop *eventLoop, <b>long</b> <b>long</b> id, <b>void</b> *clientData) <font color='red'>{</font>
<a name='L813'>    <b>int</b> j;
<a name='L814'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(eventLoop);
<a name='L815'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(id);
<a name='L816'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(clientData);
<a name='L817'>
<a name='L818'>    <i><font color='green'>/* Software watchdog: deliver the SIGALRM that will reach the signal</font></i>
<a name='L819'><i><font color='green'>     * handler if we don't return here fast enough. */</font></i>
<a name='L820'>    <b>if</b> (server.watchdog_period) <a href='../S/69.html#L768' title='Defined at 768 in src/debug.c.'>watchdogScheduleSignal</a>(server.watchdog_period);
<a name='L821'>
<a name='L822'>    <i><font color='green'>/* We take a cached value of the unix time in the global state because</font></i>
<a name='L823'><i><font color='green'>     * with virtual memory and aging there is to store the current time</font></i>
<a name='L824'><i><font color='green'>     * in objects at every object access, and accuracy is not needed.</font></i>
<a name='L825'><i><font color='green'>     * To access a global var is faster than calling time(NULL) */</font></i>
<a name='L826'>    server.unixtime = time(NULL);
<a name='L827'>
<a name='L828'>    <a href='../S/32.html#L295' title='Defined at 295 in src/redis.h.'>run_with_period</a>(100) <a href='../S/35.html#L691' title='Defined at 691 in src/redis.c.'>trackOperationsPerSecond</a>();
<a name='L829'>
<a name='L830'>    <i><font color='green'>/* We have just 22 bits per object for LRU information.</font></i>
<a name='L831'><i><font color='green'>     * So we use an (eventually wrapping) LRU clock with 10 seconds resolution.</font></i>
<a name='L832'><i><font color='green'>     * 2^22 bits with 10 seconds resoluton is more or less 1.5 years.</font></i>
<a name='L833'><i><font color='green'>     *</font></i>
<a name='L834'><i><font color='green'>     * Note that even if this will wrap after 1.5 years it's not a problem,</font></i>
<a name='L835'><i><font color='green'>     * everything will still work but just some object will appear younger</font></i>
<a name='L836'><i><font color='green'>     * to Redis. But for this to happen a given object should never be touched</font></i>
<a name='L837'><i><font color='green'>     * for 1.5 years.</font></i>
<a name='L838'><i><font color='green'>     *</font></i>
<a name='L839'><i><font color='green'>     * Note that you can change the resolution altering the</font></i>
<a name='L840'><i><font color='green'>     * REDIS_LRU_CLOCK_RESOLUTION define.</font></i>
<a name='L841'><i><font color='green'>     */</font></i>
<a name='L842'>    <a href='../S/35.html#L684' title='Defined at 684 in src/redis.c.'>updateLRUClock</a>();
<a name='L843'>
<a name='L844'>    <i><font color='green'>/* Record the max memory used since the server was started. */</font></i>
<a name='L845'>    <b>if</b> (<a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>() &gt; server.stat_peak_memory)
<a name='L846'>        server.stat_peak_memory = <a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>();
<a name='L847'>
<a name='L848'>    <i><font color='green'>/* We received a SIGTERM, shutting down here in a safe way, as it is</font></i>
<a name='L849'><i><font color='green'>     * not ok doing so inside the signal handler. */</font></i>
<a name='L850'>    <b>if</b> (server.shutdown_asap) <font color='red'>{</font>
<a name='L851'>        <b>if</b> (<a href='../S/35.html#L1685' title='Defined at 1685 in src/redis.c.'>prepareForShutdown</a>(0) == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) exit(0);
<a name='L852'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"SIGTERM received but errors trying to shut down the server, check the logs for more information");
<a name='L853'>    <font color='red'>}</font>
<a name='L854'>
<a name='L855'>    <i><font color='green'>/* Show some info about non-empty databases */</font></i>
<a name='L856'>    <a href='../S/32.html#L295' title='Defined at 295 in src/redis.h.'>run_with_period</a>(5000) <font color='red'>{</font>
<a name='L857'>        <b>for</b> (j = 0; j &lt; server.dbnum; j++) <font color='red'>{</font>
<a name='L858'>            <b>long</b> <b>long</b> size, used, vkeys;
<a name='L859'>
<a name='L860'>            size = <a href='../D/2126.html' title='Multiple defined in 2 places.'>dictSlots</a>(server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L861'>            used = <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L862'>            vkeys = <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(server.db[j].expires);
<a name='L863'>            <b>if</b> (used || vkeys) <font color='red'>{</font>
<a name='L864'>                <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>,"DB %d: %lld keys (%lld volatile) in %lld slots HT.",j,used,vkeys,size);
<a name='L865'>                <i><font color='green'>/* dictPrintStats(server.dict); */</font></i>
<a name='L866'>            <font color='red'>}</font>
<a name='L867'>        <font color='red'>}</font>
<a name='L868'>    <font color='red'>}</font>
<a name='L869'>
<a name='L870'>    <i><font color='green'>/* We don't want to resize the hash tables while a bacground saving</font></i>
<a name='L871'><i><font color='green'>     * is in progress: the saving child is created using fork() that is</font></i>
<a name='L872'><i><font color='green'>     * implemented with a copy-on-write semantic in most modern systems, so</font></i>
<a name='L873'><i><font color='green'>     * if we resize the HT while there is the saving child at work actually</font></i>
<a name='L874'><i><font color='green'>     * a lot of memory movements in the parent will cause a lot of pages</font></i>
<a name='L875'><i><font color='green'>     * copied. */</font></i>
<a name='L876'>    <b>if</b> (server.rdb_child_pid == -1 &amp;&amp; server.aof_child_pid == -1) <font color='red'>{</font>
<a name='L877'>        <a href='../S/35.html#L573' title='Defined at 573 in src/redis.c.'>tryResizeHashTables</a>();
<a name='L878'>        <b>if</b> (server.activerehashing) <a href='../S/35.html#L588' title='Defined at 588 in src/redis.c.'>incrementallyRehash</a>();
<a name='L879'>    <font color='red'>}</font>
<a name='L880'>
<a name='L881'>    <i><font color='green'>/* Show information about connected clients */</font></i>
<a name='L882'>    <b>if</b> (!server.sentinel_mode) <font color='red'>{</font>
<a name='L883'>        <a href='../S/32.html#L295' title='Defined at 295 in src/redis.h.'>run_with_period</a>(5000) <font color='red'>{</font>
<a name='L884'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L230' title='Defined at 230 in src/redis.h.'>REDIS_VERBOSE</a>,
<a name='L885'>                "%d clients connected (%d slaves), %zu bytes in use",
<a name='L886'>                <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.clients)-<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves),
<a name='L887'>                <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves),
<a name='L888'>                <a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>());
<a name='L889'>        <font color='red'>}</font>
<a name='L890'>    <font color='red'>}</font>
<a name='L891'>
<a name='L892'>    <i><font color='green'>/* We need to do a few operations on clients asynchronously. */</font></i>
<a name='L893'>    <a href='../S/35.html#L764' title='Defined at 764 in src/redis.c.'>clientsCron</a>();
<a name='L894'>
<a name='L895'>    <i><font color='green'>/* Start a scheduled AOF rewrite if this was requested by the user while</font></i>
<a name='L896'><i><font color='green'>     * a BGSAVE was in progress. */</font></i>
<a name='L897'>    <b>if</b> (server.rdb_child_pid == -1 &amp;&amp; server.aof_child_pid == -1 &amp;&amp;
<a name='L898'>        server.aof_rewrite_scheduled)
<a name='L899'>    <font color='red'>{</font>
<a name='L900'>        <a href='../S/62.html#L951' title='Defined at 951 in src/aof.c.'>rewriteAppendOnlyFileBackground</a>();
<a name='L901'>    <font color='red'>}</font>
<a name='L902'>
<a name='L903'>    <i><font color='green'>/* Check if a background saving or AOF rewrite in progress terminated. */</font></i>
<a name='L904'>    <b>if</b> (server.rdb_child_pid != -1 || server.aof_child_pid != -1) <font color='red'>{</font>
<a name='L905'>        <b>int</b> statloc;
<a name='L906'>        pid_t pid;
<a name='L907'>
<a name='L908'>        <b>if</b> ((pid = wait3(&amp;statloc,WNOHANG,NULL)) != 0) <font color='red'>{</font>
<a name='L909'>            <b>int</b> exitcode = WEXITSTATUS(statloc);
<a name='L910'>            <b>int</b> bysignal = 0;
<a name='L911'>            
<a name='L912'>            <b>if</b> (WIFSIGNALED(statloc)) bysignal = WTERMSIG(statloc);
<a name='L913'>
<a name='L914'>            <b>if</b> (pid == server.rdb_child_pid) <font color='red'>{</font>
<a name='L915'>                <a href='../S/87.html#L1183' title='Defined at 1183 in src/rdb.c.'>backgroundSaveDoneHandler</a>(exitcode,bysignal);
<a name='L916'>            <font color='red'>}</font> <b>else</b> <b>if</b> (pid == server.aof_child_pid) <font color='red'>{</font>
<a name='L917'>                <a href='../S/62.html#L1038' title='Defined at 1038 in src/aof.c.'>backgroundRewriteDoneHandler</a>(exitcode,bysignal);
<a name='L918'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L919'>                <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,
<a name='L920'>                    "Warning, detected child with unmatched pid: %ld",
<a name='L921'>                    (<b>long</b>)pid);
<a name='L922'>            <font color='red'>}</font>
<a name='L923'>            <a href='../S/35.html#L611' title='Defined at 611 in src/redis.c.'>updateDictResizePolicy</a>();
<a name='L924'>        <font color='red'>}</font>
<a name='L925'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L926'>        <i><font color='green'>/* If there is not a background saving/rewrite in progress check if</font></i>
<a name='L927'><i><font color='green'>         * we have to save/rewrite now */</font></i>
<a name='L928'>         <b>for</b> (j = 0; j &lt; server.saveparamslen; j++) <font color='red'>{</font>
<a name='L929'>            <b>struct</b> <a href='../S/32.html#L418' title='Defined at 418 in src/redis.h.'>saveparam</a> *sp = server.saveparams+j;
<a name='L930'>
<a name='L931'>            <b>if</b> (server.dirty &gt;= sp-&gt;changes &amp;&amp;
<a name='L932'>                server.unixtime-server.lastsave &gt; sp-&gt;seconds) <font color='red'>{</font>
<a name='L933'>                <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"%d changes in %d seconds. Saving...",
<a name='L934'>                    sp-&gt;changes, sp-&gt;seconds);
<a name='L935'>                <a href='../S/87.html#L718' title='Defined at 718 in src/rdb.c.'>rdbSaveBackground</a>(server.rdb_filename);
<a name='L936'>                <b>break</b>;
<a name='L937'>            <font color='red'>}</font>
<a name='L938'>         <font color='red'>}</font>
<a name='L939'>
<a name='L940'>         <i><font color='green'>/* Trigger an AOF rewrite if needed */</font></i>
<a name='L941'>         <b>if</b> (server.rdb_child_pid == -1 &amp;&amp;
<a name='L942'>             server.aof_child_pid == -1 &amp;&amp;
<a name='L943'>             server.aof_rewrite_perc &amp;&amp;
<a name='L944'>             server.aof_current_size &gt; server.aof_rewrite_min_size)
<a name='L945'>         <font color='red'>{</font>
<a name='L946'>            <b>long</b> <b>long</b> base = server.aof_rewrite_base_size ?
<a name='L947'>                            server.aof_rewrite_base_size : 1;
<a name='L948'>            <b>long</b> <b>long</b> growth = (server.aof_current_size*100/base) - 100;
<a name='L949'>            <b>if</b> (growth &gt;= server.aof_rewrite_perc) <font color='red'>{</font>
<a name='L950'>                <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"Starting automatic rewriting of AOF on %lld%% growth",growth);
<a name='L951'>                <a href='../S/62.html#L951' title='Defined at 951 in src/aof.c.'>rewriteAppendOnlyFileBackground</a>();
<a name='L952'>            <font color='red'>}</font>
<a name='L953'>         <font color='red'>}</font>
<a name='L954'>    <font color='red'>}</font>
<a name='L955'>
<a name='L956'>
<a name='L957'>    <i><font color='green'>/* If we postponed an AOF buffer flush, let's try to do it every time the</font></i>
<a name='L958'><i><font color='green'>     * cron function is called. */</font></i>
<a name='L959'>    <b>if</b> (server.aof_flush_postponed_start) <a href='../S/62.html#L229' title='Defined at 229 in src/aof.c.'>flushAppendOnlyFile</a>(0);
<a name='L960'>
<a name='L961'>    <i><font color='green'>/* Expire a few keys per cycle, only if this is a master.</font></i>
<a name='L962'><i><font color='green'>     * On slaves we wait for DEL operations synthesized by the master</font></i>
<a name='L963'><i><font color='green'>     * in order to guarantee a strict consistency. */</font></i>
<a name='L964'>    <b>if</b> (server.masterhost == NULL) <a href='../S/35.html#L624' title='Defined at 624 in src/redis.c.'>activeExpireCycle</a>();
<a name='L965'>
<a name='L966'>    <i><font color='green'>/* Close clients that need to be closed asynchronous */</font></i>
<a name='L967'>    <a href='../S/86.html#L684' title='Defined at 684 in src/networking.c.'>freeClientsInAsyncFreeQueue</a>();
<a name='L968'>
<a name='L969'>    <i><font color='green'>/* Replication cron function -- used to reconnect to master and</font></i>
<a name='L970'><i><font color='green'>     * to detect transfer failures. */</font></i>
<a name='L971'>    <a href='../S/32.html#L295' title='Defined at 295 in src/redis.h.'>run_with_period</a>(1000) <a href='../S/14.html#L742' title='Defined at 742 in src/replication.c.'>replicationCron</a>();
<a name='L972'>
<a name='L973'>    <i><font color='green'>/* Run the sentinel timer if we are in sentinel mode. */</font></i>
<a name='L974'>    <a href='../S/32.html#L295' title='Defined at 295 in src/redis.h.'>run_with_period</a>(100) <font color='red'>{</font>
<a name='L975'>        <b>if</b> (server.sentinel_mode) <a href='../S/82.html#L3050' title='Defined at 3050 in src/sentinel.c.'>sentinelTimer</a>();
<a name='L976'>    <font color='red'>}</font>
<a name='L977'>
<a name='L978'>    server.cronloops++;
<a name='L979'>    <b>return</b> 1000/<a href='../S/32.html#L70' title='Defined at 70 in src/redis.h.'>REDIS_HZ</a>;
<a name='L980'><font color='red'>}</font>
<a name='L981'>
<a name='L982'><i><font color='green'>/* This function gets called every time Redis is entering the</font></i>
<a name='L983'><i><font color='green'> * main loop of the event driven library, that is, before to sleep</font></i>
<a name='L984'><i><font color='green'> * for ready file descriptors. */</font></i>
<a name='L985'><b>void</b> <a href='../S/35.html#L2620' title='Refered from 2620 in src/redis.c.'>beforeSleep</a>(<b>struct</b> aeEventLoop *eventLoop) <font color='red'>{</font>
<a name='L986'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(eventLoop);
<a name='L987'>    <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L988'>    <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *c;
<a name='L989'>
<a name='L990'>    <i><font color='green'>/* Try to process pending commands for clients that were just unblocked. */</font></i>
<a name='L991'>    <b>while</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.unblocked_clients)) <font color='red'>{</font>
<a name='L992'>        ln = <a href='../S/58.html#L58' title='Defined at 58 in src/adlist.h.'>listFirst</a>(server.unblocked_clients);
<a name='L993'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(ln != NULL);
<a name='L994'>        c = ln-&gt;value;
<a name='L995'>        <a href='../S/54.html#L159' title='Defined at 159 in src/adlist.c.'>listDelNode</a>(server.unblocked_clients,ln);
<a name='L996'>        c-&gt;flags &amp;= ~<a href='../S/32.html#L179' title='Defined at 179 in src/redis.h.'>REDIS_UNBLOCKED</a>;
<a name='L997'>
<a name='L998'>        <i><font color='green'>/* Process remaining data in the input buffer. */</font></i>
<a name='L999'>        <b>if</b> (c-&gt;querybuf &amp;&amp; <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;querybuf) &gt; 0) <font color='red'>{</font>
<a name='L1000'>            server.current_client = c;
<a name='L1001'>            <a href='../S/86.html#L974' title='Defined at 974 in src/networking.c.'>processInputBuffer</a>(c);
<a name='L1002'>            server.current_client = NULL;
<a name='L1003'>        <font color='red'>}</font>
<a name='L1004'>    <font color='red'>}</font>
<a name='L1005'>
<a name='L1006'>    <i><font color='green'>/* Write the AOF buffer on disk */</font></i>
<a name='L1007'>    <a href='../S/62.html#L229' title='Defined at 229 in src/aof.c.'>flushAppendOnlyFile</a>(0);
<a name='L1008'><font color='red'>}</font>
<a name='L1009'>
<a name='L1010'><i><font color='green'>/* =========================== Server initialization ======================== */</font></i>
<a name='L1011'>
<a name='L1012'><b>void</b> <a href='../S/35.html#L1268' title='Refered from 1268 in src/redis.c.'>createSharedObjects</a>(<b>void</b>) <font color='red'>{</font>
<a name='L1013'>    <b>int</b> j;
<a name='L1014'>
<a name='L1015'>    shared.crlf = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("\r\n"));
<a name='L1016'>    shared.<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a> = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("+OK\r\n"));
<a name='L1017'>    shared.err = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("-ERR\r\n"));
<a name='L1018'>    shared.emptybulk = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("$0\r\n\r\n"));
<a name='L1019'>    shared.czero = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(":0\r\n"));
<a name='L1020'>    shared.cone = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(":1\r\n"));
<a name='L1021'>    shared.cnegone = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(":-1\r\n"));
<a name='L1022'>    shared.nullbulk = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("$-1\r\n"));
<a name='L1023'>    shared.nullmultibulk = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("*-1\r\n"));
<a name='L1024'>    shared.emptymultibulk = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("*0\r\n"));
<a name='L1025'>    shared.pong = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("+PONG\r\n"));
<a name='L1026'>    shared.queued = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("+QUEUED\r\n"));
<a name='L1027'>    shared.wrongtypeerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1028'>        "-ERR Operation against a key holding the wrong kind of value\r\n"));
<a name='L1029'>    shared.nokeyerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1030'>        "-ERR no such key\r\n"));
<a name='L1031'>    shared.syntaxerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1032'>        "-ERR syntax error\r\n"));
<a name='L1033'>    shared.sameobjecterr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1034'>        "-ERR source and destination objects are the same\r\n"));
<a name='L1035'>    shared.outofrangeerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1036'>        "-ERR index out of range\r\n"));
<a name='L1037'>    shared.noscripterr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1038'>        "-NOSCRIPT No matching script. Please use EVAL.\r\n"));
<a name='L1039'>    shared.loadingerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1040'>        "-LOADING Redis is loading the dataset in memory\r\n"));
<a name='L1041'>    shared.slowscripterr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1042'>        "-BUSY Redis is busy running a script. You can only call SCRIPT KILL or SHUTDOWN NOSAVE.\r\n"));
<a name='L1043'>    shared.masterdownerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1044'>        "-MASTERDOWN Link with MASTER is down and slave-serve-stale-data is set to 'no'.\r\n"));
<a name='L1045'>    shared.bgsaveerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1046'>        "-MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Commands that may modify the data set are disabled. Please check Redis logs for details about the error.\r\n"));
<a name='L1047'>    shared.roslaveerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1048'>        "-READONLY You can't write against a read only slave.\r\n"));
<a name='L1049'>    shared.oomerr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1050'>        "-OOM command not allowed when used memory &gt; 'maxmemory'.\r\n"));
<a name='L1051'>    shared.execaborterr = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(
<a name='L1052'>        "-EXECABORT Transaction discarded because of previous errors.\r\n"));
<a name='L1053'>    shared.space = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(" "));
<a name='L1054'>    shared.colon = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(":"));
<a name='L1055'>    shared.plus = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,<a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>("+"));
<a name='L1056'>
<a name='L1057'>    <b>for</b> (j = 0; j &lt; <a href='../S/32.html#L78' title='Defined at 78 in src/redis.h.'>REDIS_SHARED_SELECT_CMDS</a>; j++) <font color='red'>{</font>
<a name='L1058'>        shared.select[j] = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,
<a name='L1059'>            <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),"select %d\r\n", j));
<a name='L1060'>    <font color='red'>}</font>
<a name='L1061'>    shared.messagebulk = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("$7\r\nmessage\r\n",13);
<a name='L1062'>    shared.pmessagebulk = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("$8\r\npmessage\r\n",14);
<a name='L1063'>    shared.subscribebulk = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("$9\r\nsubscribe\r\n",15);
<a name='L1064'>    shared.unsubscribebulk = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("$11\r\nunsubscribe\r\n",18);
<a name='L1065'>    shared.psubscribebulk = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("$10\r\npsubscribe\r\n",17);
<a name='L1066'>    shared.punsubscribebulk = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("$12\r\npunsubscribe\r\n",19);
<a name='L1067'>    shared.del = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("DEL",3);
<a name='L1068'>    shared.rpop = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("RPOP",4);
<a name='L1069'>    shared.lpop = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("LPOP",4);
<a name='L1070'>    shared.lpush = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>("LPUSH",5);
<a name='L1071'>    <b>for</b> (j = 0; j &lt; <a href='../S/32.html#L79' title='Defined at 79 in src/redis.h.'>REDIS_SHARED_INTEGERS</a>; j++) <font color='red'>{</font>
<a name='L1072'>        shared.integers[j] = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,(<b>void</b>*)(<b>long</b>)j);
<a name='L1073'>        shared.integers[j]-&gt;encoding = <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>;
<a name='L1074'>    <font color='red'>}</font>
<a name='L1075'>    <b>for</b> (j = 0; j &lt; <a href='../S/32.html#L80' title='Defined at 80 in src/redis.h.'>REDIS_SHARED_BULKHDR_LEN</a>; j++) <font color='red'>{</font>
<a name='L1076'>        shared.mbulkhdr[j] = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,
<a name='L1077'>            <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),"*%d\r\n",j));
<a name='L1078'>        shared.bulkhdr[j] = <a href='../S/71.html#L35' title='Defined at 35 in src/object.c.'>createObject</a>(<a href='../D/923.html' title='Multiple defined in 2 places.'>REDIS_STRING</a>,
<a name='L1079'>            <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),"$%d\r\n",j));
<a name='L1080'>    <font color='red'>}</font>
<a name='L1081'><font color='red'>}</font>
<a name='L1082'>
<a name='L1083'><b>void</b> <a href='../S/35.html#L2540' title='Refered from 2540 in src/redis.c.'>initServerConfig</a>() <font color='red'>{</font>
<a name='L1084'>    <a href='../S/74.html#L366' title='Defined at 366 in src/util.c.'>getRandomHexChars</a>(server.runid,<a href='../S/32.html#L92' title='Defined at 92 in src/redis.h.'>REDIS_RUN_ID_SIZE</a>);
<a name='L1085'>    server.runid[<a href='../S/32.html#L92' title='Defined at 92 in src/redis.h.'>REDIS_RUN_ID_SIZE</a>] = '\0';
<a name='L1086'>    server.arch_bits = (<b>sizeof</b>(<b>long</b>) == 8) ? 64 : 32;
<a name='L1087'>    server.port = <a href='../S/32.html#L71' title='Defined at 71 in src/redis.h.'>REDIS_SERVERPORT</a>;
<a name='L1088'>    server.bindaddr = NULL;
<a name='L1089'>    server.unixsocket = NULL;
<a name='L1090'>    server.unixsocketperm = 0;
<a name='L1091'>    server.ipfd = -1;
<a name='L1092'>    server.sofd = -1;
<a name='L1093'>    server.dbnum = <a href='../S/32.html#L73' title='Defined at 73 in src/redis.h.'>REDIS_DEFAULT_DBNUM</a>;
<a name='L1094'>    server.verbosity = <a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>;
<a name='L1095'>    server.maxidletime = <a href='../S/32.html#L72' title='Defined at 72 in src/redis.h.'>REDIS_MAXIDLETIME</a>;
<a name='L1096'>    server.client_max_querybuf_len = <a href='../S/32.html#L96' title='Defined at 96 in src/redis.h.'>REDIS_MAX_QUERYBUF_LEN</a>;
<a name='L1097'>    server.saveparams = NULL;
<a name='L1098'>    server.loading = 0;
<a name='L1099'>    server.logfile = NULL; <i><font color='green'>/* NULL = log on standard output */</font></i>
<a name='L1100'>    server.syslog_enabled = 0;
<a name='L1101'>    server.syslog_ident = <a href='../S/39.html#L210' title='Defined at 210 in src/zmalloc.c.'>zstrdup</a>("redis");
<a name='L1102'>    server.syslog_facility = LOG_LOCAL0;
<a name='L1103'>    server.<a href='../S/35.html#L2402' title='Defined at 2402 in src/redis.c.'>daemonize</a> = 0;
<a name='L1104'>    server.aof_state = <a href='../S/32.html#L167' title='Defined at 167 in src/redis.h.'>REDIS_AOF_OFF</a>;
<a name='L1105'>    server.<a href='../D/1557.html' title='Multiple defined in 2 places.'>aof_fsync</a> = <a href='../S/32.html#L244' title='Defined at 244 in src/redis.h.'>AOF_FSYNC_EVERYSEC</a>;
<a name='L1106'>    server.aof_no_fsync_on_rewrite = 0;
<a name='L1107'>    server.aof_rewrite_perc = <a href='../S/32.html#L82' title='Defined at 82 in src/redis.h.'>REDIS_AOF_REWRITE_PERC</a>;
<a name='L1108'>    server.aof_rewrite_min_size = <a href='../S/32.html#L83' title='Defined at 83 in src/redis.h.'>REDIS_AOF_REWRITE_MIN_SIZE</a>;
<a name='L1109'>    server.aof_rewrite_base_size = 0;
<a name='L1110'>    server.aof_rewrite_scheduled = 0;
<a name='L1111'>    server.aof_last_fsync = time(NULL);
<a name='L1112'>    server.aof_rewrite_time_last = -1;
<a name='L1113'>    server.aof_rewrite_time_start = -1;
<a name='L1114'>    server.aof_lastbgrewrite_status = <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1115'>    server.aof_delayed_fsync = 0;
<a name='L1116'>    server.aof_fd = -1;
<a name='L1117'>    server.aof_selected_db = -1; <i><font color='green'>/* Make sure the first time will not match */</font></i>
<a name='L1118'>    server.aof_flush_postponed_start = 0;
<a name='L1119'>    server.pidfile = <a href='../S/39.html#L210' title='Defined at 210 in src/zmalloc.c.'>zstrdup</a>("/var/run/redis.pid");
<a name='L1120'>    server.rdb_filename = <a href='../S/39.html#L210' title='Defined at 210 in src/zmalloc.c.'>zstrdup</a>("dump.rdb");
<a name='L1121'>    server.aof_filename = <a href='../S/39.html#L210' title='Defined at 210 in src/zmalloc.c.'>zstrdup</a>("appendonly.aof");
<a name='L1122'>    server.requirepass = NULL;
<a name='L1123'>    server.rdb_compression = 1;
<a name='L1124'>    server.rdb_checksum = 1;
<a name='L1125'>    server.activerehashing = 1;
<a name='L1126'>    server.maxclients = <a href='../S/32.html#L87' title='Defined at 87 in src/redis.h.'>REDIS_MAX_CLIENTS</a>;
<a name='L1127'>    server.bpop_blocked_clients = 0;
<a name='L1128'>    server.maxmemory = 0;
<a name='L1129'>    server.maxmemory_policy = <a href='../S/32.html#L261' title='Defined at 261 in src/redis.h.'>REDIS_MAXMEMORY_VOLATILE_LRU</a>;
<a name='L1130'>    server.maxmemory_samples = 3;
<a name='L1131'>    server.hash_max_ziplist_entries = <a href='../S/32.html#L247' title='Defined at 247 in src/redis.h.'>REDIS_HASH_MAX_ZIPLIST_ENTRIES</a>;
<a name='L1132'>    server.hash_max_ziplist_value = <a href='../S/32.html#L248' title='Defined at 248 in src/redis.h.'>REDIS_HASH_MAX_ZIPLIST_VALUE</a>;
<a name='L1133'>    server.list_max_ziplist_entries = <a href='../S/32.html#L249' title='Defined at 249 in src/redis.h.'>REDIS_LIST_MAX_ZIPLIST_ENTRIES</a>;
<a name='L1134'>    server.list_max_ziplist_value = <a href='../S/32.html#L250' title='Defined at 250 in src/redis.h.'>REDIS_LIST_MAX_ZIPLIST_VALUE</a>;
<a name='L1135'>    server.set_max_intset_entries = <a href='../S/32.html#L251' title='Defined at 251 in src/redis.h.'>REDIS_SET_MAX_INTSET_ENTRIES</a>;
<a name='L1136'>    server.zset_max_ziplist_entries = <a href='../S/32.html#L252' title='Defined at 252 in src/redis.h.'>REDIS_ZSET_MAX_ZIPLIST_ENTRIES</a>;
<a name='L1137'>    server.zset_max_ziplist_value = <a href='../S/32.html#L253' title='Defined at 253 in src/redis.h.'>REDIS_ZSET_MAX_ZIPLIST_VALUE</a>;
<a name='L1138'>    server.shutdown_asap = 0;
<a name='L1139'>    server.repl_ping_slave_period = <a href='../S/32.html#L91' title='Defined at 91 in src/redis.h.'>REDIS_REPL_PING_SLAVE_PERIOD</a>;
<a name='L1140'>    server.repl_timeout = <a href='../S/32.html#L90' title='Defined at 90 in src/redis.h.'>REDIS_REPL_TIMEOUT</a>;
<a name='L1141'>    server.lua_caller = NULL;
<a name='L1142'>    server.lua_time_limit = <a href='../S/32.html#L269' title='Defined at 269 in src/redis.h.'>REDIS_LUA_TIME_LIMIT</a>;
<a name='L1143'>    server.lua_client = NULL;
<a name='L1144'>    server.lua_timedout = 0;
<a name='L1145'>
<a name='L1146'>    <a href='../S/35.html#L684' title='Defined at 684 in src/redis.c.'>updateLRUClock</a>();
<a name='L1147'>    <a href='../S/96.html#L51' title='Defined at 51 in src/config.c.'>resetServerSaveParams</a>();
<a name='L1148'>
<a name='L1149'>    <a href='../S/96.html#L44' title='Defined at 44 in src/config.c.'>appendServerSaveParams</a>(60*60,1);  <i><font color='green'>/* save after 1 hour and 1 change */</font></i>
<a name='L1150'>    <a href='../S/96.html#L44' title='Defined at 44 in src/config.c.'>appendServerSaveParams</a>(300,100);  <i><font color='green'>/* save after 5 minutes and 100 changes */</font></i>
<a name='L1151'>    <a href='../S/96.html#L44' title='Defined at 44 in src/config.c.'>appendServerSaveParams</a>(60,10000); <i><font color='green'>/* save after 1 minute and 10000 changes */</font></i>
<a name='L1152'>    <i><font color='green'>/* Replication related */</font></i>
<a name='L1153'>    server.masterauth = NULL;
<a name='L1154'>    server.masterhost = NULL;
<a name='L1155'>    server.masterport = 6379;
<a name='L1156'>    server.master = NULL;
<a name='L1157'>    server.repl_state = <a href='../S/32.html#L199' title='Defined at 199 in src/redis.h.'>REDIS_REPL_NONE</a>;
<a name='L1158'>    server.repl_syncio_timeout = <a href='../S/32.html#L207' title='Defined at 207 in src/redis.h.'>REDIS_REPL_SYNCIO_TIMEOUT</a>;
<a name='L1159'>    server.repl_serve_stale_data = 1;
<a name='L1160'>    server.repl_slave_ro = 1;
<a name='L1161'>    server.repl_down_since = time(NULL);
<a name='L1162'>    server.slave_priority = <a href='../S/32.html#L89' title='Defined at 89 in src/redis.h.'>REDIS_DEFAULT_SLAVE_PRIORITY</a>;
<a name='L1163'>
<a name='L1164'>    <i><font color='green'>/* Client output buffer limits */</font></i>
<a name='L1165'>    server.client_obuf_limits[<a href='../S/32.html#L193' title='Defined at 193 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_NORMAL</a>].hard_limit_bytes = 0;
<a name='L1166'>    server.client_obuf_limits[<a href='../S/32.html#L193' title='Defined at 193 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_NORMAL</a>].soft_limit_bytes = 0;
<a name='L1167'>    server.client_obuf_limits[<a href='../S/32.html#L193' title='Defined at 193 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_NORMAL</a>].soft_limit_seconds = 0;
<a name='L1168'>    server.client_obuf_limits[<a href='../S/32.html#L194' title='Defined at 194 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_SLAVE</a>].hard_limit_bytes = 1024*1024*256;
<a name='L1169'>    server.client_obuf_limits[<a href='../S/32.html#L194' title='Defined at 194 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_SLAVE</a>].soft_limit_bytes = 1024*1024*64;
<a name='L1170'>    server.client_obuf_limits[<a href='../S/32.html#L194' title='Defined at 194 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_SLAVE</a>].soft_limit_seconds = 60;
<a name='L1171'>    server.client_obuf_limits[<a href='../S/32.html#L195' title='Defined at 195 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_PUBSUB</a>].hard_limit_bytes = 1024*1024*32;
<a name='L1172'>    server.client_obuf_limits[<a href='../S/32.html#L195' title='Defined at 195 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_PUBSUB</a>].soft_limit_bytes = 1024*1024*8;
<a name='L1173'>    server.client_obuf_limits[<a href='../S/32.html#L195' title='Defined at 195 in src/redis.h.'>REDIS_CLIENT_LIMIT_CLASS_PUBSUB</a>].soft_limit_seconds = 60;
<a name='L1174'>
<a name='L1175'>    <i><font color='green'>/* Double constants initialization */</font></i>
<a name='L1176'>    R_Zero = 0.0;
<a name='L1177'>    R_PosInf = 1.0/R_Zero;
<a name='L1178'>    R_NegInf = -1.0/R_Zero;
<a name='L1179'>    R_Nan = R_Zero/R_Zero;
<a name='L1180'>
<a name='L1181'>    <i><font color='green'>/* Command table -- we intiialize it here as it is part of the</font></i>
<a name='L1182'><i><font color='green'>     * initial configuration, since command names may be changed via</font></i>
<a name='L1183'><i><font color='green'>     * redis.conf using the rename-command directive. */</font></i>
<a name='L1184'>    server.commands = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;commandTableDictType,NULL);
<a name='L1185'>    <a href='../S/35.html#L1364' title='Defined at 1364 in src/redis.c.'>populateCommandTable</a>();
<a name='L1186'>    server.<a href='../S/31.html#L235' title='Defined at 235 in src/db.c.'>delCommand</a> = <a href='../S/35.html#L1452' title='Defined at 1452 in src/redis.c.'>lookupCommandByCString</a>("del");
<a name='L1187'>    server.<a href='../S/81.html#L86' title='Defined at 86 in src/multi.c.'>multiCommand</a> = <a href='../S/35.html#L1452' title='Defined at 1452 in src/redis.c.'>lookupCommandByCString</a>("multi");
<a name='L1188'>    server.<a href='../S/60.html#L323' title='Defined at 323 in src/t_list.c.'>lpushCommand</a> = <a href='../S/35.html#L1452' title='Defined at 1452 in src/redis.c.'>lookupCommandByCString</a>("lpush");
<a name='L1189'>    server.<a href='../S/60.html#L507' title='Defined at 507 in src/t_list.c.'>lpopCommand</a> = <a href='../S/35.html#L1452' title='Defined at 1452 in src/redis.c.'>lookupCommandByCString</a>("lpop");
<a name='L1190'>    server.<a href='../S/60.html#L511' title='Defined at 511 in src/t_list.c.'>rpopCommand</a> = <a href='../S/35.html#L1452' title='Defined at 1452 in src/redis.c.'>lookupCommandByCString</a>("rpop");
<a name='L1191'>    
<a name='L1192'>    <i><font color='green'>/* Slow log */</font></i>
<a name='L1193'>    server.slowlog_log_slower_than = <a href='../S/32.html#L85' title='Defined at 85 in src/redis.h.'>REDIS_SLOWLOG_LOG_SLOWER_THAN</a>;
<a name='L1194'>    server.slowlog_max_len = <a href='../S/32.html#L86' title='Defined at 86 in src/redis.h.'>REDIS_SLOWLOG_MAX_LEN</a>;
<a name='L1195'>
<a name='L1196'>    <i><font color='green'>/* Debugging */</font></i>
<a name='L1197'>    server.assert_failed = "&lt;no assertion failed&gt;";
<a name='L1198'>    server.assert_file = "&lt;no file&gt;";
<a name='L1199'>    server.assert_line = 0;
<a name='L1200'>    server.bug_report_start = 0;
<a name='L1201'>    server.watchdog_period = 0;
<a name='L1202'><font color='red'>}</font>
<a name='L1203'>
<a name='L1204'><i><font color='green'>/* This function will try to raise the max number of open files accordingly to</font></i>
<a name='L1205'><i><font color='green'> * the configured max number of clients. It will also account for 32 additional</font></i>
<a name='L1206'><i><font color='green'> * file descriptors as we need a few more for persistence, listening</font></i>
<a name='L1207'><i><font color='green'> * sockets, log files and so forth.</font></i>
<a name='L1208'><i><font color='green'> *</font></i>
<a name='L1209'><i><font color='green'> * If it will not be possible to set the limit accordingly to the configured</font></i>
<a name='L1210'><i><font color='green'> * max number of clients, the function will do the reverse setting</font></i>
<a name='L1211'><i><font color='green'> * server.maxclients to the value that we can actually handle. */</font></i>
<a name='L1212'><b>void</b> <a href='../S/35.html#L1269' title='Refered from 1269 in src/redis.c.'>adjustOpenFilesLimit</a>(<b>void</b>) <font color='red'>{</font>
<a name='L1213'>    rlim_t maxfiles = server.maxclients+32;
<a name='L1214'>    <b>struct</b> rlimit limit;
<a name='L1215'>
<a name='L1216'>    <b>if</b> (getrlimit(RLIMIT_NOFILE,&amp;limit) == -1) <font color='red'>{</font>
<a name='L1217'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Unable to obtain the current NOFILE limit (%s), assuming 1024 and setting the max clients configuration accordingly.",
<a name='L1218'>            strerror(errno));
<a name='L1219'>        server.maxclients = 1024-32;
<a name='L1220'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1221'>        rlim_t oldlimit = limit.rlim_cur;
<a name='L1222'>
<a name='L1223'>        <i><font color='green'>/* Set the max number of files if the current limit is not enough</font></i>
<a name='L1224'><i><font color='green'>         * for our needs. */</font></i>
<a name='L1225'>        <b>if</b> (oldlimit &lt; maxfiles) <font color='red'>{</font>
<a name='L1226'>            rlim_t f;
<a name='L1227'>            
<a name='L1228'>            f = maxfiles;
<a name='L1229'>            <b>while</b>(f &gt; oldlimit) <font color='red'>{</font>
<a name='L1230'>                limit.rlim_cur = f;
<a name='L1231'>                limit.rlim_max = f;
<a name='L1232'>                <b>if</b> (setrlimit(RLIMIT_NOFILE,&amp;limit) != -1) <b>break</b>;
<a name='L1233'>                f -= 128;
<a name='L1234'>            <font color='red'>}</font>
<a name='L1235'>            <b>if</b> (f &lt; oldlimit) f = oldlimit;
<a name='L1236'>            <b>if</b> (f != maxfiles) <font color='red'>{</font>
<a name='L1237'>                server.maxclients = f-32;
<a name='L1238'>                <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Unable to set the max number of files limit to %d (%s), setting the max clients configuration to %d.",
<a name='L1239'>                    (<b>int</b>) maxfiles, strerror(errno), (<b>int</b>) server.maxclients);
<a name='L1240'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1241'>                <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"Max number of open files set to %d",
<a name='L1242'>                    (<b>int</b>) maxfiles);
<a name='L1243'>            <font color='red'>}</font>
<a name='L1244'>        <font color='red'>}</font>
<a name='L1245'>    <font color='red'>}</font>
<a name='L1246'><font color='red'>}</font>
<a name='L1247'>
<a name='L1248'><b>void</b> <a href='../S/35.html#L2598' title='Refered from 2598 in src/redis.c.'>initServer</a>() <font color='red'>{</font>
<a name='L1249'>    <b>int</b> j;
<a name='L1250'>
<a name='L1251'>    signal(SIGHUP, SIG_IGN);
<a name='L1252'>    signal(SIGPIPE, SIG_IGN);
<a name='L1253'>    <a href='../S/35.html#L2472' title='Defined at 2472 in src/redis.c.'>setupSignalHandlers</a>();
<a name='L1254'>
<a name='L1255'>    <b>if</b> (server.syslog_enabled) <font color='red'>{</font>
<a name='L1256'>        openlog(server.syslog_ident, LOG_PID | LOG_NDELAY | LOG_NOWAIT,
<a name='L1257'>            server.syslog_facility);
<a name='L1258'>    <font color='red'>}</font>
<a name='L1259'>
<a name='L1260'>    server.current_client = NULL;
<a name='L1261'>    server.clients = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L1262'>    server.clients_to_close = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L1263'>    server.slaves = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L1264'>    server.monitors = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L1265'>    server.unblocked_clients = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L1266'>    server.ready_keys = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L1267'>
<a name='L1268'>    <a href='../S/35.html#L1012' title='Defined at 1012 in src/redis.c.'>createSharedObjects</a>();
<a name='L1269'>    <a href='../S/35.html#L1212' title='Defined at 1212 in src/redis.c.'>adjustOpenFilesLimit</a>();
<a name='L1270'>    server.el = <a href='../S/36.html#L62' title='Defined at 62 in src/ae.c.'>aeCreateEventLoop</a>(server.maxclients+1024);
<a name='L1271'>    server.db = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(<a href='../D/3798.html' title='Multiple defined in 2 places.'>redisDb</a>)*server.dbnum);
<a name='L1272'>
<a name='L1273'>    <b>if</b> (server.port != 0) <font color='red'>{</font>
<a name='L1274'>        server.ipfd = <a href='../S/50.html#L277' title='Defined at 277 in src/anet.c.'>anetTcpServer</a>(server.neterr,server.port,server.bindaddr);
<a name='L1275'>        <b>if</b> (server.ipfd == <a href='../S/84.html#L35' title='Defined at 35 in src/anet.h.'>ANET_ERR</a>) <font color='red'>{</font>
<a name='L1276'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>, "Opening port %d: %s",
<a name='L1277'>                server.port, server.neterr);
<a name='L1278'>            exit(1);
<a name='L1279'>        <font color='red'>}</font>
<a name='L1280'>    <font color='red'>}</font>
<a name='L1281'>    <b>if</b> (server.unixsocket != NULL) <font color='red'>{</font>
<a name='L1282'>        unlink(server.unixsocket); <i><font color='green'>/* don't care if this fails */</font></i>
<a name='L1283'>        server.sofd = <a href='../S/50.html#L299' title='Defined at 299 in src/anet.c.'>anetUnixServer</a>(server.neterr,server.unixsocket,server.unixsocketperm);
<a name='L1284'>        <b>if</b> (server.sofd == <a href='../S/84.html#L35' title='Defined at 35 in src/anet.h.'>ANET_ERR</a>) <font color='red'>{</font>
<a name='L1285'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>, "Opening socket: %s", server.neterr);
<a name='L1286'>            exit(1);
<a name='L1287'>        <font color='red'>}</font>
<a name='L1288'>    <font color='red'>}</font>
<a name='L1289'>    <b>if</b> (server.ipfd &lt; 0 &amp;&amp; server.sofd &lt; 0) <font color='red'>{</font>
<a name='L1290'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>, "Configured to not listen anywhere, exiting.");
<a name='L1291'>        exit(1);
<a name='L1292'>    <font color='red'>}</font>
<a name='L1293'>    <b>for</b> (j = 0; j &lt; server.dbnum; j++) <font color='red'>{</font>
<a name='L1294'>        server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a> = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;dbDictType,NULL);
<a name='L1295'>        server.db[j].expires = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;keyptrDictType,NULL);
<a name='L1296'>        server.db[j].blocking_keys = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;keylistDictType,NULL);
<a name='L1297'>        server.db[j].ready_keys = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;setDictType,NULL);
<a name='L1298'>        server.db[j].watched_keys = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;keylistDictType,NULL);
<a name='L1299'>        server.db[j].id = j;
<a name='L1300'>    <font color='red'>}</font>
<a name='L1301'>    server.pubsub_channels = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;keylistDictType,NULL);
<a name='L1302'>    server.pubsub_patterns = <a href='../S/54.html#L41' title='Defined at 41 in src/adlist.c.'>listCreate</a>();
<a name='L1303'>    <a href='../S/58.html#L65' title='Defined at 65 in src/adlist.h.'>listSetFreeMethod</a>(server.pubsub_patterns,<a href='../S/46.html#L36' title='Defined at 36 in src/pubsub.c.'>freePubsubPattern</a>);
<a name='L1304'>    <a href='../S/58.html#L66' title='Defined at 66 in src/adlist.h.'>listSetMatchMethod</a>(server.pubsub_patterns,<a href='../S/46.html#L43' title='Defined at 43 in src/pubsub.c.'>listMatchPubsubPattern</a>);
<a name='L1305'>    server.cronloops = 0;
<a name='L1306'>    server.rdb_child_pid = -1;
<a name='L1307'>    server.aof_child_pid = -1;
<a name='L1308'>    <a href='../S/62.html#L68' title='Defined at 68 in src/aof.c.'>aofRewriteBufferReset</a>();
<a name='L1309'>    server.aof_buf = <a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>();
<a name='L1310'>    server.lastsave = time(NULL);
<a name='L1311'>    server.rdb_save_time_last = -1;
<a name='L1312'>    server.rdb_save_time_start = -1;
<a name='L1313'>    server.dirty = 0;
<a name='L1314'>    server.stat_numcommands = 0;
<a name='L1315'>    server.stat_numconnections = 0;
<a name='L1316'>    server.stat_expiredkeys = 0;
<a name='L1317'>    server.stat_evictedkeys = 0;
<a name='L1318'>    server.stat_starttime = time(NULL);
<a name='L1319'>    server.stat_keyspace_misses = 0;
<a name='L1320'>    server.stat_keyspace_hits = 0;
<a name='L1321'>    server.stat_peak_memory = 0;
<a name='L1322'>    server.stat_fork_time = 0;
<a name='L1323'>    server.stat_rejected_conn = 0;
<a name='L1324'>    memset(server.ops_sec_samples,0,<b>sizeof</b>(server.ops_sec_samples));
<a name='L1325'>    server.ops_sec_idx = 0;
<a name='L1326'>    server.ops_sec_last_sample_time = <a href='../D/3402.html' title='Multiple defined in 3 places.'>mstime</a>();
<a name='L1327'>    server.ops_sec_last_sample_ops = 0;
<a name='L1328'>    server.unixtime = time(NULL);
<a name='L1329'>    server.lastbgsave_status = <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1330'>    server.stop_writes_on_bgsave_err = 1;
<a name='L1331'>    <a href='../S/36.html#L169' title='Defined at 169 in src/ae.c.'>aeCreateTimeEvent</a>(server.el, 1, <a href='../S/35.html#L812' title='Defined at 812 in src/redis.c.'>serverCron</a>, NULL, NULL);
<a name='L1332'>    <b>if</b> (server.ipfd &gt; 0 &amp;&amp; <a href='../S/36.html#L104' title='Defined at 104 in src/ae.c.'>aeCreateFileEvent</a>(server.el,server.ipfd,<a href='../S/38.html#L40' title='Defined at 40 in src/ae.h.'>AE_READABLE</a>,
<a name='L1333'>        <a href='../S/86.html#L543' title='Defined at 543 in src/networking.c.'>acceptTcpHandler</a>,NULL) == <a href='../S/38.html#L37' title='Defined at 37 in src/ae.h.'>AE_ERR</a>) <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unrecoverable error creating server.ipfd file event.");
<a name='L1334'>    <b>if</b> (server.sofd &gt; 0 &amp;&amp; <a href='../S/36.html#L104' title='Defined at 104 in src/ae.c.'>aeCreateFileEvent</a>(server.el,server.sofd,<a href='../S/38.html#L40' title='Defined at 40 in src/ae.h.'>AE_READABLE</a>,
<a name='L1335'>        <a href='../S/86.html#L559' title='Defined at 559 in src/networking.c.'>acceptUnixHandler</a>,NULL) == <a href='../S/38.html#L37' title='Defined at 37 in src/ae.h.'>AE_ERR</a>) <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unrecoverable error creating server.sofd file event.");
<a name='L1336'>
<a name='L1337'>    <b>if</b> (server.aof_state == <a href='../S/32.html#L168' title='Defined at 168 in src/redis.h.'>REDIS_AOF_ON</a>) <font color='red'>{</font>
<a name='L1338'>        server.aof_fd = open(server.aof_filename,
<a name='L1339'>                               O_WRONLY|O_APPEND|O_CREAT,0644);
<a name='L1340'>        <b>if</b> (server.aof_fd == -1) <font color='red'>{</font>
<a name='L1341'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>, "Can't open the append-only file: %s",
<a name='L1342'>                strerror(errno));
<a name='L1343'>            exit(1);
<a name='L1344'>        <font color='red'>}</font>
<a name='L1345'>    <font color='red'>}</font>
<a name='L1346'>
<a name='L1347'>    <i><font color='green'>/* 32 bit instances are limited to 4GB of address space, so if there is</font></i>
<a name='L1348'><i><font color='green'>     * no explicit limit in the user provided configuration we set a limit</font></i>
<a name='L1349'><i><font color='green'>     * at 3 GB using maxmemory with 'noeviction' policy'. This avoids</font></i>
<a name='L1350'><i><font color='green'>     * useless crashes of the Redis instance for out of memory. */</font></i>
<a name='L1351'>    <b>if</b> (server.arch_bits == 32 &amp;&amp; server.maxmemory == 0) <font color='red'>{</font>
<a name='L1352'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Warning: 32 bit instance detected but no memory limit set. Setting 3 GB maxmemory limit with 'noeviction' policy now.");
<a name='L1353'>        server.maxmemory = 3072LL*(1024*1024); <i><font color='green'>/* 3 GB */</font></i>
<a name='L1354'>        server.maxmemory_policy = <a href='../S/32.html#L266' title='Defined at 266 in src/redis.h.'>REDIS_MAXMEMORY_NO_EVICTION</a>;
<a name='L1355'>    <font color='red'>}</font>
<a name='L1356'>
<a name='L1357'>    <a href='../S/75.html#L526' title='Defined at 526 in src/scripting.c.'>scriptingInit</a>();
<a name='L1358'>    <a href='../S/70.html#L103' title='Defined at 103 in src/slowlog.c.'>slowlogInit</a>();
<a name='L1359'>    <a href='../S/25.html#L91' title='Defined at 91 in src/bio.c.'>bioInit</a>();
<a name='L1360'><font color='red'>}</font>
<a name='L1361'>
<a name='L1362'><i><font color='green'>/* Populates the Redis Command Table starting from the hard coded list</font></i>
<a name='L1363'><i><font color='green'> * we have on top of redis.c file. */</font></i>
<a name='L1364'><b>void</b> <a href='../R/3152.html' title='Multiple refered from 2 places.'>populateCommandTable</a>(<b>void</b>) <font color='red'>{</font>
<a name='L1365'>    <b>int</b> j;
<a name='L1366'>    <b>int</b> numcommands = <b>sizeof</b>(redisCommandTable)/<b>sizeof</b>(<b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a>);
<a name='L1367'>
<a name='L1368'>    <b>for</b> (j = 0; j &lt; numcommands; j++) <font color='red'>{</font>
<a name='L1369'>        <b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> *c = redisCommandTable+j;
<a name='L1370'>        <b>char</b> *f = c-&gt;sflags;
<a name='L1371'>        <b>int</b> retval;
<a name='L1372'>
<a name='L1373'>        <b>while</b>(*f != '\0') <font color='red'>{</font>
<a name='L1374'>            <b>switch</b>(*f) <font color='red'>{</font>
<a name='L1375'>            <b>case</b> 'w': c-&gt;flags |= <a href='../S/32.html#L107' title='Defined at 107 in src/redis.h.'>REDIS_CMD_WRITE</a>; <b>break</b>;
<a name='L1376'>            <b>case</b> 'r': c-&gt;flags |= <a href='../S/32.html#L108' title='Defined at 108 in src/redis.h.'>REDIS_CMD_READONLY</a>; <b>break</b>;
<a name='L1377'>            <b>case</b> 'm': c-&gt;flags |= <a href='../S/32.html#L109' title='Defined at 109 in src/redis.h.'>REDIS_CMD_DENYOOM</a>; <b>break</b>;
<a name='L1378'>            <b>case</b> 'a': c-&gt;flags |= <a href='../S/32.html#L111' title='Defined at 111 in src/redis.h.'>REDIS_CMD_ADMIN</a>; <b>break</b>;
<a name='L1379'>            <b>case</b> 'p': c-&gt;flags |= <a href='../S/32.html#L112' title='Defined at 112 in src/redis.h.'>REDIS_CMD_PUBSUB</a>; <b>break</b>;
<a name='L1380'>            <b>case</b> 'f': c-&gt;flags |= <a href='../S/32.html#L110' title='Defined at 110 in src/redis.h.'>REDIS_CMD_FORCE_REPLICATION</a>; <b>break</b>;
<a name='L1381'>            <b>case</b> 's': c-&gt;flags |= <a href='../S/32.html#L113' title='Defined at 113 in src/redis.h.'>REDIS_CMD_NOSCRIPT</a>; <b>break</b>;
<a name='L1382'>            <b>case</b> 'R': c-&gt;flags |= <a href='../S/32.html#L114' title='Defined at 114 in src/redis.h.'>REDIS_CMD_RANDOM</a>; <b>break</b>;
<a name='L1383'>            <b>case</b> 'S': c-&gt;flags |= <a href='../S/32.html#L115' title='Defined at 115 in src/redis.h.'>REDIS_CMD_SORT_FOR_SCRIPT</a>; <b>break</b>;
<a name='L1384'>            <b>case</b> 'l': c-&gt;flags |= <a href='../S/32.html#L116' title='Defined at 116 in src/redis.h.'>REDIS_CMD_LOADING</a>; <b>break</b>;
<a name='L1385'>            <b>case</b> 't': c-&gt;flags |= <a href='../S/32.html#L117' title='Defined at 117 in src/redis.h.'>REDIS_CMD_STALE</a>; <b>break</b>;
<a name='L1386'>            <b>case</b> 'M': c-&gt;flags |= <a href='../S/32.html#L118' title='Defined at 118 in src/redis.h.'>REDIS_CMD_SKIP_MONITOR</a>; <b>break</b>;
<a name='L1387'>            <b>default</b>: <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported command flag"); <b>break</b>;
<a name='L1388'>            <font color='red'>}</font>
<a name='L1389'>            f++;
<a name='L1390'>        <font color='red'>}</font>
<a name='L1391'>
<a name='L1392'>        retval = <a href='../D/2061.html' title='Multiple defined in 2 places.'>dictAdd</a>(server.commands, <a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(c-&gt;name), c);
<a name='L1393'>        <a href='../D/1684.html' title='Multiple defined in 3 places.'>assert</a>(retval == <a href='../D/124.html' title='Multiple defined in 2 places.'>DICT_OK</a>);
<a name='L1394'>    <font color='red'>}</font>
<a name='L1395'><font color='red'>}</font>
<a name='L1396'>
<a name='L1397'><b>void</b> <a href='../R/3537.html' title='Multiple refered from 2 places.'>resetCommandTableStats</a>(<b>void</b>) <font color='red'>{</font>
<a name='L1398'>    <b>int</b> numcommands = <b>sizeof</b>(redisCommandTable)/<b>sizeof</b>(<b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a>);
<a name='L1399'>    <b>int</b> j;
<a name='L1400'>
<a name='L1401'>    <b>for</b> (j = 0; j &lt; numcommands; j++) <font color='red'>{</font>
<a name='L1402'>        <b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> *c = redisCommandTable+j;
<a name='L1403'>
<a name='L1404'>        c-&gt;microseconds = 0;
<a name='L1405'>        c-&gt;calls = 0;
<a name='L1406'>    <font color='red'>}</font>
<a name='L1407'><font color='red'>}</font>
<a name='L1408'>
<a name='L1409'><i><font color='green'>/* ========================== Redis OP Array API ============================ */</font></i>
<a name='L1410'>
<a name='L1411'><b>void</b> <a href='../S/35.html#L1500' title='Refered from 1500 in src/redis.c.'>redisOpArrayInit</a>(redisOpArray *oa) <font color='red'>{</font>
<a name='L1412'>    oa-&gt;ops = NULL;
<a name='L1413'>    oa-&gt;numops = 0;
<a name='L1414'><font color='red'>}</font>
<a name='L1415'>
<a name='L1416'><b>int</b> <a href='../S/35.html#L1483' title='Refered from 1483 in src/redis.c.'>redisOpArrayAppend</a>(redisOpArray *oa, <b>struct</b> redisCommand *cmd, <b>int</b> dbid,
<a name='L1417'>                       robj **argv, <b>int</b> argc, <b>int</b> target)
<a name='L1418'><font color='red'>{</font>
<a name='L1419'>    <a href='../D/3835.html' title='Multiple defined in 2 places.'>redisOp</a> *op;
<a name='L1420'>
<a name='L1421'>    oa-&gt;ops = <a href='../S/39.html#L149' title='Defined at 149 in src/zmalloc.c.'>zrealloc</a>(oa-&gt;ops,<b>sizeof</b>(<a href='../D/3835.html' title='Multiple defined in 2 places.'>redisOp</a>)*(oa-&gt;numops+1));
<a name='L1422'>    op = oa-&gt;ops+oa-&gt;numops;
<a name='L1423'>    op-&gt;cmd = cmd;
<a name='L1424'>    op-&gt;dbid = dbid;
<a name='L1425'>    op-&gt;argv = argv;
<a name='L1426'>    op-&gt;argc = argc;
<a name='L1427'>    op-&gt;target = target;
<a name='L1428'>    oa-&gt;numops++;
<a name='L1429'>    <b>return</b> oa-&gt;numops;
<a name='L1430'><font color='red'>}</font>
<a name='L1431'>
<a name='L1432'><b>void</b> <a href='../S/35.html#L1541' title='Refered from 1541 in src/redis.c.'>redisOpArrayFree</a>(redisOpArray *oa) <font color='red'>{</font>
<a name='L1433'>    <b>while</b>(oa-&gt;numops) <font color='red'>{</font>
<a name='L1434'>        <b>int</b> j;
<a name='L1435'>        <a href='../D/3835.html' title='Multiple defined in 2 places.'>redisOp</a> *op;
<a name='L1436'>
<a name='L1437'>        oa-&gt;numops--;
<a name='L1438'>        op = oa-&gt;ops+oa-&gt;numops;
<a name='L1439'>        <b>for</b> (j = 0; j &lt; op-&gt;argc; j++)
<a name='L1440'>            <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(op-&gt;argv[j]);
<a name='L1441'>        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(op-&gt;argv);
<a name='L1442'>    <font color='red'>}</font>
<a name='L1443'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(oa-&gt;ops);
<a name='L1444'><font color='red'>}</font>
<a name='L1445'>
<a name='L1446'><i><font color='green'>/* ====================== Commands lookup and execution ===================== */</font></i>
<a name='L1447'>
<a name='L1448'><b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> *<a href='../R/2465.html' title='Multiple refered from 7 places.'>lookupCommand</a>(sds name) <font color='red'>{</font>
<a name='L1449'>    <b>return</b> <a href='../S/29.html#L501' title='Defined at 501 in src/dict.c.'>dictFetchValue</a>(server.commands, name);
<a name='L1450'><font color='red'>}</font>
<a name='L1451'>
<a name='L1452'><b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> *<a href='../R/2466.html' title='Multiple refered from 6 places.'>lookupCommandByCString</a>(<b>char</b> *s) <font color='red'>{</font>
<a name='L1453'>    <b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> *cmd;
<a name='L1454'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> name = <a href='../D/4013.html' title='Multiple defined in 2 places.'>sdsnew</a>(s);
<a name='L1455'>
<a name='L1456'>    cmd = <a href='../S/29.html#L501' title='Defined at 501 in src/dict.c.'>dictFetchValue</a>(server.commands, name);
<a name='L1457'>    <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(name);
<a name='L1458'>    <b>return</b> cmd;
<a name='L1459'><font color='red'>}</font>
<a name='L1460'>
<a name='L1461'><i><font color='green'>/* Propagate the specified command (in the context of the specified database id)</font></i>
<a name='L1462'><i><font color='green'> * to AOF and Slaves.</font></i>
<a name='L1463'><i><font color='green'> *</font></i>
<a name='L1464'><i><font color='green'> * flags are an xor between:</font></i>
<a name='L1465'><i><font color='green'> * + REDIS_PROPAGATE_NONE (no propagation of command at all)</font></i>
<a name='L1466'><i><font color='green'> * + REDIS_PROPAGATE_AOF (propagate into the AOF file if is enabled)</font></i>
<a name='L1467'><i><font color='green'> * + REDIS_PROPAGATE_REPL (propagate into the replication link)</font></i>
<a name='L1468'><i><font color='green'> */</font></i>
<a name='L1469'><b>void</b> <a href='../R/3246.html' title='Multiple refered from 11 places.'>propagate</a>(<b>struct</b> redisCommand *cmd, <b>int</b> dbid, robj **argv, <b>int</b> argc,
<a name='L1470'>               <b>int</b> flags)
<a name='L1471'><font color='red'>{</font>
<a name='L1472'>    <b>if</b> (server.aof_state != <a href='../S/32.html#L167' title='Defined at 167 in src/redis.h.'>REDIS_AOF_OFF</a> &amp;&amp; flags &amp; <a href='../S/32.html#L289' title='Defined at 289 in src/redis.h.'>REDIS_PROPAGATE_AOF</a>)
<a name='L1473'>        <a href='../S/62.html#L384' title='Defined at 384 in src/aof.c.'>feedAppendOnlyFile</a>(cmd,dbid,argv,argc);
<a name='L1474'>    <b>if</b> (flags &amp; <a href='../S/32.html#L290' title='Defined at 290 in src/redis.h.'>REDIS_PROPAGATE_REPL</a> &amp;&amp; <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves))
<a name='L1475'>        <a href='../S/14.html#L42' title='Defined at 42 in src/replication.c.'>replicationFeedSlaves</a>(server.slaves,dbid,argv,argc);
<a name='L1476'><font color='red'>}</font>
<a name='L1477'>
<a name='L1478'><i><font color='green'>/* Used inside commands to schedule the propagation of additional commands</font></i>
<a name='L1479'><i><font color='green'> * after the current command is propagated to AOF / Replication. */</font></i>
<a name='L1480'><b>void</b> <a href='../S/32.html#L947' title='Refered from 947 in src/redis.h.'>alsoPropagate</a>(<b>struct</b> redisCommand *cmd, <b>int</b> dbid, robj **argv, <b>int</b> argc,
<a name='L1481'>                   <b>int</b> target)
<a name='L1482'><font color='red'>{</font>
<a name='L1483'>    <a href='../S/35.html#L1416' title='Defined at 1416 in src/redis.c.'>redisOpArrayAppend</a>(&amp;server.also_propagate,cmd,dbid,argv,argc,target);
<a name='L1484'><font color='red'>}</font>
<a name='L1485'>
<a name='L1486'><i><font color='green'>/* Call() is the core of Redis execution of a command */</font></i>
<a name='L1487'><b>void</b> <a href='../R/1512.html' title='Multiple refered from 4 places.'>call</a>(redisClient *c, <b>int</b> flags) <font color='red'>{</font>
<a name='L1488'>    <b>long</b> <b>long</b> dirty, start = <a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>(), duration;
<a name='L1489'>
<a name='L1490'>    <i><font color='green'>/* Sent the command to clients in MONITOR mode, only if the commands are</font></i>
<a name='L1491'><i><font color='green'>     * not geneated from reading an AOF. */</font></i>
<a name='L1492'>    <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.monitors) &amp;&amp;
<a name='L1493'>        !server.loading &amp;&amp;
<a name='L1494'>        !(c-&gt;cmd-&gt;flags &amp; <a href='../S/32.html#L118' title='Defined at 118 in src/redis.h.'>REDIS_CMD_SKIP_MONITOR</a>))
<a name='L1495'>    <font color='red'>{</font>
<a name='L1496'>        <a href='../S/14.html#L76' title='Defined at 76 in src/replication.c.'>replicationFeedMonitors</a>(c,server.monitors,c-&gt;db-&gt;id,c-&gt;argv,c-&gt;argc);
<a name='L1497'>    <font color='red'>}</font>
<a name='L1498'>
<a name='L1499'>    <i><font color='green'>/* Call the command. */</font></i>
<a name='L1500'>    <a href='../S/35.html#L1411' title='Defined at 1411 in src/redis.c.'>redisOpArrayInit</a>(&amp;server.also_propagate);
<a name='L1501'>    dirty = server.dirty;
<a name='L1502'>    c-&gt;cmd-&gt;proc(c);
<a name='L1503'>    dirty = server.dirty-dirty;
<a name='L1504'>    duration = <a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>()-start;
<a name='L1505'>
<a name='L1506'>    <i><font color='green'>/* When EVAL is called loading the AOF we don't want commands called</font></i>
<a name='L1507'><i><font color='green'>     * from Lua to go into the slowlog or to populate statistics. */</font></i>
<a name='L1508'>    <b>if</b> (server.loading &amp;&amp; c-&gt;flags &amp; <a href='../S/32.html#L181' title='Defined at 181 in src/redis.h.'>REDIS_LUA_CLIENT</a>)
<a name='L1509'>        flags &amp;= ~(<a href='../S/32.html#L282' title='Defined at 282 in src/redis.h.'>REDIS_CALL_SLOWLOG</a> | <a href='../S/32.html#L283' title='Defined at 283 in src/redis.h.'>REDIS_CALL_STATS</a>);
<a name='L1510'>
<a name='L1511'>    <i><font color='green'>/* Log the command into the Slow log if needed, and populate the</font></i>
<a name='L1512'><i><font color='green'>     * per-command statistics that we show in INFO commandstats. */</font></i>
<a name='L1513'>    <b>if</b> (flags &amp; <a href='../S/32.html#L282' title='Defined at 282 in src/redis.h.'>REDIS_CALL_SLOWLOG</a>)
<a name='L1514'>        <a href='../S/70.html#L112' title='Defined at 112 in src/slowlog.c.'>slowlogPushEntryIfNeeded</a>(c-&gt;argv,c-&gt;argc,duration);
<a name='L1515'>    <b>if</b> (flags &amp; <a href='../S/32.html#L283' title='Defined at 283 in src/redis.h.'>REDIS_CALL_STATS</a>) <font color='red'>{</font>
<a name='L1516'>        c-&gt;cmd-&gt;microseconds += duration;
<a name='L1517'>        c-&gt;cmd-&gt;calls++;
<a name='L1518'>    <font color='red'>}</font>
<a name='L1519'>
<a name='L1520'>    <i><font color='green'>/* Propagate the command into the AOF and replication link */</font></i>
<a name='L1521'>    <b>if</b> (flags &amp; <a href='../S/32.html#L284' title='Defined at 284 in src/redis.h.'>REDIS_CALL_PROPAGATE</a>) <font color='red'>{</font>
<a name='L1522'>        <b>int</b> flags = <a href='../S/32.html#L288' title='Defined at 288 in src/redis.h.'>REDIS_PROPAGATE_NONE</a>;
<a name='L1523'>
<a name='L1524'>        <b>if</b> (c-&gt;cmd-&gt;flags &amp; <a href='../S/32.html#L110' title='Defined at 110 in src/redis.h.'>REDIS_CMD_FORCE_REPLICATION</a>)
<a name='L1525'>            flags |= <a href='../S/32.html#L290' title='Defined at 290 in src/redis.h.'>REDIS_PROPAGATE_REPL</a>;
<a name='L1526'>        <b>if</b> (dirty)
<a name='L1527'>            flags |= (<a href='../S/32.html#L290' title='Defined at 290 in src/redis.h.'>REDIS_PROPAGATE_REPL</a> | <a href='../S/32.html#L289' title='Defined at 289 in src/redis.h.'>REDIS_PROPAGATE_AOF</a>);
<a name='L1528'>        <b>if</b> (flags != <a href='../S/32.html#L288' title='Defined at 288 in src/redis.h.'>REDIS_PROPAGATE_NONE</a>)
<a name='L1529'>            <a href='../S/35.html#L1469' title='Defined at 1469 in src/redis.c.'>propagate</a>(c-&gt;cmd,c-&gt;db-&gt;id,c-&gt;argv,c-&gt;argc,flags);
<a name='L1530'>    <font color='red'>}</font>
<a name='L1531'>    <i><font color='green'>/* Commands such as LPUSH or BRPOPLPUSH may propagate an additional</font></i>
<a name='L1532'><i><font color='green'>     * PUSH command. */</font></i>
<a name='L1533'>    <b>if</b> (server.also_propagate.numops) <font color='red'>{</font>
<a name='L1534'>        <b>int</b> j;
<a name='L1535'>        <a href='../D/3835.html' title='Multiple defined in 2 places.'>redisOp</a> *rop;
<a name='L1536'>
<a name='L1537'>        <b>for</b> (j = 0; j &lt; server.also_propagate.numops; j++) <font color='red'>{</font>
<a name='L1538'>            rop = &amp;server.also_propagate.ops[j];
<a name='L1539'>            <a href='../S/35.html#L1469' title='Defined at 1469 in src/redis.c.'>propagate</a>(rop-&gt;cmd, rop-&gt;dbid, rop-&gt;argv, rop-&gt;argc, rop-&gt;target);
<a name='L1540'>        <font color='red'>}</font>
<a name='L1541'>        <a href='../S/35.html#L1432' title='Defined at 1432 in src/redis.c.'>redisOpArrayFree</a>(&amp;server.also_propagate);
<a name='L1542'>    <font color='red'>}</font>
<a name='L1543'>    server.stat_numcommands++;
<a name='L1544'><font color='red'>}</font>
<a name='L1545'>
<a name='L1546'><i><font color='green'>/* If this function gets called we already read a whole</font></i>
<a name='L1547'><i><font color='green'> * command, arguments are in the client argv/argc fields.</font></i>
<a name='L1548'><i><font color='green'> * processCommand() execute the command or prepare the</font></i>
<a name='L1549'><i><font color='green'> * server for a bulk read from the client.</font></i>
<a name='L1550'><i><font color='green'> *</font></i>
<a name='L1551'><i><font color='green'> * If 1 is returned the client is still alive and valid and</font></i>
<a name='L1552'><i><font color='green'> * and other operations can be performed by the caller. Otherwise</font></i>
<a name='L1553'><i><font color='green'> * if 0 is returned the client was destroied (i.e. after QUIT). */</font></i>
<a name='L1554'><b>int</b> <a href='../R/3174.html' title='Multiple refered from 2 places.'>processCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1555'>    <i><font color='green'>/* The QUIT command is handled separately. Normal command procs will</font></i>
<a name='L1556'><i><font color='green'>     * go through checking for replication and QUIT will cause trouble</font></i>
<a name='L1557'><i><font color='green'>     * when FORCE_REPLICATION is enabled and would be implemented in</font></i>
<a name='L1558'><i><font color='green'>     * a regular command proc. */</font></i>
<a name='L1559'>    <b>if</b> (!strcasecmp(c-&gt;argv[0]-&gt;ptr,"quit")) <font color='red'>{</font>
<a name='L1560'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a>);
<a name='L1561'>        c-&gt;flags |= <a href='../S/32.html#L178' title='Defined at 178 in src/redis.h.'>REDIS_CLOSE_AFTER_REPLY</a>;
<a name='L1562'>        <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L1563'>    <font color='red'>}</font>
<a name='L1564'>
<a name='L1565'>    <i><font color='green'>/* Now lookup the command and check ASAP about trivial error conditions</font></i>
<a name='L1566'><i><font color='green'>     * such as wrong arity, bad command name and so forth. */</font></i>
<a name='L1567'>    c-&gt;cmd = c-&gt;lastcmd = <a href='../S/35.html#L1448' title='Defined at 1448 in src/redis.c.'>lookupCommand</a>(c-&gt;argv[0]-&gt;ptr);
<a name='L1568'>    <b>if</b> (!c-&gt;cmd) <font color='red'>{</font>
<a name='L1569'>        <a href='../S/81.html#L81' title='Defined at 81 in src/multi.c.'>flagTransaction</a>(c);
<a name='L1570'>        <a href='../S/86.html#L334' title='Defined at 334 in src/networking.c.'>addReplyErrorFormat</a>(c,"unknown command '%s'",
<a name='L1571'>            (<b>char</b>*)c-&gt;argv[0]-&gt;ptr);
<a name='L1572'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1573'>    <font color='red'>}</font> <b>else</b> <b>if</b> ((c-&gt;cmd-&gt;arity &gt; 0 &amp;&amp; c-&gt;cmd-&gt;arity != c-&gt;argc) ||
<a name='L1574'>               (c-&gt;argc &lt; -c-&gt;cmd-&gt;arity)) <font color='red'>{</font>
<a name='L1575'>        <a href='../S/81.html#L81' title='Defined at 81 in src/multi.c.'>flagTransaction</a>(c);
<a name='L1576'>        <a href='../S/86.html#L334' title='Defined at 334 in src/networking.c.'>addReplyErrorFormat</a>(c,"wrong number of arguments for '%s' command",
<a name='L1577'>            c-&gt;cmd-&gt;name);
<a name='L1578'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1579'>    <font color='red'>}</font>
<a name='L1580'>
<a name='L1581'>    <i><font color='green'>/* Check if the user is authenticated */</font></i>
<a name='L1582'>    <b>if</b> (server.requirepass &amp;&amp; !c-&gt;authenticated &amp;&amp; c-&gt;cmd-&gt;proc != <a href='../S/35.html#L1783' title='Defined at 1783 in src/redis.c.'>authCommand</a>)
<a name='L1583'>    <font color='red'>{</font>
<a name='L1584'>        <a href='../S/81.html#L81' title='Defined at 81 in src/multi.c.'>flagTransaction</a>(c);
<a name='L1585'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"operation not permitted");
<a name='L1586'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1587'>    <font color='red'>}</font>
<a name='L1588'>
<a name='L1589'>    <i><font color='green'>/* Handle the maxmemory directive.</font></i>
<a name='L1590'><i><font color='green'>     *</font></i>
<a name='L1591'><i><font color='green'>     * First we try to free some memory if possible (if there are volatile</font></i>
<a name='L1592'><i><font color='green'>     * keys in the dataset). If there are not the only thing we can do</font></i>
<a name='L1593'><i><font color='green'>     * is returning an error. */</font></i>
<a name='L1594'>    <b>if</b> (server.maxmemory) <font color='red'>{</font>
<a name='L1595'>        <b>int</b> retval = <a href='../S/35.html#L2228' title='Defined at 2228 in src/redis.c.'>freeMemoryIfNeeded</a>();
<a name='L1596'>        <b>if</b> ((c-&gt;cmd-&gt;flags &amp; <a href='../S/32.html#L109' title='Defined at 109 in src/redis.h.'>REDIS_CMD_DENYOOM</a>) &amp;&amp; retval == <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>) <font color='red'>{</font>
<a name='L1597'>            <a href='../S/81.html#L81' title='Defined at 81 in src/multi.c.'>flagTransaction</a>(c);
<a name='L1598'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.oomerr);
<a name='L1599'>            <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1600'>        <font color='red'>}</font>
<a name='L1601'>    <font color='red'>}</font>
<a name='L1602'>
<a name='L1603'>    <i><font color='green'>/* Don't accept write commands if there are problems persisting on disk. */</font></i>
<a name='L1604'>    <b>if</b> (server.stop_writes_on_bgsave_err &amp;&amp;
<a name='L1605'>        server.saveparamslen &gt; 0
<a name='L1606'>        &amp;&amp; server.lastbgsave_status == <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a> &amp;&amp;
<a name='L1607'>        c-&gt;cmd-&gt;flags &amp; <a href='../S/32.html#L107' title='Defined at 107 in src/redis.h.'>REDIS_CMD_WRITE</a>)
<a name='L1608'>    <font color='red'>{</font>
<a name='L1609'>        <a href='../S/81.html#L81' title='Defined at 81 in src/multi.c.'>flagTransaction</a>(c);
<a name='L1610'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.bgsaveerr);
<a name='L1611'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1612'>    <font color='red'>}</font>
<a name='L1613'>
<a name='L1614'>    <i><font color='green'>/* Don't accept write commands if this is a read only slave. But</font></i>
<a name='L1615'><i><font color='green'>     * accept write commands if this is our master. */</font></i>
<a name='L1616'>    <b>if</b> (server.masterhost &amp;&amp; server.repl_slave_ro &amp;&amp;
<a name='L1617'>        !(c-&gt;flags &amp; <a href='../S/32.html#L173' title='Defined at 173 in src/redis.h.'>REDIS_MASTER</a>) &amp;&amp;
<a name='L1618'>        c-&gt;cmd-&gt;flags &amp; <a href='../S/32.html#L107' title='Defined at 107 in src/redis.h.'>REDIS_CMD_WRITE</a>)
<a name='L1619'>    <font color='red'>{</font>
<a name='L1620'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.roslaveerr);
<a name='L1621'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1622'>    <font color='red'>}</font>
<a name='L1623'>
<a name='L1624'>    <i><font color='green'>/* Only allow SUBSCRIBE and UNSUBSCRIBE in the context of Pub/Sub */</font></i>
<a name='L1625'>    <b>if</b> ((<a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(c-&gt;pubsub_channels) &gt; 0 || <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(c-&gt;pubsub_patterns) &gt; 0)
<a name='L1626'>        &amp;&amp;
<a name='L1627'>        c-&gt;cmd-&gt;proc != <a href='../S/46.html#L255' title='Defined at 255 in src/pubsub.c.'>subscribeCommand</a> &amp;&amp;
<a name='L1628'>        c-&gt;cmd-&gt;proc != <a href='../S/46.html#L262' title='Defined at 262 in src/pubsub.c.'>unsubscribeCommand</a> &amp;&amp;
<a name='L1629'>        c-&gt;cmd-&gt;proc != <a href='../S/46.html#L274' title='Defined at 274 in src/pubsub.c.'>psubscribeCommand</a> &amp;&amp;
<a name='L1630'>        c-&gt;cmd-&gt;proc != <a href='../S/46.html#L281' title='Defined at 281 in src/pubsub.c.'>punsubscribeCommand</a>) <font color='red'>{</font>
<a name='L1631'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"only (P)SUBSCRIBE / (P)UNSUBSCRIBE / QUIT allowed in this context");
<a name='L1632'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1633'>    <font color='red'>}</font>
<a name='L1634'>
<a name='L1635'>    <i><font color='green'>/* Only allow INFO and SLAVEOF when slave-serve-stale-data is no and</font></i>
<a name='L1636'><i><font color='green'>     * we are a slave with a broken link with master. */</font></i>
<a name='L1637'>    <b>if</b> (server.masterhost &amp;&amp; server.repl_state != <a href='../S/32.html#L204' title='Defined at 204 in src/redis.h.'>REDIS_REPL_CONNECTED</a> &amp;&amp;
<a name='L1638'>        server.repl_serve_stale_data == 0 &amp;&amp;
<a name='L1639'>        !(c-&gt;cmd-&gt;flags &amp; <a href='../S/32.html#L117' title='Defined at 117 in src/redis.h.'>REDIS_CMD_STALE</a>))
<a name='L1640'>    <font color='red'>{</font>
<a name='L1641'>        <a href='../S/81.html#L81' title='Defined at 81 in src/multi.c.'>flagTransaction</a>(c);
<a name='L1642'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.masterdownerr);
<a name='L1643'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1644'>    <font color='red'>}</font>
<a name='L1645'>
<a name='L1646'>    <i><font color='green'>/* Loading DB? Return an error if the command has not the</font></i>
<a name='L1647'><i><font color='green'>     * REDIS_CMD_LOADING flag. */</font></i>
<a name='L1648'>    <b>if</b> (server.loading &amp;&amp; !(c-&gt;cmd-&gt;flags &amp; <a href='../S/32.html#L116' title='Defined at 116 in src/redis.h.'>REDIS_CMD_LOADING</a>)) <font color='red'>{</font>
<a name='L1649'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.loadingerr);
<a name='L1650'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1651'>    <font color='red'>}</font>
<a name='L1652'>
<a name='L1653'>    <i><font color='green'>/* Lua script too slow? Only allow commands with REDIS_CMD_STALE flag. */</font></i>
<a name='L1654'>    <b>if</b> (server.lua_timedout &amp;&amp;
<a name='L1655'>          c-&gt;cmd-&gt;proc != <a href='../S/35.html#L1783' title='Defined at 1783 in src/redis.c.'>authCommand</a> &amp;&amp;
<a name='L1656'>        !(c-&gt;cmd-&gt;proc == <a href='../S/31.html#L338' title='Defined at 338 in src/db.c.'>shutdownCommand</a> &amp;&amp;
<a name='L1657'>          c-&gt;argc == 2 &amp;&amp;
<a name='L1658'>          tolower(((<b>char</b>*)c-&gt;argv[1]-&gt;ptr)[0]) == 'n') &amp;&amp;
<a name='L1659'>        !(c-&gt;cmd-&gt;proc == <a href='../S/75.html#L975' title='Defined at 975 in src/scripting.c.'>scriptCommand</a> &amp;&amp;
<a name='L1660'>          c-&gt;argc == 2 &amp;&amp;
<a name='L1661'>          tolower(((<b>char</b>*)c-&gt;argv[1]-&gt;ptr)[0]) == 'k'))
<a name='L1662'>    <font color='red'>{</font>
<a name='L1663'>        <a href='../S/81.html#L81' title='Defined at 81 in src/multi.c.'>flagTransaction</a>(c);
<a name='L1664'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.slowscripterr);
<a name='L1665'>        <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1666'>    <font color='red'>}</font>
<a name='L1667'>
<a name='L1668'>    <i><font color='green'>/* Exec the command */</font></i>
<a name='L1669'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L175' title='Defined at 175 in src/redis.h.'>REDIS_MULTI</a> &amp;&amp;
<a name='L1670'>        c-&gt;cmd-&gt;proc != <a href='../S/81.html#L116' title='Defined at 116 in src/multi.c.'>execCommand</a> &amp;&amp; c-&gt;cmd-&gt;proc != <a href='../S/81.html#L95' title='Defined at 95 in src/multi.c.'>discardCommand</a> &amp;&amp;
<a name='L1671'>        c-&gt;cmd-&gt;proc != <a href='../S/81.html#L86' title='Defined at 86 in src/multi.c.'>multiCommand</a> &amp;&amp; c-&gt;cmd-&gt;proc != <a href='../S/81.html#L310' title='Defined at 310 in src/multi.c.'>watchCommand</a>)
<a name='L1672'>    <font color='red'>{</font>
<a name='L1673'>        <a href='../S/81.html#L56' title='Defined at 56 in src/multi.c.'>queueMultiCommand</a>(c);
<a name='L1674'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.queued);
<a name='L1675'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1676'>        <a href='../S/35.html#L1487' title='Defined at 1487 in src/redis.c.'>call</a>(c,<a href='../S/32.html#L285' title='Defined at 285 in src/redis.h.'>REDIS_CALL_FULL</a>);
<a name='L1677'>        <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.ready_keys))
<a name='L1678'>            <a href='../S/60.html#L934' title='Defined at 934 in src/t_list.c.'>handleClientsBlockedOnLists</a>();
<a name='L1679'>    <font color='red'>}</font>
<a name='L1680'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1681'><font color='red'>}</font>
<a name='L1682'>
<a name='L1683'><i><font color='green'>/*================================== Shutdown =============================== */</font></i>
<a name='L1684'>
<a name='L1685'><b>int</b> <a href='../R/3161.html' title='Multiple refered from 3 places.'>prepareForShutdown</a>(<b>int</b> flags) <font color='red'>{</font>
<a name='L1686'>    <b>int</b> <a href='../S/305.html#L51' title='Defined at 51 in deps/lua/src/llex.c.'>save</a> = flags &amp; <a href='../S/32.html#L276' title='Defined at 276 in src/redis.h.'>REDIS_SHUTDOWN_SAVE</a>;
<a name='L1687'>    <b>int</b> nosave = flags &amp; <a href='../S/32.html#L278' title='Defined at 278 in src/redis.h.'>REDIS_SHUTDOWN_NOSAVE</a>;
<a name='L1688'>
<a name='L1689'>    <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"User requested shutdown...");
<a name='L1690'>    <i><font color='green'>/* Kill the saving child if there is a background saving in progress.</font></i>
<a name='L1691'><i><font color='green'>       We want to avoid race conditions, for instance our saving child may</font></i>
<a name='L1692'><i><font color='green'>       overwrite the synchronous saving did by SHUTDOWN. */</font></i>
<a name='L1693'>    <b>if</b> (server.rdb_child_pid != -1) <font color='red'>{</font>
<a name='L1694'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"There is a child saving an .rdb. Killing it!");
<a name='L1695'>        kill(server.rdb_child_pid,SIGKILL);
<a name='L1696'>        <a href='../S/87.html#L761' title='Defined at 761 in src/rdb.c.'>rdbRemoveTempFile</a>(server.rdb_child_pid);
<a name='L1697'>    <font color='red'>}</font>
<a name='L1698'>    <b>if</b> (server.aof_state != <a href='../S/32.html#L167' title='Defined at 167 in src/redis.h.'>REDIS_AOF_OFF</a>) <font color='red'>{</font>
<a name='L1699'>        <i><font color='green'>/* Kill the AOF saving child as the AOF we already have may be longer</font></i>
<a name='L1700'><i><font color='green'>         * but contains the full dataset anyway. */</font></i>
<a name='L1701'>        <b>if</b> (server.aof_child_pid != -1) <font color='red'>{</font>
<a name='L1702'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,
<a name='L1703'>                "There is a child rewriting the AOF. Killing it!");
<a name='L1704'>            kill(server.aof_child_pid,SIGKILL);
<a name='L1705'>        <font color='red'>}</font>
<a name='L1706'>        <i><font color='green'>/* Append only file: fsync() the AOF and exit */</font></i>
<a name='L1707'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"Calling fsync() on the AOF file.");
<a name='L1708'>        <a href='../D/1557.html' title='Multiple defined in 2 places.'>aof_fsync</a>(server.aof_fd);
<a name='L1709'>    <font color='red'>}</font>
<a name='L1710'>    <b>if</b> ((server.saveparamslen &gt; 0 &amp;&amp; !nosave) || <a href='../S/305.html#L51' title='Defined at 51 in deps/lua/src/llex.c.'>save</a>) <font color='red'>{</font>
<a name='L1711'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"Saving the final RDB snapshot before exiting.");
<a name='L1712'>        <i><font color='green'>/* Snapshotting. Perform a SYNC SAVE and exit */</font></i>
<a name='L1713'>        <b>if</b> (<a href='../S/87.html#L630' title='Defined at 630 in src/rdb.c.'>rdbSave</a>(server.rdb_filename) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <font color='red'>{</font>
<a name='L1714'>            <i><font color='green'>/* Ooops.. error saving! The best we can do is to continue</font></i>
<a name='L1715'><i><font color='green'>             * operating. Note that if there was a background saving process,</font></i>
<a name='L1716'><i><font color='green'>             * in the next cron() Redis will be notified that the background</font></i>
<a name='L1717'><i><font color='green'>             * saving aborted, handling special stuff like slaves pending for</font></i>
<a name='L1718'><i><font color='green'>             * synchronization... */</font></i>
<a name='L1719'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Error trying to save the DB, can't exit.");
<a name='L1720'>            <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L1721'>        <font color='red'>}</font>
<a name='L1722'>    <font color='red'>}</font>
<a name='L1723'>    <b>if</b> (server.<a href='../S/35.html#L2402' title='Defined at 2402 in src/redis.c.'>daemonize</a>) <font color='red'>{</font>
<a name='L1724'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"Removing the pid file.");
<a name='L1725'>        unlink(server.pidfile);
<a name='L1726'>    <font color='red'>}</font>
<a name='L1727'>    <i><font color='green'>/* Close the listening sockets. Apparently this allows faster restarts. */</font></i>
<a name='L1728'>    <b>if</b> (server.ipfd != -1) close(server.ipfd);
<a name='L1729'>    <b>if</b> (server.sofd != -1) close(server.sofd);
<a name='L1730'>    <b>if</b> (server.unixsocket) <font color='red'>{</font>
<a name='L1731'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"Removing the unix socket file.");
<a name='L1732'>        unlink(server.unixsocket); <i><font color='green'>/* don't care if this fails */</font></i>
<a name='L1733'>    <font color='red'>}</font>
<a name='L1734'>
<a name='L1735'>    <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Redis is now ready to exit, bye bye...");
<a name='L1736'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L1737'><font color='red'>}</font>
<a name='L1738'>
<a name='L1739'><i><font color='green'>/*================================== Commands =============================== */</font></i>
<a name='L1740'>
<a name='L1741'><i><font color='green'>/* Return zero if strings are the same, non-zero if they are not.</font></i>
<a name='L1742'><i><font color='green'> * The comparison is performed in a way that prevents an attacker to obtain</font></i>
<a name='L1743'><i><font color='green'> * information about the nature of the strings just monitoring the execution</font></i>
<a name='L1744'><i><font color='green'> * time of the function.</font></i>
<a name='L1745'><i><font color='green'> *</font></i>
<a name='L1746'><i><font color='green'> * Note that limiting the comparison length to strings up to 512 bytes we</font></i>
<a name='L1747'><i><font color='green'> * can avoid leaking any information about the password length and any</font></i>
<a name='L1748'><i><font color='green'> * possible branch misprediction related leak.</font></i>
<a name='L1749'><i><font color='green'> */</font></i>
<a name='L1750'><b>int</b> <a href='../S/35.html#L1786' title='Refered from 1786 in src/redis.c.'>time_independent_strcmp</a>(<b>char</b> *a, <b>char</b> *b) <font color='red'>{</font>
<a name='L1751'>    <b>char</b> bufa[<a href='../S/32.html#L88' title='Defined at 88 in src/redis.h.'>REDIS_AUTHPASS_MAX_LEN</a>], bufb[<a href='../S/32.html#L88' title='Defined at 88 in src/redis.h.'>REDIS_AUTHPASS_MAX_LEN</a>];
<a name='L1752'>    <i><font color='green'>/* The above two strlen perform len(a) + len(b) operations where either</font></i>
<a name='L1753'><i><font color='green'>     * a or b are fixed (our password) length, and the difference is only</font></i>
<a name='L1754'><i><font color='green'>     * relative to the length of the user provided string, so no information</font></i>
<a name='L1755'><i><font color='green'>     * leak is possible in the following two lines of code. */</font></i>
<a name='L1756'>    <b>int</b> alen = strlen(a);
<a name='L1757'>    <b>int</b> blen = strlen(b);
<a name='L1758'>    <b>int</b> j;
<a name='L1759'>    <b>int</b> diff = 0;
<a name='L1760'>
<a name='L1761'>    <i><font color='green'>/* We can't compare strings longer than our static buffers.</font></i>
<a name='L1762'><i><font color='green'>     * Note that this will never pass the first test in practical circumstances</font></i>
<a name='L1763'><i><font color='green'>     * so there is no info leak. */</font></i>
<a name='L1764'>    <b>if</b> (alen &gt; <b>sizeof</b>(bufa) || blen &gt; <b>sizeof</b>(bufb)) <b>return</b> 1;
<a name='L1765'>
<a name='L1766'>    memset(bufa,0,<b>sizeof</b>(bufa));        <i><font color='green'>/* Constant time. */</font></i>
<a name='L1767'>    memset(bufb,0,<b>sizeof</b>(bufb));        <i><font color='green'>/* Constant time. */</font></i>
<a name='L1768'>    <i><font color='green'>/* Again the time of the following two copies is proportional to</font></i>
<a name='L1769'><i><font color='green'>     * len(a) + len(b) so no info is leaked. */</font></i>
<a name='L1770'>    memcpy(bufa,a,alen);
<a name='L1771'>    memcpy(bufb,b,blen);
<a name='L1772'>
<a name='L1773'>    <i><font color='green'>/* Always compare all the chars in the two buffers without</font></i>
<a name='L1774'><i><font color='green'>     * conditional expressions. */</font></i>
<a name='L1775'>    <b>for</b> (j = 0; j &lt; <b>sizeof</b>(bufa); j++) <font color='red'>{</font>
<a name='L1776'>        diff |= (bufa[j] ^ bufb[j]);
<a name='L1777'>    <font color='red'>}</font>
<a name='L1778'>    <i><font color='green'>/* Length must be equal as well. */</font></i>
<a name='L1779'>    diff |= alen ^ blen;
<a name='L1780'>    <b>return</b> diff; <i><font color='green'>/* If zero strings are the same. */</font></i>
<a name='L1781'><font color='red'>}</font>
<a name='L1782'>
<a name='L1783'><b>void</b> <a href='../R/1427.html' title='Multiple refered from 4 places.'>authCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1784'>    <b>if</b> (!server.requirepass) <font color='red'>{</font>
<a name='L1785'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"Client sent AUTH, but no password is set");
<a name='L1786'>    <font color='red'>}</font> <b>else</b> <b>if</b> (!<a href='../S/35.html#L1750' title='Defined at 1750 in src/redis.c.'>time_independent_strcmp</a>(c-&gt;argv[1]-&gt;ptr, server.requirepass)) <font color='red'>{</font>
<a name='L1787'>      c-&gt;authenticated = 1;
<a name='L1788'>      <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a>);
<a name='L1789'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1790'>      c-&gt;authenticated = 0;
<a name='L1791'>      <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"invalid password");
<a name='L1792'>    <font color='red'>}</font>
<a name='L1793'><font color='red'>}</font>
<a name='L1794'>
<a name='L1795'><b>void</b> <a href='../R/3146.html' title='Multiple refered from 3 places.'>pingCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1796'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.pong);
<a name='L1797'><font color='red'>}</font>
<a name='L1798'>
<a name='L1799'><b>void</b> <a href='../R/1881.html' title='Multiple refered from 2 places.'>echoCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1800'>    <a href='../S/86.html#L475' title='Defined at 475 in src/networking.c.'>addReplyBulk</a>(c,c-&gt;argv[1]);
<a name='L1801'><font color='red'>}</font>
<a name='L1802'>
<a name='L1803'><b>void</b> <a href='../R/4000.html' title='Multiple refered from 2 places.'>timeCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1804'>    <b>struct</b> timeval tv;
<a name='L1805'>
<a name='L1806'>    <i><font color='green'>/* gettimeofday() can only fail if &amp;tv is a bad addresss so we</font></i>
<a name='L1807'><i><font color='green'>     * don't check for errors. */</font></i>
<a name='L1808'>    gettimeofday(&amp;tv,NULL);
<a name='L1809'>    <a href='../S/86.html#L448' title='Defined at 448 in src/networking.c.'>addReplyMultiBulkLen</a>(c,2);
<a name='L1810'>    <a href='../S/86.html#L498' title='Defined at 498 in src/networking.c.'>addReplyBulkLongLong</a>(c,tv.tv_sec);
<a name='L1811'>    <a href='../S/86.html#L498' title='Defined at 498 in src/networking.c.'>addReplyBulkLongLong</a>(c,tv.tv_usec);
<a name='L1812'><font color='red'>}</font>
<a name='L1813'>
<a name='L1814'><i><font color='green'>/* Convert an amount of bytes into a human readable string in the form</font></i>
<a name='L1815'><i><font color='green'> * of 100B, 2G, 100M, 4K, and so forth. */</font></i>
<a name='L1816'><b>void</b> <a href='../R/1509.html' title='Multiple refered from 2 places.'>bytesToHuman</a>(<b>char</b> *s, <b>unsigned</b> <b>long</b> <b>long</b> n) <font color='red'>{</font>
<a name='L1817'>    <b>double</b> d;
<a name='L1818'>
<a name='L1819'>    <b>if</b> (n &lt; 1024) <font color='red'>{</font>
<a name='L1820'>        <i><font color='green'>/* Bytes */</font></i>
<a name='L1821'>        sprintf(s,"%lluB",n);
<a name='L1822'>        <b>return</b>;
<a name='L1823'>    <font color='red'>}</font> <b>else</b> <b>if</b> (n &lt; (1024*1024)) <font color='red'>{</font>
<a name='L1824'>        d = (<b>double</b>)n/(1024);
<a name='L1825'>        sprintf(s,"%.2fK",d);
<a name='L1826'>    <font color='red'>}</font> <b>else</b> <b>if</b> (n &lt; (1024LL*1024*1024)) <font color='red'>{</font>
<a name='L1827'>        d = (<b>double</b>)n/(1024*1024);
<a name='L1828'>        sprintf(s,"%.2fM",d);
<a name='L1829'>    <font color='red'>}</font> <b>else</b> <b>if</b> (n &lt; (1024LL*1024*1024*1024)) <font color='red'>{</font>
<a name='L1830'>        d = (<b>double</b>)n/(1024LL*1024*1024);
<a name='L1831'>        sprintf(s,"%.2fG",d);
<a name='L1832'>    <font color='red'>}</font>
<a name='L1833'><font color='red'>}</font>
<a name='L1834'>
<a name='L1835'><i><font color='green'>/* Create the string returned by the INFO command. This is decoupled</font></i>
<a name='L1836'><i><font color='green'> * by the INFO command itself as we need to report the same information</font></i>
<a name='L1837'><i><font color='green'> * on memory corruption problems. */</font></i>
<a name='L1838'><a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> <a href='../R/2030.html' title='Multiple refered from 4 places.'>genRedisInfoString</a>(<b>char</b> *section) <font color='red'>{</font>
<a name='L1839'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> info = <a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>();
<a name='L1840'>    time_t uptime = server.unixtime-server.stat_starttime;
<a name='L1841'>    <b>int</b> j, numcommands;
<a name='L1842'>    <b>struct</b> rusage self_ru, c_ru;
<a name='L1843'>    <b>unsigned</b> <b>long</b> lol, bib;
<a name='L1844'>    <b>int</b> allsections = 0, defsections = 0;
<a name='L1845'>    <b>int</b> sections = 0;
<a name='L1846'>
<a name='L1847'>    <b>if</b> (section) <font color='red'>{</font>
<a name='L1848'>        allsections = strcasecmp(section,"all") == 0;
<a name='L1849'>        defsections = strcasecmp(section,"default") == 0;
<a name='L1850'>    <font color='red'>}</font>
<a name='L1851'>
<a name='L1852'>    getrusage(RUSAGE_SELF, &amp;self_ru);
<a name='L1853'>    getrusage(RUSAGE_CHILDREN, &amp;c_ru);
<a name='L1854'>    <a href='../S/86.html#L1074' title='Defined at 1074 in src/networking.c.'>getClientsMaxBuffers</a>(&amp;lol,&amp;bib);
<a name='L1855'>
<a name='L1856'>    <i><font color='green'>/* Server */</font></i>
<a name='L1857'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"server")) <font color='red'>{</font>
<a name='L1858'>        <b>struct</b> utsname name;
<a name='L1859'>        <b>char</b> *mode;
<a name='L1860'>
<a name='L1861'>        <b>if</b> (server.sentinel_mode) mode = "sentinel";
<a name='L1862'>        <b>else</b> mode = "standalone";
<a name='L1863'>    
<a name='L1864'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L1865'>        uname(&amp;name);
<a name='L1866'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L1867'>            "# Server\r\n"
<a name='L1868'>            "redis_version:%s\r\n"
<a name='L1869'>            "redis_git_sha1:%s\r\n"
<a name='L1870'>            "redis_git_dirty:%d\r\n"
<a name='L1871'>            "redis_mode:%s\r\n"
<a name='L1872'>            "os:%s %s %s\r\n"
<a name='L1873'>            "arch_bits:%d\r\n"
<a name='L1874'>            "multiplexing_api:%s\r\n"
<a name='L1875'>            "gcc_version:%d.%d.%d\r\n"
<a name='L1876'>            "process_id:%ld\r\n"
<a name='L1877'>            "run_id:%s\r\n"
<a name='L1878'>            "tcp_port:%d\r\n"
<a name='L1879'>            "uptime_in_seconds:%ld\r\n"
<a name='L1880'>            "uptime_in_days:%ld\r\n"
<a name='L1881'>            "lru_clock:%ld\r\n",
<a name='L1882'>            <a href='../S/43.html#L1' title='Defined at 1 in src/version.h.'>REDIS_VERSION</a>,
<a name='L1883'>            <a href='../S/33.html#L36' title='Defined at 36 in src/release.c.'>redisGitSHA1</a>(),
<a name='L1884'>            strtol(<a href='../S/33.html#L40' title='Defined at 40 in src/release.c.'>redisGitDirty</a>(),NULL,10) &gt; 0,
<a name='L1885'>            mode,
<a name='L1886'>            name.sysname, name.release, name.machine,
<a name='L1887'>            server.arch_bits,
<a name='L1888'>            <a href='../S/36.html#L425' title='Defined at 425 in src/ae.c.'>aeGetApiName</a>(),
<a name='L1889'><font color='darkred'>#ifdef</font> __GNUC__
<a name='L1890'>            __GNUC__,__GNUC_MINOR__,__GNUC_PATCHLEVEL__,
<a name='L1891'><font color='darkred'>#else</font>
<a name='L1892'>            0,0,0,
<a name='L1893'><font color='darkred'>#endif</font>
<a name='L1894'>            (<b>long</b>) getpid(),
<a name='L1895'>            server.runid,
<a name='L1896'>            server.port,
<a name='L1897'>            uptime,
<a name='L1898'>            uptime/(3600*24),
<a name='L1899'>            (<b>unsigned</b> <b>long</b>) server.lruclock);
<a name='L1900'>    <font color='red'>}</font>
<a name='L1901'>
<a name='L1902'>    <i><font color='green'>/* Clients */</font></i>
<a name='L1903'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"clients")) <font color='red'>{</font>
<a name='L1904'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L1905'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L1906'>            "# Clients\r\n"
<a name='L1907'>            "connected_clients:%lu\r\n"
<a name='L1908'>            "client_longest_output_list:%lu\r\n"
<a name='L1909'>            "client_biggest_input_buf:%lu\r\n"
<a name='L1910'>            "blocked_clients:%d\r\n",
<a name='L1911'>            <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.clients)-<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves),
<a name='L1912'>            lol, bib,
<a name='L1913'>            server.bpop_blocked_clients);
<a name='L1914'>    <font color='red'>}</font>
<a name='L1915'>
<a name='L1916'>    <i><font color='green'>/* Memory */</font></i>
<a name='L1917'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"memory")) <font color='red'>{</font>
<a name='L1918'>        <b>char</b> hmem[64];
<a name='L1919'>        <b>char</b> peak_hmem[64];
<a name='L1920'>
<a name='L1921'>        <a href='../S/35.html#L1816' title='Defined at 1816 in src/redis.c.'>bytesToHuman</a>(hmem,<a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>());
<a name='L1922'>        <a href='../S/35.html#L1816' title='Defined at 1816 in src/redis.c.'>bytesToHuman</a>(peak_hmem,server.stat_peak_memory);
<a name='L1923'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L1924'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L1925'>            "# Memory\r\n"
<a name='L1926'>            "used_memory:%zu\r\n"
<a name='L1927'>            "used_memory_human:%s\r\n"
<a name='L1928'>            "used_memory_rss:%zu\r\n"
<a name='L1929'>            "used_memory_peak:%zu\r\n"
<a name='L1930'>            "used_memory_peak_human:%s\r\n"
<a name='L1931'>            "used_memory_lua:%lld\r\n"
<a name='L1932'>            "mem_fragmentation_ratio:%.2f\r\n"
<a name='L1933'>            "mem_allocator:%s\r\n",
<a name='L1934'>            <a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>(),
<a name='L1935'>            hmem,
<a name='L1936'>            <a href='../D/4546.html' title='Multiple defined in 3 places.'>zmalloc_get_rss</a>(),
<a name='L1937'>            server.stat_peak_memory,
<a name='L1938'>            peak_hmem,
<a name='L1939'>            ((<b>long</b> <b>long</b>)<a href='../S/272.html#L899' title='Defined at 899 in deps/lua/src/lapi.c.'>lua_gc</a>(server.lua,<a href='../S/266.html#L224' title='Defined at 224 in deps/lua/src/lua.h.'>LUA_GCCOUNT</a>,0))*1024LL,
<a name='L1940'>            <a href='../S/39.html#L324' title='Defined at 324 in src/zmalloc.c.'>zmalloc_get_fragmentation_ratio</a>(),
<a name='L1941'>            <a href='../D/1344.html' title='Multiple defined in 3 places.'>ZMALLOC_LIB</a>
<a name='L1942'>            );
<a name='L1943'>    <font color='red'>}</font>
<a name='L1944'>
<a name='L1945'>    <i><font color='green'>/* Persistence */</font></i>
<a name='L1946'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"persistence")) <font color='red'>{</font>
<a name='L1947'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L1948'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L1949'>            "# Persistence\r\n"
<a name='L1950'>            "loading:%d\r\n"
<a name='L1951'>            "rdb_changes_since_last_save:%lld\r\n"
<a name='L1952'>            "rdb_bgsave_in_progress:%d\r\n"
<a name='L1953'>            "rdb_last_save_time:%ld\r\n"
<a name='L1954'>            "rdb_last_bgsave_status:%s\r\n"
<a name='L1955'>            "rdb_last_bgsave_time_sec:%ld\r\n"
<a name='L1956'>            "rdb_current_bgsave_time_sec:%ld\r\n"
<a name='L1957'>            "aof_enabled:%d\r\n"
<a name='L1958'>            "aof_rewrite_in_progress:%d\r\n"
<a name='L1959'>            "aof_rewrite_scheduled:%d\r\n"
<a name='L1960'>            "aof_last_rewrite_time_sec:%ld\r\n"
<a name='L1961'>            "aof_current_rewrite_time_sec:%ld\r\n"
<a name='L1962'>            "aof_last_bgrewrite_status:%s\r\n",
<a name='L1963'>            server.loading,
<a name='L1964'>            server.dirty,
<a name='L1965'>            server.rdb_child_pid != -1,
<a name='L1966'>            server.lastsave,
<a name='L1967'>            (server.lastbgsave_status == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) ? "ok" : "err",
<a name='L1968'>            server.rdb_save_time_last,
<a name='L1969'>            (server.rdb_child_pid == -1) ?
<a name='L1970'>                -1 : time(NULL)-server.rdb_save_time_start,
<a name='L1971'>            server.aof_state != <a href='../S/32.html#L167' title='Defined at 167 in src/redis.h.'>REDIS_AOF_OFF</a>,
<a name='L1972'>            server.aof_child_pid != -1,
<a name='L1973'>            server.aof_rewrite_scheduled,
<a name='L1974'>            server.aof_rewrite_time_last,
<a name='L1975'>            (server.aof_child_pid == -1) ?
<a name='L1976'>                -1 : time(NULL)-server.aof_rewrite_time_start,
<a name='L1977'>            (server.aof_lastbgrewrite_status == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) ? "ok" : "err");
<a name='L1978'>
<a name='L1979'>        <b>if</b> (server.aof_state != <a href='../S/32.html#L167' title='Defined at 167 in src/redis.h.'>REDIS_AOF_OFF</a>) <font color='red'>{</font>
<a name='L1980'>            info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L1981'>                "aof_current_size:%lld\r\n"
<a name='L1982'>                "aof_base_size:%lld\r\n"
<a name='L1983'>                "aof_pending_rewrite:%d\r\n"
<a name='L1984'>                "aof_buffer_length:%zu\r\n"
<a name='L1985'>                "aof_rewrite_buffer_length:%lu\r\n"
<a name='L1986'>                "aof_pending_bio_fsync:%llu\r\n"
<a name='L1987'>                "aof_delayed_fsync:%lu\r\n",
<a name='L1988'>                (<b>long</b> <b>long</b>) server.aof_current_size,
<a name='L1989'>                (<b>long</b> <b>long</b>) server.aof_rewrite_base_size,
<a name='L1990'>                server.aof_rewrite_scheduled,
<a name='L1991'>                <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(server.aof_buf),
<a name='L1992'>                <a href='../S/62.html#L77' title='Defined at 77 in src/aof.c.'>aofRewriteBufferSize</a>(),
<a name='L1993'>                <a href='../S/25.html#L187' title='Defined at 187 in src/bio.c.'>bioPendingJobsOfType</a>(<a href='../S/68.html#L39' title='Defined at 39 in src/bio.h.'>REDIS_BIO_AOF_FSYNC</a>),
<a name='L1994'>                server.aof_delayed_fsync);
<a name='L1995'>        <font color='red'>}</font>
<a name='L1996'>
<a name='L1997'>        <b>if</b> (server.loading) <font color='red'>{</font>
<a name='L1998'>            <b>double</b> perc;
<a name='L1999'>            time_t eta, elapsed;
<a name='L2000'>            off_t remaining_bytes = server.loading_total_bytes-
<a name='L2001'>                                    server.loading_loaded_bytes;
<a name='L2002'>
<a name='L2003'>            perc = ((<b>double</b>)server.loading_loaded_bytes /
<a name='L2004'>                   server.loading_total_bytes) * 100;
<a name='L2005'>
<a name='L2006'>            elapsed = server.unixtime-server.loading_start_time;
<a name='L2007'>            <b>if</b> (elapsed == 0) <font color='red'>{</font>
<a name='L2008'>                eta = 1; <i><font color='green'>/* A fake 1 second figure if we don't have</font></i>
<a name='L2009'><i><font color='green'>                            enough info */</font></i>
<a name='L2010'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2011'>                eta = (elapsed*remaining_bytes)/server.loading_loaded_bytes;
<a name='L2012'>            <font color='red'>}</font>
<a name='L2013'>
<a name='L2014'>            info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2015'>                "loading_start_time:%ld\r\n"
<a name='L2016'>                "loading_total_bytes:%llu\r\n"
<a name='L2017'>                "loading_loaded_bytes:%llu\r\n"
<a name='L2018'>                "loading_loaded_perc:%.2f\r\n"
<a name='L2019'>                "loading_eta_seconds:%ld\r\n"
<a name='L2020'>                ,(<b>unsigned</b> <b>long</b>) server.loading_start_time,
<a name='L2021'>                (<b>unsigned</b> <b>long</b> <b>long</b>) server.loading_total_bytes,
<a name='L2022'>                (<b>unsigned</b> <b>long</b> <b>long</b>) server.loading_loaded_bytes,
<a name='L2023'>                perc,
<a name='L2024'>                eta
<a name='L2025'>            );
<a name='L2026'>        <font color='red'>}</font>
<a name='L2027'>    <font color='red'>}</font>
<a name='L2028'>
<a name='L2029'>    <i><font color='green'>/* Stats */</font></i>
<a name='L2030'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"stats")) <font color='red'>{</font>
<a name='L2031'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L2032'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2033'>            "# Stats\r\n"
<a name='L2034'>            "total_connections_received:%lld\r\n"
<a name='L2035'>            "total_commands_processed:%lld\r\n"
<a name='L2036'>            "instantaneous_ops_per_sec:%lld\r\n"
<a name='L2037'>            "rejected_connections:%lld\r\n"
<a name='L2038'>            "expired_keys:%lld\r\n"
<a name='L2039'>            "evicted_keys:%lld\r\n"
<a name='L2040'>            "keyspace_hits:%lld\r\n"
<a name='L2041'>            "keyspace_misses:%lld\r\n"
<a name='L2042'>            "pubsub_channels:%ld\r\n"
<a name='L2043'>            "pubsub_patterns:%lu\r\n"
<a name='L2044'>            "latest_fork_usec:%lld\r\n",
<a name='L2045'>            server.stat_numconnections,
<a name='L2046'>            server.stat_numcommands,
<a name='L2047'>            <a href='../S/35.html#L705' title='Defined at 705 in src/redis.c.'>getOperationsPerSecond</a>(),
<a name='L2048'>            server.stat_rejected_conn,
<a name='L2049'>            server.stat_expiredkeys,
<a name='L2050'>            server.stat_evictedkeys,
<a name='L2051'>            server.stat_keyspace_hits,
<a name='L2052'>            server.stat_keyspace_misses,
<a name='L2053'>            <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(server.pubsub_channels),
<a name='L2054'>            <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.pubsub_patterns),
<a name='L2055'>            server.stat_fork_time);
<a name='L2056'>    <font color='red'>}</font>
<a name='L2057'>
<a name='L2058'>    <i><font color='green'>/* Replication */</font></i>
<a name='L2059'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"replication")) <font color='red'>{</font>
<a name='L2060'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L2061'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2062'>            "# Replication\r\n"
<a name='L2063'>            "role:%s\r\n",
<a name='L2064'>            server.masterhost == NULL ? "master" : "slave");
<a name='L2065'>        <b>if</b> (server.masterhost) <font color='red'>{</font>
<a name='L2066'>            info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2067'>                "master_host:%s\r\n"
<a name='L2068'>                "master_port:%d\r\n"
<a name='L2069'>                "master_link_status:%s\r\n"
<a name='L2070'>                "master_last_io_seconds_ago:%d\r\n"
<a name='L2071'>                "master_sync_in_progress:%d\r\n"
<a name='L2072'>                ,server.masterhost,
<a name='L2073'>                server.masterport,
<a name='L2074'>                (server.repl_state == <a href='../S/32.html#L204' title='Defined at 204 in src/redis.h.'>REDIS_REPL_CONNECTED</a>) ?
<a name='L2075'>                    "up" : "down",
<a name='L2076'>                server.master ?
<a name='L2077'>                ((<b>int</b>)(server.unixtime-server.master-&gt;lastinteraction)) : -1,
<a name='L2078'>                server.repl_state == <a href='../S/32.html#L203' title='Defined at 203 in src/redis.h.'>REDIS_REPL_TRANSFER</a>
<a name='L2079'>            );
<a name='L2080'>
<a name='L2081'>            <b>if</b> (server.repl_state == <a href='../S/32.html#L203' title='Defined at 203 in src/redis.h.'>REDIS_REPL_TRANSFER</a>) <font color='red'>{</font>
<a name='L2082'>                info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2083'>                    "master_sync_left_bytes:%lld\r\n"
<a name='L2084'>                    "master_sync_last_io_seconds_ago:%d\r\n"
<a name='L2085'>                    , (<b>long</b> <b>long</b>)
<a name='L2086'>                        (server.repl_transfer_size - server.repl_transfer_read),
<a name='L2087'>                    (<b>int</b>)(server.unixtime-server.repl_transfer_lastio)
<a name='L2088'>                );
<a name='L2089'>            <font color='red'>}</font>
<a name='L2090'>
<a name='L2091'>            <b>if</b> (server.repl_state != <a href='../S/32.html#L204' title='Defined at 204 in src/redis.h.'>REDIS_REPL_CONNECTED</a>) <font color='red'>{</font>
<a name='L2092'>                info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2093'>                    "master_link_down_since_seconds:%ld\r\n",
<a name='L2094'>                    (<b>long</b>)server.unixtime-server.repl_down_since);
<a name='L2095'>            <font color='red'>}</font>
<a name='L2096'>            info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2097'>                "slave_priority:%d\r\n"
<a name='L2098'>                "slave_read_only:%d\r\n",
<a name='L2099'>                server.slave_priority,
<a name='L2100'>                server.repl_slave_ro);
<a name='L2101'>        <font color='red'>}</font>
<a name='L2102'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2103'>            "connected_slaves:%lu\r\n",
<a name='L2104'>            <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves));
<a name='L2105'>        <b>if</b> (<a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves)) <font color='red'>{</font>
<a name='L2106'>            <b>int</b> slaveid = 0;
<a name='L2107'>            <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L2108'>            <a href='../D/2703.html' title='Multiple defined in 2 places.'>listIter</a> li;
<a name='L2109'>
<a name='L2110'>            <a href='../S/54.html#L197' title='Defined at 197 in src/adlist.c.'>listRewind</a>(server.slaves,&amp;li);
<a name='L2111'>            <b>while</b>((ln = <a href='../S/54.html#L221' title='Defined at 221 in src/adlist.c.'>listNext</a>(&amp;li))) <font color='red'>{</font>
<a name='L2112'>                <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *slave = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L2113'>                <b>char</b> *state = NULL;
<a name='L2114'>                <b>char</b> ip[32];
<a name='L2115'>                <b>int</b> port;
<a name='L2116'>
<a name='L2117'>                <b>if</b> (<a href='../S/50.html#L356' title='Defined at 356 in src/anet.c.'>anetPeerToString</a>(slave-&gt;fd,ip,&amp;port) == -1) <b>continue</b>;
<a name='L2118'>                <b>switch</b>(slave-&gt;replstate) <font color='red'>{</font>
<a name='L2119'>                <b>case</b> <a href='../S/32.html#L213' title='Defined at 213 in src/redis.h.'>REDIS_REPL_WAIT_BGSAVE_START</a>:
<a name='L2120'>                <b>case</b> <a href='../S/32.html#L214' title='Defined at 214 in src/redis.h.'>REDIS_REPL_WAIT_BGSAVE_END</a>:
<a name='L2121'>                    state = "wait_bgsave";
<a name='L2122'>                    <b>break</b>;
<a name='L2123'>                <b>case</b> <a href='../S/32.html#L215' title='Defined at 215 in src/redis.h.'>REDIS_REPL_SEND_BULK</a>:
<a name='L2124'>                    state = "send_bulk";
<a name='L2125'>                    <b>break</b>;
<a name='L2126'>                <b>case</b> <a href='../S/32.html#L216' title='Defined at 216 in src/redis.h.'>REDIS_REPL_ONLINE</a>:
<a name='L2127'>                    state = "online";
<a name='L2128'>                    <b>break</b>;
<a name='L2129'>                <font color='red'>}</font>
<a name='L2130'>                <b>if</b> (state == NULL) <b>continue</b>;
<a name='L2131'>                info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,"slave%d:%s,%d,%s\r\n",
<a name='L2132'>                    slaveid,ip,slave-&gt;slave_listening_port,state);
<a name='L2133'>                slaveid++;
<a name='L2134'>            <font color='red'>}</font>
<a name='L2135'>        <font color='red'>}</font>
<a name='L2136'>    <font color='red'>}</font>
<a name='L2137'>
<a name='L2138'>    <i><font color='green'>/* CPU */</font></i>
<a name='L2139'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"cpu")) <font color='red'>{</font>
<a name='L2140'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L2141'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2142'>        "# CPU\r\n"
<a name='L2143'>        "used_cpu_sys:%.2f\r\n"
<a name='L2144'>        "used_cpu_user:%.2f\r\n"
<a name='L2145'>        "used_cpu_sys_children:%.2f\r\n"
<a name='L2146'>        "used_cpu_user_children:%.2f\r\n",
<a name='L2147'>        (<b>float</b>)self_ru.ru_stime.tv_sec+(<b>float</b>)self_ru.ru_stime.tv_usec/1000000,
<a name='L2148'>        (<b>float</b>)self_ru.ru_utime.tv_sec+(<b>float</b>)self_ru.ru_utime.tv_usec/1000000,
<a name='L2149'>        (<b>float</b>)c_ru.ru_stime.tv_sec+(<b>float</b>)c_ru.ru_stime.tv_usec/1000000,
<a name='L2150'>        (<b>float</b>)c_ru.ru_utime.tv_sec+(<b>float</b>)c_ru.ru_utime.tv_usec/1000000);
<a name='L2151'>    <font color='red'>}</font>
<a name='L2152'>
<a name='L2153'>    <i><font color='green'>/* cmdtime */</font></i>
<a name='L2154'>    <b>if</b> (allsections || !strcasecmp(section,"commandstats")) <font color='red'>{</font>
<a name='L2155'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L2156'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info, "# Commandstats\r\n");
<a name='L2157'>        numcommands = <b>sizeof</b>(redisCommandTable)/<b>sizeof</b>(<b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a>);
<a name='L2158'>        <b>for</b> (j = 0; j &lt; numcommands; j++) <font color='red'>{</font>
<a name='L2159'>            <b>struct</b> <a href='../D/3782.html' title='Multiple defined in 2 places.'>redisCommand</a> *c = redisCommandTable+j;
<a name='L2160'>
<a name='L2161'>            <b>if</b> (!c-&gt;calls) <b>continue</b>;
<a name='L2162'>            info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info,
<a name='L2163'>                "cmdstat_%s:calls=%lld,usec=%lld,usec_per_call=%.2f\r\n",
<a name='L2164'>                c-&gt;name, c-&gt;calls, c-&gt;microseconds,
<a name='L2165'>                (c-&gt;calls == 0) ? 0 : ((<b>float</b>)c-&gt;microseconds/c-&gt;calls));
<a name='L2166'>        <font color='red'>}</font>
<a name='L2167'>    <font color='red'>}</font>
<a name='L2168'>
<a name='L2169'>    <i><font color='green'>/* Key space */</font></i>
<a name='L2170'>    <b>if</b> (allsections || defsections || !strcasecmp(section,"keyspace")) <font color='red'>{</font>
<a name='L2171'>        <b>if</b> (sections++) info = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(info,"\r\n");
<a name='L2172'>        info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info, "# Keyspace\r\n");
<a name='L2173'>        <b>for</b> (j = 0; j &lt; server.dbnum; j++) <font color='red'>{</font>
<a name='L2174'>            <b>long</b> <b>long</b> keys, vkeys;
<a name='L2175'>
<a name='L2176'>            keys = <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L2177'>            vkeys = <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(server.db[j].expires);
<a name='L2178'>            <b>if</b> (keys || vkeys) <font color='red'>{</font>
<a name='L2179'>                info = <a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(info, "db%d:keys=%lld,expires=%lld\r\n",
<a name='L2180'>                    j, keys, vkeys);
<a name='L2181'>            <font color='red'>}</font>
<a name='L2182'>        <font color='red'>}</font>
<a name='L2183'>    <font color='red'>}</font>
<a name='L2184'>    <b>return</b> info;
<a name='L2185'><font color='red'>}</font>
<a name='L2186'>
<a name='L2187'><b>void</b> <a href='../R/2201.html' title='Multiple refered from 2 places.'>infoCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L2188'>    <b>char</b> *section = c-&gt;argc == 2 ? c-&gt;argv[1]-&gt;ptr : "default";
<a name='L2189'>
<a name='L2190'>    <b>if</b> (c-&gt;argc &gt; 2) <font color='red'>{</font>
<a name='L2191'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.syntaxerr);
<a name='L2192'>        <b>return</b>;
<a name='L2193'>    <font color='red'>}</font>
<a name='L2194'>    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> info = <a href='../S/35.html#L1838' title='Defined at 1838 in src/redis.c.'>genRedisInfoString</a>(section);
<a name='L2195'>    <a href='../S/86.html#L304' title='Defined at 304 in src/networking.c.'>addReplySds</a>(c,<a href='../D/3996.html' title='Multiple defined in 2 places.'>sdscatprintf</a>(<a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>(),"$%lu\r\n",
<a name='L2196'>        (<b>unsigned</b> <b>long</b>)<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(info)));
<a name='L2197'>    <a href='../S/86.html#L304' title='Defined at 304 in src/networking.c.'>addReplySds</a>(c,info);
<a name='L2198'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.crlf);
<a name='L2199'><font color='red'>}</font>
<a name='L2200'>
<a name='L2201'><b>void</b> <a href='../R/3021.html' title='Multiple refered from 2 places.'>monitorCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L2202'>    <i><font color='green'>/* ignore MONITOR if already slave or in monitor mode */</font></i>
<a name='L2203'>    <b>if</b> (c-&gt;flags &amp; <a href='../S/32.html#L172' title='Defined at 172 in src/redis.h.'>REDIS_SLAVE</a>) <b>return</b>;
<a name='L2204'>
<a name='L2205'>    c-&gt;flags |= (<a href='../S/32.html#L172' title='Defined at 172 in src/redis.h.'>REDIS_SLAVE</a>|<a href='../S/32.html#L174' title='Defined at 174 in src/redis.h.'>REDIS_MONITOR</a>);
<a name='L2206'>    c-&gt;slaveseldb = 0;
<a name='L2207'>    <a href='../S/54.html#L106' title='Defined at 106 in src/adlist.c.'>listAddNodeTail</a>(server.monitors,c);
<a name='L2208'>    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.<a href='../S/44.html#L300' title='Defined at 300 in src/intset.c.'>ok</a>);
<a name='L2209'><font color='red'>}</font>
<a name='L2210'>
<a name='L2211'><i><font color='green'>/* ============================ Maxmemory directive  ======================== */</font></i>
<a name='L2212'>
<a name='L2213'><i><font color='green'>/* This function gets called when 'maxmemory' is set on the config file to limit</font></i>
<a name='L2214'><i><font color='green'> * the max memory used by the server, before processing a command.</font></i>
<a name='L2215'><i><font color='green'> *</font></i>
<a name='L2216'><i><font color='green'> * The goal of the function is to free enough memory to keep Redis under the</font></i>
<a name='L2217'><i><font color='green'> * configured memory limit.</font></i>
<a name='L2218'><i><font color='green'> *</font></i>
<a name='L2219'><i><font color='green'> * The function starts calculating how many bytes should be freed to keep</font></i>
<a name='L2220'><i><font color='green'> * Redis under the limit, and enters a loop selecting the best keys to</font></i>
<a name='L2221'><i><font color='green'> * evict accordingly to the configured policy.</font></i>
<a name='L2222'><i><font color='green'> *</font></i>
<a name='L2223'><i><font color='green'> * If all the bytes needed to return back under the limit were freed the</font></i>
<a name='L2224'><i><font color='green'> * function returns REDIS_OK, otherwise REDIS_ERR is returned, and the caller</font></i>
<a name='L2225'><i><font color='green'> * should block the execution of commands that will result in more memory</font></i>
<a name='L2226'><i><font color='green'> * used by the server.</font></i>
<a name='L2227'><i><font color='green'> */</font></i>
<a name='L2228'><b>int</b> <a href='../R/2003.html' title='Multiple refered from 4 places.'>freeMemoryIfNeeded</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2229'>    size_t mem_used, mem_tofree, mem_freed;
<a name='L2230'>    <b>int</b> slaves = <a href='../S/58.html#L57' title='Defined at 57 in src/adlist.h.'>listLength</a>(server.slaves);
<a name='L2231'>
<a name='L2232'>    <i><font color='green'>/* Remove the size of slaves output buffers and AOF buffer from the</font></i>
<a name='L2233'><i><font color='green'>     * count of used memory. */</font></i>
<a name='L2234'>    mem_used = <a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>();
<a name='L2235'>    <b>if</b> (slaves) <font color='red'>{</font>
<a name='L2236'>        <a href='../D/2703.html' title='Multiple defined in 2 places.'>listIter</a> li;
<a name='L2237'>        <a href='../D/2710.html' title='Multiple defined in 2 places.'>listNode</a> *ln;
<a name='L2238'>
<a name='L2239'>        <a href='../S/54.html#L197' title='Defined at 197 in src/adlist.c.'>listRewind</a>(server.slaves,&amp;li);
<a name='L2240'>        <b>while</b>((ln = <a href='../S/54.html#L221' title='Defined at 221 in src/adlist.c.'>listNext</a>(&amp;li))) <font color='red'>{</font>
<a name='L2241'>            <a href='../D/3781.html' title='Multiple defined in 2 places.'>redisClient</a> *slave = <a href='../S/58.html#L62' title='Defined at 62 in src/adlist.h.'>listNodeValue</a>(ln);
<a name='L2242'>            <b>unsigned</b> <b>long</b> obuf_bytes = <a href='../S/86.html#L1257' title='Defined at 1257 in src/networking.c.'>getClientOutputBufferMemoryUsage</a>(slave);
<a name='L2243'>            <b>if</b> (obuf_bytes &gt; mem_used)
<a name='L2244'>                mem_used = 0;
<a name='L2245'>            <b>else</b>
<a name='L2246'>                mem_used -= obuf_bytes;
<a name='L2247'>        <font color='red'>}</font>
<a name='L2248'>    <font color='red'>}</font>
<a name='L2249'>    <b>if</b> (server.aof_state != <a href='../S/32.html#L167' title='Defined at 167 in src/redis.h.'>REDIS_AOF_OFF</a>) <font color='red'>{</font>
<a name='L2250'>        mem_used -= <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(server.aof_buf);
<a name='L2251'>        mem_used -= <a href='../S/62.html#L77' title='Defined at 77 in src/aof.c.'>aofRewriteBufferSize</a>();
<a name='L2252'>    <font color='red'>}</font>
<a name='L2253'>
<a name='L2254'>    <i><font color='green'>/* Check if we are over the memory limit. */</font></i>
<a name='L2255'>    <b>if</b> (mem_used &lt;= server.maxmemory) <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L2256'>
<a name='L2257'>    <b>if</b> (server.maxmemory_policy == <a href='../S/32.html#L266' title='Defined at 266 in src/redis.h.'>REDIS_MAXMEMORY_NO_EVICTION</a>)
<a name='L2258'>        <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>; <i><font color='green'>/* We need to free memory, but policy forbids. */</font></i>
<a name='L2259'>
<a name='L2260'>    <i><font color='green'>/* Compute how much memory we need to free. */</font></i>
<a name='L2261'>    mem_tofree = mem_used - server.maxmemory;
<a name='L2262'>    mem_freed = 0;
<a name='L2263'>    <b>while</b> (mem_freed &lt; mem_tofree) <font color='red'>{</font>
<a name='L2264'>        <b>int</b> j, k, keys_freed = 0;
<a name='L2265'>
<a name='L2266'>        <b>for</b> (j = 0; j &lt; server.dbnum; j++) <font color='red'>{</font>
<a name='L2267'>            <b>long</b> bestval = 0; <i><font color='green'>/* just to prevent warning */</font></i>
<a name='L2268'>            <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> bestkey = NULL;
<a name='L2269'>            <b>struct</b> <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L2270'>            <a href='../D/3798.html' title='Multiple defined in 2 places.'>redisDb</a> *db = server.db+j;
<a name='L2271'>            <a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a> *<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>;
<a name='L2272'>
<a name='L2273'>            <b>if</b> (server.maxmemory_policy == <a href='../S/32.html#L264' title='Defined at 264 in src/redis.h.'>REDIS_MAXMEMORY_ALLKEYS_LRU</a> ||
<a name='L2274'>                server.maxmemory_policy == <a href='../S/32.html#L265' title='Defined at 265 in src/redis.h.'>REDIS_MAXMEMORY_ALLKEYS_RANDOM</a>)
<a name='L2275'>            <font color='red'>{</font>
<a name='L2276'>                <a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a> = server.db[j].<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>;
<a name='L2277'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2278'>                <a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a> = server.db[j].expires;
<a name='L2279'>            <font color='red'>}</font>
<a name='L2280'>            <b>if</b> (<a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>) == 0) <b>continue</b>;
<a name='L2281'>
<a name='L2282'>            <i><font color='green'>/* volatile-random and allkeys-random policy */</font></i>
<a name='L2283'>            <b>if</b> (server.maxmemory_policy == <a href='../S/32.html#L265' title='Defined at 265 in src/redis.h.'>REDIS_MAXMEMORY_ALLKEYS_RANDOM</a> ||
<a name='L2284'>                server.maxmemory_policy == <a href='../S/32.html#L263' title='Defined at 263 in src/redis.h.'>REDIS_MAXMEMORY_VOLATILE_RANDOM</a>)
<a name='L2285'>            <font color='red'>{</font>
<a name='L2286'>                de = <a href='../S/29.html#L568' title='Defined at 568 in src/dict.c.'>dictGetRandomKey</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L2287'>                bestkey = <a href='../S/88.html#L131' title='Defined at 131 in src/dict.h.'>dictGetKey</a>(de);
<a name='L2288'>            <font color='red'>}</font>
<a name='L2289'>
<a name='L2290'>            <i><font color='green'>/* volatile-lru and allkeys-lru policy */</font></i>
<a name='L2291'>            <b>else</b> <b>if</b> (server.maxmemory_policy == <a href='../S/32.html#L264' title='Defined at 264 in src/redis.h.'>REDIS_MAXMEMORY_ALLKEYS_LRU</a> ||
<a name='L2292'>                server.maxmemory_policy == <a href='../S/32.html#L261' title='Defined at 261 in src/redis.h.'>REDIS_MAXMEMORY_VOLATILE_LRU</a>)
<a name='L2293'>            <font color='red'>{</font>
<a name='L2294'>                <b>for</b> (k = 0; k &lt; server.maxmemory_samples; k++) <font color='red'>{</font>
<a name='L2295'>                    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> thiskey;
<a name='L2296'>                    <b>long</b> thisval;
<a name='L2297'>                    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *o;
<a name='L2298'>
<a name='L2299'>                    de = <a href='../S/29.html#L568' title='Defined at 568 in src/dict.c.'>dictGetRandomKey</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L2300'>                    thiskey = <a href='../S/88.html#L131' title='Defined at 131 in src/dict.h.'>dictGetKey</a>(de);
<a name='L2301'>                    <i><font color='green'>/* When policy is volatile-lru we need an additional lookup</font></i>
<a name='L2302'><i><font color='green'>                     * to locate the real key, as dict is set to db-&gt;expires. */</font></i>
<a name='L2303'>                    <b>if</b> (server.maxmemory_policy == <a href='../S/32.html#L261' title='Defined at 261 in src/redis.h.'>REDIS_MAXMEMORY_VOLATILE_LRU</a>)
<a name='L2304'>                        de = <a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(db-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>, thiskey);
<a name='L2305'>                    o = <a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de);
<a name='L2306'>                    thisval = <a href='../S/71.html#L529' title='Defined at 529 in src/object.c.'>estimateObjectIdleTime</a>(o);
<a name='L2307'>
<a name='L2308'>                    <i><font color='green'>/* Higher idle time is better candidate for deletion */</font></i>
<a name='L2309'>                    <b>if</b> (bestkey == NULL || thisval &gt; bestval) <font color='red'>{</font>
<a name='L2310'>                        bestkey = thiskey;
<a name='L2311'>                        bestval = thisval;
<a name='L2312'>                    <font color='red'>}</font>
<a name='L2313'>                <font color='red'>}</font>
<a name='L2314'>            <font color='red'>}</font>
<a name='L2315'>
<a name='L2316'>            <i><font color='green'>/* volatile-ttl */</font></i>
<a name='L2317'>            <b>else</b> <b>if</b> (server.maxmemory_policy == <a href='../S/32.html#L262' title='Defined at 262 in src/redis.h.'>REDIS_MAXMEMORY_VOLATILE_TTL</a>) <font color='red'>{</font>
<a name='L2318'>                <b>for</b> (k = 0; k &lt; server.maxmemory_samples; k++) <font color='red'>{</font>
<a name='L2319'>                    <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> thiskey;
<a name='L2320'>                    <b>long</b> thisval;
<a name='L2321'>
<a name='L2322'>                    de = <a href='../S/29.html#L568' title='Defined at 568 in src/dict.c.'>dictGetRandomKey</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L2323'>                    thiskey = <a href='../S/88.html#L131' title='Defined at 131 in src/dict.h.'>dictGetKey</a>(de);
<a name='L2324'>                    thisval = (<b>long</b>) <a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de);
<a name='L2325'>
<a name='L2326'>                    <i><font color='green'>/* Expire sooner (minor expire unix timestamp) is better</font></i>
<a name='L2327'><i><font color='green'>                     * candidate for deletion */</font></i>
<a name='L2328'>                    <b>if</b> (bestkey == NULL || thisval &lt; bestval) <font color='red'>{</font>
<a name='L2329'>                        bestkey = thiskey;
<a name='L2330'>                        bestval = thisval;
<a name='L2331'>                    <font color='red'>}</font>
<a name='L2332'>                <font color='red'>}</font>
<a name='L2333'>            <font color='red'>}</font>
<a name='L2334'>
<a name='L2335'>            <i><font color='green'>/* Finally remove the selected key. */</font></i>
<a name='L2336'>            <b>if</b> (bestkey) <font color='red'>{</font>
<a name='L2337'>                <b>long</b> <b>long</b> delta;
<a name='L2338'>
<a name='L2339'>                <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *keyobj = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>(bestkey,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(bestkey));
<a name='L2340'>                <a href='../S/31.html#L486' title='Defined at 486 in src/db.c.'>propagateExpire</a>(db,keyobj);
<a name='L2341'>                <i><font color='green'>/* We compute the amount of memory freed by dbDelete() alone.</font></i>
<a name='L2342'><i><font color='green'>                 * It is possible that actually the memory needed to propagate</font></i>
<a name='L2343'><i><font color='green'>                 * the DEL in AOF and replication link is greater than the one</font></i>
<a name='L2344'><i><font color='green'>                 * we are freeing removing the key, but we can't account for</font></i>
<a name='L2345'><i><font color='green'>                 * that otherwise we would never exit the loop.</font></i>
<a name='L2346'><i><font color='green'>                 *</font></i>
<a name='L2347'><i><font color='green'>                 * AOF and Output buffer memory will be freed eventually so</font></i>
<a name='L2348'><i><font color='green'>                 * we only care about memory used by the key space. */</font></i>
<a name='L2349'>                delta = (<b>long</b> <b>long</b>) <a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>();
<a name='L2350'>                <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(db,keyobj);
<a name='L2351'>                delta -= (<b>long</b> <b>long</b>) <a href='../S/39.html#L218' title='Defined at 218 in src/zmalloc.c.'>zmalloc_used_memory</a>();
<a name='L2352'>                mem_freed += delta;
<a name='L2353'>                server.stat_evictedkeys++;
<a name='L2354'>                <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(keyobj);
<a name='L2355'>                keys_freed++;
<a name='L2356'>
<a name='L2357'>                <i><font color='green'>/* When the memory to free starts to be big enough, we may</font></i>
<a name='L2358'><i><font color='green'>                 * start spending so much time here that is impossible to</font></i>
<a name='L2359'><i><font color='green'>                 * deliver data to the slaves fast enough, so we force the</font></i>
<a name='L2360'><i><font color='green'>                 * transmission here inside the loop. */</font></i>
<a name='L2361'>                <b>if</b> (slaves) <a href='../S/86.html#L1355' title='Defined at 1355 in src/networking.c.'>flushSlavesOutputBuffers</a>();
<a name='L2362'>            <font color='red'>}</font>
<a name='L2363'>        <font color='red'>}</font>
<a name='L2364'>        <b>if</b> (!keys_freed) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>; <i><font color='green'>/* nothing to free... */</font></i>
<a name='L2365'>    <font color='red'>}</font>
<a name='L2366'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L2367'><font color='red'>}</font>
<a name='L2368'>
<a name='L2369'><i><font color='green'>/* =================================== Main! ================================ */</font></i>
<a name='L2370'>
<a name='L2371'><font color='darkred'>#ifdef</font> __linux__
<a name='L2372'><b>int</b> <a href='../S/35.html#L2387' title='Refered from 2387 in src/redis.c.'>linuxOvercommitMemoryValue</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2373'>    FILE *fp = fopen("/proc/sys/vm/overcommit_memory","r");
<a name='L2374'>    <b>char</b> buf[64];
<a name='L2375'>
<a name='L2376'>    <b>if</b> (!fp) <b>return</b> -1;
<a name='L2377'>    <b>if</b> (fgets(buf,64,fp) == NULL) <font color='red'>{</font>
<a name='L2378'>        fclose(fp);
<a name='L2379'>        <b>return</b> -1;
<a name='L2380'>    <font color='red'>}</font>
<a name='L2381'>    fclose(fp);
<a name='L2382'>
<a name='L2383'>    <b>return</b> atoi(buf);
<a name='L2384'><font color='red'>}</font>
<a name='L2385'>
<a name='L2386'><b>void</b> <a href='../S/35.html#L2606' title='Refered from 2606 in src/redis.c.'>linuxOvercommitMemoryWarning</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2387'>    <b>if</b> (<a href='../S/35.html#L2372' title='Defined at 2372 in src/redis.c.'>linuxOvercommitMemoryValue</a>() == 0) <font color='red'>{</font>
<a name='L2388'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.");
<a name='L2389'>    <font color='red'>}</font>
<a name='L2390'><font color='red'>}</font>
<a name='L2391'><font color='darkred'>#endif</font> <i><font color='green'>/* __linux__ */</font></i>
<a name='L2392'>
<a name='L2393'><b>void</b> <a href='../S/35.html#L2599' title='Refered from 2599 in src/redis.c.'>createPidFile</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2394'>    <i><font color='green'>/* Try to write the pid file in a best-effort way. */</font></i>
<a name='L2395'>    FILE *fp = fopen(server.pidfile,"w");
<a name='L2396'>    <b>if</b> (fp) <font color='red'>{</font>
<a name='L2397'>        fprintf(fp,"%d\n",(<b>int</b>)getpid());
<a name='L2398'>        fclose(fp);
<a name='L2399'>    <font color='red'>}</font>
<a name='L2400'><font color='red'>}</font>
<a name='L2401'>
<a name='L2402'><b>void</b> <a href='../R/1755.html' title='Multiple refered from 9 places.'>daemonize</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2403'>    <b>int</b> fd;
<a name='L2404'>
<a name='L2405'>    <b>if</b> (fork() != 0) exit(0); <i><font color='green'>/* parent exits */</font></i>
<a name='L2406'>    setsid(); <i><font color='green'>/* create a new session */</font></i>
<a name='L2407'>
<a name='L2408'>    <i><font color='green'>/* Every output goes to /dev/null. If Redis is daemonized but</font></i>
<a name='L2409'><i><font color='green'>     * the 'logfile' is set to 'stdout' in the configuration file</font></i>
<a name='L2410'><i><font color='green'>     * it will not log at all. */</font></i>
<a name='L2411'>    <b>if</b> ((fd = open("/dev/null", O_RDWR, 0)) != -1) <font color='red'>{</font>
<a name='L2412'>        dup2(fd, STDIN_FILENO);
<a name='L2413'>        dup2(fd, STDOUT_FILENO);
<a name='L2414'>        dup2(fd, STDERR_FILENO);
<a name='L2415'>        <b>if</b> (fd &gt; STDERR_FILENO) close(fd);
<a name='L2416'>    <font color='red'>}</font>
<a name='L2417'><font color='red'>}</font>
<a name='L2418'>
<a name='L2419'><b>void</b> <a href='../R/4078.html' title='Multiple refered from 23 places.'>version</a>() <font color='red'>{</font>
<a name='L2420'>    printf("Redis server v=%s sha=%s:%d malloc=%s bits=%d\n",
<a name='L2421'>        <a href='../S/43.html#L1' title='Defined at 1 in src/version.h.'>REDIS_VERSION</a>,
<a name='L2422'>        <a href='../S/33.html#L36' title='Defined at 36 in src/release.c.'>redisGitSHA1</a>(),
<a name='L2423'>        atoi(<a href='../S/33.html#L40' title='Defined at 40 in src/release.c.'>redisGitDirty</a>()) &gt; 0,
<a name='L2424'>        <a href='../D/1344.html' title='Multiple defined in 3 places.'>ZMALLOC_LIB</a>,
<a name='L2425'>        <b>sizeof</b>(<b>long</b>) == 4 ? 32 : 64);
<a name='L2426'>    exit(0);
<a name='L2427'><font color='red'>}</font>
<a name='L2428'>
<a name='L2429'><b>void</b> <a href='../R/4070.html' title='Multiple refered from 10 places.'>usage</a>() <font color='red'>{</font>
<a name='L2430'>    fprintf(stderr,"Usage: ./redis-server [/path/to/redis.conf] [options]\n");
<a name='L2431'>    fprintf(stderr,"       ./redis-server - (read config from stdin)\n");
<a name='L2432'>    fprintf(stderr,"       ./redis-server -v or --version\n");
<a name='L2433'>    fprintf(stderr,"       ./redis-server -h or --help\n");
<a name='L2434'>    fprintf(stderr,"       ./redis-server --test-memory &lt;megabytes&gt;\n\n");
<a name='L2435'>    fprintf(stderr,"Examples:\n");
<a name='L2436'>    fprintf(stderr,"       ./redis-server (run the server with default conf)\n");
<a name='L2437'>    fprintf(stderr,"       ./redis-server /etc/redis/6379.conf\n");
<a name='L2438'>    fprintf(stderr,"       ./redis-server --port 7777\n");
<a name='L2439'>    fprintf(stderr,"       ./redis-server --port 7777 --slaveof 127.0.0.1 8888\n");
<a name='L2440'>    fprintf(stderr,"       ./redis-server /etc/myredis.conf --loglevel verbose\n\n");
<a name='L2441'>    fprintf(stderr,"Sentinel mode:\n");
<a name='L2442'>    fprintf(stderr,"       ./redis-server /etc/sentinel.conf --sentinel\n");
<a name='L2443'>    exit(1);
<a name='L2444'><font color='red'>}</font>
<a name='L2445'>
<a name='L2446'><b>void</b> <a href='../S/35.html#L2600' title='Refered from 2600 in src/redis.c.'>redisAsciiArt</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2447'><font color='darkred'>#include</font> "<a href='24.html'>asciilogo.h</a>"
<a name='L2448'>    <b>char</b> *buf = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(1024*16);
<a name='L2449'>    <b>char</b> *mode = "stand alone";
<a name='L2450'>
<a name='L2451'>    <b>if</b> (server.sentinel_mode) mode = "sentinel";
<a name='L2452'>
<a name='L2453'>    snprintf(buf,1024*16,ascii_logo,
<a name='L2454'>        <a href='../S/43.html#L1' title='Defined at 1 in src/version.h.'>REDIS_VERSION</a>,
<a name='L2455'>        <a href='../S/33.html#L36' title='Defined at 36 in src/release.c.'>redisGitSHA1</a>(),
<a name='L2456'>        strtol(<a href='../S/33.html#L40' title='Defined at 40 in src/release.c.'>redisGitDirty</a>(),NULL,10) &gt; 0,
<a name='L2457'>        (<b>sizeof</b>(<b>long</b>) == 8) ? "64" : "32",
<a name='L2458'>        mode, server.port,
<a name='L2459'>        (<b>long</b>) getpid()
<a name='L2460'>    );
<a name='L2461'>    <a href='../S/35.html#L260' title='Defined at 260 in src/redis.c.'>redisLogRaw</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>|<a href='../S/32.html#L233' title='Defined at 233 in src/redis.h.'>REDIS_LOG_RAW</a>,buf);
<a name='L2462'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(buf);
<a name='L2463'><font color='red'>}</font>
<a name='L2464'>
<a name='L2465'><b>static</b> <b>void</b> <a href='../S/35.html#L2479' title='Refered from 2479 in src/redis.c.'>sigtermHandler</a>(<b>int</b> sig) <font color='red'>{</font>
<a name='L2466'>    <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(sig);
<a name='L2467'>
<a name='L2468'>    <a href='../S/35.html#L313' title='Defined at 313 in src/redis.c.'>redisLogFromHandler</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Received SIGTERM, scheduling shutdown...");
<a name='L2469'>    server.shutdown_asap = 1;
<a name='L2470'><font color='red'>}</font>
<a name='L2471'>
<a name='L2472'><b>void</b> <a href='../R/3784.html' title='Multiple refered from 2 places.'>setupSignalHandlers</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2473'>    <b>struct</b> sigaction act;
<a name='L2474'>
<a name='L2475'>    <i><font color='green'>/* When the SA_SIGINFO flag is set in sa_flags then sa_sigaction is used.</font></i>
<a name='L2476'><i><font color='green'>     * Otherwise, sa_handler is used. */</font></i>
<a name='L2477'>    sigemptyset(&amp;act.sa_mask);
<a name='L2478'>    act.sa_flags = 0;
<a name='L2479'>    act.sa_handler = <a href='../S/35.html#L2465' title='Defined at 2465 in src/redis.c.'>sigtermHandler</a>;
<a name='L2480'>    sigaction(SIGTERM, &amp;act, NULL);
<a name='L2481'>
<a name='L2482'><font color='darkred'>#ifdef</font> <a href='../S/53.html#L58' title='Defined at 58 in src/config.h.'>HAVE_BACKTRACE</a>
<a name='L2483'>    sigemptyset(&amp;act.sa_mask);
<a name='L2484'>    act.sa_flags = SA_NODEFER | SA_RESETHAND | SA_SIGINFO;
<a name='L2485'>    act.sa_sigaction = <a href='../S/69.html#L668' title='Defined at 668 in src/debug.c.'>sigsegvHandler</a>;
<a name='L2486'>    sigaction(SIGSEGV, &amp;act, NULL);
<a name='L2487'>    sigaction(SIGBUS, &amp;act, NULL);
<a name='L2488'>    sigaction(SIGFPE, &amp;act, NULL);
<a name='L2489'>    sigaction(SIGILL, &amp;act, NULL);
<a name='L2490'><font color='darkred'>#endif</font>
<a name='L2491'>    <b>return</b>;
<a name='L2492'><font color='red'>}</font>
<a name='L2493'>
<a name='L2494'><b>void</b> <a href='../S/19.html#L243' title='Defined at 243 in src/memtest.c.'>memtest</a>(size_t megabytes, <b>int</b> passes);
<a name='L2495'>
<a name='L2496'><i><font color='green'>/* Returns 1 if there is --sentinel among the arguments or if</font></i>
<a name='L2497'><i><font color='green'> * argv[0] is exactly "redis-sentinel". */</font></i>
<a name='L2498'><b>int</b> <a href='../S/35.html#L2539' title='Refered from 2539 in src/redis.c.'>checkForSentinelMode</a>(<b>int</b> argc, <b>char</b> **argv) <font color='red'>{</font>
<a name='L2499'>    <b>int</b> j;
<a name='L2500'>
<a name='L2501'>    <b>if</b> (strstr(argv[0],"redis-sentinel") != NULL) <b>return</b> 1;
<a name='L2502'>    <b>for</b> (j = 1; j &lt; argc; j++)
<a name='L2503'>        <b>if</b> (!strcmp(argv[j],"--sentinel")) <b>return</b> 1;
<a name='L2504'>    <b>return</b> 0;
<a name='L2505'><font color='red'>}</font>
<a name='L2506'>
<a name='L2507'><i><font color='green'>/* Function called at startup to load RDB or AOF file in memory. */</font></i>
<a name='L2508'><b>void</b> <a href='../S/35.html#L2608' title='Refered from 2608 in src/redis.c.'>loadDataFromDisk</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2509'>    <b>long</b> <b>long</b> start = <a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>();
<a name='L2510'>    <b>if</b> (server.aof_state == <a href='../S/32.html#L168' title='Defined at 168 in src/redis.h.'>REDIS_AOF_ON</a>) <font color='red'>{</font>
<a name='L2511'>        <b>if</b> (<a href='../S/62.html#L475' title='Defined at 475 in src/aof.c.'>loadAppendOnlyFile</a>(server.aof_filename) == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L2512'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"DB loaded from append only file: %.3f seconds",(<b>float</b>)(<a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>()-start)/1000000);
<a name='L2513'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2514'>        <b>if</b> (<a href='../S/87.html#L1060' title='Defined at 1060 in src/rdb.c.'>rdbLoad</a>(server.rdb_filename) == <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <font color='red'>{</font>
<a name='L2515'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"DB loaded from disk: %.3f seconds",
<a name='L2516'>                (<b>float</b>)(<a href='../D/4460.html' title='Multiple defined in 2 places.'>ustime</a>()-start)/1000000);
<a name='L2517'>        <font color='red'>}</font> <b>else</b> <b>if</b> (errno != ENOENT) <font color='red'>{</font>
<a name='L2518'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Fatal error loading the DB. Exiting.");
<a name='L2519'>            exit(1);
<a name='L2520'>        <font color='red'>}</font>
<a name='L2521'>    <font color='red'>}</font>
<a name='L2522'><font color='red'>}</font>
<a name='L2523'>
<a name='L2524'><b>void</b> <a href='../S/35.html#L2535' title='Refered from 2535 in src/redis.c.'>redisOutOfMemoryHandler</a>(size_t allocation_size) <font color='red'>{</font>
<a name='L2525'>    <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Out Of Memory allocating %zu bytes!",
<a name='L2526'>        allocation_size);
<a name='L2527'>    <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("OOM");
<a name='L2528'><font color='red'>}</font>
<a name='L2529'>
<a name='L2530'><b>int</b> main(<b>int</b> argc, <b>char</b> **argv) <font color='red'>{</font>
<a name='L2531'>    <b>struct</b> timeval tv;
<a name='L2532'>
<a name='L2533'>    <i><font color='green'>/* We need to initialize our libraries, and the server configuration. */</font></i>
<a name='L2534'>    <a href='../S/39.html#L237' title='Defined at 237 in src/zmalloc.c.'>zmalloc_enable_thread_safeness</a>();
<a name='L2535'>    <a href='../S/39.html#L241' title='Defined at 241 in src/zmalloc.c.'>zmalloc_set_oom_handler</a>(<a href='../S/35.html#L2524' title='Defined at 2524 in src/redis.c.'>redisOutOfMemoryHandler</a>);
<a name='L2536'>    srand(time(NULL)^getpid());
<a name='L2537'>    gettimeofday(&amp;tv,NULL);
<a name='L2538'>    <a href='../S/29.html#L90' title='Defined at 90 in src/dict.c.'>dictSetHashFunctionSeed</a>(tv.tv_sec^tv.tv_usec^getpid());
<a name='L2539'>    server.sentinel_mode = <a href='../S/35.html#L2498' title='Defined at 2498 in src/redis.c.'>checkForSentinelMode</a>(argc,argv);
<a name='L2540'>    <a href='../S/35.html#L1083' title='Defined at 1083 in src/redis.c.'>initServerConfig</a>();
<a name='L2541'>
<a name='L2542'>    <i><font color='green'>/* We need to init sentinel right now as parsing the configuration file</font></i>
<a name='L2543'><i><font color='green'>     * in sentinel mode will have the effect of populating the sentinel</font></i>
<a name='L2544'><i><font color='green'>     * data structures with master nodes to monitor. */</font></i>
<a name='L2545'>    <b>if</b> (server.sentinel_mode) <font color='red'>{</font>
<a name='L2546'>        <a href='../S/82.html#L384' title='Defined at 384 in src/sentinel.c.'>initSentinelConfig</a>();
<a name='L2547'>        <a href='../S/82.html#L389' title='Defined at 389 in src/sentinel.c.'>initSentinel</a>();
<a name='L2548'>    <font color='red'>}</font>
<a name='L2549'>
<a name='L2550'>    <b>if</b> (argc &gt;= 2) <font color='red'>{</font>
<a name='L2551'>        <b>int</b> j = 1; <i><font color='green'>/* First option to parse in argv[] */</font></i>
<a name='L2552'>        <a href='../D/3987.html' title='Multiple defined in 2 places.'>sds</a> options = <a href='../D/4005.html' title='Multiple defined in 2 places.'>sdsempty</a>();
<a name='L2553'>        <b>char</b> *configfile = NULL;
<a name='L2554'>
<a name='L2555'>        <i><font color='green'>/* Handle special options --help and --version */</font></i>
<a name='L2556'>        <b>if</b> (strcmp(argv[1], "-v") == 0 ||
<a name='L2557'>            strcmp(argv[1], "--version") == 0) <a href='../S/35.html#L2419' title='Defined at 2419 in src/redis.c.'>version</a>();
<a name='L2558'>        <b>if</b> (strcmp(argv[1], "--help") == 0 ||
<a name='L2559'>            strcmp(argv[1], "-h") == 0) <a href='../D/4458.html' title='Multiple defined in 3 places.'>usage</a>();
<a name='L2560'>        <b>if</b> (strcmp(argv[1], "--test-memory") == 0) <font color='red'>{</font>
<a name='L2561'>            <b>if</b> (argc == 3) <font color='red'>{</font>
<a name='L2562'>                <a href='../S/19.html#L243' title='Defined at 243 in src/memtest.c.'>memtest</a>(atoi(argv[2]),50);
<a name='L2563'>                exit(0);
<a name='L2564'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2565'>                fprintf(stderr,"Please specify the amount of memory to test in megabytes.\n");
<a name='L2566'>                fprintf(stderr,"Example: ./redis-server --test-memory 4096\n\n");
<a name='L2567'>                exit(1);
<a name='L2568'>            <font color='red'>}</font>
<a name='L2569'>        <font color='red'>}</font>
<a name='L2570'>
<a name='L2571'>        <i><font color='green'>/* First argument is the config file name? */</font></i>
<a name='L2572'>        <b>if</b> (argv[j][0] != '-' || argv[j][1] != '-')
<a name='L2573'>            configfile = argv[j++];
<a name='L2574'>        <i><font color='green'>/* All the other options are parsed and conceptually appended to the</font></i>
<a name='L2575'><i><font color='green'>         * configuration file. For instance --port 6380 will generate the</font></i>
<a name='L2576'><i><font color='green'>         * string "port 6380\n" to be parsed after the actual file name</font></i>
<a name='L2577'><i><font color='green'>         * is parsed, if any. */</font></i>
<a name='L2578'>        <b>while</b>(j != argc) <font color='red'>{</font>
<a name='L2579'>            <b>if</b> (argv[j][0] == '-' &amp;&amp; argv[j][1] == '-') <font color='red'>{</font>
<a name='L2580'>                <i><font color='green'>/* Option name */</font></i>
<a name='L2581'>                <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(options)) options = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(options,"\n");
<a name='L2582'>                options = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(options,argv[j]+2);
<a name='L2583'>                options = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(options," ");
<a name='L2584'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2585'>                <i><font color='green'>/* Option argument */</font></i>
<a name='L2586'>                options = <a href='../D/3997.html' title='Multiple defined in 2 places.'>sdscatrepr</a>(options,argv[j],strlen(argv[j]));
<a name='L2587'>                options = <a href='../D/3994.html' title='Multiple defined in 2 places.'>sdscat</a>(options," ");
<a name='L2588'>            <font color='red'>}</font>
<a name='L2589'>            j++;
<a name='L2590'>        <font color='red'>}</font>
<a name='L2591'>        <a href='../S/96.html#L51' title='Defined at 51 in src/config.c.'>resetServerSaveParams</a>();
<a name='L2592'>        <a href='../S/96.html#L417' title='Defined at 417 in src/config.c.'>loadServerConfig</a>(configfile,options);
<a name='L2593'>        <a href='../D/4006.html' title='Multiple defined in 2 places.'>sdsfree</a>(options);
<a name='L2594'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2595'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>, "Warning: no config file specified, using the default config. In order to specify a config file use %s /path/to/%s.conf", argv[0], server.sentinel_mode ? "sentinel" : "redis");
<a name='L2596'>    <font color='red'>}</font>
<a name='L2597'>    <b>if</b> (server.<a href='../S/35.html#L2402' title='Defined at 2402 in src/redis.c.'>daemonize</a>) <a href='../S/35.html#L2402' title='Defined at 2402 in src/redis.c.'>daemonize</a>();
<a name='L2598'>    <a href='../S/35.html#L1248' title='Defined at 1248 in src/redis.c.'>initServer</a>();
<a name='L2599'>    <b>if</b> (server.<a href='../S/35.html#L2402' title='Defined at 2402 in src/redis.c.'>daemonize</a>) <a href='../S/35.html#L2393' title='Defined at 2393 in src/redis.c.'>createPidFile</a>();
<a name='L2600'>    <a href='../S/35.html#L2446' title='Defined at 2446 in src/redis.c.'>redisAsciiArt</a>();
<a name='L2601'>
<a name='L2602'>    <b>if</b> (!server.sentinel_mode) <font color='red'>{</font>
<a name='L2603'>        <i><font color='green'>/* Things only needed when not running in Sentinel mode. */</font></i>
<a name='L2604'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"Server started, Redis version " <a href='../S/43.html#L1' title='Defined at 1 in src/version.h.'>REDIS_VERSION</a>);
<a name='L2605'><font color='darkred'>    #ifdef</font> __linux__
<a name='L2606'>        <a href='../S/35.html#L2386' title='Defined at 2386 in src/redis.c.'>linuxOvercommitMemoryWarning</a>();
<a name='L2607'><font color='darkred'>    #endif</font>
<a name='L2608'>        <a href='../S/35.html#L2508' title='Defined at 2508 in src/redis.c.'>loadDataFromDisk</a>();
<a name='L2609'>        <b>if</b> (server.ipfd &gt; 0)
<a name='L2610'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"The server is now ready to accept connections on port %d", server.port);
<a name='L2611'>        <b>if</b> (server.sofd &gt; 0)
<a name='L2612'>            <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L231' title='Defined at 231 in src/redis.h.'>REDIS_NOTICE</a>,"The server is now ready to accept connections at %s", server.unixsocket);
<a name='L2613'>    <font color='red'>}</font>
<a name='L2614'>
<a name='L2615'>    <i><font color='green'>/* Warning the user about suspicious maxmemory setting. */</font></i>
<a name='L2616'>    <b>if</b> (server.maxmemory &gt; 0 &amp;&amp; server.maxmemory &lt; 1024*1024) <font color='red'>{</font>
<a name='L2617'>        <a href='../S/35.html#L294' title='Defined at 294 in src/redis.c.'>redisLog</a>(<a href='../S/32.html#L232' title='Defined at 232 in src/redis.h.'>REDIS_WARNING</a>,"WARNING: You specified a maxmemory value that is less than 1MB (current value is %llu bytes). Are you sure this is what you really want?", server.maxmemory);
<a name='L2618'>    <font color='red'>}</font>
<a name='L2619'>
<a name='L2620'>    <a href='../S/36.html#L429' title='Defined at 429 in src/ae.c.'>aeSetBeforeSleepProc</a>(server.el,<a href='../S/35.html#L985' title='Defined at 985 in src/redis.c.'>beforeSleep</a>);
<a name='L2621'>    <a href='../S/36.html#L416' title='Defined at 416 in src/ae.c.'>aeMain</a>(server.el);
<a name='L2622'>    <a href='../S/36.html#L93' title='Defined at 93 in src/ae.c.'>aeDeleteEventLoop</a>(server.el);
<a name='L2623'>    <b>return</b> 0;
<a name='L2624'><font color='red'>}</font>
<a name='L2625'>
<a name='L2626'><i><font color='green'>/* The End */</font></i>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L260'>[^]</a><a href='#L2530'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
