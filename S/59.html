<html>
<head>
<title>src/t_zset.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/401.html'>src</a>/t_zset.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L55'>[^]</a><a href='#L2179'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L55' title='Defined at 55.'>zslCreateNode</a>
<li><a href='#L62' title='Defined at 62.'>zslCreate</a>
<li><a href='#L79' title='Defined at 79.'>zslFreeNode</a>
<li><a href='#L84' title='Defined at 84.'>zslFree</a>
<li><a href='#L100' title='Defined at 100.'>zslRandomLevel</a>
<li><a href='#L107' title='Defined at 107.'>zslInsert</a>
<li><a href='#L164' title='Defined at 164.'>zslDeleteNode</a>
<li><a href='#L185' title='Defined at 185.'>zslDelete</a>
<li><a href='#L211' title='Defined at 211.'>zslValueGteMin</a>
<li><a href='#L215' title='Defined at 215.'>zslValueLteMax</a>
<li><a href='#L220' title='Defined at 220.'>zslIsInRange</a>
<li><a href='#L238' title='Defined at 238.'>zslFirstInRange</a>
<li><a href='#L264' title='Defined at 264.'>zslLastInRange</a>
<li><a href='#L291' title='Defined at 291.'>zslDeleteRangeByScore</a>
<li><a href='#L322' title='Defined at 322.'>zslDeleteRangeByRank</a>
<li><a href='#L354' title='Defined at 354.'>zslGetRank</a>
<li><a href='#L378' title='Defined at 378.'>zslGetElementByRank</a>
<li><a href='#L398' title='Defined at 398.'>zslParseRange</a>
<li><a href='#L438' title='Defined at 438.'>zzlGetScore</a>
<li><a href='#L460' title='Defined at 460.'>zzlCompareElements</a>
<li><a href='#L480' title='Defined at 480.'>zzlLength</a>
<li><a href='#L486' title='Defined at 486.'>zzlNext</a>
<li><a href='#L505' title='Defined at 505.'>zzlPrev</a>
<li><a href='#L524' title='Defined at 524.'>zzlIsInRange</a>
<li><a href='#L550' title='Defined at 550.'>zzlFirstInRange</a>
<li><a href='#L578' title='Defined at 578.'>zzlLastInRange</a>
<li><a href='#L609' title='Defined at 609.'>zzlFind</a>
<li><a href='#L634' title='Defined at 634.'>zzlDelete</a>
<li><a href='#L643' title='Defined at 643.'>zzlInsertAt</a>
<li><a href='#L670' title='Defined at 670.'>zzlInsert</a>
<li><a href='#L706' title='Defined at 706.'>zzlDeleteRangeByScore</a>
<li><a href='#L737' title='Defined at 737.'>zzlDeleteRangeByRank</a>
<li><a href='#L748' title='Defined at 748.'>zsetLength</a>
<li><a href='#L760' title='Defined at 760.'>zsetConvert</a>
<li><a href='#L841' title='Defined at 841.'>zaddGenericCommand</a>
<li><a href='#L984' title='Defined at 984.'>zaddCommand</a>
<li><a href='#L988' title='Defined at 988.'>zincrbyCommand</a>
<li><a href='#L992' title='Defined at 992.'>zremCommand</a>
<li><a href='#L1047' title='Defined at 1047.'>zremrangebyscoreCommand</a>
<li><a href='#L1079' title='Defined at 1079.'>zremrangebyrankCommand</a>
<li><a href='#L1186' title='Defined at 1186.'>zuiInitIterator</a>
<li><a href='#L1222' title='Defined at 1222.'>zuiClearIterator</a>
<li><a href='#L1249' title='Defined at 1249.'>zuiLength</a>
<li><a href='#L1279' title='Defined at 1279.'>zuiNext</a>
<li><a href='#L1339' title='Defined at 1339.'>zuiLongLongFromValue</a>
<li><a href='#L1364' title='Defined at 1364.'>zuiObjectFromValue</a>
<li><a href='#L1376' title='Defined at 1376.'>zuiBufferFromValue</a>
<li><a href='#L1398' title='Defined at 1398.'>zuiFind</a>
<li><a href='#L1450' title='Defined at 1450.'>zuiCompareByCardinality</a>
<li><a href='#L1459' title='Defined at 1459.'>zunionInterAggregate</a>
<li><a href='#L1476' title='Defined at 1476.'>zunionInterGenericCommand</a>
<li><a href='#L1684' title='Defined at 1684.'>zunionstoreCommand</a>
<li><a href='#L1688' title='Defined at 1688.'>zinterstoreCommand</a>
<li><a href='#L1692' title='Defined at 1692.'>zrangeGenericCommand</a>
<li><a href='#L1794' title='Defined at 1794.'>zrangeCommand</a>
<li><a href='#L1798' title='Defined at 1798.'>zrevrangeCommand</a>
<li><a href='#L1803' title='Defined at 1803.'>genericZrangebyscoreCommand</a>
<li><a href='#L1989' title='Defined at 1989.'>zrangebyscoreCommand</a>
<li><a href='#L1993' title='Defined at 1993.'>zrevrangebyscoreCommand</a>
<li><a href='#L1997' title='Defined at 1997.'>zcountCommand</a>
<li><a href='#L2074' title='Defined at 2074.'>zcardCommand</a>
<li><a href='#L2084' title='Defined at 2084.'>zscoreCommand</a>
<li><a href='#L2114' title='Defined at 2114.'>zrankGenericCommand</a>
<li><a href='#L2175' title='Defined at 2175.'>zrankCommand</a>
<li><a href='#L2179' title='Defined at 2179.'>zrevrankCommand</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'> * Copyright (c) 2009-2012, Salvatore Sanfilippo &lt;antirez at gmail dot com&gt;</font></i>
<a name='L3'><i><font color='green'> * Copyright (c) 2009-2012, Pieter Noordhuis &lt;pcnoordhuis at gmail dot com&gt;</font></i>
<a name='L4'><i><font color='green'> * All rights reserved.</font></i>
<a name='L5'><i><font color='green'> *</font></i>
<a name='L6'><i><font color='green'> * Redistribution and use in source and binary forms, with or without</font></i>
<a name='L7'><i><font color='green'> * modification, are permitted provided that the following conditions are met:</font></i>
<a name='L8'><i><font color='green'> *</font></i>
<a name='L9'><i><font color='green'> *   * Redistributions of source code must retain the above copyright notice,</font></i>
<a name='L10'><i><font color='green'> *     this list of conditions and the following disclaimer.</font></i>
<a name='L11'><i><font color='green'> *   * Redistributions in binary form must reproduce the above copyright</font></i>
<a name='L12'><i><font color='green'> *     notice, this list of conditions and the following disclaimer in the</font></i>
<a name='L13'><i><font color='green'> *     documentation and/or other materials provided with the distribution.</font></i>
<a name='L14'><i><font color='green'> *   * Neither the name of Redis nor the names of its contributors may be used</font></i>
<a name='L15'><i><font color='green'> *     to endorse or promote products derived from this software without</font></i>
<a name='L16'><i><font color='green'> *     specific prior written permission.</font></i>
<a name='L17'><i><font color='green'> *</font></i>
<a name='L18'><i><font color='green'> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</font></i>
<a name='L19'><i><font color='green'> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</font></i>
<a name='L20'><i><font color='green'> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</font></i>
<a name='L21'><i><font color='green'> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</font></i>
<a name='L22'><i><font color='green'> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</font></i>
<a name='L23'><i><font color='green'> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</font></i>
<a name='L24'><i><font color='green'> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</font></i>
<a name='L25'><i><font color='green'> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</font></i>
<a name='L26'><i><font color='green'> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</font></i>
<a name='L27'><i><font color='green'> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</font></i>
<a name='L28'><i><font color='green'> * POSSIBILITY OF SUCH DAMAGE.</font></i>
<a name='L29'><i><font color='green'> */</font></i>
<a name='L30'>
<a name='L31'><i><font color='green'>/*-----------------------------------------------------------------------------</font></i>
<a name='L32'><i><font color='green'> * Sorted set API</font></i>
<a name='L33'><i><font color='green'> *----------------------------------------------------------------------------*/</font></i>
<a name='L34'>
<a name='L35'><i><font color='green'>/* ZSETs are ordered sets using two data structures to hold the same elements</font></i>
<a name='L36'><i><font color='green'> * in order to get O(log(N)) INSERT and REMOVE operations into a sorted</font></i>
<a name='L37'><i><font color='green'> * data structure.</font></i>
<a name='L38'><i><font color='green'> *</font></i>
<a name='L39'><i><font color='green'> * The elements are added to an hash table mapping Redis objects to scores.</font></i>
<a name='L40'><i><font color='green'> * At the same time the elements are added to a skip list mapping scores</font></i>
<a name='L41'><i><font color='green'> * to Redis objects (so objects are sorted by scores in this "view"). */</font></i>
<a name='L42'>
<a name='L43'><i><font color='green'>/* This skiplist implementation is almost a C translation of the original</font></i>
<a name='L44'><i><font color='green'> * algorithm described by William Pugh in "Skip Lists: A Probabilistic</font></i>
<a name='L45'><i><font color='green'> * Alternative to Balanced Trees", modified in three ways:</font></i>
<a name='L46'><i><font color='green'> * a) this implementation allows for repeated scores.</font></i>
<a name='L47'><i><font color='green'> * b) the comparison is not just by key (our 'score') but by satellite data.</font></i>
<a name='L48'><i><font color='green'> * c) there is a back pointer, so it's a doubly linked list with the back</font></i>
<a name='L49'><i><font color='green'> * pointers being only at "level 1". This allows to traverse the list</font></i>
<a name='L50'><i><font color='green'> * from tail to head, useful for ZREVRANGE. */</font></i>
<a name='L51'>
<a name='L52'><font color='darkred'>#include</font> "<a href='32.html'>redis.h</a>"
<a name='L53'><font color='darkred'>#include</font> &lt;math.h&gt;
<a name='L54'>
<a name='L55'><a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *<a href='../R/4194.html' title='Multiple refered from 2 places.'>zslCreateNode</a>(<b>int</b> level, <b>double</b> score, robj *obj) <font color='red'>{</font>
<a name='L56'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *zn = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(*zn)+level*<b>sizeof</b>(<b>struct</b> zskiplistLevel));
<a name='L57'>    zn-&gt;score = score;
<a name='L58'>    zn-&gt;obj = obj;
<a name='L59'>    <b>return</b> zn;
<a name='L60'><font color='red'>}</font>
<a name='L61'>
<a name='L62'><a href='../D/4581.html' title='Multiple defined in 2 places.'>zskiplist</a> *<a href='../R/4193.html' title='Multiple refered from 3 places.'>zslCreate</a>(<b>void</b>) <font color='red'>{</font>
<a name='L63'>    <b>int</b> j;
<a name='L64'>    <a href='../D/4581.html' title='Multiple defined in 2 places.'>zskiplist</a> *zsl;
<a name='L65'>
<a name='L66'>    zsl = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(*zsl));
<a name='L67'>    zsl-&gt;level = 1;
<a name='L68'>    zsl-&gt;length = 0;
<a name='L69'>    zsl-&gt;header = <a href='../S/59.html#L55' title='Defined at 55 in src/t_zset.c.'>zslCreateNode</a>(<a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>,0,NULL);
<a name='L70'>    <b>for</b> (j = 0; j &lt; <a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>; j++) <font color='red'>{</font>
<a name='L71'>        zsl-&gt;header-&gt;level[j].forward = NULL;
<a name='L72'>        zsl-&gt;header-&gt;level[j].span = 0;
<a name='L73'>    <font color='red'>}</font>
<a name='L74'>    zsl-&gt;header-&gt;backward = NULL;
<a name='L75'>    zsl-&gt;tail = NULL;
<a name='L76'>    <b>return</b> zsl;
<a name='L77'><font color='red'>}</font>
<a name='L78'>
<a name='L79'><b>void</b> <a href='../R/4201.html' title='Multiple refered from 5 places.'>zslFreeNode</a>(zskiplistNode *node) <font color='red'>{</font>
<a name='L80'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(node-&gt;obj);
<a name='L81'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(node);
<a name='L82'><font color='red'>}</font>
<a name='L83'>
<a name='L84'><b>void</b> <a href='../R/4200.html' title='Multiple refered from 2 places.'>zslFree</a>(zskiplist *zsl) <font color='red'>{</font>
<a name='L85'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *node = zsl-&gt;header-&gt;level[0].forward, *<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>;
<a name='L86'>
<a name='L87'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(zsl-&gt;header);
<a name='L88'>    <b>while</b>(node) <font color='red'>{</font>
<a name='L89'>        <a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a> = node-&gt;level[0].forward;
<a name='L90'>        <a href='../S/59.html#L79' title='Defined at 79 in src/t_zset.c.'>zslFreeNode</a>(node);
<a name='L91'>        node = <a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>;
<a name='L92'>    <font color='red'>}</font>
<a name='L93'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(zsl);
<a name='L94'><font color='red'>}</font>
<a name='L95'>
<a name='L96'><i><font color='green'>/* Returns a random level for the new skiplist node we are going to create.</font></i>
<a name='L97'><i><font color='green'> * The return value of this function is between 1 and ZSKIPLIST_MAXLEVEL</font></i>
<a name='L98'><i><font color='green'> * (both inclusive), with a powerlaw-alike distribution where higher</font></i>
<a name='L99'><i><font color='green'> * levels are less likely to be returned. */</font></i>
<a name='L100'><b>int</b> <a href='../S/59.html#L130' title='Refered from 130 in src/t_zset.c.'>zslRandomLevel</a>(<b>void</b>) <font color='red'>{</font>
<a name='L101'>    <b>int</b> level = 1;
<a name='L102'>    <b>while</b> ((random()&amp;0xFFFF) &lt; (<a href='../S/32.html#L239' title='Defined at 239 in src/redis.h.'>ZSKIPLIST_P</a> * 0xFFFF))
<a name='L103'>        level += 1;
<a name='L104'>    <b>return</b> (level&lt;<a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>) ? level : <a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>;
<a name='L105'><font color='red'>}</font>
<a name='L106'>
<a name='L107'><a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *<a href='../R/4204.html' title='Multiple refered from 7 places.'>zslInsert</a>(zskiplist *zsl, <b>double</b> score, robj *obj) <font color='red'>{</font>
<a name='L108'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *update[<a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>], *x;
<a name='L109'>    <b>unsigned</b> <b>int</b> rank[<a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>];
<a name='L110'>    <b>int</b> i, level;
<a name='L111'>
<a name='L112'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(!<a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(score));
<a name='L113'>    x = zsl-&gt;header;
<a name='L114'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L115'>        <i><font color='green'>/* store rank that is crossed to reach the insert position */</font></i>
<a name='L116'>        rank[i] = i == (zsl-&gt;level-1) ? 0 : rank[i+1];
<a name='L117'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp;
<a name='L118'>            (x-&gt;level[i].forward-&gt;score &lt; score ||
<a name='L119'>                (x-&gt;level[i].forward-&gt;score == score &amp;&amp;
<a name='L120'>                <a href='../S/71.html#L338' title='Defined at 338 in src/object.c.'>compareStringObjects</a>(x-&gt;level[i].forward-&gt;obj,obj) &lt; 0))) <font color='red'>{</font>
<a name='L121'>            rank[i] += x-&gt;level[i].span;
<a name='L122'>            x = x-&gt;level[i].forward;
<a name='L123'>        <font color='red'>}</font>
<a name='L124'>        update[i] = x;
<a name='L125'>    <font color='red'>}</font>
<a name='L126'>    <i><font color='green'>/* we assume the key is not already inside, since we allow duplicated</font></i>
<a name='L127'><i><font color='green'>     * scores, and the re-insertion of score and redis object should never</font></i>
<a name='L128'><i><font color='green'>     * happpen since the caller of zslInsert() should test in the hash table</font></i>
<a name='L129'><i><font color='green'>     * if the element is already inside or not. */</font></i>
<a name='L130'>    level = <a href='../S/59.html#L100' title='Defined at 100 in src/t_zset.c.'>zslRandomLevel</a>();
<a name='L131'>    <b>if</b> (level &gt; zsl-&gt;level) <font color='red'>{</font>
<a name='L132'>        <b>for</b> (i = zsl-&gt;level; i &lt; level; i++) <font color='red'>{</font>
<a name='L133'>            rank[i] = 0;
<a name='L134'>            update[i] = zsl-&gt;header;
<a name='L135'>            update[i]-&gt;level[i].span = zsl-&gt;length;
<a name='L136'>        <font color='red'>}</font>
<a name='L137'>        zsl-&gt;level = level;
<a name='L138'>    <font color='red'>}</font>
<a name='L139'>    x = <a href='../S/59.html#L55' title='Defined at 55 in src/t_zset.c.'>zslCreateNode</a>(level,score,obj);
<a name='L140'>    <b>for</b> (i = 0; i &lt; level; i++) <font color='red'>{</font>
<a name='L141'>        x-&gt;level[i].forward = update[i]-&gt;level[i].forward;
<a name='L142'>        update[i]-&gt;level[i].forward = x;
<a name='L143'>
<a name='L144'>        <i><font color='green'>/* update span covered by update[i] as x is inserted here */</font></i>
<a name='L145'>        x-&gt;level[i].span = update[i]-&gt;level[i].span - (rank[0] - rank[i]);
<a name='L146'>        update[i]-&gt;level[i].span = (rank[0] - rank[i]) + 1;
<a name='L147'>    <font color='red'>}</font>
<a name='L148'>
<a name='L149'>    <i><font color='green'>/* increment span for untouched levels */</font></i>
<a name='L150'>    <b>for</b> (i = level; i &lt; zsl-&gt;level; i++) <font color='red'>{</font>
<a name='L151'>        update[i]-&gt;level[i].span++;
<a name='L152'>    <font color='red'>}</font>
<a name='L153'>
<a name='L154'>    x-&gt;backward = (update[0] == zsl-&gt;header) ? NULL : update[0];
<a name='L155'>    <b>if</b> (x-&gt;level[0].forward)
<a name='L156'>        x-&gt;level[0].forward-&gt;backward = x;
<a name='L157'>    <b>else</b>
<a name='L158'>        zsl-&gt;tail = x;
<a name='L159'>    zsl-&gt;length++;
<a name='L160'>    <b>return</b> x;
<a name='L161'><font color='red'>}</font>
<a name='L162'>
<a name='L163'><i><font color='green'>/* Internal function used by zslDelete, zslDeleteByScore and zslDeleteByRank */</font></i>
<a name='L164'><b>void</b> <a href='../R/4196.html' title='Multiple refered from 3 places.'>zslDeleteNode</a>(zskiplist *zsl, zskiplistNode *x, zskiplistNode **update) <font color='red'>{</font>
<a name='L165'>    <b>int</b> i;
<a name='L166'>    <b>for</b> (i = 0; i &lt; zsl-&gt;level; i++) <font color='red'>{</font>
<a name='L167'>        <b>if</b> (update[i]-&gt;level[i].forward == x) <font color='red'>{</font>
<a name='L168'>            update[i]-&gt;level[i].span += x-&gt;level[i].span - 1;
<a name='L169'>            update[i]-&gt;level[i].forward = x-&gt;level[i].forward;
<a name='L170'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L171'>            update[i]-&gt;level[i].span -= 1;
<a name='L172'>        <font color='red'>}</font>
<a name='L173'>    <font color='red'>}</font>
<a name='L174'>    <b>if</b> (x-&gt;level[0].forward) <font color='red'>{</font>
<a name='L175'>        x-&gt;level[0].forward-&gt;backward = x-&gt;backward;
<a name='L176'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L177'>        zsl-&gt;tail = x-&gt;backward;
<a name='L178'>    <font color='red'>}</font>
<a name='L179'>    <b>while</b>(zsl-&gt;level &gt; 1 &amp;&amp; zsl-&gt;header-&gt;level[zsl-&gt;level-1].forward == NULL)
<a name='L180'>        zsl-&gt;level--;
<a name='L181'>    zsl-&gt;length--;
<a name='L182'><font color='red'>}</font>
<a name='L183'>
<a name='L184'><i><font color='green'>/* Delete an element with matching score/object from the skiplist. */</font></i>
<a name='L185'><b>int</b> <a href='../R/4195.html' title='Multiple refered from 3 places.'>zslDelete</a>(zskiplist *zsl, <b>double</b> score, robj *obj) <font color='red'>{</font>
<a name='L186'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *update[<a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>], *x;
<a name='L187'>    <b>int</b> i;
<a name='L188'>
<a name='L189'>    x = zsl-&gt;header;
<a name='L190'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L191'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp;
<a name='L192'>            (x-&gt;level[i].forward-&gt;score &lt; score ||
<a name='L193'>                (x-&gt;level[i].forward-&gt;score == score &amp;&amp;
<a name='L194'>                <a href='../S/71.html#L338' title='Defined at 338 in src/object.c.'>compareStringObjects</a>(x-&gt;level[i].forward-&gt;obj,obj) &lt; 0)))
<a name='L195'>            x = x-&gt;level[i].forward;
<a name='L196'>        update[i] = x;
<a name='L197'>    <font color='red'>}</font>
<a name='L198'>    <i><font color='green'>/* We may have multiple elements with the same score, what we need</font></i>
<a name='L199'><i><font color='green'>     * is to find the element with both the right score and object. */</font></i>
<a name='L200'>    x = x-&gt;level[0].forward;
<a name='L201'>    <b>if</b> (x &amp;&amp; score == x-&gt;score &amp;&amp; <a href='../S/71.html#L365' title='Defined at 365 in src/object.c.'>equalStringObjects</a>(x-&gt;obj,obj)) <font color='red'>{</font>
<a name='L202'>        <a href='../S/59.html#L164' title='Defined at 164 in src/t_zset.c.'>zslDeleteNode</a>(zsl, x, update);
<a name='L203'>        <a href='../S/59.html#L79' title='Defined at 79 in src/t_zset.c.'>zslFreeNode</a>(x);
<a name='L204'>        <b>return</b> 1;
<a name='L205'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L206'>        <b>return</b> 0; <i><font color='green'>/* not found */</font></i>
<a name='L207'>    <font color='red'>}</font>
<a name='L208'>    <b>return</b> 0; <i><font color='green'>/* not found */</font></i>
<a name='L209'><font color='red'>}</font>
<a name='L210'>
<a name='L211'><b>static</b> <b>int</b> <a href='../R/4209.html' title='Multiple refered from 8 places.'>zslValueGteMin</a>(<b>double</b> value, zrangespec *spec) <font color='red'>{</font>
<a name='L212'>    <b>return</b> spec-&gt;minex ? (value &gt; spec-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>) : (value &gt;= spec-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>);
<a name='L213'><font color='red'>}</font>
<a name='L214'>
<a name='L215'><b>static</b> <b>int</b> <a href='../R/4210.html' title='Multiple refered from 11 places.'>zslValueLteMax</a>(<b>double</b> value, zrangespec *spec) <font color='red'>{</font>
<a name='L216'>    <b>return</b> spec-&gt;maxex ? (value &lt; spec-&gt;max) : (value &lt;= spec-&gt;max);
<a name='L217'><font color='red'>}</font>
<a name='L218'>
<a name='L219'><i><font color='green'>/* Returns if there is a part of the zset is in range. */</font></i>
<a name='L220'><b>int</b> <a href='../R/4205.html' title='Multiple refered from 2 places.'>zslIsInRange</a>(zskiplist *zsl, zrangespec *range) <font color='red'>{</font>
<a name='L221'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *x;
<a name='L222'>
<a name='L223'>    <i><font color='green'>/* Test for ranges that will always be empty. */</font></i>
<a name='L224'>    <b>if</b> (range-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> &gt; range-&gt;max ||
<a name='L225'>            (range-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> == range-&gt;max &amp;&amp; (range-&gt;minex || range-&gt;maxex)))
<a name='L226'>        <b>return</b> 0;
<a name='L227'>    x = zsl-&gt;tail;
<a name='L228'>    <b>if</b> (x == NULL || !<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(x-&gt;score,range))
<a name='L229'>        <b>return</b> 0;
<a name='L230'>    x = zsl-&gt;header-&gt;level[0].forward;
<a name='L231'>    <b>if</b> (x == NULL || !<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(x-&gt;score,range))
<a name='L232'>        <b>return</b> 0;
<a name='L233'>    <b>return</b> 1;
<a name='L234'><font color='red'>}</font>
<a name='L235'>
<a name='L236'><i><font color='green'>/* Find the first node that is contained in the specified range.</font></i>
<a name='L237'><i><font color='green'> * Returns NULL when no element is contained in the range. */</font></i>
<a name='L238'><a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *<a href='../R/4199.html' title='Multiple refered from 3 places.'>zslFirstInRange</a>(zskiplist *zsl, zrangespec range) <font color='red'>{</font>
<a name='L239'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *x;
<a name='L240'>    <b>int</b> i;
<a name='L241'>
<a name='L242'>    <i><font color='green'>/* If everything is out of range, return early. */</font></i>
<a name='L243'>    <b>if</b> (!<a href='../S/59.html#L220' title='Defined at 220 in src/t_zset.c.'>zslIsInRange</a>(zsl,&amp;range)) <b>return</b> NULL;
<a name='L244'>
<a name='L245'>    x = zsl-&gt;header;
<a name='L246'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L247'>        <i><font color='green'>/* Go forward while *OUT* of range. */</font></i>
<a name='L248'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp;
<a name='L249'>            !<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(x-&gt;level[i].forward-&gt;score,&amp;range))
<a name='L250'>                x = x-&gt;level[i].forward;
<a name='L251'>    <font color='red'>}</font>
<a name='L252'>
<a name='L253'>    <i><font color='green'>/* This is an inner range, so the next node cannot be NULL. */</font></i>
<a name='L254'>    x = x-&gt;level[0].forward;
<a name='L255'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(x != NULL);
<a name='L256'>
<a name='L257'>    <i><font color='green'>/* Check if score &lt;= max. */</font></i>
<a name='L258'>    <b>if</b> (!<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(x-&gt;score,&amp;range)) <b>return</b> NULL;
<a name='L259'>    <b>return</b> x;
<a name='L260'><font color='red'>}</font>
<a name='L261'>
<a name='L262'><i><font color='green'>/* Find the last node that is contained in the specified range.</font></i>
<a name='L263'><i><font color='green'> * Returns NULL when no element is contained in the range. */</font></i>
<a name='L264'><a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *<a href='../R/4206.html' title='Multiple refered from 2 places.'>zslLastInRange</a>(zskiplist *zsl, zrangespec range) <font color='red'>{</font>
<a name='L265'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *x;
<a name='L266'>    <b>int</b> i;
<a name='L267'>
<a name='L268'>    <i><font color='green'>/* If everything is out of range, return early. */</font></i>
<a name='L269'>    <b>if</b> (!<a href='../S/59.html#L220' title='Defined at 220 in src/t_zset.c.'>zslIsInRange</a>(zsl,&amp;range)) <b>return</b> NULL;
<a name='L270'>
<a name='L271'>    x = zsl-&gt;header;
<a name='L272'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L273'>        <i><font color='green'>/* Go forward while *IN* range. */</font></i>
<a name='L274'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp;
<a name='L275'>            <a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(x-&gt;level[i].forward-&gt;score,&amp;range))
<a name='L276'>                x = x-&gt;level[i].forward;
<a name='L277'>    <font color='red'>}</font>
<a name='L278'>
<a name='L279'>    <i><font color='green'>/* This is an inner range, so this node cannot be NULL. */</font></i>
<a name='L280'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(x != NULL);
<a name='L281'>
<a name='L282'>    <i><font color='green'>/* Check if score &gt;= min. */</font></i>
<a name='L283'>    <b>if</b> (!<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(x-&gt;score,&amp;range)) <b>return</b> NULL;
<a name='L284'>    <b>return</b> x;
<a name='L285'><font color='red'>}</font>
<a name='L286'>
<a name='L287'><i><font color='green'>/* Delete all the elements with score between min and max from the skiplist.</font></i>
<a name='L288'><i><font color='green'> * Min and mx are inclusive, so a score &gt;= min || score &lt;= max is deleted.</font></i>
<a name='L289'><i><font color='green'> * Note that this function takes the reference to the hash table view of the</font></i>
<a name='L290'><i><font color='green'> * sorted set, in order to remove the elements from the hash table too. */</font></i>
<a name='L291'><b>unsigned</b> <b>long</b> <a href='../S/59.html#L1067' title='Refered from 1067 in src/t_zset.c.'>zslDeleteRangeByScore</a>(zskiplist *zsl, zrangespec range, dict *dict) <font color='red'>{</font>
<a name='L292'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *update[<a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>], *x;
<a name='L293'>    <b>unsigned</b> <b>long</b> removed = 0;
<a name='L294'>    <b>int</b> i;
<a name='L295'>
<a name='L296'>    x = zsl-&gt;header;
<a name='L297'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L298'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp; (range.minex ?
<a name='L299'>            x-&gt;level[i].forward-&gt;score &lt;= range.<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> :
<a name='L300'>            x-&gt;level[i].forward-&gt;score &lt; range.<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>))
<a name='L301'>                x = x-&gt;level[i].forward;
<a name='L302'>        update[i] = x;
<a name='L303'>    <font color='red'>}</font>
<a name='L304'>
<a name='L305'>    <i><font color='green'>/* Current node is the last with score &lt; or &lt;= min. */</font></i>
<a name='L306'>    x = x-&gt;level[0].forward;
<a name='L307'>
<a name='L308'>    <i><font color='green'>/* Delete nodes while in range. */</font></i>
<a name='L309'>    <b>while</b> (x &amp;&amp; (range.maxex ? x-&gt;score &lt; range.max : x-&gt;score &lt;= range.max)) <font color='red'>{</font>
<a name='L310'>        <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a> = x-&gt;level[0].forward;
<a name='L311'>        <a href='../S/59.html#L164' title='Defined at 164 in src/t_zset.c.'>zslDeleteNode</a>(zsl,x,update);
<a name='L312'>        <a href='../D/2066.html' title='Multiple defined in 2 places.'>dictDelete</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,x-&gt;obj);
<a name='L313'>        <a href='../S/59.html#L79' title='Defined at 79 in src/t_zset.c.'>zslFreeNode</a>(x);
<a name='L314'>        removed++;
<a name='L315'>        x = <a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>;
<a name='L316'>    <font color='red'>}</font>
<a name='L317'>    <b>return</b> removed;
<a name='L318'><font color='red'>}</font>
<a name='L319'>
<a name='L320'><i><font color='green'>/* Delete all the elements with rank between start and end from the skiplist.</font></i>
<a name='L321'><i><font color='green'> * Start and end are inclusive. Note that start and end need to be 1-based */</font></i>
<a name='L322'><b>unsigned</b> <b>long</b> <a href='../S/59.html#L1115' title='Refered from 1115 in src/t_zset.c.'>zslDeleteRangeByRank</a>(zskiplist *zsl, <b>unsigned</b> <b>int</b> start, <b>unsigned</b> <b>int</b> end, dict *dict) <font color='red'>{</font>
<a name='L323'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *update[<a href='../S/32.html#L238' title='Defined at 238 in src/redis.h.'>ZSKIPLIST_MAXLEVEL</a>], *x;
<a name='L324'>    <b>unsigned</b> <b>long</b> traversed = 0, removed = 0;
<a name='L325'>    <b>int</b> i;
<a name='L326'>
<a name='L327'>    x = zsl-&gt;header;
<a name='L328'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L329'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp; (traversed + x-&gt;level[i].span) &lt; start) <font color='red'>{</font>
<a name='L330'>            traversed += x-&gt;level[i].span;
<a name='L331'>            x = x-&gt;level[i].forward;
<a name='L332'>        <font color='red'>}</font>
<a name='L333'>        update[i] = x;
<a name='L334'>    <font color='red'>}</font>
<a name='L335'>
<a name='L336'>    traversed++;
<a name='L337'>    x = x-&gt;level[0].forward;
<a name='L338'>    <b>while</b> (x &amp;&amp; traversed &lt;= end) <font color='red'>{</font>
<a name='L339'>        <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a> = x-&gt;level[0].forward;
<a name='L340'>        <a href='../S/59.html#L164' title='Defined at 164 in src/t_zset.c.'>zslDeleteNode</a>(zsl,x,update);
<a name='L341'>        <a href='../D/2066.html' title='Multiple defined in 2 places.'>dictDelete</a>(<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,x-&gt;obj);
<a name='L342'>        <a href='../S/59.html#L79' title='Defined at 79 in src/t_zset.c.'>zslFreeNode</a>(x);
<a name='L343'>        removed++;
<a name='L344'>        traversed++;
<a name='L345'>        x = <a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>;
<a name='L346'>    <font color='red'>}</font>
<a name='L347'>    <b>return</b> removed;
<a name='L348'><font color='red'>}</font>
<a name='L349'>
<a name='L350'><i><font color='green'>/* Find the rank for an element by both score and key.</font></i>
<a name='L351'><i><font color='green'> * Returns 0 when the element cannot be found, rank otherwise.</font></i>
<a name='L352'><i><font color='green'> * Note that the rank is 1-based due to the span of zsl-&gt;header to the</font></i>
<a name='L353'><i><font color='green'> * first element. */</font></i>
<a name='L354'><b>unsigned</b> <b>long</b> <a href='../R/4203.html' title='Multiple refered from 3 places.'>zslGetRank</a>(zskiplist *zsl, <b>double</b> score, robj *o) <font color='red'>{</font>
<a name='L355'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *x;
<a name='L356'>    <b>unsigned</b> <b>long</b> rank = 0;
<a name='L357'>    <b>int</b> i;
<a name='L358'>
<a name='L359'>    x = zsl-&gt;header;
<a name='L360'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L361'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp;
<a name='L362'>            (x-&gt;level[i].forward-&gt;score &lt; score ||
<a name='L363'>                (x-&gt;level[i].forward-&gt;score == score &amp;&amp;
<a name='L364'>                <a href='../S/71.html#L338' title='Defined at 338 in src/object.c.'>compareStringObjects</a>(x-&gt;level[i].forward-&gt;obj,o) &lt;= 0))) <font color='red'>{</font>
<a name='L365'>            rank += x-&gt;level[i].span;
<a name='L366'>            x = x-&gt;level[i].forward;
<a name='L367'>        <font color='red'>}</font>
<a name='L368'>
<a name='L369'>        <i><font color='green'>/* x might be equal to zsl-&gt;header, so test if obj is non-NULL */</font></i>
<a name='L370'>        <b>if</b> (x-&gt;obj &amp;&amp; <a href='../S/71.html#L365' title='Defined at 365 in src/object.c.'>equalStringObjects</a>(x-&gt;obj,o)) <font color='red'>{</font>
<a name='L371'>            <b>return</b> rank;
<a name='L372'>        <font color='red'>}</font>
<a name='L373'>    <font color='red'>}</font>
<a name='L374'>    <b>return</b> 0;
<a name='L375'><font color='red'>}</font>
<a name='L376'>
<a name='L377'><i><font color='green'>/* Finds an element by its rank. The rank argument needs to be 1-based. */</font></i>
<a name='L378'><a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a>* <a href='../R/4202.html' title='Multiple refered from 5 places.'>zslGetElementByRank</a>(zskiplist *zsl, <b>unsigned</b> <b>long</b> rank) <font color='red'>{</font>
<a name='L379'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *x;
<a name='L380'>    <b>unsigned</b> <b>long</b> traversed = 0;
<a name='L381'>    <b>int</b> i;
<a name='L382'>
<a name='L383'>    x = zsl-&gt;header;
<a name='L384'>    <b>for</b> (i = zsl-&gt;level-1; i &gt;= 0; i--) <font color='red'>{</font>
<a name='L385'>        <b>while</b> (x-&gt;level[i].forward &amp;&amp; (traversed + x-&gt;level[i].span) &lt;= rank)
<a name='L386'>        <font color='red'>{</font>
<a name='L387'>            traversed += x-&gt;level[i].span;
<a name='L388'>            x = x-&gt;level[i].forward;
<a name='L389'>        <font color='red'>}</font>
<a name='L390'>        <b>if</b> (traversed == rank) <font color='red'>{</font>
<a name='L391'>            <b>return</b> x;
<a name='L392'>        <font color='red'>}</font>
<a name='L393'>    <font color='red'>}</font>
<a name='L394'>    <b>return</b> NULL;
<a name='L395'><font color='red'>}</font>
<a name='L396'>
<a name='L397'><i><font color='green'>/* Populate the rangespec according to the objects min and max. */</font></i>
<a name='L398'><b>static</b> <b>int</b> <a href='../R/4207.html' title='Multiple refered from 3 places.'>zslParseRange</a>(robj *min, robj *max, zrangespec *spec) <font color='red'>{</font>
<a name='L399'>    <b>char</b> *eptr;
<a name='L400'>    spec-&gt;minex = spec-&gt;maxex = 0;
<a name='L401'>
<a name='L402'>    <i><font color='green'>/* Parse the min-max interval. If one of the values is prefixed</font></i>
<a name='L403'><i><font color='green'>     * by the "(" character, it's considered "open". For instance</font></i>
<a name='L404'><i><font color='green'>     * ZRANGEBYSCORE zset (1.5 (2.5 will match min &lt; x &lt; max</font></i>
<a name='L405'><i><font color='green'>     * ZRANGEBYSCORE zset 1.5 2.5 will instead match min &lt;= x &lt;= max */</font></i>
<a name='L406'>    <b>if</b> (<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>) <font color='red'>{</font>
<a name='L407'>        spec-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> = (<b>long</b>)<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>-&gt;ptr;
<a name='L408'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L409'>        <b>if</b> (((<b>char</b>*)<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>-&gt;ptr)[0] == '(') <font color='red'>{</font>
<a name='L410'>            spec-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> = strtod((<b>char</b>*)<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>-&gt;ptr+1,&amp;eptr);
<a name='L411'>            <b>if</b> (eptr[0] != '\0' || <a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(spec-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>)) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L412'>            spec-&gt;minex = 1;
<a name='L413'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L414'>            spec-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> = strtod((<b>char</b>*)<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>-&gt;ptr,&amp;eptr);
<a name='L415'>            <b>if</b> (eptr[0] != '\0' || <a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(spec-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a>)) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L416'>        <font color='red'>}</font>
<a name='L417'>    <font color='red'>}</font>
<a name='L418'>    <b>if</b> (max-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>) <font color='red'>{</font>
<a name='L419'>        spec-&gt;max = (<b>long</b>)max-&gt;ptr;
<a name='L420'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L421'>        <b>if</b> (((<b>char</b>*)max-&gt;ptr)[0] == '(') <font color='red'>{</font>
<a name='L422'>            spec-&gt;max = strtod((<b>char</b>*)max-&gt;ptr+1,&amp;eptr);
<a name='L423'>            <b>if</b> (eptr[0] != '\0' || <a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(spec-&gt;max)) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L424'>            spec-&gt;maxex = 1;
<a name='L425'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L426'>            spec-&gt;max = strtod((<b>char</b>*)max-&gt;ptr,&amp;eptr);
<a name='L427'>            <b>if</b> (eptr[0] != '\0' || <a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(spec-&gt;max)) <b>return</b> <a href='../D/794.html' title='Multiple defined in 2 places.'>REDIS_ERR</a>;
<a name='L428'>        <font color='red'>}</font>
<a name='L429'>    <font color='red'>}</font>
<a name='L430'>
<a name='L431'>    <b>return</b> <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>;
<a name='L432'><font color='red'>}</font>
<a name='L433'>
<a name='L434'><i><font color='green'>/*-----------------------------------------------------------------------------</font></i>
<a name='L435'><i><font color='green'> * Ziplist-backed sorted set API</font></i>
<a name='L436'><i><font color='green'> *----------------------------------------------------------------------------*/</font></i>
<a name='L437'>
<a name='L438'><b>double</b> <a href='../R/4230.html' title='Multiple refered from 16 places.'>zzlGetScore</a>(<b>unsigned</b> <b>char</b> *sptr) <font color='red'>{</font>
<a name='L439'>    <b>unsigned</b> <b>char</b> *vstr;
<a name='L440'>    <b>unsigned</b> <b>int</b> vlen;
<a name='L441'>    <b>long</b> <b>long</b> vlong;
<a name='L442'>    <b>char</b> buf[128];
<a name='L443'>    <b>double</b> score;
<a name='L444'>
<a name='L445'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(sptr != NULL);
<a name='L446'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(<a href='../S/89.html#L746' title='Defined at 746 in src/ziplist.c.'>ziplistGet</a>(sptr,&amp;vstr,&amp;vlen,&amp;vlong));
<a name='L447'>
<a name='L448'>    <b>if</b> (vstr) <font color='red'>{</font>
<a name='L449'>        memcpy(buf,vstr,vlen);
<a name='L450'>        buf[vlen] = '\0';
<a name='L451'>        score = strtod(buf,NULL);
<a name='L452'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L453'>        score = vlong;
<a name='L454'>    <font color='red'>}</font>
<a name='L455'>
<a name='L456'>    <b>return</b> score;
<a name='L457'><font color='red'>}</font>
<a name='L458'>
<a name='L459'><i><font color='green'>/* Compare element in sorted set with given element. */</font></i>
<a name='L460'><b>int</b> <a href='../S/59.html#L688' title='Refered from 688 in src/t_zset.c.'>zzlCompareElements</a>(<b>unsigned</b> <b>char</b> *eptr, <b>unsigned</b> <b>char</b> *cstr, <b>unsigned</b> <b>int</b> clen) <font color='red'>{</font>
<a name='L461'>    <b>unsigned</b> <b>char</b> *vstr;
<a name='L462'>    <b>unsigned</b> <b>int</b> vlen;
<a name='L463'>    <b>long</b> <b>long</b> vlong;
<a name='L464'>    <b>unsigned</b> <b>char</b> vbuf[32];
<a name='L465'>    <b>int</b> minlen, cmp;
<a name='L466'>
<a name='L467'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(<a href='../S/89.html#L746' title='Defined at 746 in src/ziplist.c.'>ziplistGet</a>(eptr,&amp;vstr,&amp;vlen,&amp;vlong));
<a name='L468'>    <b>if</b> (vstr == NULL) <font color='red'>{</font>
<a name='L469'>        <i><font color='green'>/* Store string representation of long long in buf. */</font></i>
<a name='L470'>        vlen = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>((<b>char</b>*)vbuf,<b>sizeof</b>(vbuf),vlong);
<a name='L471'>        vstr = vbuf;
<a name='L472'>    <font color='red'>}</font>
<a name='L473'>
<a name='L474'>    minlen = (vlen &lt; clen) ? vlen : clen;
<a name='L475'>    cmp = memcmp(vstr,cstr,minlen);
<a name='L476'>    <b>if</b> (cmp == 0) <b>return</b> vlen-clen;
<a name='L477'>    <b>return</b> cmp;
<a name='L478'><font color='red'>}</font>
<a name='L479'>
<a name='L480'><b>unsigned</b> <b>int</b> <a href='../R/4235.html' title='Multiple refered from 6 places.'>zzlLength</a>(<b>unsigned</b> <b>char</b> *zl) <font color='red'>{</font>
<a name='L481'>    <b>return</b> <a href='../S/89.html#L879' title='Defined at 879 in src/ziplist.c.'>ziplistLen</a>(zl)/2;
<a name='L482'><font color='red'>}</font>
<a name='L483'>
<a name='L484'><i><font color='green'>/* Move to next entry based on the values in eptr and sptr. Both are set to</font></i>
<a name='L485'><i><font color='green'> * NULL when there is no next entry. */</font></i>
<a name='L486'><b>void</b> <a href='../R/4236.html' title='Multiple refered from 10 places.'>zzlNext</a>(<b>unsigned</b> <b>char</b> *zl, <b>unsigned</b> <b>char</b> **eptr, <b>unsigned</b> <b>char</b> **sptr) <font color='red'>{</font>
<a name='L487'>    <b>unsigned</b> <b>char</b> *_eptr, *_sptr;
<a name='L488'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(*eptr != NULL &amp;&amp; *sptr != NULL);
<a name='L489'>
<a name='L490'>    _eptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,*sptr);
<a name='L491'>    <b>if</b> (_eptr != NULL) <font color='red'>{</font>
<a name='L492'>        _sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,_eptr);
<a name='L493'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(_sptr != NULL);
<a name='L494'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L495'>        <i><font color='green'>/* No next entry. */</font></i>
<a name='L496'>        _sptr = NULL;
<a name='L497'>    <font color='red'>}</font>
<a name='L498'>
<a name='L499'>    *eptr = _eptr;
<a name='L500'>    *sptr = _sptr;
<a name='L501'><font color='red'>}</font>
<a name='L502'>
<a name='L503'><i><font color='green'>/* Move to the previous entry based on the values in eptr and sptr. Both are</font></i>
<a name='L504'><i><font color='green'> * set to NULL when there is no next entry. */</font></i>
<a name='L505'><b>void</b> <a href='../R/4237.html' title='Multiple refered from 4 places.'>zzlPrev</a>(<b>unsigned</b> <b>char</b> *zl, <b>unsigned</b> <b>char</b> **eptr, <b>unsigned</b> <b>char</b> **sptr) <font color='red'>{</font>
<a name='L506'>    <b>unsigned</b> <b>char</b> *_eptr, *_sptr;
<a name='L507'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(*eptr != NULL &amp;&amp; *sptr != NULL);
<a name='L508'>
<a name='L509'>    _sptr = <a href='../S/89.html#L724' title='Defined at 724 in src/ziplist.c.'>ziplistPrev</a>(zl,*eptr);
<a name='L510'>    <b>if</b> (_sptr != NULL) <font color='red'>{</font>
<a name='L511'>        _eptr = <a href='../S/89.html#L724' title='Defined at 724 in src/ziplist.c.'>ziplistPrev</a>(zl,_sptr);
<a name='L512'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(_eptr != NULL);
<a name='L513'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L514'>        <i><font color='green'>/* No previous entry. */</font></i>
<a name='L515'>        _eptr = NULL;
<a name='L516'>    <font color='red'>}</font>
<a name='L517'>
<a name='L518'>    *eptr = _eptr;
<a name='L519'>    *sptr = _sptr;
<a name='L520'><font color='red'>}</font>
<a name='L521'>
<a name='L522'><i><font color='green'>/* Returns if there is a part of the zset is in range. Should only be used</font></i>
<a name='L523'><i><font color='green'> * internally by zzlFirstInRange and zzlLastInRange. */</font></i>
<a name='L524'><b>int</b> <a href='../R/4233.html' title='Multiple refered from 2 places.'>zzlIsInRange</a>(<b>unsigned</b> <b>char</b> *zl, zrangespec *range) <font color='red'>{</font>
<a name='L525'>    <b>unsigned</b> <b>char</b> *p;
<a name='L526'>    <b>double</b> score;
<a name='L527'>
<a name='L528'>    <i><font color='green'>/* Test for ranges that will always be empty. */</font></i>
<a name='L529'>    <b>if</b> (range-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> &gt; range-&gt;max ||
<a name='L530'>            (range-&gt;<a href='../S/20.html#L50' title='Defined at 50 in src/pqsort.c.'>min</a> == range-&gt;max &amp;&amp; (range-&gt;minex || range-&gt;maxex)))
<a name='L531'>        <b>return</b> 0;
<a name='L532'>
<a name='L533'>    p = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,-1); <i><font color='green'>/* Last score. */</font></i>
<a name='L534'>    <b>if</b> (p == NULL) <b>return</b> 0; <i><font color='green'>/* Empty sorted set */</font></i>
<a name='L535'>    score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(p);
<a name='L536'>    <b>if</b> (!<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(score,range))
<a name='L537'>        <b>return</b> 0;
<a name='L538'>
<a name='L539'>    p = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,1); <i><font color='green'>/* First score. */</font></i>
<a name='L540'>    <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(p != NULL);
<a name='L541'>    score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(p);
<a name='L542'>    <b>if</b> (!<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(score,range))
<a name='L543'>        <b>return</b> 0;
<a name='L544'>
<a name='L545'>    <b>return</b> 1;
<a name='L546'><font color='red'>}</font>
<a name='L547'>
<a name='L548'><i><font color='green'>/* Find pointer to the first element contained in the specified range.</font></i>
<a name='L549'><i><font color='green'> * Returns NULL when no element is contained in the range. */</font></i>
<a name='L550'><b>unsigned</b> <b>char</b> *<a href='../R/4229.html' title='Multiple refered from 3 places.'>zzlFirstInRange</a>(<b>unsigned</b> <b>char</b> *zl, zrangespec range) <font color='red'>{</font>
<a name='L551'>    <b>unsigned</b> <b>char</b> *eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,0), *sptr;
<a name='L552'>    <b>double</b> score;
<a name='L553'>
<a name='L554'>    <i><font color='green'>/* If everything is out of range, return early. */</font></i>
<a name='L555'>    <b>if</b> (!<a href='../S/59.html#L524' title='Defined at 524 in src/t_zset.c.'>zzlIsInRange</a>(zl,&amp;range)) <b>return</b> NULL;
<a name='L556'>
<a name='L557'>    <b>while</b> (eptr != NULL) <font color='red'>{</font>
<a name='L558'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L559'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(sptr != NULL);
<a name='L560'>
<a name='L561'>        score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L562'>        <b>if</b> (<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(score,&amp;range)) <font color='red'>{</font>
<a name='L563'>            <i><font color='green'>/* Check if score &lt;= max. */</font></i>
<a name='L564'>            <b>if</b> (<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(score,&amp;range))
<a name='L565'>                <b>return</b> eptr;
<a name='L566'>            <b>return</b> NULL;
<a name='L567'>        <font color='red'>}</font>
<a name='L568'>
<a name='L569'>        <i><font color='green'>/* Move to next element. */</font></i>
<a name='L570'>        eptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,sptr);
<a name='L571'>    <font color='red'>}</font>
<a name='L572'>
<a name='L573'>    <b>return</b> NULL;
<a name='L574'><font color='red'>}</font>
<a name='L575'>
<a name='L576'><i><font color='green'>/* Find pointer to the last element contained in the specified range.</font></i>
<a name='L577'><i><font color='green'> * Returns NULL when no element is contained in the range. */</font></i>
<a name='L578'><b>unsigned</b> <b>char</b> *<a href='../S/59.html#L1862' title='Refered from 1862 in src/t_zset.c.'>zzlLastInRange</a>(<b>unsigned</b> <b>char</b> *zl, zrangespec range) <font color='red'>{</font>
<a name='L579'>    <b>unsigned</b> <b>char</b> *eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,-2), *sptr;
<a name='L580'>    <b>double</b> score;
<a name='L581'>
<a name='L582'>    <i><font color='green'>/* If everything is out of range, return early. */</font></i>
<a name='L583'>    <b>if</b> (!<a href='../S/59.html#L524' title='Defined at 524 in src/t_zset.c.'>zzlIsInRange</a>(zl,&amp;range)) <b>return</b> NULL;
<a name='L584'>
<a name='L585'>    <b>while</b> (eptr != NULL) <font color='red'>{</font>
<a name='L586'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L587'>        <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(sptr != NULL);
<a name='L588'>
<a name='L589'>        score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L590'>        <b>if</b> (<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(score,&amp;range)) <font color='red'>{</font>
<a name='L591'>            <i><font color='green'>/* Check if score &gt;= min. */</font></i>
<a name='L592'>            <b>if</b> (<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(score,&amp;range))
<a name='L593'>                <b>return</b> eptr;
<a name='L594'>            <b>return</b> NULL;
<a name='L595'>        <font color='red'>}</font>
<a name='L596'>
<a name='L597'>        <i><font color='green'>/* Move to previous element by moving to the score of previous element.</font></i>
<a name='L598'><i><font color='green'>         * When this returns NULL, we know there also is no element. */</font></i>
<a name='L599'>        sptr = <a href='../S/89.html#L724' title='Defined at 724 in src/ziplist.c.'>ziplistPrev</a>(zl,eptr);
<a name='L600'>        <b>if</b> (sptr != NULL)
<a name='L601'>            <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>((eptr = <a href='../S/89.html#L724' title='Defined at 724 in src/ziplist.c.'>ziplistPrev</a>(zl,sptr)) != NULL);
<a name='L602'>        <b>else</b>
<a name='L603'>            eptr = NULL;
<a name='L604'>    <font color='red'>}</font>
<a name='L605'>
<a name='L606'>    <b>return</b> NULL;
<a name='L607'><font color='red'>}</font>
<a name='L608'>
<a name='L609'><b>unsigned</b> <b>char</b> *<a href='../R/4228.html' title='Multiple refered from 4 places.'>zzlFind</a>(<b>unsigned</b> <b>char</b> *zl, robj *ele, <b>double</b> *score) <font color='red'>{</font>
<a name='L610'>    <b>unsigned</b> <b>char</b> *eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,0), *sptr;
<a name='L611'>
<a name='L612'>    ele = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(ele);
<a name='L613'>    <b>while</b> (eptr != NULL) <font color='red'>{</font>
<a name='L614'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L615'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,ele,sptr != NULL);
<a name='L616'>
<a name='L617'>        <b>if</b> (<a href='../S/89.html#L792' title='Defined at 792 in src/ziplist.c.'>ziplistCompare</a>(eptr,ele-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(ele-&gt;ptr))) <font color='red'>{</font>
<a name='L618'>            <i><font color='green'>/* Matching element, pull out score. */</font></i>
<a name='L619'>            <b>if</b> (score != NULL) *score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L620'>            <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(ele);
<a name='L621'>            <b>return</b> eptr;
<a name='L622'>        <font color='red'>}</font>
<a name='L623'>
<a name='L624'>        <i><font color='green'>/* Move to next element. */</font></i>
<a name='L625'>        eptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,sptr);
<a name='L626'>    <font color='red'>}</font>
<a name='L627'>
<a name='L628'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(ele);
<a name='L629'>    <b>return</b> NULL;
<a name='L630'><font color='red'>}</font>
<a name='L631'>
<a name='L632'><i><font color='green'>/* Delete (element,score) pair from ziplist. Use local copy of eptr because we</font></i>
<a name='L633'><i><font color='green'> * don't want to modify the one given as argument. */</font></i>
<a name='L634'><b>unsigned</b> <b>char</b> *<a href='../R/4225.html' title='Multiple refered from 2 places.'>zzlDelete</a>(<b>unsigned</b> <b>char</b> *zl, <b>unsigned</b> <b>char</b> *eptr) <font color='red'>{</font>
<a name='L635'>    <b>unsigned</b> <b>char</b> *p = eptr;
<a name='L636'>
<a name='L637'>    <i><font color='green'>/* TODO: add function to ziplist API to delete N elements from offset. */</font></i>
<a name='L638'>    zl = <a href='../S/89.html#L773' title='Defined at 773 in src/ziplist.c.'>ziplistDelete</a>(zl,&amp;p);
<a name='L639'>    zl = <a href='../S/89.html#L773' title='Defined at 773 in src/ziplist.c.'>ziplistDelete</a>(zl,&amp;p);
<a name='L640'>    <b>return</b> zl;
<a name='L641'><font color='red'>}</font>
<a name='L642'>
<a name='L643'><b>unsigned</b> <b>char</b> *<a href='../R/4232.html' title='Multiple refered from 4 places.'>zzlInsertAt</a>(<b>unsigned</b> <b>char</b> *zl, <b>unsigned</b> <b>char</b> *eptr, robj *ele, <b>double</b> score) <font color='red'>{</font>
<a name='L644'>    <b>unsigned</b> <b>char</b> *sptr;
<a name='L645'>    <b>char</b> scorebuf[128];
<a name='L646'>    <b>int</b> scorelen;
<a name='L647'>    size_t offset;
<a name='L648'>
<a name='L649'>    <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,ele,ele-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>);
<a name='L650'>    scorelen = <a href='../S/74.html#L325' title='Defined at 325 in src/util.c.'>d2string</a>(scorebuf,<b>sizeof</b>(scorebuf),score);
<a name='L651'>    <b>if</b> (eptr == NULL) <font color='red'>{</font>
<a name='L652'>        zl = <a href='../S/89.html#L668' title='Defined at 668 in src/ziplist.c.'>ziplistPush</a>(zl,ele-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(ele-&gt;ptr),<a href='../S/66.html#L32' title='Defined at 32 in src/ziplist.h.'>ZIPLIST_TAIL</a>);
<a name='L653'>        zl = <a href='../S/89.html#L668' title='Defined at 668 in src/ziplist.c.'>ziplistPush</a>(zl,(<b>unsigned</b> <b>char</b>*)scorebuf,scorelen,<a href='../S/66.html#L32' title='Defined at 32 in src/ziplist.h.'>ZIPLIST_TAIL</a>);
<a name='L654'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L655'>        <i><font color='green'>/* Keep offset relative to zl, as it might be re-allocated. */</font></i>
<a name='L656'>        offset = eptr-zl;
<a name='L657'>        zl = <a href='../S/89.html#L766' title='Defined at 766 in src/ziplist.c.'>ziplistInsert</a>(zl,eptr,ele-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(ele-&gt;ptr));
<a name='L658'>        eptr = zl+offset;
<a name='L659'>
<a name='L660'>        <i><font color='green'>/* Insert score after the element. */</font></i>
<a name='L661'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,ele,(sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr)) != NULL);
<a name='L662'>        zl = <a href='../S/89.html#L766' title='Defined at 766 in src/ziplist.c.'>ziplistInsert</a>(zl,sptr,(<b>unsigned</b> <b>char</b>*)scorebuf,scorelen);
<a name='L663'>    <font color='red'>}</font>
<a name='L664'>
<a name='L665'>    <b>return</b> zl;
<a name='L666'><font color='red'>}</font>
<a name='L667'>
<a name='L668'><i><font color='green'>/* Insert (element,score) pair in ziplist. This function assumes the element is</font></i>
<a name='L669'><i><font color='green'> * not yet present in the list. */</font></i>
<a name='L670'><b>unsigned</b> <b>char</b> *<a href='../R/4231.html' title='Multiple refered from 3 places.'>zzlInsert</a>(<b>unsigned</b> <b>char</b> *zl, robj *ele, <b>double</b> score) <font color='red'>{</font>
<a name='L671'>    <b>unsigned</b> <b>char</b> *eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,0), *sptr;
<a name='L672'>    <b>double</b> s;
<a name='L673'>
<a name='L674'>    ele = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(ele);
<a name='L675'>    <b>while</b> (eptr != NULL) <font color='red'>{</font>
<a name='L676'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L677'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,ele,sptr != NULL);
<a name='L678'>        s = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L679'>
<a name='L680'>        <b>if</b> (s &gt; score) <font color='red'>{</font>
<a name='L681'>            <i><font color='green'>/* First element with score larger than score for element to be</font></i>
<a name='L682'><i><font color='green'>             * inserted. This means we should take its spot in the list to</font></i>
<a name='L683'><i><font color='green'>             * maintain ordering. */</font></i>
<a name='L684'>            zl = <a href='../S/59.html#L643' title='Defined at 643 in src/t_zset.c.'>zzlInsertAt</a>(zl,eptr,ele,score);
<a name='L685'>            <b>break</b>;
<a name='L686'>        <font color='red'>}</font> <b>else</b> <b>if</b> (s == score) <font color='red'>{</font>
<a name='L687'>            <i><font color='green'>/* Ensure lexicographical ordering for elements. */</font></i>
<a name='L688'>            <b>if</b> (<a href='../S/59.html#L460' title='Defined at 460 in src/t_zset.c.'>zzlCompareElements</a>(eptr,ele-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(ele-&gt;ptr)) &gt; 0) <font color='red'>{</font>
<a name='L689'>                zl = <a href='../S/59.html#L643' title='Defined at 643 in src/t_zset.c.'>zzlInsertAt</a>(zl,eptr,ele,score);
<a name='L690'>                <b>break</b>;
<a name='L691'>            <font color='red'>}</font>
<a name='L692'>        <font color='red'>}</font>
<a name='L693'>
<a name='L694'>        <i><font color='green'>/* Move to next element. */</font></i>
<a name='L695'>        eptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,sptr);
<a name='L696'>    <font color='red'>}</font>
<a name='L697'>
<a name='L698'>    <i><font color='green'>/* Push on tail of list when it was not yet inserted. */</font></i>
<a name='L699'>    <b>if</b> (eptr == NULL)
<a name='L700'>        zl = <a href='../S/59.html#L643' title='Defined at 643 in src/t_zset.c.'>zzlInsertAt</a>(zl,NULL,ele,score);
<a name='L701'>
<a name='L702'>    <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(ele);
<a name='L703'>    <b>return</b> zl;
<a name='L704'><font color='red'>}</font>
<a name='L705'>
<a name='L706'><b>unsigned</b> <b>char</b> *<a href='../S/59.html#L1063' title='Refered from 1063 in src/t_zset.c.'>zzlDeleteRangeByScore</a>(<b>unsigned</b> <b>char</b> *zl, zrangespec range, <b>unsigned</b> <b>long</b> *deleted) <font color='red'>{</font>
<a name='L707'>    <b>unsigned</b> <b>char</b> *eptr, *sptr;
<a name='L708'>    <b>double</b> score;
<a name='L709'>    <b>unsigned</b> <b>long</b> num = 0;
<a name='L710'>
<a name='L711'>    <b>if</b> (deleted != NULL) *deleted = 0;
<a name='L712'>
<a name='L713'>    eptr = <a href='../S/59.html#L550' title='Defined at 550 in src/t_zset.c.'>zzlFirstInRange</a>(zl,range);
<a name='L714'>    <b>if</b> (eptr == NULL) <b>return</b> zl;
<a name='L715'>
<a name='L716'>    <i><font color='green'>/* When the tail of the ziplist is deleted, eptr will point to the sentinel</font></i>
<a name='L717'><i><font color='green'>     * byte and ziplistNext will return NULL. */</font></i>
<a name='L718'>    <b>while</b> ((sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr)) != NULL) <font color='red'>{</font>
<a name='L719'>        score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L720'>        <b>if</b> (<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(score,&amp;range)) <font color='red'>{</font>
<a name='L721'>            <i><font color='green'>/* Delete both the element and the score. */</font></i>
<a name='L722'>            zl = <a href='../S/89.html#L773' title='Defined at 773 in src/ziplist.c.'>ziplistDelete</a>(zl,&amp;eptr);
<a name='L723'>            zl = <a href='../S/89.html#L773' title='Defined at 773 in src/ziplist.c.'>ziplistDelete</a>(zl,&amp;eptr);
<a name='L724'>            num++;
<a name='L725'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L726'>            <i><font color='green'>/* No longer in range. */</font></i>
<a name='L727'>            <b>break</b>;
<a name='L728'>        <font color='red'>}</font>
<a name='L729'>    <font color='red'>}</font>
<a name='L730'>
<a name='L731'>    <b>if</b> (deleted != NULL) *deleted = num;
<a name='L732'>    <b>return</b> zl;
<a name='L733'><font color='red'>}</font>
<a name='L734'>
<a name='L735'><i><font color='green'>/* Delete all the elements with rank between start and end from the skiplist.</font></i>
<a name='L736'><i><font color='green'> * Start and end are inclusive. Note that start and end need to be 1-based */</font></i>
<a name='L737'><b>unsigned</b> <b>char</b> *<a href='../S/59.html#L1109' title='Refered from 1109 in src/t_zset.c.'>zzlDeleteRangeByRank</a>(<b>unsigned</b> <b>char</b> *zl, <b>unsigned</b> <b>int</b> start, <b>unsigned</b> <b>int</b> end, <b>unsigned</b> <b>long</b> *deleted) <font color='red'>{</font>
<a name='L738'>    <b>unsigned</b> <b>int</b> num = (end-start)+1;
<a name='L739'>    <b>if</b> (deleted) *deleted = num;
<a name='L740'>    zl = <a href='../S/89.html#L786' title='Defined at 786 in src/ziplist.c.'>ziplistDeleteRange</a>(zl,2*(start-1),2*num);
<a name='L741'>    <b>return</b> zl;
<a name='L742'><font color='red'>}</font>
<a name='L743'>
<a name='L744'><i><font color='green'>/*-----------------------------------------------------------------------------</font></i>
<a name='L745'><i><font color='green'> * Common sorted set API</font></i>
<a name='L746'><i><font color='green'> *----------------------------------------------------------------------------*/</font></i>
<a name='L747'>
<a name='L748'><b>unsigned</b> <b>int</b> <a href='../R/4188.html' title='Multiple refered from 10 places.'>zsetLength</a>(robj *zobj) <font color='red'>{</font>
<a name='L749'>    <b>int</b> length = -1;
<a name='L750'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L751'>        length = <a href='../S/59.html#L480' title='Defined at 480 in src/t_zset.c.'>zzlLength</a>(zobj-&gt;ptr);
<a name='L752'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L753'>        length = ((<a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a>*)zobj-&gt;ptr)-&gt;zsl-&gt;length;
<a name='L754'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L755'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L756'>    <font color='red'>}</font>
<a name='L757'>    <b>return</b> length;
<a name='L758'><font color='red'>}</font>
<a name='L759'>
<a name='L760'><b>void</b> <a href='../R/4187.html' title='Multiple refered from 7 places.'>zsetConvert</a>(robj *zobj, <b>int</b> encoding) <font color='red'>{</font>
<a name='L761'>    <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs;
<a name='L762'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *node, *<a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>;
<a name='L763'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *ele;
<a name='L764'>    <b>double</b> score;
<a name='L765'>
<a name='L766'>    <b>if</b> (zobj-&gt;encoding == encoding) <b>return</b>;
<a name='L767'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L768'>        <b>unsigned</b> <b>char</b> *zl = zobj-&gt;ptr;
<a name='L769'>        <b>unsigned</b> <b>char</b> *eptr, *sptr;
<a name='L770'>        <b>unsigned</b> <b>char</b> *vstr;
<a name='L771'>        <b>unsigned</b> <b>int</b> vlen;
<a name='L772'>        <b>long</b> <b>long</b> vlong;
<a name='L773'>
<a name='L774'>        <b>if</b> (encoding != <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>)
<a name='L775'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown target encoding");
<a name='L776'>
<a name='L777'>        zs = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(*zs));
<a name='L778'>        zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a> = <a href='../D/2065.html' title='Multiple defined in 2 places.'>dictCreate</a>(&amp;zsetDictType,NULL);
<a name='L779'>        zs-&gt;zsl = <a href='../S/59.html#L62' title='Defined at 62 in src/t_zset.c.'>zslCreate</a>();
<a name='L780'>
<a name='L781'>        eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,0);
<a name='L782'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,zobj,eptr != NULL);
<a name='L783'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L784'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,zobj,sptr != NULL);
<a name='L785'>
<a name='L786'>        <b>while</b> (eptr != NULL) <font color='red'>{</font>
<a name='L787'>            score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L788'>            <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,zobj,<a href='../S/89.html#L746' title='Defined at 746 in src/ziplist.c.'>ziplistGet</a>(eptr,&amp;vstr,&amp;vlen,&amp;vlong));
<a name='L789'>            <b>if</b> (vstr == NULL)
<a name='L790'>                ele = <a href='../S/71.html#L51' title='Defined at 51 in src/object.c.'>createStringObjectFromLongLong</a>(vlong);
<a name='L791'>            <b>else</b>
<a name='L792'>                ele = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>((<b>char</b>*)vstr,vlen);
<a name='L793'>
<a name='L794'>            <i><font color='green'>/* Has incremented refcount since it was just created. */</font></i>
<a name='L795'>            node = <a href='../S/59.html#L107' title='Defined at 107 in src/t_zset.c.'>zslInsert</a>(zs-&gt;zsl,score,ele);
<a name='L796'>            <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(NULL,zobj,<a href='../D/2061.html' title='Multiple defined in 2 places.'>dictAdd</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,ele,&amp;node-&gt;score) == <a href='../D/124.html' title='Multiple defined in 2 places.'>DICT_OK</a>);
<a name='L797'>            <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(ele); <i><font color='green'>/* Added to dictionary. */</font></i>
<a name='L798'>            <a href='../S/59.html#L486' title='Defined at 486 in src/t_zset.c.'>zzlNext</a>(zl,&amp;eptr,&amp;sptr);
<a name='L799'>        <font color='red'>}</font>
<a name='L800'>
<a name='L801'>        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(zobj-&gt;ptr);
<a name='L802'>        zobj-&gt;ptr = zs;
<a name='L803'>        zobj-&gt;encoding = <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>;
<a name='L804'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L805'>        <b>unsigned</b> <b>char</b> *zl = <a href='../S/89.html#L418' title='Defined at 418 in src/ziplist.c.'>ziplistNew</a>();
<a name='L806'>
<a name='L807'>        <b>if</b> (encoding != <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>)
<a name='L808'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown target encoding");
<a name='L809'>
<a name='L810'>        <i><font color='green'>/* Approach similar to zslFree(), since we want to free the skiplist at</font></i>
<a name='L811'><i><font color='green'>         * the same time as creating the ziplist. */</font></i>
<a name='L812'>        zs = zobj-&gt;ptr;
<a name='L813'>        <a href='../D/2108.html' title='Multiple defined in 2 places.'>dictRelease</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L814'>        node = zs-&gt;zsl-&gt;header-&gt;level[0].forward;
<a name='L815'>        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(zs-&gt;zsl-&gt;header);
<a name='L816'>        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(zs-&gt;zsl);
<a name='L817'>
<a name='L818'>        <b>while</b> (node) <font color='red'>{</font>
<a name='L819'>            ele = <a href='../S/71.html#L312' title='Defined at 312 in src/object.c.'>getDecodedObject</a>(node-&gt;obj);
<a name='L820'>            zl = <a href='../S/59.html#L643' title='Defined at 643 in src/t_zset.c.'>zzlInsertAt</a>(zl,NULL,ele,node-&gt;score);
<a name='L821'>            <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(ele);
<a name='L822'>
<a name='L823'>            <a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a> = node-&gt;level[0].forward;
<a name='L824'>            <a href='../S/59.html#L79' title='Defined at 79 in src/t_zset.c.'>zslFreeNode</a>(node);
<a name='L825'>            node = <a href='../D/3419.html' title='Multiple defined in 2 places.'>next</a>;
<a name='L826'>        <font color='red'>}</font>
<a name='L827'>
<a name='L828'>        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(zs);
<a name='L829'>        zobj-&gt;ptr = zl;
<a name='L830'>        zobj-&gt;encoding = <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>;
<a name='L831'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L832'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L833'>    <font color='red'>}</font>
<a name='L834'><font color='red'>}</font>
<a name='L835'>
<a name='L836'><i><font color='green'>/*-----------------------------------------------------------------------------</font></i>
<a name='L837'><i><font color='green'> * Sorted set commands </font></i>
<a name='L838'><i><font color='green'> *----------------------------------------------------------------------------*/</font></i>
<a name='L839'>
<a name='L840'><i><font color='green'>/* This generic command implements both ZADD and ZINCRBY. */</font></i>
<a name='L841'><b>void</b> <a href='../R/4098.html' title='Multiple refered from 2 places.'>zaddGenericCommand</a>(redisClient *c, <b>int</b> incr) <font color='red'>{</font>
<a name='L842'>    <b>static</b> <b>char</b> *nanerr = "resulting score is not a number (NaN)";
<a name='L843'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L844'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *ele;
<a name='L845'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L846'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *curobj;
<a name='L847'>    <b>double</b> score = 0, *scores, curscore = 0.0;
<a name='L848'>    <b>int</b> j, elements = (c-&gt;argc-2)/2;
<a name='L849'>    <b>int</b> added = 0;
<a name='L850'>
<a name='L851'>    <b>if</b> (c-&gt;argc % 2) <font color='red'>{</font>
<a name='L852'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.syntaxerr);
<a name='L853'>        <b>return</b>;
<a name='L854'>    <font color='red'>}</font>
<a name='L855'>
<a name='L856'>    <i><font color='green'>/* Start parsing all the scores, we need to emit any syntax error</font></i>
<a name='L857'><i><font color='green'>     * before executing additions to the sorted set, as the command should</font></i>
<a name='L858'><i><font color='green'>     * either execute fully or nothing at all. */</font></i>
<a name='L859'>    scores = <a href='../S/39.html#L121' title='Defined at 121 in src/zmalloc.c.'>zmalloc</a>(<b>sizeof</b>(<b>double</b>)*elements);
<a name='L860'>    <b>for</b> (j = 0; j &lt; elements; j++) <font color='red'>{</font>
<a name='L861'>        <b>if</b> (<a href='../S/71.html#L408' title='Defined at 408 in src/object.c.'>getDoubleFromObjectOrReply</a>(c,c-&gt;argv[2+j*2],&amp;scores[j],NULL)
<a name='L862'>            != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L863'>        <font color='red'>{</font>
<a name='L864'>            <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(scores);
<a name='L865'>            <b>return</b>;
<a name='L866'>        <font color='red'>}</font>
<a name='L867'>    <font color='red'>}</font>
<a name='L868'>
<a name='L869'>    <i><font color='green'>/* Lookup the key and create the sorted set if does not exist. */</font></i>
<a name='L870'>    zobj = <a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,key);
<a name='L871'>    <b>if</b> (zobj == NULL) <font color='red'>{</font>
<a name='L872'>        <b>if</b> (server.zset_max_ziplist_entries == 0 ||
<a name='L873'>            server.zset_max_ziplist_value &lt; <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(c-&gt;argv[3]-&gt;ptr))
<a name='L874'>        <font color='red'>{</font>
<a name='L875'>            zobj = <a href='../S/71.html#L133' title='Defined at 133 in src/object.c.'>createZsetObject</a>();
<a name='L876'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L877'>            zobj = <a href='../S/71.html#L144' title='Defined at 144 in src/object.c.'>createZsetZiplistObject</a>();
<a name='L878'>        <font color='red'>}</font>
<a name='L879'>        <a href='../S/31.html#L91' title='Defined at 91 in src/db.c.'>dbAdd</a>(c-&gt;db,key,zobj);
<a name='L880'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L881'>        <b>if</b> (zobj-&gt;type != <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>) <font color='red'>{</font>
<a name='L882'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.wrongtypeerr);
<a name='L883'>            <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(scores);
<a name='L884'>            <b>return</b>;
<a name='L885'>        <font color='red'>}</font>
<a name='L886'>    <font color='red'>}</font>
<a name='L887'>
<a name='L888'>    <b>for</b> (j = 0; j &lt; elements; j++) <font color='red'>{</font>
<a name='L889'>        score = scores[j];
<a name='L890'>
<a name='L891'>        <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L892'>            <b>unsigned</b> <b>char</b> *eptr;
<a name='L893'>
<a name='L894'>            <i><font color='green'>/* Prefer non-encoded element when dealing with ziplists. */</font></i>
<a name='L895'>            ele = c-&gt;argv[3+j*2];
<a name='L896'>            <b>if</b> ((eptr = <a href='../S/59.html#L609' title='Defined at 609 in src/t_zset.c.'>zzlFind</a>(zobj-&gt;ptr,ele,&amp;curscore)) != NULL) <font color='red'>{</font>
<a name='L897'>                <b>if</b> (incr) <font color='red'>{</font>
<a name='L898'>                    score += curscore;
<a name='L899'>                    <b>if</b> (<a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(score)) <font color='red'>{</font>
<a name='L900'>                        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,nanerr);
<a name='L901'>                        <i><font color='green'>/* Don't need to check if the sorted set is empty</font></i>
<a name='L902'><i><font color='green'>                         * because we know it has at least one element. */</font></i>
<a name='L903'>                        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(scores);
<a name='L904'>                        <b>return</b>;
<a name='L905'>                    <font color='red'>}</font>
<a name='L906'>                <font color='red'>}</font>
<a name='L907'>
<a name='L908'>                <i><font color='green'>/* Remove and re-insert when score changed. */</font></i>
<a name='L909'>                <b>if</b> (score != curscore) <font color='red'>{</font>
<a name='L910'>                    zobj-&gt;ptr = <a href='../S/59.html#L634' title='Defined at 634 in src/t_zset.c.'>zzlDelete</a>(zobj-&gt;ptr,eptr);
<a name='L911'>                    zobj-&gt;ptr = <a href='../S/59.html#L670' title='Defined at 670 in src/t_zset.c.'>zzlInsert</a>(zobj-&gt;ptr,ele,score);
<a name='L912'>
<a name='L913'>                    <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,key);
<a name='L914'>                    server.dirty++;
<a name='L915'>                <font color='red'>}</font>
<a name='L916'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L917'>                <i><font color='green'>/* Optimize: check if the element is too large or the list</font></i>
<a name='L918'><i><font color='green'>                 * becomes too long *before* executing zzlInsert. */</font></i>
<a name='L919'>                zobj-&gt;ptr = <a href='../S/59.html#L670' title='Defined at 670 in src/t_zset.c.'>zzlInsert</a>(zobj-&gt;ptr,ele,score);
<a name='L920'>                <b>if</b> (<a href='../S/59.html#L480' title='Defined at 480 in src/t_zset.c.'>zzlLength</a>(zobj-&gt;ptr) &gt; server.zset_max_ziplist_entries)
<a name='L921'>                    <a href='../S/59.html#L760' title='Defined at 760 in src/t_zset.c.'>zsetConvert</a>(zobj,<a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>);
<a name='L922'>                <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(ele-&gt;ptr) &gt; server.zset_max_ziplist_value)
<a name='L923'>                    <a href='../S/59.html#L760' title='Defined at 760 in src/t_zset.c.'>zsetConvert</a>(zobj,<a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>);
<a name='L924'>
<a name='L925'>                <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,key);
<a name='L926'>                server.dirty++;
<a name='L927'>                <b>if</b> (!incr) added++;
<a name='L928'>            <font color='red'>}</font>
<a name='L929'>        <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L930'>            <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L931'>            <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *znode;
<a name='L932'>            <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L933'>
<a name='L934'>            ele = c-&gt;argv[3+j*2] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[3+j*2]);
<a name='L935'>            de = <a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,ele);
<a name='L936'>            <b>if</b> (de != NULL) <font color='red'>{</font>
<a name='L937'>                curobj = <a href='../S/88.html#L131' title='Defined at 131 in src/dict.h.'>dictGetKey</a>(de);
<a name='L938'>                curscore = *(<b>double</b>*)<a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de);
<a name='L939'>
<a name='L940'>                <b>if</b> (incr) <font color='red'>{</font>
<a name='L941'>                    score += curscore;
<a name='L942'>                    <b>if</b> (<a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(score)) <font color='red'>{</font>
<a name='L943'>                        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,nanerr);
<a name='L944'>                        <i><font color='green'>/* Don't need to check if the sorted set is empty</font></i>
<a name='L945'><i><font color='green'>                         * because we know it has at least one element. */</font></i>
<a name='L946'>                        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(scores);
<a name='L947'>                        <b>return</b>;
<a name='L948'>                    <font color='red'>}</font>
<a name='L949'>                <font color='red'>}</font>
<a name='L950'>
<a name='L951'>                <i><font color='green'>/* Remove and re-insert when score changed. We can safely</font></i>
<a name='L952'><i><font color='green'>                 * delete the key object from the skiplist, since the</font></i>
<a name='L953'><i><font color='green'>                 * dictionary still has a reference to it. */</font></i>
<a name='L954'>                <b>if</b> (score != curscore) <font color='red'>{</font>
<a name='L955'>                    <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,curobj,<a href='../S/59.html#L185' title='Defined at 185 in src/t_zset.c.'>zslDelete</a>(zs-&gt;zsl,curscore,curobj));
<a name='L956'>                    znode = <a href='../S/59.html#L107' title='Defined at 107 in src/t_zset.c.'>zslInsert</a>(zs-&gt;zsl,score,curobj);
<a name='L957'>                    <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(curobj); <i><font color='green'>/* Re-inserted in skiplist. */</font></i>
<a name='L958'>                    <a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de) = &amp;znode-&gt;score; <i><font color='green'>/* Update score ptr. */</font></i>
<a name='L959'>
<a name='L960'>                    <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,key);
<a name='L961'>                    server.dirty++;
<a name='L962'>                <font color='red'>}</font>
<a name='L963'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L964'>                znode = <a href='../S/59.html#L107' title='Defined at 107 in src/t_zset.c.'>zslInsert</a>(zs-&gt;zsl,score,ele);
<a name='L965'>                <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(ele); <i><font color='green'>/* Inserted in skiplist. */</font></i>
<a name='L966'>                <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,NULL,<a href='../D/2061.html' title='Multiple defined in 2 places.'>dictAdd</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,ele,&amp;znode-&gt;score) == <a href='../D/124.html' title='Multiple defined in 2 places.'>DICT_OK</a>);
<a name='L967'>                <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(ele); <i><font color='green'>/* Added to dictionary. */</font></i>
<a name='L968'>
<a name='L969'>                <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,key);
<a name='L970'>                server.dirty++;
<a name='L971'>                <b>if</b> (!incr) added++;
<a name='L972'>            <font color='red'>}</font>
<a name='L973'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L974'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L975'>        <font color='red'>}</font>
<a name='L976'>    <font color='red'>}</font>
<a name='L977'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(scores);
<a name='L978'>    <b>if</b> (incr) <i><font color='green'>/* ZINCRBY */</font></i>
<a name='L979'>        <a href='../S/86.html#L407' title='Defined at 407 in src/networking.c.'>addReplyDouble</a>(c,score);
<a name='L980'>    <b>else</b> <i><font color='green'>/* ZADD */</font></i>
<a name='L981'>        <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,added);
<a name='L982'><font color='red'>}</font>
<a name='L983'>
<a name='L984'><b>void</b> <a href='../R/4097.html' title='Multiple refered from 2 places.'>zaddCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L985'>    <a href='../S/59.html#L841' title='Defined at 841 in src/t_zset.c.'>zaddGenericCommand</a>(c,0);
<a name='L986'><font color='red'>}</font>
<a name='L987'>
<a name='L988'><b>void</b> <a href='../R/4104.html' title='Multiple refered from 2 places.'>zincrbyCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L989'>    <a href='../S/59.html#L841' title='Defined at 841 in src/t_zset.c.'>zaddGenericCommand</a>(c,1);
<a name='L990'><font color='red'>}</font>
<a name='L991'>
<a name='L992'><b>void</b> <a href='../R/4179.html' title='Multiple refered from 2 places.'>zremCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L993'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L994'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L995'>    <b>int</b> deleted = 0, j;
<a name='L996'>
<a name='L997'>    <b>if</b> ((zobj = <a href='../S/31.html#L81' title='Defined at 81 in src/db.c.'>lookupKeyWriteOrReply</a>(c,key,shared.czero)) == NULL ||
<a name='L998'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L999'>
<a name='L1000'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1001'>        <b>unsigned</b> <b>char</b> *eptr;
<a name='L1002'>
<a name='L1003'>        <b>for</b> (j = 2; j &lt; c-&gt;argc; j++) <font color='red'>{</font>
<a name='L1004'>            <b>if</b> ((eptr = <a href='../S/59.html#L609' title='Defined at 609 in src/t_zset.c.'>zzlFind</a>(zobj-&gt;ptr,c-&gt;argv[j],NULL)) != NULL) <font color='red'>{</font>
<a name='L1005'>                deleted++;
<a name='L1006'>                zobj-&gt;ptr = <a href='../S/59.html#L634' title='Defined at 634 in src/t_zset.c.'>zzlDelete</a>(zobj-&gt;ptr,eptr);
<a name='L1007'>                <b>if</b> (<a href='../S/59.html#L480' title='Defined at 480 in src/t_zset.c.'>zzlLength</a>(zobj-&gt;ptr) == 0) <font color='red'>{</font>
<a name='L1008'>                    <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(c-&gt;db,key);
<a name='L1009'>                    <b>break</b>;
<a name='L1010'>                <font color='red'>}</font>
<a name='L1011'>            <font color='red'>}</font>
<a name='L1012'>        <font color='red'>}</font>
<a name='L1013'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1014'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L1015'>        <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L1016'>        <b>double</b> score;
<a name='L1017'>
<a name='L1018'>        <b>for</b> (j = 2; j &lt; c-&gt;argc; j++) <font color='red'>{</font>
<a name='L1019'>            de = <a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,c-&gt;argv[j]);
<a name='L1020'>            <b>if</b> (de != NULL) <font color='red'>{</font>
<a name='L1021'>                deleted++;
<a name='L1022'>
<a name='L1023'>                <i><font color='green'>/* Delete from the skiplist */</font></i>
<a name='L1024'>                score = *(<b>double</b>*)<a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de);
<a name='L1025'>                <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,c-&gt;argv[j],<a href='../S/59.html#L185' title='Defined at 185 in src/t_zset.c.'>zslDelete</a>(zs-&gt;zsl,score,c-&gt;argv[j]));
<a name='L1026'>
<a name='L1027'>                <i><font color='green'>/* Delete from the hash table */</font></i>
<a name='L1028'>                <a href='../D/2066.html' title='Multiple defined in 2 places.'>dictDelete</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,c-&gt;argv[j]);
<a name='L1029'>                <b>if</b> (<a href='../S/35.html#L562' title='Defined at 562 in src/redis.c.'>htNeedsResize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>)) <a href='../S/29.html#L198' title='Defined at 198 in src/dict.c.'>dictResize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L1030'>                <b>if</b> (<a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>) == 0) <font color='red'>{</font>
<a name='L1031'>                    <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(c-&gt;db,key);
<a name='L1032'>                    <b>break</b>;
<a name='L1033'>                <font color='red'>}</font>
<a name='L1034'>            <font color='red'>}</font>
<a name='L1035'>        <font color='red'>}</font>
<a name='L1036'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1037'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1038'>    <font color='red'>}</font>
<a name='L1039'>
<a name='L1040'>    <b>if</b> (deleted) <font color='red'>{</font>
<a name='L1041'>        <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,key);
<a name='L1042'>        server.dirty += deleted;
<a name='L1043'>    <font color='red'>}</font>
<a name='L1044'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,deleted);
<a name='L1045'><font color='red'>}</font>
<a name='L1046'>
<a name='L1047'><b>void</b> <a href='../R/4181.html' title='Multiple refered from 2 places.'>zremrangebyscoreCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1048'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L1049'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L1050'>    <a href='../S/32.html#L925' title='Defined at 925 in src/redis.h.'>zrangespec</a> range;
<a name='L1051'>    <b>unsigned</b> <b>long</b> deleted;
<a name='L1052'>
<a name='L1053'>    <i><font color='green'>/* Parse the range arguments. */</font></i>
<a name='L1054'>    <b>if</b> (<a href='../S/59.html#L398' title='Defined at 398 in src/t_zset.c.'>zslParseRange</a>(c-&gt;argv[2],c-&gt;argv[3],&amp;range) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <font color='red'>{</font>
<a name='L1055'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"min or max is not a float");
<a name='L1056'>        <b>return</b>;
<a name='L1057'>    <font color='red'>}</font>
<a name='L1058'>
<a name='L1059'>    <b>if</b> ((zobj = <a href='../S/31.html#L81' title='Defined at 81 in src/db.c.'>lookupKeyWriteOrReply</a>(c,key,shared.czero)) == NULL ||
<a name='L1060'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L1061'>
<a name='L1062'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1063'>        zobj-&gt;ptr = <a href='../S/59.html#L706' title='Defined at 706 in src/t_zset.c.'>zzlDeleteRangeByScore</a>(zobj-&gt;ptr,range,&amp;deleted);
<a name='L1064'>        <b>if</b> (<a href='../S/59.html#L480' title='Defined at 480 in src/t_zset.c.'>zzlLength</a>(zobj-&gt;ptr) == 0) <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(c-&gt;db,key);
<a name='L1065'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1066'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L1067'>        deleted = <a href='../S/59.html#L291' title='Defined at 291 in src/t_zset.c.'>zslDeleteRangeByScore</a>(zs-&gt;zsl,range,zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L1068'>        <b>if</b> (<a href='../S/35.html#L562' title='Defined at 562 in src/redis.c.'>htNeedsResize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>)) <a href='../S/29.html#L198' title='Defined at 198 in src/dict.c.'>dictResize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L1069'>        <b>if</b> (<a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>) == 0) <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(c-&gt;db,key);
<a name='L1070'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1071'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1072'>    <font color='red'>}</font>
<a name='L1073'>
<a name='L1074'>    <b>if</b> (deleted) <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,key);
<a name='L1075'>    server.dirty += deleted;
<a name='L1076'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,deleted);
<a name='L1077'><font color='red'>}</font>
<a name='L1078'>
<a name='L1079'><b>void</b> <a href='../R/4180.html' title='Multiple refered from 2 places.'>zremrangebyrankCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1080'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L1081'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L1082'>    <b>long</b> start;
<a name='L1083'>    <b>long</b> end;
<a name='L1084'>    <b>int</b> llen;
<a name='L1085'>    <b>unsigned</b> <b>long</b> deleted;
<a name='L1086'>
<a name='L1087'>    <b>if</b> ((<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c, c-&gt;argv[2], &amp;start, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) ||
<a name='L1088'>        (<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c, c-&gt;argv[3], &amp;end, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)) <b>return</b>;
<a name='L1089'>
<a name='L1090'>    <b>if</b> ((zobj = <a href='../S/31.html#L81' title='Defined at 81 in src/db.c.'>lookupKeyWriteOrReply</a>(c,key,shared.czero)) == NULL ||
<a name='L1091'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L1092'>
<a name='L1093'>    <i><font color='green'>/* Sanitize indexes. */</font></i>
<a name='L1094'>    llen = <a href='../S/59.html#L748' title='Defined at 748 in src/t_zset.c.'>zsetLength</a>(zobj);
<a name='L1095'>    <b>if</b> (start &lt; 0) start = llen+start;
<a name='L1096'>    <b>if</b> (end &lt; 0) end = llen+end;
<a name='L1097'>    <b>if</b> (start &lt; 0) start = 0;
<a name='L1098'>
<a name='L1099'>    <i><font color='green'>/* Invariant: start &gt;= 0, so this test will be true when end &lt; 0.</font></i>
<a name='L1100'><i><font color='green'>     * The range is empty when start &gt; end or start &gt;= length. */</font></i>
<a name='L1101'>    <b>if</b> (start &gt; end || start &gt;= llen) <font color='red'>{</font>
<a name='L1102'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.czero);
<a name='L1103'>        <b>return</b>;
<a name='L1104'>    <font color='red'>}</font>
<a name='L1105'>    <b>if</b> (end &gt;= llen) end = llen-1;
<a name='L1106'>
<a name='L1107'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1108'>        <i><font color='green'>/* Correct for 1-based rank. */</font></i>
<a name='L1109'>        zobj-&gt;ptr = <a href='../S/59.html#L737' title='Defined at 737 in src/t_zset.c.'>zzlDeleteRangeByRank</a>(zobj-&gt;ptr,start+1,end+1,&amp;deleted);
<a name='L1110'>        <b>if</b> (<a href='../S/59.html#L480' title='Defined at 480 in src/t_zset.c.'>zzlLength</a>(zobj-&gt;ptr) == 0) <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(c-&gt;db,key);
<a name='L1111'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1112'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L1113'>
<a name='L1114'>        <i><font color='green'>/* Correct for 1-based rank. */</font></i>
<a name='L1115'>        deleted = <a href='../S/59.html#L322' title='Defined at 322 in src/t_zset.c.'>zslDeleteRangeByRank</a>(zs-&gt;zsl,start+1,end+1,zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L1116'>        <b>if</b> (<a href='../S/35.html#L562' title='Defined at 562 in src/redis.c.'>htNeedsResize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>)) <a href='../S/29.html#L198' title='Defined at 198 in src/dict.c.'>dictResize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L1117'>        <b>if</b> (<a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>) == 0) <a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(c-&gt;db,key);
<a name='L1118'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1119'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1120'>    <font color='red'>}</font>
<a name='L1121'>
<a name='L1122'>    <b>if</b> (deleted) <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,key);
<a name='L1123'>    server.dirty += deleted;
<a name='L1124'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,deleted);
<a name='L1125'><font color='red'>}</font>
<a name='L1126'>
<a name='L1127'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L1128'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *subject;
<a name='L1129'>    <b>int</b> type; <i><font color='green'>/* Set, sorted set */</font></i>
<a name='L1130'>    <b>int</b> encoding;
<a name='L1131'>    <b>double</b> weight;
<a name='L1132'>
<a name='L1133'>    <b>union</b> <font color='red'>{</font>
<a name='L1134'>        <i><font color='green'>/* Set iterators. */</font></i>
<a name='L1135'>        <b>union</b> _iterset <font color='red'>{</font>
<a name='L1136'>            <b>struct</b> <font color='red'>{</font>
<a name='L1137'>                <a href='../D/2513.html' title='Multiple defined in 2 places.'>intset</a> *is;
<a name='L1138'>                <b>int</b> ii;
<a name='L1139'>            <font color='red'>}</font> is;
<a name='L1140'>            <b>struct</b> <font color='red'>{</font>
<a name='L1141'>                <a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a> *<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>;
<a name='L1142'>                <a href='../D/2099.html' title='Multiple defined in 4 places.'>dictIterator</a> *di;
<a name='L1143'>                <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L1144'>            <font color='red'>}</font> ht;
<a name='L1145'>        <font color='red'>}</font> set;
<a name='L1146'>
<a name='L1147'>        <i><font color='green'>/* Sorted set iterators. */</font></i>
<a name='L1148'>        <b>union</b> _iterzset <font color='red'>{</font>
<a name='L1149'>            <b>struct</b> <font color='red'>{</font>
<a name='L1150'>                <b>unsigned</b> <b>char</b> *zl;
<a name='L1151'>                <b>unsigned</b> <b>char</b> *eptr, *sptr;
<a name='L1152'>            <font color='red'>}</font> zl;
<a name='L1153'>            <b>struct</b> <font color='red'>{</font>
<a name='L1154'>                <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs;
<a name='L1155'>                <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *node;
<a name='L1156'>            <font color='red'>}</font> sl;
<a name='L1157'>        <font color='red'>}</font> <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a>;
<a name='L1158'>    <font color='red'>}</font> iter;
<a name='L1159'><font color='red'>}</font> <a href='../R/4189.html' title='Multiple refered from 4 places.'>zsetopsrc</a>;
<a name='L1160'>
<a name='L1161'>
<a name='L1162'><i><font color='green'>/* Use dirty flags for pointers that need to be cleaned up in the next</font></i>
<a name='L1163'><i><font color='green'> * iteration over the zsetopval. The dirty flag for the long long value is</font></i>
<a name='L1164'><i><font color='green'> * special, since long long values don't need cleanup. Instead, it means that</font></i>
<a name='L1165'><i><font color='green'> * we already checked that "ell" holds a long long, or tried to convert another</font></i>
<a name='L1166'><i><font color='green'> * representation into a long long value. When this was successful,</font></i>
<a name='L1167'><i><font color='green'> * OPVAL_VALID_LL is set as well. */</font></i>
<a name='L1168'><font color='darkred'>#define</font> <a href='../R/500.html' title='Multiple refered from 2 places.'>OPVAL_DIRTY_ROBJ</a> 1
<a name='L1169'><font color='darkred'>#define</font> <a href='../R/499.html' title='Multiple refered from 2 places.'>OPVAL_DIRTY_LL</a> 2
<a name='L1170'><font color='darkred'>#define</font> <a href='../R/501.html' title='Multiple refered from 5 places.'>OPVAL_VALID_LL</a> 4
<a name='L1171'>
<a name='L1172'><i><font color='green'>/* Store value retrieved from the iterator. */</font></i>
<a name='L1173'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L1174'>    <b>int</b> flags;
<a name='L1175'>    <b>unsigned</b> <b>char</b> _buf[32]; <i><font color='green'>/* Private buffer. */</font></i>
<a name='L1176'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *ele;
<a name='L1177'>    <b>unsigned</b> <b>char</b> *estr;
<a name='L1178'>    <b>unsigned</b> <b>int</b> elen;
<a name='L1179'>    <b>long</b> <b>long</b> ell;
<a name='L1180'>    <b>double</b> score;
<a name='L1181'><font color='red'>}</font> <a href='../R/4190.html' title='Multiple refered from 2 places.'>zsetopval</a>;
<a name='L1182'>
<a name='L1183'><b>typedef</b> <b>union</b> _iterset <a href='../R/2283.html' title='Multiple refered from 5 places.'>iterset</a>;
<a name='L1184'><b>typedef</b> <b>union</b> _iterzset <a href='../R/2284.html' title='Multiple refered from 5 places.'>iterzset</a>;
<a name='L1185'>
<a name='L1186'><b>void</b> <a href='../S/59.html#L1565' title='Refered from 1565 in src/t_zset.c.'>zuiInitIterator</a>(zsetopsrc *op) <font color='red'>{</font>
<a name='L1187'>    <b>if</b> (op-&gt;subject == NULL)
<a name='L1188'>        <b>return</b>;
<a name='L1189'>
<a name='L1190'>    <b>if</b> (op-&gt;type == <a href='../D/908.html' title='Multiple defined in 2 places.'>REDIS_SET</a>) <font color='red'>{</font>
<a name='L1191'>        <a href='../S/59.html#L1183' title='Defined at 1183 in src/t_zset.c.'>iterset</a> *it = &amp;op-&gt;iter.set;
<a name='L1192'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L136' title='Defined at 136 in src/redis.h.'>REDIS_ENCODING_INTSET</a>) <font color='red'>{</font>
<a name='L1193'>            it-&gt;is.is = op-&gt;subject-&gt;ptr;
<a name='L1194'>            it-&gt;is.ii = 0;
<a name='L1195'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../D/785.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_HT</a>) <font color='red'>{</font>
<a name='L1196'>            it-&gt;ht.<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a> = op-&gt;subject-&gt;ptr;
<a name='L1197'>            it-&gt;ht.di = <a href='../D/2087.html' title='Multiple defined in 2 places.'>dictGetIterator</a>(op-&gt;subject-&gt;ptr);
<a name='L1198'>            it-&gt;ht.de = <a href='../D/2101.html' title='Multiple defined in 2 places.'>dictNext</a>(it-&gt;ht.di);
<a name='L1199'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1200'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown set encoding");
<a name='L1201'>        <font color='red'>}</font>
<a name='L1202'>    <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;type == <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>) <font color='red'>{</font>
<a name='L1203'>        <a href='../S/59.html#L1184' title='Defined at 1184 in src/t_zset.c.'>iterzset</a> *it = &amp;op-&gt;iter.<a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a>;
<a name='L1204'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1205'>            it-&gt;zl.zl = op-&gt;subject-&gt;ptr;
<a name='L1206'>            it-&gt;zl.eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(it-&gt;zl.zl,0);
<a name='L1207'>            <b>if</b> (it-&gt;zl.eptr != NULL) <font color='red'>{</font>
<a name='L1208'>                it-&gt;zl.sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(it-&gt;zl.zl,it-&gt;zl.eptr);
<a name='L1209'>                <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(it-&gt;zl.sptr != NULL);
<a name='L1210'>            <font color='red'>}</font>
<a name='L1211'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1212'>            it-&gt;sl.zs = op-&gt;subject-&gt;ptr;
<a name='L1213'>            it-&gt;sl.node = it-&gt;sl.zs-&gt;zsl-&gt;header-&gt;level[0].forward;
<a name='L1214'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1215'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1216'>        <font color='red'>}</font>
<a name='L1217'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1218'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported type");
<a name='L1219'>    <font color='red'>}</font>
<a name='L1220'><font color='red'>}</font>
<a name='L1221'>
<a name='L1222'><b>void</b> <a href='../S/59.html#L1660' title='Refered from 1660 in src/t_zset.c.'>zuiClearIterator</a>(zsetopsrc *op) <font color='red'>{</font>
<a name='L1223'>    <b>if</b> (op-&gt;subject == NULL)
<a name='L1224'>        <b>return</b>;
<a name='L1225'>
<a name='L1226'>    <b>if</b> (op-&gt;type == <a href='../D/908.html' title='Multiple defined in 2 places.'>REDIS_SET</a>) <font color='red'>{</font>
<a name='L1227'>        <a href='../S/59.html#L1183' title='Defined at 1183 in src/t_zset.c.'>iterset</a> *it = &amp;op-&gt;iter.set;
<a name='L1228'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L136' title='Defined at 136 in src/redis.h.'>REDIS_ENCODING_INTSET</a>) <font color='red'>{</font>
<a name='L1229'>            <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(it); <i><font color='green'>/* skip */</font></i>
<a name='L1230'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../D/785.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_HT</a>) <font color='red'>{</font>
<a name='L1231'>            <a href='../D/2109.html' title='Multiple defined in 2 places.'>dictReleaseIterator</a>(it-&gt;ht.di);
<a name='L1232'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1233'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown set encoding");
<a name='L1234'>        <font color='red'>}</font>
<a name='L1235'>    <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;type == <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>) <font color='red'>{</font>
<a name='L1236'>        <a href='../S/59.html#L1184' title='Defined at 1184 in src/t_zset.c.'>iterzset</a> *it = &amp;op-&gt;iter.<a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a>;
<a name='L1237'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1238'>            <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(it); <i><font color='green'>/* skip */</font></i>
<a name='L1239'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1240'>            <a href='../D/847.html' title='Multiple defined in 3 places.'>REDIS_NOTUSED</a>(it); <i><font color='green'>/* skip */</font></i>
<a name='L1241'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1242'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1243'>        <font color='red'>}</font>
<a name='L1244'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1245'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported type");
<a name='L1246'>    <font color='red'>}</font>
<a name='L1247'><font color='red'>}</font>
<a name='L1248'>
<a name='L1249'><b>int</b> <a href='../R/4216.html' title='Multiple refered from 3 places.'>zuiLength</a>(zsetopsrc *op) <font color='red'>{</font>
<a name='L1250'>    <b>if</b> (op-&gt;subject == NULL)
<a name='L1251'>        <b>return</b> 0;
<a name='L1252'>
<a name='L1253'>    <b>if</b> (op-&gt;type == <a href='../D/908.html' title='Multiple defined in 2 places.'>REDIS_SET</a>) <font color='red'>{</font>
<a name='L1254'>        <a href='../S/59.html#L1183' title='Defined at 1183 in src/t_zset.c.'>iterset</a> *it = &amp;op-&gt;iter.set;
<a name='L1255'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L136' title='Defined at 136 in src/redis.h.'>REDIS_ENCODING_INTSET</a>) <font color='red'>{</font>
<a name='L1256'>            <b>return</b> <a href='../S/44.html#L275' title='Defined at 275 in src/intset.c.'>intsetLen</a>(it-&gt;is.is);
<a name='L1257'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../D/785.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_HT</a>) <font color='red'>{</font>
<a name='L1258'>            <b>return</b> <a href='../D/2125.html' title='Multiple defined in 2 places.'>dictSize</a>(it-&gt;ht.<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>);
<a name='L1259'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1260'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown set encoding");
<a name='L1261'>        <font color='red'>}</font>
<a name='L1262'>    <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;type == <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>) <font color='red'>{</font>
<a name='L1263'>        <a href='../S/59.html#L1184' title='Defined at 1184 in src/t_zset.c.'>iterzset</a> *it = &amp;op-&gt;iter.<a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a>;
<a name='L1264'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1265'>            <b>return</b> <a href='../S/59.html#L480' title='Defined at 480 in src/t_zset.c.'>zzlLength</a>(it-&gt;zl.zl);
<a name='L1266'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1267'>            <b>return</b> it-&gt;sl.zs-&gt;zsl-&gt;length;
<a name='L1268'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1269'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1270'>        <font color='red'>}</font>
<a name='L1271'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1272'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported type");
<a name='L1273'>    <font color='red'>}</font>
<a name='L1274'><font color='red'>}</font>
<a name='L1275'>
<a name='L1276'><i><font color='green'>/* Check if the current value is valid. If so, store it in the passed structure</font></i>
<a name='L1277'><i><font color='green'> * and move to the next element. If not valid, this means we have reached the</font></i>
<a name='L1278'><i><font color='green'> * end of the structure and can abort. */</font></i>
<a name='L1279'><b>int</b> <a href='../R/4218.html' title='Multiple refered from 2 places.'>zuiNext</a>(zsetopsrc *op, zsetopval *val) <font color='red'>{</font>
<a name='L1280'>    <b>if</b> (op-&gt;subject == NULL)
<a name='L1281'>        <b>return</b> 0;
<a name='L1282'>
<a name='L1283'>    <b>if</b> (val-&gt;flags &amp; <a href='../S/59.html#L1168' title='Defined at 1168 in src/t_zset.c.'>OPVAL_DIRTY_ROBJ</a>)
<a name='L1284'>        <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(val-&gt;ele);
<a name='L1285'>
<a name='L1286'>    memset(val,0,<b>sizeof</b>(<a href='../S/59.html#L1181' title='Defined at 1181 in src/t_zset.c.'>zsetopval</a>));
<a name='L1287'>
<a name='L1288'>    <b>if</b> (op-&gt;type == <a href='../D/908.html' title='Multiple defined in 2 places.'>REDIS_SET</a>) <font color='red'>{</font>
<a name='L1289'>        <a href='../S/59.html#L1183' title='Defined at 1183 in src/t_zset.c.'>iterset</a> *it = &amp;op-&gt;iter.set;
<a name='L1290'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L136' title='Defined at 136 in src/redis.h.'>REDIS_ENCODING_INTSET</a>) <font color='red'>{</font>
<a name='L1291'>            <a href='../S/160.html#L89' title='Defined at 89 in deps/jemalloc/include/msvc_compat/stdint.h.'>int64_t</a> ell;
<a name='L1292'>
<a name='L1293'>            <b>if</b> (!<a href='../S/44.html#L266' title='Defined at 266 in src/intset.c.'>intsetGet</a>(it-&gt;is.is,it-&gt;is.ii,&amp;ell))
<a name='L1294'>                <b>return</b> 0;
<a name='L1295'>            val-&gt;ell = ell;
<a name='L1296'>            val-&gt;score = 1.0;
<a name='L1297'>
<a name='L1298'>            <i><font color='green'>/* Move to next element. */</font></i>
<a name='L1299'>            it-&gt;is.ii++;
<a name='L1300'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../D/785.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_HT</a>) <font color='red'>{</font>
<a name='L1301'>            <b>if</b> (it-&gt;ht.de == NULL)
<a name='L1302'>                <b>return</b> 0;
<a name='L1303'>            val-&gt;ele = <a href='../S/88.html#L131' title='Defined at 131 in src/dict.h.'>dictGetKey</a>(it-&gt;ht.de);
<a name='L1304'>            val-&gt;score = 1.0;
<a name='L1305'>
<a name='L1306'>            <i><font color='green'>/* Move to next element. */</font></i>
<a name='L1307'>            it-&gt;ht.de = <a href='../D/2101.html' title='Multiple defined in 2 places.'>dictNext</a>(it-&gt;ht.di);
<a name='L1308'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1309'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown set encoding");
<a name='L1310'>        <font color='red'>}</font>
<a name='L1311'>    <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;type == <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>) <font color='red'>{</font>
<a name='L1312'>        <a href='../S/59.html#L1184' title='Defined at 1184 in src/t_zset.c.'>iterzset</a> *it = &amp;op-&gt;iter.<a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a>;
<a name='L1313'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1314'>            <i><font color='green'>/* No need to check both, but better be explicit. */</font></i>
<a name='L1315'>            <b>if</b> (it-&gt;zl.eptr == NULL || it-&gt;zl.sptr == NULL)
<a name='L1316'>                <b>return</b> 0;
<a name='L1317'>            <a href='../S/32.html#L299' title='Defined at 299 in src/redis.h.'>redisAssert</a>(<a href='../S/89.html#L746' title='Defined at 746 in src/ziplist.c.'>ziplistGet</a>(it-&gt;zl.eptr,&amp;val-&gt;estr,&amp;val-&gt;elen,&amp;val-&gt;ell));
<a name='L1318'>            val-&gt;score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(it-&gt;zl.sptr);
<a name='L1319'>
<a name='L1320'>            <i><font color='green'>/* Move to next element. */</font></i>
<a name='L1321'>            <a href='../S/59.html#L486' title='Defined at 486 in src/t_zset.c.'>zzlNext</a>(it-&gt;zl.zl,&amp;it-&gt;zl.eptr,&amp;it-&gt;zl.sptr);
<a name='L1322'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1323'>            <b>if</b> (it-&gt;sl.node == NULL)
<a name='L1324'>                <b>return</b> 0;
<a name='L1325'>            val-&gt;ele = it-&gt;sl.node-&gt;obj;
<a name='L1326'>            val-&gt;score = it-&gt;sl.node-&gt;score;
<a name='L1327'>
<a name='L1328'>            <i><font color='green'>/* Move to next element. */</font></i>
<a name='L1329'>            it-&gt;sl.node = it-&gt;sl.node-&gt;level[0].forward;
<a name='L1330'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1331'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1332'>        <font color='red'>}</font>
<a name='L1333'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1334'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported type");
<a name='L1335'>    <font color='red'>}</font>
<a name='L1336'>    <b>return</b> 1;
<a name='L1337'><font color='red'>}</font>
<a name='L1338'>
<a name='L1339'><b>int</b> <a href='../S/59.html#L1406' title='Refered from 1406 in src/t_zset.c.'>zuiLongLongFromValue</a>(zsetopval *val) <font color='red'>{</font>
<a name='L1340'>    <b>if</b> (!(val-&gt;flags &amp; <a href='../S/59.html#L1169' title='Defined at 1169 in src/t_zset.c.'>OPVAL_DIRTY_LL</a>)) <font color='red'>{</font>
<a name='L1341'>        val-&gt;flags |= <a href='../S/59.html#L1169' title='Defined at 1169 in src/t_zset.c.'>OPVAL_DIRTY_LL</a>;
<a name='L1342'>
<a name='L1343'>        <b>if</b> (val-&gt;ele != NULL) <font color='red'>{</font>
<a name='L1344'>            <b>if</b> (val-&gt;ele-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>) <font color='red'>{</font>
<a name='L1345'>                val-&gt;ell = (<b>long</b>)val-&gt;ele-&gt;ptr;
<a name='L1346'>                val-&gt;flags |= <a href='../S/59.html#L1170' title='Defined at 1170 in src/t_zset.c.'>OPVAL_VALID_LL</a>;
<a name='L1347'>            <font color='red'>}</font> <b>else</b> <b>if</b> (val-&gt;ele-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>) <font color='red'>{</font>
<a name='L1348'>                <b>if</b> (<a href='../S/74.html#L244' title='Defined at 244 in src/util.c.'>string2ll</a>(val-&gt;ele-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(val-&gt;ele-&gt;ptr),&amp;val-&gt;ell))
<a name='L1349'>                    val-&gt;flags |= <a href='../S/59.html#L1170' title='Defined at 1170 in src/t_zset.c.'>OPVAL_VALID_LL</a>;
<a name='L1350'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1351'>                <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported element encoding");
<a name='L1352'>            <font color='red'>}</font>
<a name='L1353'>        <font color='red'>}</font> <b>else</b> <b>if</b> (val-&gt;estr != NULL) <font color='red'>{</font>
<a name='L1354'>            <b>if</b> (<a href='../S/74.html#L244' title='Defined at 244 in src/util.c.'>string2ll</a>((<b>char</b>*)val-&gt;estr,val-&gt;elen,&amp;val-&gt;ell))
<a name='L1355'>                val-&gt;flags |= <a href='../S/59.html#L1170' title='Defined at 1170 in src/t_zset.c.'>OPVAL_VALID_LL</a>;
<a name='L1356'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1357'>            <i><font color='green'>/* The long long was already set, flag as valid. */</font></i>
<a name='L1358'>            val-&gt;flags |= <a href='../S/59.html#L1170' title='Defined at 1170 in src/t_zset.c.'>OPVAL_VALID_LL</a>;
<a name='L1359'>        <font color='red'>}</font>
<a name='L1360'>    <font color='red'>}</font>
<a name='L1361'>    <b>return</b> val-&gt;flags &amp; <a href='../S/59.html#L1170' title='Defined at 1170 in src/t_zset.c.'>OPVAL_VALID_LL</a>;
<a name='L1362'><font color='red'>}</font>
<a name='L1363'>
<a name='L1364'><a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *<a href='../R/4219.html' title='Multiple refered from 5 places.'>zuiObjectFromValue</a>(zsetopval *val) <font color='red'>{</font>
<a name='L1365'>    <b>if</b> (val-&gt;ele == NULL) <font color='red'>{</font>
<a name='L1366'>        <b>if</b> (val-&gt;estr != NULL) <font color='red'>{</font>
<a name='L1367'>            val-&gt;ele = <a href='../D/1986.html' title='Multiple defined in 2 places.'>createStringObject</a>((<b>char</b>*)val-&gt;estr,val-&gt;elen);
<a name='L1368'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1369'>            val-&gt;ele = <a href='../S/71.html#L51' title='Defined at 51 in src/object.c.'>createStringObjectFromLongLong</a>(val-&gt;ell);
<a name='L1370'>        <font color='red'>}</font>
<a name='L1371'>        val-&gt;flags |= <a href='../S/59.html#L1168' title='Defined at 1168 in src/t_zset.c.'>OPVAL_DIRTY_ROBJ</a>;
<a name='L1372'>    <font color='red'>}</font>
<a name='L1373'>    <b>return</b> val-&gt;ele;
<a name='L1374'><font color='red'>}</font>
<a name='L1375'>
<a name='L1376'><b>int</b> zuiBufferFromValue(zsetopval *val) <font color='red'>{</font>
<a name='L1377'>    <b>if</b> (val-&gt;estr == NULL) <font color='red'>{</font>
<a name='L1378'>        <b>if</b> (val-&gt;ele != NULL) <font color='red'>{</font>
<a name='L1379'>            <b>if</b> (val-&gt;ele-&gt;encoding == <a href='../D/786.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_INT</a>) <font color='red'>{</font>
<a name='L1380'>                val-&gt;elen = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>((<b>char</b>*)val-&gt;_buf,<b>sizeof</b>(val-&gt;_buf),(<b>long</b>)val-&gt;ele-&gt;ptr);
<a name='L1381'>                val-&gt;estr = val-&gt;_buf;
<a name='L1382'>            <font color='red'>}</font> <b>else</b> <b>if</b> (val-&gt;ele-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>) <font color='red'>{</font>
<a name='L1383'>                val-&gt;elen = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(val-&gt;ele-&gt;ptr);
<a name='L1384'>                val-&gt;estr = val-&gt;ele-&gt;ptr;
<a name='L1385'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1386'>                <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported element encoding");
<a name='L1387'>            <font color='red'>}</font>
<a name='L1388'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1389'>            val-&gt;elen = <a href='../S/74.html#L220' title='Defined at 220 in src/util.c.'>ll2string</a>((<b>char</b>*)val-&gt;_buf,<b>sizeof</b>(val-&gt;_buf),val-&gt;ell);
<a name='L1390'>            val-&gt;estr = val-&gt;_buf;
<a name='L1391'>        <font color='red'>}</font>
<a name='L1392'>    <font color='red'>}</font>
<a name='L1393'>    <b>return</b> 1;
<a name='L1394'><font color='red'>}</font>
<a name='L1395'>
<a name='L1396'><i><font color='green'>/* Find value pointed to by val in the source pointer to by op. When found,</font></i>
<a name='L1397'><i><font color='green'> * return 1 and store its score in target. Return 0 otherwise. */</font></i>
<a name='L1398'><b>int</b> <a href='../R/4214.html' title='Multiple refered from 2 places.'>zuiFind</a>(zsetopsrc *op, zsetopval *val, <b>double</b> *score) <font color='red'>{</font>
<a name='L1399'>    <b>if</b> (op-&gt;subject == NULL)
<a name='L1400'>        <b>return</b> 0;
<a name='L1401'>
<a name='L1402'>    <b>if</b> (op-&gt;type == <a href='../D/908.html' title='Multiple defined in 2 places.'>REDIS_SET</a>) <font color='red'>{</font>
<a name='L1403'>        <a href='../S/59.html#L1183' title='Defined at 1183 in src/t_zset.c.'>iterset</a> *it = &amp;op-&gt;iter.set;
<a name='L1404'>
<a name='L1405'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L136' title='Defined at 136 in src/redis.h.'>REDIS_ENCODING_INTSET</a>) <font color='red'>{</font>
<a name='L1406'>            <b>if</b> (<a href='../S/59.html#L1339' title='Defined at 1339 in src/t_zset.c.'>zuiLongLongFromValue</a>(val) &amp;&amp; <a href='../S/44.html#L254' title='Defined at 254 in src/intset.c.'>intsetFind</a>(it-&gt;is.is,val-&gt;ell)) <font color='red'>{</font>
<a name='L1407'>                *score = 1.0;
<a name='L1408'>                <b>return</b> 1;
<a name='L1409'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1410'>                <b>return</b> 0;
<a name='L1411'>            <font color='red'>}</font>
<a name='L1412'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../D/785.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_HT</a>) <font color='red'>{</font>
<a name='L1413'>            <a href='../S/59.html#L1364' title='Defined at 1364 in src/t_zset.c.'>zuiObjectFromValue</a>(val);
<a name='L1414'>            <b>if</b> (<a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(it-&gt;ht.<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,val-&gt;ele) != NULL) <font color='red'>{</font>
<a name='L1415'>                *score = 1.0;
<a name='L1416'>                <b>return</b> 1;
<a name='L1417'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1418'>                <b>return</b> 0;
<a name='L1419'>            <font color='red'>}</font>
<a name='L1420'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1421'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown set encoding");
<a name='L1422'>        <font color='red'>}</font>
<a name='L1423'>    <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;type == <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>) <font color='red'>{</font>
<a name='L1424'>        <a href='../S/59.html#L1184' title='Defined at 1184 in src/t_zset.c.'>iterzset</a> *it = &amp;op-&gt;iter.<a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a>;
<a name='L1425'>        <a href='../S/59.html#L1364' title='Defined at 1364 in src/t_zset.c.'>zuiObjectFromValue</a>(val);
<a name='L1426'>
<a name='L1427'>        <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1428'>            <b>if</b> (<a href='../S/59.html#L609' title='Defined at 609 in src/t_zset.c.'>zzlFind</a>(it-&gt;zl.zl,val-&gt;ele,score) != NULL) <font color='red'>{</font>
<a name='L1429'>                <i><font color='green'>/* Score is already set by zzlFind. */</font></i>
<a name='L1430'>                <b>return</b> 1;
<a name='L1431'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1432'>                <b>return</b> 0;
<a name='L1433'>            <font color='red'>}</font>
<a name='L1434'>        <font color='red'>}</font> <b>else</b> <b>if</b> (op-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1435'>            <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L1436'>            <b>if</b> ((de = <a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(it-&gt;sl.zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,val-&gt;ele)) != NULL) <font color='red'>{</font>
<a name='L1437'>                *score = *(<b>double</b>*)<a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de);
<a name='L1438'>                <b>return</b> 1;
<a name='L1439'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1440'>                <b>return</b> 0;
<a name='L1441'>            <font color='red'>}</font>
<a name='L1442'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1443'>            <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1444'>        <font color='red'>}</font>
<a name='L1445'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1446'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unsupported type");
<a name='L1447'>    <font color='red'>}</font>
<a name='L1448'><font color='red'>}</font>
<a name='L1449'>
<a name='L1450'><b>int</b> <a href='../S/59.html#L1569' title='Refered from 1569 in src/t_zset.c.'>zuiCompareByCardinality</a>(<b>const</b> <b>void</b> *s1, <b>const</b> <b>void</b> *s2) <font color='red'>{</font>
<a name='L1451'>    <b>return</b> <a href='../S/59.html#L1249' title='Defined at 1249 in src/t_zset.c.'>zuiLength</a>((<a href='../S/59.html#L1159' title='Defined at 1159 in src/t_zset.c.'>zsetopsrc</a>*)s1) - <a href='../S/59.html#L1249' title='Defined at 1249 in src/t_zset.c.'>zuiLength</a>((<a href='../S/59.html#L1159' title='Defined at 1159 in src/t_zset.c.'>zsetopsrc</a>*)s2);
<a name='L1452'><font color='red'>}</font>
<a name='L1453'>
<a name='L1454'><font color='darkred'>#define</font> <a href='../R/604.html' title='Multiple refered from 3 places.'>REDIS_AGGR_SUM</a> 1
<a name='L1455'><font color='darkred'>#define</font> <a href='../R/603.html' title='Multiple refered from 2 places.'>REDIS_AGGR_MIN</a> 2
<a name='L1456'><font color='darkred'>#define</font> <a href='../R/602.html' title='Multiple refered from 2 places.'>REDIS_AGGR_MAX</a> 3
<a name='L1457'><font color='darkred'>#define</font> zunionInterDictValue(_e) (<a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(_e) == NULL ? 1.0 : *(<b>double</b>*)<a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(_e))
<a name='L1458'>
<a name='L1459'><b>inline</b> <b>static</b> <b>void</b> <a href='../R/4220.html' title='Multiple refered from 4 places.'>zunionInterAggregate</a>(<b>double</b> *target, <b>double</b> val, <b>int</b> aggregate) <font color='red'>{</font>
<a name='L1460'>    <b>if</b> (aggregate == <a href='../S/59.html#L1454' title='Defined at 1454 in src/t_zset.c.'>REDIS_AGGR_SUM</a>) <font color='red'>{</font>
<a name='L1461'>        *target = *target + val;
<a name='L1462'>        <i><font color='green'>/* The result of adding two doubles is NaN when one variable</font></i>
<a name='L1463'><i><font color='green'>         * is +inf and the other is -inf. When these numbers are added,</font></i>
<a name='L1464'><i><font color='green'>         * we maintain the convention of the result being 0.0. */</font></i>
<a name='L1465'>        <b>if</b> (<a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(*target)) *target = 0.0;
<a name='L1466'>    <font color='red'>}</font> <b>else</b> <b>if</b> (aggregate == <a href='../S/59.html#L1455' title='Defined at 1455 in src/t_zset.c.'>REDIS_AGGR_MIN</a>) <font color='red'>{</font>
<a name='L1467'>        *target = val &lt; *target ? val : *target;
<a name='L1468'>    <font color='red'>}</font> <b>else</b> <b>if</b> (aggregate == <a href='../S/59.html#L1456' title='Defined at 1456 in src/t_zset.c.'>REDIS_AGGR_MAX</a>) <font color='red'>{</font>
<a name='L1469'>        *target = val &gt; *target ? val : *target;
<a name='L1470'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1471'>        <i><font color='green'>/* safety net */</font></i>
<a name='L1472'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown ZUNION/INTER aggregate type");
<a name='L1473'>    <font color='red'>}</font>
<a name='L1474'><font color='red'>}</font>
<a name='L1475'>
<a name='L1476'><b>void</b> <a href='../R/4221.html' title='Multiple refered from 2 places.'>zunionInterGenericCommand</a>(redisClient *c, robj *dstkey, <b>int</b> op) <font color='red'>{</font>
<a name='L1477'>    <b>int</b> i, j;
<a name='L1478'>    <b>long</b> setnum;
<a name='L1479'>    <b>int</b> aggregate = <a href='../S/59.html#L1454' title='Defined at 1454 in src/t_zset.c.'>REDIS_AGGR_SUM</a>;
<a name='L1480'>    <a href='../S/59.html#L1159' title='Defined at 1159 in src/t_zset.c.'>zsetopsrc</a> *src;
<a name='L1481'>    <a href='../S/59.html#L1181' title='Defined at 1181 in src/t_zset.c.'>zsetopval</a> zval;
<a name='L1482'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *tmp;
<a name='L1483'>    <b>unsigned</b> <b>int</b> maxelelen = 0;
<a name='L1484'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *dstobj;
<a name='L1485'>    <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *dstzset;
<a name='L1486'>    <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *znode;
<a name='L1487'>    <b>int</b> touched = 0;
<a name='L1488'>
<a name='L1489'>    <i><font color='green'>/* expect setnum input keys to be given */</font></i>
<a name='L1490'>    <b>if</b> ((<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c, c-&gt;argv[2], &amp;setnum, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>))
<a name='L1491'>        <b>return</b>;
<a name='L1492'>
<a name='L1493'>    <b>if</b> (setnum &lt; 1) <font color='red'>{</font>
<a name='L1494'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,
<a name='L1495'>            "at least 1 input key is needed for ZUNIONSTORE/ZINTERSTORE");
<a name='L1496'>        <b>return</b>;
<a name='L1497'>    <font color='red'>}</font>
<a name='L1498'>
<a name='L1499'>    <i><font color='green'>/* test if the expected number of keys would overflow */</font></i>
<a name='L1500'>    <b>if</b> (setnum &gt; c-&gt;argc-3) <font color='red'>{</font>
<a name='L1501'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.syntaxerr);
<a name='L1502'>        <b>return</b>;
<a name='L1503'>    <font color='red'>}</font>
<a name='L1504'>
<a name='L1505'>    <i><font color='green'>/* read keys to be used for input */</font></i>
<a name='L1506'>    src = <a href='../S/39.html#L135' title='Defined at 135 in src/zmalloc.c.'>zcalloc</a>(<b>sizeof</b>(<a href='../S/59.html#L1159' title='Defined at 1159 in src/t_zset.c.'>zsetopsrc</a>) * setnum);
<a name='L1507'>    <b>for</b> (i = 0, j = 3; i &lt; setnum; i++, j++) <font color='red'>{</font>
<a name='L1508'>        <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *obj = <a href='../S/31.html#L70' title='Defined at 70 in src/db.c.'>lookupKeyWrite</a>(c-&gt;db,c-&gt;argv[j]);
<a name='L1509'>        <b>if</b> (obj != NULL) <font color='red'>{</font>
<a name='L1510'>            <b>if</b> (obj-&gt;type != <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a> &amp;&amp; obj-&gt;type != <a href='../D/908.html' title='Multiple defined in 2 places.'>REDIS_SET</a>) <font color='red'>{</font>
<a name='L1511'>                <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(src);
<a name='L1512'>                <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.wrongtypeerr);
<a name='L1513'>                <b>return</b>;
<a name='L1514'>            <font color='red'>}</font>
<a name='L1515'>
<a name='L1516'>            src[i].subject = obj;
<a name='L1517'>            src[i].type = obj-&gt;type;
<a name='L1518'>            src[i].encoding = obj-&gt;encoding;
<a name='L1519'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1520'>            src[i].subject = NULL;
<a name='L1521'>        <font color='red'>}</font>
<a name='L1522'>
<a name='L1523'>        <i><font color='green'>/* Default all weights to 1. */</font></i>
<a name='L1524'>        src[i].weight = 1.0;
<a name='L1525'>    <font color='red'>}</font>
<a name='L1526'>
<a name='L1527'>    <i><font color='green'>/* parse optional extra arguments */</font></i>
<a name='L1528'>    <b>if</b> (j &lt; c-&gt;argc) <font color='red'>{</font>
<a name='L1529'>        <b>int</b> remaining = c-&gt;argc - j;
<a name='L1530'>
<a name='L1531'>        <b>while</b> (remaining) <font color='red'>{</font>
<a name='L1532'>            <b>if</b> (remaining &gt;= (setnum + 1) &amp;&amp; !strcasecmp(c-&gt;argv[j]-&gt;ptr,"weights")) <font color='red'>{</font>
<a name='L1533'>                j++; remaining--;
<a name='L1534'>                <b>for</b> (i = 0; i &lt; setnum; i++, j++, remaining--) <font color='red'>{</font>
<a name='L1535'>                    <b>if</b> (<a href='../S/71.html#L408' title='Defined at 408 in src/object.c.'>getDoubleFromObjectOrReply</a>(c,c-&gt;argv[j],&amp;src[i].weight,
<a name='L1536'>                            "weight value is not a float") != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)
<a name='L1537'>                    <font color='red'>{</font>
<a name='L1538'>                        <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(src);
<a name='L1539'>                        <b>return</b>;
<a name='L1540'>                    <font color='red'>}</font>
<a name='L1541'>                <font color='red'>}</font>
<a name='L1542'>            <font color='red'>}</font> <b>else</b> <b>if</b> (remaining &gt;= 2 &amp;&amp; !strcasecmp(c-&gt;argv[j]-&gt;ptr,"aggregate")) <font color='red'>{</font>
<a name='L1543'>                j++; remaining--;
<a name='L1544'>                <b>if</b> (!strcasecmp(c-&gt;argv[j]-&gt;ptr,"sum")) <font color='red'>{</font>
<a name='L1545'>                    aggregate = <a href='../S/59.html#L1454' title='Defined at 1454 in src/t_zset.c.'>REDIS_AGGR_SUM</a>;
<a name='L1546'>                <font color='red'>}</font> <b>else</b> <b>if</b> (!strcasecmp(c-&gt;argv[j]-&gt;ptr,"min")) <font color='red'>{</font>
<a name='L1547'>                    aggregate = <a href='../S/59.html#L1455' title='Defined at 1455 in src/t_zset.c.'>REDIS_AGGR_MIN</a>;
<a name='L1548'>                <font color='red'>}</font> <b>else</b> <b>if</b> (!strcasecmp(c-&gt;argv[j]-&gt;ptr,"max")) <font color='red'>{</font>
<a name='L1549'>                    aggregate = <a href='../S/59.html#L1456' title='Defined at 1456 in src/t_zset.c.'>REDIS_AGGR_MAX</a>;
<a name='L1550'>                <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1551'>                    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(src);
<a name='L1552'>                    <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.syntaxerr);
<a name='L1553'>                    <b>return</b>;
<a name='L1554'>                <font color='red'>}</font>
<a name='L1555'>                j++; remaining--;
<a name='L1556'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1557'>                <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(src);
<a name='L1558'>                <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.syntaxerr);
<a name='L1559'>                <b>return</b>;
<a name='L1560'>            <font color='red'>}</font>
<a name='L1561'>        <font color='red'>}</font>
<a name='L1562'>    <font color='red'>}</font>
<a name='L1563'>
<a name='L1564'>    <b>for</b> (i = 0; i &lt; setnum; i++)
<a name='L1565'>        <a href='../S/59.html#L1186' title='Defined at 1186 in src/t_zset.c.'>zuiInitIterator</a>(&amp;src[i]);
<a name='L1566'>
<a name='L1567'>    <i><font color='green'>/* sort sets from the smallest to largest, this will improve our</font></i>
<a name='L1568'><i><font color='green'>     * algorithm's performance */</font></i>
<a name='L1569'>    qsort(src,setnum,<b>sizeof</b>(<a href='../S/59.html#L1159' title='Defined at 1159 in src/t_zset.c.'>zsetopsrc</a>),<a href='../S/59.html#L1450' title='Defined at 1450 in src/t_zset.c.'>zuiCompareByCardinality</a>);
<a name='L1570'>
<a name='L1571'>    dstobj = <a href='../S/71.html#L133' title='Defined at 133 in src/object.c.'>createZsetObject</a>();
<a name='L1572'>    dstzset = dstobj-&gt;ptr;
<a name='L1573'>    memset(&amp;zval, 0, <b>sizeof</b>(zval));
<a name='L1574'>
<a name='L1575'>    <b>if</b> (op == <a href='../D/851.html' title='Multiple defined in 2 places.'>REDIS_OP_INTER</a>) <font color='red'>{</font>
<a name='L1576'>        <i><font color='green'>/* Skip everything if the smallest input is empty. */</font></i>
<a name='L1577'>        <b>if</b> (<a href='../S/59.html#L1249' title='Defined at 1249 in src/t_zset.c.'>zuiLength</a>(&amp;src[0]) &gt; 0) <font color='red'>{</font>
<a name='L1578'>            <i><font color='green'>/* Precondition: as src[0] is non-empty and the inputs are ordered</font></i>
<a name='L1579'><i><font color='green'>             * by size, all src[i &gt; 0] are non-empty too. */</font></i>
<a name='L1580'>            <b>while</b> (<a href='../S/59.html#L1279' title='Defined at 1279 in src/t_zset.c.'>zuiNext</a>(&amp;src[0],&amp;zval)) <font color='red'>{</font>
<a name='L1581'>                <b>double</b> score, value;
<a name='L1582'>
<a name='L1583'>                score = src[0].weight * zval.score;
<a name='L1584'>                <b>if</b> (<a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(score)) score = 0;
<a name='L1585'>
<a name='L1586'>                <b>for</b> (j = 1; j &lt; setnum; j++) <font color='red'>{</font>
<a name='L1587'>                    <i><font color='green'>/* It is not safe to access the zset we are</font></i>
<a name='L1588'><i><font color='green'>                     * iterating, so explicitly check for equal object. */</font></i>
<a name='L1589'>                    <b>if</b> (src[j].subject == src[0].subject) <font color='red'>{</font>
<a name='L1590'>                        value = zval.score*src[j].weight;
<a name='L1591'>                        <a href='../S/59.html#L1459' title='Defined at 1459 in src/t_zset.c.'>zunionInterAggregate</a>(&amp;score,value,aggregate);
<a name='L1592'>                    <font color='red'>}</font> <b>else</b> <b>if</b> (<a href='../S/59.html#L1398' title='Defined at 1398 in src/t_zset.c.'>zuiFind</a>(&amp;src[j],&amp;zval,&amp;value)) <font color='red'>{</font>
<a name='L1593'>                        value *= src[j].weight;
<a name='L1594'>                        <a href='../S/59.html#L1459' title='Defined at 1459 in src/t_zset.c.'>zunionInterAggregate</a>(&amp;score,value,aggregate);
<a name='L1595'>                    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1596'>                        <b>break</b>;
<a name='L1597'>                    <font color='red'>}</font>
<a name='L1598'>                <font color='red'>}</font>
<a name='L1599'>
<a name='L1600'>                <i><font color='green'>/* Only continue when present in every input. */</font></i>
<a name='L1601'>                <b>if</b> (j == setnum) <font color='red'>{</font>
<a name='L1602'>                    tmp = <a href='../S/59.html#L1364' title='Defined at 1364 in src/t_zset.c.'>zuiObjectFromValue</a>(&amp;zval);
<a name='L1603'>                    znode = <a href='../S/59.html#L107' title='Defined at 107 in src/t_zset.c.'>zslInsert</a>(dstzset-&gt;zsl,score,tmp);
<a name='L1604'>                    <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(tmp); <i><font color='green'>/* added to skiplist */</font></i>
<a name='L1605'>                    <a href='../D/2061.html' title='Multiple defined in 2 places.'>dictAdd</a>(dstzset-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,tmp,&amp;znode-&gt;score);
<a name='L1606'>                    <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(tmp); <i><font color='green'>/* added to dictionary */</font></i>
<a name='L1607'>
<a name='L1608'>                    <b>if</b> (tmp-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>)
<a name='L1609'>                        <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(tmp-&gt;ptr) &gt; maxelelen)
<a name='L1610'>                            maxelelen = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(tmp-&gt;ptr);
<a name='L1611'>                <font color='red'>}</font>
<a name='L1612'>            <font color='red'>}</font>
<a name='L1613'>        <font color='red'>}</font>
<a name='L1614'>    <font color='red'>}</font> <b>else</b> <b>if</b> (op == <a href='../D/852.html' title='Multiple defined in 2 places.'>REDIS_OP_UNION</a>) <font color='red'>{</font>
<a name='L1615'>        <b>for</b> (i = 0; i &lt; setnum; i++) <font color='red'>{</font>
<a name='L1616'>            <b>if</b> (<a href='../S/59.html#L1249' title='Defined at 1249 in src/t_zset.c.'>zuiLength</a>(&amp;src[i]) == 0)
<a name='L1617'>                <b>continue</b>;
<a name='L1618'>
<a name='L1619'>            <b>while</b> (<a href='../S/59.html#L1279' title='Defined at 1279 in src/t_zset.c.'>zuiNext</a>(&amp;src[i],&amp;zval)) <font color='red'>{</font>
<a name='L1620'>                <b>double</b> score, value;
<a name='L1621'>
<a name='L1622'>                <i><font color='green'>/* Skip key when already processed */</font></i>
<a name='L1623'>                <b>if</b> (<a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(dstzset-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,<a href='../S/59.html#L1364' title='Defined at 1364 in src/t_zset.c.'>zuiObjectFromValue</a>(&amp;zval)) != NULL)
<a name='L1624'>                    <b>continue</b>;
<a name='L1625'>
<a name='L1626'>                <i><font color='green'>/* Initialize score */</font></i>
<a name='L1627'>                score = src[i].weight * zval.score;
<a name='L1628'>                <b>if</b> (<a href='../D/2570.html' title='Multiple defined in 2 places.'>isnan</a>(score)) score = 0;
<a name='L1629'>
<a name='L1630'>                <i><font color='green'>/* Because the inputs are sorted by size, it's only possible</font></i>
<a name='L1631'><i><font color='green'>                 * for sets at larger indices to hold this element. */</font></i>
<a name='L1632'>                <b>for</b> (j = (i+1); j &lt; setnum; j++) <font color='red'>{</font>
<a name='L1633'>                    <i><font color='green'>/* It is not safe to access the zset we are</font></i>
<a name='L1634'><i><font color='green'>                     * iterating, so explicitly check for equal object. */</font></i>
<a name='L1635'>                    <b>if</b>(src[j].subject == src[i].subject) <font color='red'>{</font>
<a name='L1636'>                        value = zval.score*src[j].weight;
<a name='L1637'>                        <a href='../S/59.html#L1459' title='Defined at 1459 in src/t_zset.c.'>zunionInterAggregate</a>(&amp;score,value,aggregate);
<a name='L1638'>                    <font color='red'>}</font> <b>else</b> <b>if</b> (<a href='../S/59.html#L1398' title='Defined at 1398 in src/t_zset.c.'>zuiFind</a>(&amp;src[j],&amp;zval,&amp;value)) <font color='red'>{</font>
<a name='L1639'>                        value *= src[j].weight;
<a name='L1640'>                        <a href='../S/59.html#L1459' title='Defined at 1459 in src/t_zset.c.'>zunionInterAggregate</a>(&amp;score,value,aggregate);
<a name='L1641'>                    <font color='red'>}</font>
<a name='L1642'>                <font color='red'>}</font>
<a name='L1643'>
<a name='L1644'>                tmp = <a href='../S/59.html#L1364' title='Defined at 1364 in src/t_zset.c.'>zuiObjectFromValue</a>(&amp;zval);
<a name='L1645'>                znode = <a href='../S/59.html#L107' title='Defined at 107 in src/t_zset.c.'>zslInsert</a>(dstzset-&gt;zsl,score,tmp);
<a name='L1646'>                <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(zval.ele); <i><font color='green'>/* added to skiplist */</font></i>
<a name='L1647'>                <a href='../D/2061.html' title='Multiple defined in 2 places.'>dictAdd</a>(dstzset-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,tmp,&amp;znode-&gt;score);
<a name='L1648'>                <a href='../S/71.html#L214' title='Defined at 214 in src/object.c.'>incrRefCount</a>(zval.ele); <i><font color='green'>/* added to dictionary */</font></i>
<a name='L1649'>
<a name='L1650'>                <b>if</b> (tmp-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>)
<a name='L1651'>                    <b>if</b> (<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(tmp-&gt;ptr) &gt; maxelelen)
<a name='L1652'>                        maxelelen = <a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(tmp-&gt;ptr);
<a name='L1653'>            <font color='red'>}</font>
<a name='L1654'>        <font color='red'>}</font>
<a name='L1655'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1656'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown operator");
<a name='L1657'>    <font color='red'>}</font>
<a name='L1658'>
<a name='L1659'>    <b>for</b> (i = 0; i &lt; setnum; i++)
<a name='L1660'>        <a href='../S/59.html#L1222' title='Defined at 1222 in src/t_zset.c.'>zuiClearIterator</a>(&amp;src[i]);
<a name='L1661'>
<a name='L1662'>    <b>if</b> (<a href='../S/31.html#L158' title='Defined at 158 in src/db.c.'>dbDelete</a>(c-&gt;db,dstkey)) <font color='red'>{</font>
<a name='L1663'>        <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,dstkey);
<a name='L1664'>        touched = 1;
<a name='L1665'>        server.dirty++;
<a name='L1666'>    <font color='red'>}</font>
<a name='L1667'>    <b>if</b> (dstzset-&gt;zsl-&gt;length) <font color='red'>{</font>
<a name='L1668'>        <i><font color='green'>/* Convert to ziplist when in limits. */</font></i>
<a name='L1669'>        <b>if</b> (dstzset-&gt;zsl-&gt;length &lt;= server.zset_max_ziplist_entries &amp;&amp;
<a name='L1670'>            maxelelen &lt;= server.zset_max_ziplist_value)
<a name='L1671'>                <a href='../S/59.html#L760' title='Defined at 760 in src/t_zset.c.'>zsetConvert</a>(dstobj,<a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>);
<a name='L1672'>
<a name='L1673'>        <a href='../S/31.html#L91' title='Defined at 91 in src/db.c.'>dbAdd</a>(c-&gt;db,dstkey,dstobj);
<a name='L1674'>        <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,<a href='../S/59.html#L748' title='Defined at 748 in src/t_zset.c.'>zsetLength</a>(dstobj));
<a name='L1675'>        <b>if</b> (!touched) <a href='../S/31.html#L197' title='Defined at 197 in src/db.c.'>signalModifiedKey</a>(c-&gt;db,dstkey);
<a name='L1676'>        server.dirty++;
<a name='L1677'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1678'>        <a href='../S/71.html#L218' title='Defined at 218 in src/object.c.'>decrRefCount</a>(dstobj);
<a name='L1679'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.czero);
<a name='L1680'>    <font color='red'>}</font>
<a name='L1681'>    <a href='../S/39.html#L192' title='Defined at 192 in src/zmalloc.c.'>zfree</a>(src);
<a name='L1682'><font color='red'>}</font>
<a name='L1683'>
<a name='L1684'><b>void</b> <a href='../R/4223.html' title='Multiple refered from 2 places.'>zunionstoreCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1685'>    <a href='../S/59.html#L1476' title='Defined at 1476 in src/t_zset.c.'>zunionInterGenericCommand</a>(c,c-&gt;argv[1], <a href='../D/852.html' title='Multiple defined in 2 places.'>REDIS_OP_UNION</a>);
<a name='L1686'><font color='red'>}</font>
<a name='L1687'>
<a name='L1688'><b>void</b> <a href='../R/4105.html' title='Multiple refered from 2 places.'>zinterstoreCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1689'>    <a href='../S/59.html#L1476' title='Defined at 1476 in src/t_zset.c.'>zunionInterGenericCommand</a>(c,c-&gt;argv[1], <a href='../D/851.html' title='Multiple defined in 2 places.'>REDIS_OP_INTER</a>);
<a name='L1690'><font color='red'>}</font>
<a name='L1691'>
<a name='L1692'><b>void</b> <a href='../R/4173.html' title='Multiple refered from 2 places.'>zrangeGenericCommand</a>(redisClient *c, <b>int</b> reverse) <font color='red'>{</font>
<a name='L1693'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L1694'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L1695'>    <b>int</b> withscores = 0;
<a name='L1696'>    <b>long</b> start;
<a name='L1697'>    <b>long</b> end;
<a name='L1698'>    <b>int</b> llen;
<a name='L1699'>    <b>int</b> rangelen;
<a name='L1700'>
<a name='L1701'>    <b>if</b> ((<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c, c-&gt;argv[2], &amp;start, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) ||
<a name='L1702'>        (<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c, c-&gt;argv[3], &amp;end, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)) <b>return</b>;
<a name='L1703'>
<a name='L1704'>    <b>if</b> (c-&gt;argc == 5 &amp;&amp; !strcasecmp(c-&gt;argv[4]-&gt;ptr,"withscores")) <font color='red'>{</font>
<a name='L1705'>        withscores = 1;
<a name='L1706'>    <font color='red'>}</font> <b>else</b> <b>if</b> (c-&gt;argc &gt;= 5) <font color='red'>{</font>
<a name='L1707'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.syntaxerr);
<a name='L1708'>        <b>return</b>;
<a name='L1709'>    <font color='red'>}</font>
<a name='L1710'>
<a name='L1711'>    <b>if</b> ((zobj = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,key,shared.emptymultibulk)) == NULL
<a name='L1712'>         || <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L1713'>
<a name='L1714'>    <i><font color='green'>/* Sanitize indexes. */</font></i>
<a name='L1715'>    llen = <a href='../S/59.html#L748' title='Defined at 748 in src/t_zset.c.'>zsetLength</a>(zobj);
<a name='L1716'>    <b>if</b> (start &lt; 0) start = llen+start;
<a name='L1717'>    <b>if</b> (end &lt; 0) end = llen+end;
<a name='L1718'>    <b>if</b> (start &lt; 0) start = 0;
<a name='L1719'>
<a name='L1720'>    <i><font color='green'>/* Invariant: start &gt;= 0, so this test will be true when end &lt; 0.</font></i>
<a name='L1721'><i><font color='green'>     * The range is empty when start &gt; end or start &gt;= length. */</font></i>
<a name='L1722'>    <b>if</b> (start &gt; end || start &gt;= llen) <font color='red'>{</font>
<a name='L1723'>        <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.emptymultibulk);
<a name='L1724'>        <b>return</b>;
<a name='L1725'>    <font color='red'>}</font>
<a name='L1726'>    <b>if</b> (end &gt;= llen) end = llen-1;
<a name='L1727'>    rangelen = (end-start)+1;
<a name='L1728'>
<a name='L1729'>    <i><font color='green'>/* Return the result in form of a multi-bulk reply */</font></i>
<a name='L1730'>    <a href='../S/86.html#L448' title='Defined at 448 in src/networking.c.'>addReplyMultiBulkLen</a>(c, withscores ? (rangelen*2) : rangelen);
<a name='L1731'>
<a name='L1732'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1733'>        <b>unsigned</b> <b>char</b> *zl = zobj-&gt;ptr;
<a name='L1734'>        <b>unsigned</b> <b>char</b> *eptr, *sptr;
<a name='L1735'>        <b>unsigned</b> <b>char</b> *vstr;
<a name='L1736'>        <b>unsigned</b> <b>int</b> vlen;
<a name='L1737'>        <b>long</b> <b>long</b> vlong;
<a name='L1738'>
<a name='L1739'>        <b>if</b> (reverse)
<a name='L1740'>            eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,-2-(2*start));
<a name='L1741'>        <b>else</b>
<a name='L1742'>            eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,2*start);
<a name='L1743'>
<a name='L1744'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,eptr != NULL);
<a name='L1745'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L1746'>
<a name='L1747'>        <b>while</b> (rangelen--) <font color='red'>{</font>
<a name='L1748'>            <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,eptr != NULL &amp;&amp; sptr != NULL);
<a name='L1749'>            <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,<a href='../S/89.html#L746' title='Defined at 746 in src/ziplist.c.'>ziplistGet</a>(eptr,&amp;vstr,&amp;vlen,&amp;vlong));
<a name='L1750'>            <b>if</b> (vstr == NULL)
<a name='L1751'>                <a href='../S/86.html#L498' title='Defined at 498 in src/networking.c.'>addReplyBulkLongLong</a>(c,vlong);
<a name='L1752'>            <b>else</b>
<a name='L1753'>                <a href='../S/86.html#L482' title='Defined at 482 in src/networking.c.'>addReplyBulkCBuffer</a>(c,vstr,vlen);
<a name='L1754'>
<a name='L1755'>            <b>if</b> (withscores)
<a name='L1756'>                <a href='../S/86.html#L407' title='Defined at 407 in src/networking.c.'>addReplyDouble</a>(c,<a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr));
<a name='L1757'>
<a name='L1758'>            <b>if</b> (reverse)
<a name='L1759'>                <a href='../S/59.html#L505' title='Defined at 505 in src/t_zset.c.'>zzlPrev</a>(zl,&amp;eptr,&amp;sptr);
<a name='L1760'>            <b>else</b>
<a name='L1761'>                <a href='../S/59.html#L486' title='Defined at 486 in src/t_zset.c.'>zzlNext</a>(zl,&amp;eptr,&amp;sptr);
<a name='L1762'>        <font color='red'>}</font>
<a name='L1763'>
<a name='L1764'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1765'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L1766'>        <a href='../D/4581.html' title='Multiple defined in 2 places.'>zskiplist</a> *zsl = zs-&gt;zsl;
<a name='L1767'>        <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *ln;
<a name='L1768'>        <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *ele;
<a name='L1769'>
<a name='L1770'>        <i><font color='green'>/* Check if starting point is trivial, before doing log(N) lookup. */</font></i>
<a name='L1771'>        <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1772'>            ln = zsl-&gt;tail;
<a name='L1773'>            <b>if</b> (start &gt; 0)
<a name='L1774'>                ln = <a href='../S/59.html#L378' title='Defined at 378 in src/t_zset.c.'>zslGetElementByRank</a>(zsl,llen-start);
<a name='L1775'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1776'>            ln = zsl-&gt;header-&gt;level[0].forward;
<a name='L1777'>            <b>if</b> (start &gt; 0)
<a name='L1778'>                ln = <a href='../S/59.html#L378' title='Defined at 378 in src/t_zset.c.'>zslGetElementByRank</a>(zsl,start+1);
<a name='L1779'>        <font color='red'>}</font>
<a name='L1780'>
<a name='L1781'>        <b>while</b>(rangelen--) <font color='red'>{</font>
<a name='L1782'>            <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,ln != NULL);
<a name='L1783'>            ele = ln-&gt;obj;
<a name='L1784'>            <a href='../S/86.html#L475' title='Defined at 475 in src/networking.c.'>addReplyBulk</a>(c,ele);
<a name='L1785'>            <b>if</b> (withscores)
<a name='L1786'>                <a href='../S/86.html#L407' title='Defined at 407 in src/networking.c.'>addReplyDouble</a>(c,ln-&gt;score);
<a name='L1787'>            ln = reverse ? ln-&gt;backward : ln-&gt;level[0].forward;
<a name='L1788'>        <font color='red'>}</font>
<a name='L1789'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1790'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1791'>    <font color='red'>}</font>
<a name='L1792'><font color='red'>}</font>
<a name='L1793'>
<a name='L1794'><b>void</b> <a href='../R/4172.html' title='Multiple refered from 2 places.'>zrangeCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1795'>    <a href='../S/59.html#L1692' title='Defined at 1692 in src/t_zset.c.'>zrangeGenericCommand</a>(c,0);
<a name='L1796'><font color='red'>}</font>
<a name='L1797'>
<a name='L1798'><b>void</b> <a href='../R/4182.html' title='Multiple refered from 2 places.'>zrevrangeCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1799'>    <a href='../S/59.html#L1692' title='Defined at 1692 in src/t_zset.c.'>zrangeGenericCommand</a>(c,1);
<a name='L1800'><font color='red'>}</font>
<a name='L1801'>
<a name='L1802'><i><font color='green'>/* This command implements ZRANGEBYSCORE, ZREVRANGEBYSCORE. */</font></i>
<a name='L1803'><b>void</b> <a href='../R/2032.html' title='Multiple refered from 2 places.'>genericZrangebyscoreCommand</a>(redisClient *c, <b>int</b> reverse) <font color='red'>{</font>
<a name='L1804'>    <a href='../S/32.html#L925' title='Defined at 925 in src/redis.h.'>zrangespec</a> range;
<a name='L1805'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L1806'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L1807'>    <b>long</b> offset = 0, limit = -1;
<a name='L1808'>    <b>int</b> withscores = 0;
<a name='L1809'>    <b>unsigned</b> <b>long</b> rangelen = 0;
<a name='L1810'>    <b>void</b> *replylen = NULL;
<a name='L1811'>    <b>int</b> minidx, maxidx;
<a name='L1812'>
<a name='L1813'>    <i><font color='green'>/* Parse the range arguments. */</font></i>
<a name='L1814'>    <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1815'>        <i><font color='green'>/* Range is given as [max,min] */</font></i>
<a name='L1816'>        maxidx = 2; minidx = 3;
<a name='L1817'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1818'>        <i><font color='green'>/* Range is given as [min,max] */</font></i>
<a name='L1819'>        minidx = 2; maxidx = 3;
<a name='L1820'>    <font color='red'>}</font>
<a name='L1821'>
<a name='L1822'>    <b>if</b> (<a href='../S/59.html#L398' title='Defined at 398 in src/t_zset.c.'>zslParseRange</a>(c-&gt;argv[minidx],c-&gt;argv[maxidx],&amp;range) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <font color='red'>{</font>
<a name='L1823'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"min or max is not a float");
<a name='L1824'>        <b>return</b>;
<a name='L1825'>    <font color='red'>}</font>
<a name='L1826'>
<a name='L1827'>    <i><font color='green'>/* Parse optional extra arguments. Note that ZCOUNT will exactly have</font></i>
<a name='L1828'><i><font color='green'>     * 4 arguments, so we'll never enter the following code path. */</font></i>
<a name='L1829'>    <b>if</b> (c-&gt;argc &gt; 4) <font color='red'>{</font>
<a name='L1830'>        <b>int</b> remaining = c-&gt;argc - 4;
<a name='L1831'>        <b>int</b> <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> = 4;
<a name='L1832'>
<a name='L1833'>        <b>while</b> (remaining) <font color='red'>{</font>
<a name='L1834'>            <b>if</b> (remaining &gt;= 1 &amp;&amp; !strcasecmp(c-&gt;argv[<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>]-&gt;ptr,"withscores")) <font color='red'>{</font>
<a name='L1835'>                <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>++; remaining--;
<a name='L1836'>                withscores = 1;
<a name='L1837'>            <font color='red'>}</font> <b>else</b> <b>if</b> (remaining &gt;= 3 &amp;&amp; !strcasecmp(c-&gt;argv[<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>]-&gt;ptr,"limit")) <font color='red'>{</font>
<a name='L1838'>                <b>if</b> ((<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c, c-&gt;argv[<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>+1], &amp;offset, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) ||
<a name='L1839'>                    (<a href='../S/71.html#L498' title='Defined at 498 in src/object.c.'>getLongFromObjectOrReply</a>(c, c-&gt;argv[<a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a>+2], &amp;limit, NULL) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>)) <b>return</b>;
<a name='L1840'>                <a href='../S/55.html#L107' title='Defined at 107 in src/redis-check-dump.c.'>pos</a> += 3; remaining -= 3;
<a name='L1841'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1842'>                <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.syntaxerr);
<a name='L1843'>                <b>return</b>;
<a name='L1844'>            <font color='red'>}</font>
<a name='L1845'>        <font color='red'>}</font>
<a name='L1846'>    <font color='red'>}</font>
<a name='L1847'>
<a name='L1848'>    <i><font color='green'>/* Ok, lookup the key and get the range */</font></i>
<a name='L1849'>    <b>if</b> ((zobj = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,key,shared.emptymultibulk)) == NULL ||
<a name='L1850'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L1851'>
<a name='L1852'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L1853'>        <b>unsigned</b> <b>char</b> *zl = zobj-&gt;ptr;
<a name='L1854'>        <b>unsigned</b> <b>char</b> *eptr, *sptr;
<a name='L1855'>        <b>unsigned</b> <b>char</b> *vstr;
<a name='L1856'>        <b>unsigned</b> <b>int</b> vlen;
<a name='L1857'>        <b>long</b> <b>long</b> vlong;
<a name='L1858'>        <b>double</b> score;
<a name='L1859'>
<a name='L1860'>        <i><font color='green'>/* If reversed, get the last node in range as starting point. */</font></i>
<a name='L1861'>        <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1862'>            eptr = <a href='../S/59.html#L578' title='Defined at 578 in src/t_zset.c.'>zzlLastInRange</a>(zl,range);
<a name='L1863'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1864'>            eptr = <a href='../S/59.html#L550' title='Defined at 550 in src/t_zset.c.'>zzlFirstInRange</a>(zl,range);
<a name='L1865'>        <font color='red'>}</font>
<a name='L1866'>
<a name='L1867'>        <i><font color='green'>/* No "first" element in the specified interval. */</font></i>
<a name='L1868'>        <b>if</b> (eptr == NULL) <font color='red'>{</font>
<a name='L1869'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.emptymultibulk);
<a name='L1870'>            <b>return</b>;
<a name='L1871'>        <font color='red'>}</font>
<a name='L1872'>
<a name='L1873'>        <i><font color='green'>/* Get score pointer for the first element. */</font></i>
<a name='L1874'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,eptr != NULL);
<a name='L1875'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L1876'>
<a name='L1877'>        <i><font color='green'>/* We don't know in advance how many matching elements there are in the</font></i>
<a name='L1878'><i><font color='green'>         * list, so we push this object that will represent the multi-bulk</font></i>
<a name='L1879'><i><font color='green'>         * length in the output buffer, and will "fix" it later */</font></i>
<a name='L1880'>        replylen = <a href='../S/86.html#L371' title='Defined at 371 in src/networking.c.'>addDeferredMultiBulkLength</a>(c);
<a name='L1881'>
<a name='L1882'>        <i><font color='green'>/* If there is an offset, just traverse the number of elements without</font></i>
<a name='L1883'><i><font color='green'>         * checking the score because that is done in the next loop. */</font></i>
<a name='L1884'>        <b>while</b> (eptr &amp;&amp; offset--) <font color='red'>{</font>
<a name='L1885'>            <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1886'>                <a href='../S/59.html#L505' title='Defined at 505 in src/t_zset.c.'>zzlPrev</a>(zl,&amp;eptr,&amp;sptr);
<a name='L1887'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1888'>                <a href='../S/59.html#L486' title='Defined at 486 in src/t_zset.c.'>zzlNext</a>(zl,&amp;eptr,&amp;sptr);
<a name='L1889'>            <font color='red'>}</font>
<a name='L1890'>        <font color='red'>}</font>
<a name='L1891'>
<a name='L1892'>        <b>while</b> (eptr &amp;&amp; limit--) <font color='red'>{</font>
<a name='L1893'>            score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L1894'>
<a name='L1895'>            <i><font color='green'>/* Abort when the node is no longer in range. */</font></i>
<a name='L1896'>            <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1897'>                <b>if</b> (!<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(score,&amp;range)) <b>break</b>;
<a name='L1898'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1899'>                <b>if</b> (!<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(score,&amp;range)) <b>break</b>;
<a name='L1900'>            <font color='red'>}</font>
<a name='L1901'>
<a name='L1902'>            <i><font color='green'>/* We know the element exists, so ziplistGet should always succeed */</font></i>
<a name='L1903'>            <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,<a href='../S/89.html#L746' title='Defined at 746 in src/ziplist.c.'>ziplistGet</a>(eptr,&amp;vstr,&amp;vlen,&amp;vlong));
<a name='L1904'>
<a name='L1905'>            rangelen++;
<a name='L1906'>            <b>if</b> (vstr == NULL) <font color='red'>{</font>
<a name='L1907'>                <a href='../S/86.html#L498' title='Defined at 498 in src/networking.c.'>addReplyBulkLongLong</a>(c,vlong);
<a name='L1908'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1909'>                <a href='../S/86.html#L482' title='Defined at 482 in src/networking.c.'>addReplyBulkCBuffer</a>(c,vstr,vlen);
<a name='L1910'>            <font color='red'>}</font>
<a name='L1911'>
<a name='L1912'>            <b>if</b> (withscores) <font color='red'>{</font>
<a name='L1913'>                <a href='../S/86.html#L407' title='Defined at 407 in src/networking.c.'>addReplyDouble</a>(c,score);
<a name='L1914'>            <font color='red'>}</font>
<a name='L1915'>
<a name='L1916'>            <i><font color='green'>/* Move to next node */</font></i>
<a name='L1917'>            <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1918'>                <a href='../S/59.html#L505' title='Defined at 505 in src/t_zset.c.'>zzlPrev</a>(zl,&amp;eptr,&amp;sptr);
<a name='L1919'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1920'>                <a href='../S/59.html#L486' title='Defined at 486 in src/t_zset.c.'>zzlNext</a>(zl,&amp;eptr,&amp;sptr);
<a name='L1921'>            <font color='red'>}</font>
<a name='L1922'>        <font color='red'>}</font>
<a name='L1923'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L1924'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L1925'>        <a href='../D/4581.html' title='Multiple defined in 2 places.'>zskiplist</a> *zsl = zs-&gt;zsl;
<a name='L1926'>        <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *ln;
<a name='L1927'>
<a name='L1928'>        <i><font color='green'>/* If reversed, get the last node in range as starting point. */</font></i>
<a name='L1929'>        <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1930'>            ln = <a href='../S/59.html#L264' title='Defined at 264 in src/t_zset.c.'>zslLastInRange</a>(zsl,range);
<a name='L1931'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1932'>            ln = <a href='../S/59.html#L238' title='Defined at 238 in src/t_zset.c.'>zslFirstInRange</a>(zsl,range);
<a name='L1933'>        <font color='red'>}</font>
<a name='L1934'>
<a name='L1935'>        <i><font color='green'>/* No "first" element in the specified interval. */</font></i>
<a name='L1936'>        <b>if</b> (ln == NULL) <font color='red'>{</font>
<a name='L1937'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.emptymultibulk);
<a name='L1938'>            <b>return</b>;
<a name='L1939'>        <font color='red'>}</font>
<a name='L1940'>
<a name='L1941'>        <i><font color='green'>/* We don't know in advance how many matching elements there are in the</font></i>
<a name='L1942'><i><font color='green'>         * list, so we push this object that will represent the multi-bulk</font></i>
<a name='L1943'><i><font color='green'>         * length in the output buffer, and will "fix" it later */</font></i>
<a name='L1944'>        replylen = <a href='../S/86.html#L371' title='Defined at 371 in src/networking.c.'>addDeferredMultiBulkLength</a>(c);
<a name='L1945'>
<a name='L1946'>        <i><font color='green'>/* If there is an offset, just traverse the number of elements without</font></i>
<a name='L1947'><i><font color='green'>         * checking the score because that is done in the next loop. */</font></i>
<a name='L1948'>        <b>while</b> (ln &amp;&amp; offset--) <font color='red'>{</font>
<a name='L1949'>            <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1950'>                ln = ln-&gt;backward;
<a name='L1951'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1952'>                ln = ln-&gt;level[0].forward;
<a name='L1953'>            <font color='red'>}</font>
<a name='L1954'>        <font color='red'>}</font>
<a name='L1955'>
<a name='L1956'>        <b>while</b> (ln &amp;&amp; limit--) <font color='red'>{</font>
<a name='L1957'>            <i><font color='green'>/* Abort when the node is no longer in range. */</font></i>
<a name='L1958'>            <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1959'>                <b>if</b> (!<a href='../S/59.html#L211' title='Defined at 211 in src/t_zset.c.'>zslValueGteMin</a>(ln-&gt;score,&amp;range)) <b>break</b>;
<a name='L1960'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1961'>                <b>if</b> (!<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(ln-&gt;score,&amp;range)) <b>break</b>;
<a name='L1962'>            <font color='red'>}</font>
<a name='L1963'>
<a name='L1964'>            rangelen++;
<a name='L1965'>            <a href='../S/86.html#L475' title='Defined at 475 in src/networking.c.'>addReplyBulk</a>(c,ln-&gt;obj);
<a name='L1966'>
<a name='L1967'>            <b>if</b> (withscores) <font color='red'>{</font>
<a name='L1968'>                <a href='../S/86.html#L407' title='Defined at 407 in src/networking.c.'>addReplyDouble</a>(c,ln-&gt;score);
<a name='L1969'>            <font color='red'>}</font>
<a name='L1970'>
<a name='L1971'>            <i><font color='green'>/* Move to next node */</font></i>
<a name='L1972'>            <b>if</b> (reverse) <font color='red'>{</font>
<a name='L1973'>                ln = ln-&gt;backward;
<a name='L1974'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1975'>                ln = ln-&gt;level[0].forward;
<a name='L1976'>            <font color='red'>}</font>
<a name='L1977'>        <font color='red'>}</font>
<a name='L1978'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1979'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L1980'>    <font color='red'>}</font>
<a name='L1981'>
<a name='L1982'>    <b>if</b> (withscores) <font color='red'>{</font>
<a name='L1983'>        rangelen *= 2;
<a name='L1984'>    <font color='red'>}</font>
<a name='L1985'>
<a name='L1986'>    <a href='../S/86.html#L381' title='Defined at 381 in src/networking.c.'>setDeferredMultiBulkLength</a>(c, replylen, rangelen);
<a name='L1987'><font color='red'>}</font>
<a name='L1988'>
<a name='L1989'><b>void</b> <a href='../R/4174.html' title='Multiple refered from 2 places.'>zrangebyscoreCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1990'>    <a href='../S/59.html#L1803' title='Defined at 1803 in src/t_zset.c.'>genericZrangebyscoreCommand</a>(c,0);
<a name='L1991'><font color='red'>}</font>
<a name='L1992'>
<a name='L1993'><b>void</b> <a href='../R/4183.html' title='Multiple refered from 2 places.'>zrevrangebyscoreCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1994'>    <a href='../S/59.html#L1803' title='Defined at 1803 in src/t_zset.c.'>genericZrangebyscoreCommand</a>(c,1);
<a name='L1995'><font color='red'>}</font>
<a name='L1996'>
<a name='L1997'><b>void</b> <a href='../R/4101.html' title='Multiple refered from 2 places.'>zcountCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L1998'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L1999'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L2000'>    <a href='../S/32.html#L925' title='Defined at 925 in src/redis.h.'>zrangespec</a> range;
<a name='L2001'>    <b>int</b> count = 0;
<a name='L2002'>
<a name='L2003'>    <i><font color='green'>/* Parse the range arguments */</font></i>
<a name='L2004'>    <b>if</b> (<a href='../S/59.html#L398' title='Defined at 398 in src/t_zset.c.'>zslParseRange</a>(c-&gt;argv[2],c-&gt;argv[3],&amp;range) != <a href='../D/848.html' title='Multiple defined in 2 places.'>REDIS_OK</a>) <font color='red'>{</font>
<a name='L2005'>        <a href='../S/86.html#L330' title='Defined at 330 in src/networking.c.'>addReplyError</a>(c,"min or max is not a float");
<a name='L2006'>        <b>return</b>;
<a name='L2007'>    <font color='red'>}</font>
<a name='L2008'>
<a name='L2009'>    <i><font color='green'>/* Lookup the sorted set */</font></i>
<a name='L2010'>    <b>if</b> ((zobj = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c, key, shared.czero)) == NULL ||
<a name='L2011'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c, zobj, <a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L2012'>
<a name='L2013'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L2014'>        <b>unsigned</b> <b>char</b> *zl = zobj-&gt;ptr;
<a name='L2015'>        <b>unsigned</b> <b>char</b> *eptr, *sptr;
<a name='L2016'>        <b>double</b> score;
<a name='L2017'>
<a name='L2018'>        <i><font color='green'>/* Use the first element in range as the starting point */</font></i>
<a name='L2019'>        eptr = <a href='../S/59.html#L550' title='Defined at 550 in src/t_zset.c.'>zzlFirstInRange</a>(zl,range);
<a name='L2020'>
<a name='L2021'>        <i><font color='green'>/* No "first" element */</font></i>
<a name='L2022'>        <b>if</b> (eptr == NULL) <font color='red'>{</font>
<a name='L2023'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c, shared.czero);
<a name='L2024'>            <b>return</b>;
<a name='L2025'>        <font color='red'>}</font>
<a name='L2026'>
<a name='L2027'>        <i><font color='green'>/* First element is in range */</font></i>
<a name='L2028'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L2029'>        score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L2030'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(score,&amp;range));
<a name='L2031'>
<a name='L2032'>        <i><font color='green'>/* Iterate over elements in range */</font></i>
<a name='L2033'>        <b>while</b> (eptr) <font color='red'>{</font>
<a name='L2034'>            score = <a href='../S/59.html#L438' title='Defined at 438 in src/t_zset.c.'>zzlGetScore</a>(sptr);
<a name='L2035'>
<a name='L2036'>            <i><font color='green'>/* Abort when the node is no longer in range. */</font></i>
<a name='L2037'>            <b>if</b> (!<a href='../S/59.html#L215' title='Defined at 215 in src/t_zset.c.'>zslValueLteMax</a>(score,&amp;range)) <font color='red'>{</font>
<a name='L2038'>                <b>break</b>;
<a name='L2039'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2040'>                count++;
<a name='L2041'>                <a href='../S/59.html#L486' title='Defined at 486 in src/t_zset.c.'>zzlNext</a>(zl,&amp;eptr,&amp;sptr);
<a name='L2042'>            <font color='red'>}</font>
<a name='L2043'>        <font color='red'>}</font>
<a name='L2044'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L2045'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L2046'>        <a href='../D/4581.html' title='Multiple defined in 2 places.'>zskiplist</a> *zsl = zs-&gt;zsl;
<a name='L2047'>        <a href='../D/4582.html' title='Multiple defined in 2 places.'>zskiplistNode</a> *zn;
<a name='L2048'>        <b>unsigned</b> <b>long</b> rank;
<a name='L2049'>
<a name='L2050'>        <i><font color='green'>/* Find first element in range */</font></i>
<a name='L2051'>        zn = <a href='../S/59.html#L238' title='Defined at 238 in src/t_zset.c.'>zslFirstInRange</a>(zsl, range);
<a name='L2052'>
<a name='L2053'>        <i><font color='green'>/* Use rank of first element, if any, to determine preliminary count */</font></i>
<a name='L2054'>        <b>if</b> (zn != NULL) <font color='red'>{</font>
<a name='L2055'>            rank = <a href='../S/59.html#L354' title='Defined at 354 in src/t_zset.c.'>zslGetRank</a>(zsl, zn-&gt;score, zn-&gt;obj);
<a name='L2056'>            count = (zsl-&gt;length - (rank - 1));
<a name='L2057'>
<a name='L2058'>            <i><font color='green'>/* Find last element in range */</font></i>
<a name='L2059'>            zn = <a href='../S/59.html#L264' title='Defined at 264 in src/t_zset.c.'>zslLastInRange</a>(zsl, range);
<a name='L2060'>
<a name='L2061'>            <i><font color='green'>/* Use rank of last element, if any, to determine the actual count */</font></i>
<a name='L2062'>            <b>if</b> (zn != NULL) <font color='red'>{</font>
<a name='L2063'>                rank = <a href='../S/59.html#L354' title='Defined at 354 in src/t_zset.c.'>zslGetRank</a>(zsl, zn-&gt;score, zn-&gt;obj);
<a name='L2064'>                count -= (zsl-&gt;length - rank);
<a name='L2065'>            <font color='red'>}</font>
<a name='L2066'>        <font color='red'>}</font>
<a name='L2067'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2068'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L2069'>    <font color='red'>}</font>
<a name='L2070'>
<a name='L2071'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c, count);
<a name='L2072'><font color='red'>}</font>
<a name='L2073'>
<a name='L2074'><b>void</b> <a href='../R/4100.html' title='Multiple refered from 2 places.'>zcardCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L2075'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L2076'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L2077'>
<a name='L2078'>    <b>if</b> ((zobj = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,key,shared.czero)) == NULL ||
<a name='L2079'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L2080'>
<a name='L2081'>    <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,<a href='../S/59.html#L748' title='Defined at 748 in src/t_zset.c.'>zsetLength</a>(zobj));
<a name='L2082'><font color='red'>}</font>
<a name='L2083'>
<a name='L2084'><b>void</b> <a href='../R/4185.html' title='Multiple refered from 2 places.'>zscoreCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L2085'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L2086'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L2087'>    <b>double</b> score;
<a name='L2088'>
<a name='L2089'>    <b>if</b> ((zobj = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,key,shared.nullbulk)) == NULL ||
<a name='L2090'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L2091'>
<a name='L2092'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L2093'>        <b>if</b> (<a href='../S/59.html#L609' title='Defined at 609 in src/t_zset.c.'>zzlFind</a>(zobj-&gt;ptr,c-&gt;argv[2],&amp;score) != NULL)
<a name='L2094'>            <a href='../S/86.html#L407' title='Defined at 407 in src/networking.c.'>addReplyDouble</a>(c,score);
<a name='L2095'>        <b>else</b>
<a name='L2096'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullbulk);
<a name='L2097'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L2098'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L2099'>        <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L2100'>
<a name='L2101'>        c-&gt;argv[2] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[2]);
<a name='L2102'>        de = <a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,c-&gt;argv[2]);
<a name='L2103'>        <b>if</b> (de != NULL) <font color='red'>{</font>
<a name='L2104'>            score = *(<b>double</b>*)<a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de);
<a name='L2105'>            <a href='../S/86.html#L407' title='Defined at 407 in src/networking.c.'>addReplyDouble</a>(c,score);
<a name='L2106'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2107'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullbulk);
<a name='L2108'>        <font color='red'>}</font>
<a name='L2109'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2110'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L2111'>    <font color='red'>}</font>
<a name='L2112'><font color='red'>}</font>
<a name='L2113'>
<a name='L2114'><b>void</b> <a href='../R/4177.html' title='Multiple refered from 2 places.'>zrankGenericCommand</a>(redisClient *c, <b>int</b> reverse) <font color='red'>{</font>
<a name='L2115'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *key = c-&gt;argv[1];
<a name='L2116'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *ele = c-&gt;argv[2];
<a name='L2117'>    <a href='../S/32.html#L318' title='Defined at 318 in src/redis.h.'>robj</a> *zobj;
<a name='L2118'>    <b>unsigned</b> <b>long</b> llen;
<a name='L2119'>    <b>unsigned</b> <b>long</b> rank;
<a name='L2120'>
<a name='L2121'>    <b>if</b> ((zobj = <a href='../S/31.html#L75' title='Defined at 75 in src/db.c.'>lookupKeyReadOrReply</a>(c,key,shared.nullbulk)) == NULL ||
<a name='L2122'>        <a href='../D/1818.html' title='Multiple defined in 2 places.'>checkType</a>(c,zobj,<a href='../D/933.html' title='Multiple defined in 2 places.'>REDIS_ZSET</a>)) <b>return</b>;
<a name='L2123'>    llen = <a href='../S/59.html#L748' title='Defined at 748 in src/t_zset.c.'>zsetLength</a>(zobj);
<a name='L2124'>
<a name='L2125'>    <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,ele,ele-&gt;encoding == <a href='../D/789.html' title='Multiple defined in 2 places.'>REDIS_ENCODING_RAW</a>);
<a name='L2126'>    <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L135' title='Defined at 135 in src/redis.h.'>REDIS_ENCODING_ZIPLIST</a>) <font color='red'>{</font>
<a name='L2127'>        <b>unsigned</b> <b>char</b> *zl = zobj-&gt;ptr;
<a name='L2128'>        <b>unsigned</b> <b>char</b> *eptr, *sptr;
<a name='L2129'>
<a name='L2130'>        eptr = <a href='../S/89.html#L677' title='Defined at 677 in src/ziplist.c.'>ziplistIndex</a>(zl,0);
<a name='L2131'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,eptr != NULL);
<a name='L2132'>        sptr = <a href='../S/89.html#L705' title='Defined at 705 in src/ziplist.c.'>ziplistNext</a>(zl,eptr);
<a name='L2133'>        <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,zobj,sptr != NULL);
<a name='L2134'>
<a name='L2135'>        rank = 1;
<a name='L2136'>        <b>while</b>(eptr != NULL) <font color='red'>{</font>
<a name='L2137'>            <b>if</b> (<a href='../S/89.html#L792' title='Defined at 792 in src/ziplist.c.'>ziplistCompare</a>(eptr,ele-&gt;ptr,<a href='../D/4011.html' title='Multiple defined in 2 places.'>sdslen</a>(ele-&gt;ptr)))
<a name='L2138'>                <b>break</b>;
<a name='L2139'>            rank++;
<a name='L2140'>            <a href='../S/59.html#L486' title='Defined at 486 in src/t_zset.c.'>zzlNext</a>(zl,&amp;eptr,&amp;sptr);
<a name='L2141'>        <font color='red'>}</font>
<a name='L2142'>
<a name='L2143'>        <b>if</b> (eptr != NULL) <font color='red'>{</font>
<a name='L2144'>            <b>if</b> (reverse)
<a name='L2145'>                <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,llen-rank);
<a name='L2146'>            <b>else</b>
<a name='L2147'>                <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,rank-1);
<a name='L2148'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2149'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullbulk);
<a name='L2150'>        <font color='red'>}</font>
<a name='L2151'>    <font color='red'>}</font> <b>else</b> <b>if</b> (zobj-&gt;encoding == <a href='../S/32.html#L137' title='Defined at 137 in src/redis.h.'>REDIS_ENCODING_SKIPLIST</a>) <font color='red'>{</font>
<a name='L2152'>        <a href='../D/4576.html' title='Multiple defined in 2 places.'>zset</a> *zs = zobj-&gt;ptr;
<a name='L2153'>        <a href='../D/4581.html' title='Multiple defined in 2 places.'>zskiplist</a> *zsl = zs-&gt;zsl;
<a name='L2154'>        <a href='../D/2073.html' title='Multiple defined in 4 places.'>dictEntry</a> *de;
<a name='L2155'>        <b>double</b> score;
<a name='L2156'>
<a name='L2157'>        ele = c-&gt;argv[2] = <a href='../S/71.html#L273' title='Defined at 273 in src/object.c.'>tryObjectEncoding</a>(c-&gt;argv[2]);
<a name='L2158'>        de = <a href='../D/2076.html' title='Multiple defined in 2 places.'>dictFind</a>(zs-&gt;<a href='../D/2060.html' title='Multiple defined in 4 places.'>dict</a>,ele);
<a name='L2159'>        <b>if</b> (de != NULL) <font color='red'>{</font>
<a name='L2160'>            score = *(<b>double</b>*)<a href='../S/88.html#L132' title='Defined at 132 in src/dict.h.'>dictGetVal</a>(de);
<a name='L2161'>            rank = <a href='../S/59.html#L354' title='Defined at 354 in src/t_zset.c.'>zslGetRank</a>(zsl,score,ele);
<a name='L2162'>            <a href='../S/32.html#L298' title='Defined at 298 in src/redis.h.'>redisAssertWithInfo</a>(c,ele,rank); <i><font color='green'>/* Existing elements always have a rank. */</font></i>
<a name='L2163'>            <b>if</b> (reverse)
<a name='L2164'>                <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,llen-rank);
<a name='L2165'>            <b>else</b>
<a name='L2166'>                <a href='../S/86.html#L439' title='Defined at 439 in src/networking.c.'>addReplyLongLong</a>(c,rank-1);
<a name='L2167'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2168'>            <a href='../S/86.html#L268' title='Defined at 268 in src/networking.c.'>addReply</a>(c,shared.nullbulk);
<a name='L2169'>        <font color='red'>}</font>
<a name='L2170'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2171'>        <a href='../S/32.html#L300' title='Defined at 300 in src/redis.h.'>redisPanic</a>("Unknown sorted set encoding");
<a name='L2172'>    <font color='red'>}</font>
<a name='L2173'><font color='red'>}</font>
<a name='L2174'>
<a name='L2175'><b>void</b> <a href='../R/4176.html' title='Multiple refered from 2 places.'>zrankCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L2176'>    <a href='../S/59.html#L2114' title='Defined at 2114 in src/t_zset.c.'>zrankGenericCommand</a>(c, 0);
<a name='L2177'><font color='red'>}</font>
<a name='L2178'>
<a name='L2179'><b>void</b> <a href='../R/4184.html' title='Multiple refered from 2 places.'>zrevrankCommand</a>(redisClient *c) <font color='red'>{</font>
<a name='L2180'>    <a href='../S/59.html#L2114' title='Defined at 2114 in src/t_zset.c.'>zrankGenericCommand</a>(c, 1);
<a name='L2181'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L55'>[^]</a><a href='#L2179'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
